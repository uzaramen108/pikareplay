"use strict";(self.webpackChunkpikachu_volleyball_p2p_online=self.webpackChunkpikachu_volleyball_p2p_online||[]).push([[293],{5128:(e,t,o)=>{var s=o(4603),i=o(6787),n=o(592),a=o(3650),l=o(9449),c=o(7561),r=o(7049),d=o(3401),h=o(8077),p=o(4697),m=o(8505),u=(o(7229),o(6090)),g=o(7391),y=o.n(g),k=o(94),E=o(5716),b=o(653),C=o(7147),I=o(6806),R=o(1674),S=o(4805),P=o(6212),w=o(6970);const v=new class{constructor(){n.A4.registerPlugin("prepare",a.p8),n.A4.registerPlugin("batch",n.ch),h.KB.registerPlugin("prepare",m.S),h.KB.registerPlugin("sprite",p.$),c.aH.registerPlugin(r.A),s.W.RESOLUTION=2,s.W.SCALE_MODE=i.M6.NEAREST,s.W.ROUND_PIXELS=!0,this.ticker=new d.Rv,this.ticker.minFPS=1,this.renderer=(0,n.q5)({width:432,height:304,antialias:!1,backgroundColor:0,backgroundAlpha:1,forceCanvas:!0,preserveDrawingBuffer:!0}),this.stage=new l.mc,this.loader=new c.aH,this.pikaVolley=null,this.playBackSpeedTimes=1,this.playBackSpeedFPS=null}readFile(e){const t=u.I.TEXTURES;t.WITH_COMPUTER=t.WITH_FRIEND,document.querySelector("#game-canvas-container").appendChild(this.renderer.view),this.renderer.render(this.stage),this.ticker.add((()=>{this.renderer.render(this.stage),U(this.pikaVolley.timeCurrent),this.pikaVolley.gameLoop()})),this.pikaVolley.replayFrameCounter>=this.pikaVolley.inputs.length&&(this.ticker.stop(),window.dispatchEvent(new Event("pikaReplayFinished"))),this.loader.add(u.I.SPRITE_SHEET);for(const e in u.I.SOUNDS)this.loader.add(u.I.SOUNDS[e]);!function(e){const t=document.getElementById("loading-box"),o=document.getElementById("progress-bar");e.onProgress.add((()=>{o.style.width=`${e.progress}%`})),e.onComplete.add((()=>{t.classList.add("hidden")}))}(this.loader);const o=new FileReader;o.onload=e=>{let t,o;try{t=JSON.parse(e.target.result),o=t.pack;const s=o.hash;if(o.hash=0,s!==(0,w.i)((0,P.l)(o)))throw"Error: The file content is not matching the hash code"}catch(e){return console.log(e),void L()}var s;s=function(e){const t=[];let o=0,s=e.options[o];for(;s;){if(s[1].speed){let e=null;switch(s[1].speed){case"slow":e=20;break;case"medium":e=25;break;case"fast":e=30}const o=s[0];t.push([o,e])}o++,s=e.options[o]}let i=0,n=0,a=25;for(let e=0;e<t.length;e++){const o=t[e][0];i+=(o-n)/a,n=o,a=t[e][1]}return i+=(e.inputs.length-n)/a,i}(o),document.getElementById("time-duration").textContent=H(s),this.loader.load((()=>{var e;this.pikaVolley=new G(this.stage,this.loader.resources,o.roomID,o.nicknames,o.partialPublicIPs,o.inputs,o.options,o.chats),(0,b.yg)(this.pikaVolley),e=o.inputs.length,B.max=e,this.seekFrame(0),this.ticker.start(),function(){const e=document.getElementById("play-pause-btn");v.ticker.started?e.textContent=document.getElementById("pause-mark").textContent:e.textContent=document.getElementById("play-mark").textContent}(),B.disabled=!1,O.disabled=!1,D.disabled=!1,f.disabled=!1,T.disabled=!1,x.disabled=!1,A.disabled=!1,M.disabled=!1,N.disabled=!1,V.disabled=!1,window.dispatchEvent(new Event("pikaReplayLoaded"))}))};try{o.readAsText(e)}catch(e){return console.log(e),void L()}}seekFrame(e){if((0,b.lD)(),document.getElementById("notice-end-of-replay").classList.add("hidden"),this.ticker.stop(),this.pikaVolley.initializeForReplay(),e>0){for(let t=0;t<e;t++)this.pikaVolley.gameLoopSilent();this.renderer.render(this.stage)}U(this.pikaVolley.timeCurrent)}seekRelativeTime(e){const t=Math.max(0,this.pikaVolley.replayFrameCounter+e*this.pikaVolley.normalFPS);this.seekFrame(t)}adjustPlaybackSpeedTimes(e){this.playBackSpeedFPS=null,this.playBackSpeedTimes=e,this.ticker.maxFPS=this.pikaVolley.normalFPS*this.playBackSpeedTimes,F()}adjustPlaybackSpeedFPS(e){this.playBackSpeedTimes=null,this.playBackSpeedFPS=e,this.ticker.maxFPS=this.playBackSpeedFPS,F()}stopBGM(){this.pikaVolley.audio.sounds.bgm.center.stop()}playBGMProperly(){this.pikaVolley.isBGMPlaying&&this.pikaVolley.audio.sounds.bgm.center.play({start:this.pikaVolley.timeBGM})}},B=document.getElementById("scrubber-range-input"),O=document.getElementById("play-pause-btn"),D=document.getElementById("seek-backward-1"),f=document.getElementById("seek-forward-1"),T=document.getElementById("seek-backward-3"),x=document.getElementById("seek-forward-3"),A=document.getElementById("speed-btn-5-fps"),M=document.getElementById("speed-btn-half-times"),N=document.getElementById("speed-btn-1-times"),V=document.getElementById("speed-btn-2-times");function F(){document.getElementById("fps-input").value=v.ticker.maxFPS}function L(){document.getElementById("notice-file-open-error").classList.remove("hidden")}function U(e){document.getElementById("time-current").textContent=H(e)}function H(e){const t=Math.floor(e%60),o=Math.floor(e/60)%60,s=Math.floor(Math.floor(e/60)/60);return s>0?`${String(s)}:${("0"+o).slice(-2)}:${("0"+t).slice(-2)}`:`${String(o)}:${("0"+t).slice(-2)}`}class G extends k.q{constructor(e,t,o,s,i,n,a,l){super(e,t),this.noInputFrameTotal.menu=1/0,this.roomId=o,this.nicknames=s,this.partialPublicIPs=i,this.inputs=n,this.options=a,this.chats=l,this.player1Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:()=>{}},this.player2Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:()=>{}},this.keyboardArray=[this.player1Keyboard,this.player2Keyboard],this.willDisplayChat=!0;const c={play:()=>{},stop:()=>{}};this.fakeAudio={sounds:{bgm:{fake:!0,center:{isPlaying:!1},play:function(){this.center.isPlaying=!0},stop:function(){this.center.isPlaying=!1}},pipikachu:c,pika:c,chu:c,pi:c,pikachu:c,powerHit:c,ballTouchesGround:c}},this.initializeForReplay()}initializeForReplay(){for(const e in this.audio.sounds)this.audio.sounds[e].stop();this.timeCurrent=0,this.timeBGM=0,this.isBGMPlaying=!1,this.replayFrameCounter=0,this.chatCounter=0,this.optionsCounter=0;const e=y().alea(this.roomId.slice(10));(0,E.p)(e);const t=y().alea(this.roomId.slice(10,15)),o=y().alea(this.roomId.slice(15));(0,b.pt)(t,o),this.view.game.cloudArray=[];for(let e=0;e<10;e++)this.view.game.cloudArray.push(new I.Es);this.view.game.wave=new I.wH,this.view.intro.visible=!1,this.view.menu.visible=!1,this.view.game.visible=!1,this.view.fadeInOut.visible=!1,this.physics=new R.vW(!0,!0),this.normalFPS=25,this.slowMotionFPS=5,this.SLOW_MOTION_FRAMES_NUM=6,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.selectedWithWho=0,this.scores=[0,0],this.winningScore=15,this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.frameCounter=0,this.noInputFrameCounter=0,this.paused=!1,this.isStereoSound=!0,this._isPracticeMode=!1,this.isRoomCreatorPlayer2=!1,this.state=this.intro}intro(){0===this.frameCounter&&(this.selectedWithWho=0,this.nicknames&&((0,C.sb)(this.nicknames[0],this.isRoomCreatorPlayer2),(0,C.sb)(this.nicknames[1],!this.isRoomCreatorPlayer2)),this.partialPublicIPs&&((0,C.UI)(this.partialPublicIPs[0],this.isRoomCreatorPlayer2),(0,C.UI)(this.partialPublicIPs[1],!this.isRoomCreatorPlayer2))),super.intro()}menu(){const e=this.selectedWithWho;super.menu(),this.selectedWithWho!==e&&(this.isRoomCreatorPlayer2=!this.isRoomCreatorPlayer2,this.nicknames&&((0,C.sb)(this.nicknames[0],this.isRoomCreatorPlayer2),(0,C.sb)(this.nicknames[1],!this.isRoomCreatorPlayer2)),this.partialPublicIPs&&((0,C.UI)(this.partialPublicIPs[0],this.isRoomCreatorPlayer2),(0,C.UI)(this.partialPublicIPs[1],!this.isRoomCreatorPlayer2)))}gameLoopSilent(){const e=this.audio;this.willDisplayChat=!1,this.audio=this.fakeAudio,this.gameLoop(),this.willDisplayChat=!0,this.audio=e}gameLoop(){if(this.replayFrameCounter>=this.inputs.length)return void document.getElementById("notice-end-of-replay").classList.remove("hidden");var e;e=this.replayFrameCounter,B.value=e;const t=this.inputs[this.replayFrameCounter],o=(0,S.d)(t>>>5),s=(0,S.d)(t%32);this.player1Keyboard.xDirection=o.xDirection,this.player1Keyboard.yDirection=o.yDirection,this.player1Keyboard.powerHit=o.powerHit,this.player2Keyboard.xDirection=s.xDirection,this.player2Keyboard.yDirection=s.yDirection,this.player2Keyboard.powerHit=s.powerHit,function(e,t){const o=document.getElementById("z-key"),s=document.getElementById("r-key"),i=document.getElementById("v-key"),n=document.getElementById("d-key"),a=document.getElementById("g-key"),l=document.getElementById("enter-key"),c=document.getElementById("up-key"),r=document.getElementById("down-key"),d=document.getElementById("left-key"),h=document.getElementById("right-key");function p(e){e.classList.add("pressed")}function m(e){e.classList.remove("pressed")}switch(e.xDirection){case 0:m(n),m(a);break;case-1:p(n),m(a);break;case 1:m(n),p(a)}switch(e.yDirection){case 0:m(s),m(i);break;case-1:p(s),m(i);break;case 1:m(s),p(i)}switch(e.powerHit){case 0:m(o);break;case 1:p(o)}switch(t.xDirection){case 0:m(d),m(h);break;case-1:p(d),m(h);break;case 1:m(d),p(h)}switch(t.yDirection){case 0:m(c),m(r);break;case-1:p(c),m(r);break;case 1:m(c),p(r)}switch(t.powerHit){case 0:m(l);break;case 1:p(l)}}(o,s);let i=this.options[this.optionsCounter];for(;i&&i[0]===this.replayFrameCounter;){if(i[1].speed){switch(i[1].speed){case"slow":this.normalFPS=20;break;case"medium":this.normalFPS=25;break;case"fast":this.normalFPS=30}n=this.normalFPS,v.playBackSpeedFPS?(v.ticker.maxFPS=v.playBackSpeedFPS,F()):v.playBackSpeedTimes&&(v.ticker.maxFPS=n*v.playBackSpeedTimes,F())}if(i[1].winningScore)switch(i[1].winningScore){case 5:this.winningScore=5;break;case 10:this.winningScore=10;break;case 15:this.winningScore=15}this.optionsCounter++,i=this.options[this.optionsCounter]}var n;this.timeCurrent+=1/this.normalFPS,this.isBGMPlaying=this.audio.sounds.bgm.center.isPlaying,this.isBGMPlaying?this.timeBGM=(this.timeBGM+1/this.normalFPS)%83:this.timeBGM=0;let a=this.chats[this.chatCounter];for(;a&&a[0]===this.replayFrameCounter;)this.willDisplayChat&&(0,b.rE)(a[2],a[1]),this.chatCounter++,a=this.chats[this.chatCounter];this.replayFrameCounter++,this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,super.gameLoop()}}console.log("ğŸ¬ [INIT] main_out.js loaded"),function(){console.log("ğŸ”§ [ASSETS] Adjusting assets path..."),u.I.SPRITE_SHEET="../"+u.I.SPRITE_SHEET;for(const e in u.I.SOUNDS)u.I.SOUNDS[e]="../"+u.I.SOUNDS[e];console.log("âœ… [ASSETS] Assets path adjusted")}(),console.log("ğŸ¬ [INIT] Initializing converter...");const _=new class{constructor(){console.log("ğŸ¬ [CONSTRUCTOR] Creating ReplayToVideoConverter"),n.A4.registerPlugin("prepare",a.p8),n.A4.registerPlugin("batch",n.ch),h.KB.registerPlugin("prepare",m.S),h.KB.registerPlugin("sprite",p.$),c.aH.registerPlugin(r.A),s.W.RESOLUTION=2,s.W.SCALE_MODE=i.M6.NEAREST,s.W.ROUND_PIXELS=!0,this.renderer=null,this.stage=null,this.loader=null,this.ticker=null,this.pikaVolley=null,this.currentPack=null,this.mediaRecorder=null,this.recordedChunks=[],this.isRecording=!1,this.audioDest=null,this.audioCtx=null,console.log("âœ… [CONSTRUCTOR] ReplayToVideoConverter created")}updateStatus(e){const t=document.getElementById("status");console.log(`ğŸ“ [STATUS] ${e}`),t&&(t.textContent=e)}handleRecordButtonClick(){if(console.log("ğŸ”˜ [BUTTON] Record button clicked"),this.isRecording)return console.warn("âš ï¸ [BUTTON] Already recording!"),void this.updateStatus("ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...");console.log("ğŸ“‚ [BUTTON] Opening file picker...");const e=document.createElement("input");e.type="file",e.accept=".txt",e.onchange=e=>{const t=e.target.files[0];console.log("ğŸ“„ [FILE] File selected:",t?.name),t&&this.loadReplayFile(t)},e.click()}loadReplayFile(e){console.log("ğŸ“¥ [LOAD] Loading replay file:",e.name),this.updateStatus("ë¦¬í”Œë ˆì´ íŒŒì¼ ë¡œë”© ì¤‘...");const t=document.getElementById("record-btn");console.log("ğŸ”˜ [LOAD] Record button element:",t),t&&(t.disabled=!0);const o=document.getElementById("loading-overlay");console.log("â³ [LOAD] Loading overlay element:",o),o&&(o.classList.remove("hidden"),console.log("âœ… [LOAD] Loading overlay shown"));const s=new FileReader;s.onload=e=>{console.log("ğŸ“– [LOAD] File read complete");try{const t=JSON.parse(e.target.result);console.log("ğŸ“¦ [LOAD] Pack parsed:",{hasNicknames:!!t.pack?.nicknames,nicknamesLength:t.pack?.nicknames?.length,nicknames:t.pack?.nicknames,hasIPs:!!t.pack?.partialPublicIPs,IPs:t.pack?.partialPublicIPs,hasChats:!!t.pack?.chats,chatsLength:t.pack?.chats?.length});const o=t.pack,s=o.hash;if(o.hash=0,s!==(0,w.i)((0,P.l)(o)))throw new Error("íŒŒì¼ ë‚´ìš©ì´ í•´ì‹œ ì½”ë“œì™€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤");console.log("âœ… [LOAD] Hash verification passed"),this.initializeRenderer(o)}catch(e){console.error("âŒ [LOAD] Error loading file:",e),this.updateStatus("íŒŒì¼ ë¡œë”© ì‹¤íŒ¨: "+e.message),t&&(t.disabled=!1),o&&o.classList.add("hidden")}},s.onerror=()=>{console.error("âŒ [LOAD] File read error"),this.updateStatus("íŒŒì¼ ì½ê¸° ì‹¤íŒ¨"),t&&(t.disabled=!1),o&&o.classList.add("hidden")},s.readAsText(e)}initializeRenderer(e){console.log("ğŸ¨ [RENDERER] Initializing renderer..."),this.updateStatus("ê²Œì„ ì—ì…‹ ë¡œë”© ì¤‘..."),this.currentPack=e,this.renderer=(0,n.q5)({width:432,height:304,antialias:!1,backgroundColor:0,backgroundAlpha:1,forceCanvas:!0,preserveDrawingBuffer:!0}),console.log("âœ… [RENDERER] Renderer created"),this.stage=new l.mc,this.ticker=new d.Rv,this.ticker.minFPS=1,this.loader=new c.aH,console.log("âœ… [RENDERER] Stage, ticker, loader created");const t=document.querySelector("#game-canvas-container");console.log("ğŸ“¦ [RENDERER] Game container element:",t),t.innerHTML="",t.appendChild(this.renderer.view),console.log("âœ… [RENDERER] Canvas appended to container");const o=u.I.TEXTURES;o.WITH_COMPUTER=o.WITH_FRIEND,this.loader.add(u.I.SPRITE_SHEET);for(const e in u.I.SOUNDS)this.loader.add(u.I.SOUNDS[e]);console.log("âœ… [RENDERER] Assets added to loader"),this.setupLoaderProgressBar(),this.loader.load((()=>this.setupGame(e))),console.log("ğŸ”„ [RENDERER] Loading assets...")}setupLoaderProgressBar(){const e=document.getElementById("progress-bar");console.log("ğŸ“Š [PROGRESS] Progress bar element:",e),e&&this.loader.onProgress.add((()=>{e.style.width=`${this.loader.progress}%`}))}setupAudioCapture(){console.log("ğŸµ [AUDIO] Setting up audio capture...");try{if(!this.pikaVolley||!this.pikaVolley.audio)return void console.error("âŒ [AUDIO] pikaVolley.audio not found");const e=this.pikaVolley.audio;console.log("ğŸ“Š [AUDIO] Audio object:",e),console.log("ğŸ“Š [AUDIO] Audio sounds:",e.sounds);for(const t in e.sounds){const o=e.sounds[t];if(console.log(`ğŸ”Š [AUDIO] Sound "${t}":`,o),o&&o._sounds&&o._sounds.length>0){const e=o._sounds[0];console.log(`ğŸ“Š [AUDIO] Howl sound for "${t}":`,e),e._node&&console.log(`âœ… [AUDIO] Found audio node for "${t}"`)}}"undefined"!=typeof Howler&&Howler.ctx&&(this.audioCtx=Howler.ctx,this.audioDest=this.audioCtx.createMediaStreamDestination(),Howler.masterGain&&(Howler.masterGain.connect(this.audioDest),console.log("âœ… [AUDIO] Connected to Howler.masterGain")))}catch(e){console.error("âŒ [AUDIO] Error:",e)}}setupGame(e){console.log("ğŸ® [GAME] Setting up game..."),console.log("ğŸ“¦ [GAME] Pack data:",{nicknames:e.nicknames,IPs:e.partialPublicIPs,chatsCount:e.chats?.length,inputsCount:e.inputs?.length}),this.updateStatus("ê²Œì„ ì´ˆê¸°í™” ì¤‘..."),console.log("ğŸ”¨ [DOM] Ensuring DOM elements exist...");const t=document.getElementById("game-canvas-container");if(t){if(!document.getElementById("player1-chat-box")){const e=document.createElement("div");e.id="player1-chat-box",e.className="chat-box pre-wrap",t.appendChild(e),console.log("âœ… [DOM] Created player1-chat-box")}if(!document.getElementById("player2-chat-box")){const e=document.createElement("div");e.id="player2-chat-box",e.className="chat-box pre-wrap",t.appendChild(e),console.log("âœ… [DOM] Created player2-chat-box")}if(!document.querySelector(".nicknames-container")){const e=document.createElement("div");e.className="nicknames-container";const o=document.createElement("div");o.className="nickname-and-partial-ip left";const s=document.createElement("span");s.id="player1-nickname",s.className="nickname";const i=document.createElement("span");i.id="player1-partial-ip",i.className="partial-ip",o.appendChild(s),o.appendChild(i);const n=document.createElement("div");n.className="nickname-and-partial-ip right";const a=document.createElement("span");a.id="player2-nickname",a.className="nickname";const l=document.createElement("span");l.id="player2-partial-ip",l.className="partial-ip",n.appendChild(a),n.appendChild(l),e.appendChild(o),e.appendChild(n),t.appendChild(e),console.log("âœ… [DOM] Created nicknames container")}if(!document.getElementById("player1-chat-disabled")){const e=document.createElement("div");e.id="player1-chat-disabled",e.className="hidden",t.appendChild(e),console.log("âœ… [DOM] Created player1-chat-disabled")}if(!document.getElementById("player2-chat-disabled")){const e=document.createElement("div");e.id="player2-chat-disabled",e.className="hidden",t.appendChild(e),console.log("âœ… [DOM] Created player2-chat-disabled")}}const o=e=>{if(!document.getElementById(e))return;const t=Node.prototype.replaceChild;Node.prototype.replaceChild=function(e,o){try{return t.call(this,e,o)}catch(t){try{this.appendChild(e)}catch(e){}return e}};const o=Node.prototype.removeChild;Node.prototype.removeChild=function(e){try{return o.call(this,e)}catch(e){return null}}};o("player1-chat-box"),o("player2-chat-box"),console.log("ğŸ›¡ï¸ [DOM] Chat box safety patch applied"),console.log("ğŸ” [DOM] Checking DOM elements...");const s=document.getElementById("player1-chat-box"),i=document.getElementById("player2-chat-box"),n=document.getElementById("player1-nickname"),a=document.getElementById("player2-nickname"),l=document.getElementById("player1-partial-ip"),c=document.getElementById("player2-partial-ip"),r=document.getElementById("player1-chat-disabled"),d=document.getElementById("player2-chat-disabled");console.log("ğŸ“‹ [DOM] Chat boxes:",{chatBox1:s,chatBox2:i}),console.log("ğŸ“‹ [DOM] Nicknames:",{nick1:n,nick2:a}),console.log("ğŸ“‹ [DOM] IPs:",{ip1:l,ip2:c}),console.log("ğŸ“‹ [DOM] Chat disabled:",{chatDisabled1:r,chatDisabled2:d}),console.log("ğŸ® [GAME] Creating PikachuVolleyballReplay..."),this.pikaVolley=new G(this.stage,this.loader.resources,e.roomID,e.nicknames,e.partialPublicIPs,e.inputs,e.options,e.chats),(0,b.yg)(this.pikaVolley),console.log("âœ… [GAME] PikachuVolleyballReplay created"),console.log("ğŸ’¬ [GAME] Setting speech bubble function..."),console.log("ğŸ’¬ [GAME] Enabling chat display..."),this.pikaVolley.willDisplayChat=!0;try{console.log("âœ… [GAME] Chat enabled")}catch(e){console.error("âŒ [GAME] Error enabling chat:",e)}console.log("â˜‘ï¸ [CHECKBOX] Activating checkboxes...");const h=document.getElementById("show-nicknames-checkbox"),p=document.getElementById("show-ip-addresses-checkbox"),m=document.getElementById("show-chat-checkbox");console.log("ğŸ“‹ [CHECKBOX] Checkbox elements:",{nicknames:h,ips:p,chat:m}),h?(console.log("â˜‘ï¸ [CHECKBOX] Activating nicknames checkbox..."),h.checked=!0,h.dispatchEvent(new Event("change")),console.log("âœ… [CHECKBOX] Nicknames checkbox activated, checked:",h.checked)):console.warn("âš ï¸ [CHECKBOX] Nicknames checkbox not found!"),p?(console.log("â˜‘ï¸ [CHECKBOX] Activating IPs checkbox..."),p.checked=!0,p.dispatchEvent(new Event("change")),console.log("âœ… [CHECKBOX] IPs checkbox activated, checked:",p.checked)):console.warn("âš ï¸ [CHECKBOX] IPs checkbox not found!"),m?(console.log("â˜‘ï¸ [CHECKBOX] Activating chat checkbox..."),m.checked=!0,m.dispatchEvent(new Event("change")),console.log("âœ… [CHECKBOX] Chat checkbox activated, checked:",m.checked)):console.warn("âš ï¸ [CHECKBOX] Chat checkbox not found!"),console.log("ğŸ” [DOM] Checking DOM elements AFTER checkbox activation..."),console.log("ğŸ“‹ [DOM] Nickname classes:",{nick1:n?.className,nick2:a?.className}),console.log("ğŸ“‹ [DOM] IP classes:",{ip1:l?.className,ip2:c?.className}),console.log("ğŸ”‡ [AUDIO] Disabling BGM..."),this.pikaVolley.audio.turnBGMVolume(!1),this.pikaVolley.audio.sounds.bgm&&this.pikaVolley.audio.sounds.bgm.center&&(this.pikaVolley.audio.sounds.bgm.center.stop(),this.pikaVolley.audio.sounds.bgm.center.play=function(){console.log("ğŸ”‡ [AUDIO] BGM play blocked")},this.pikaVolley.audio.sounds.bgm.center.isPlaying=!1),console.log("âœ… [AUDIO] BGM disabled"),console.log("ğŸ”Š [AUDIO] Enabling SFX..."),this.pikaVolley.audio.turnSFXVolume(!0),console.log("âœ… [AUDIO] SFX enabled"),this.setupAudioCapture(),console.log("ğŸ”„ [TICKER] Setting up ticker..."),this.ticker.add((()=>{this.renderer.render(this.stage);try{this.pikaVolley&&this.pikaVolley.gameLoop()}catch(e){console.warn("âš ï¸ [GAME LOOP ERROR] Ignored:",e)}this.drawOverlaysOnCanvas()})),console.log("âœ… [TICKER] Ticker set up"),setTimeout((()=>this.startRecording()),100),console.log("â° [GAME] Recording will start in 100ms")}drawOverlaysOnCanvas(){const e=this.renderer.view.getContext("2d");if(!e)return;e.save(),e.font='bold 16px "Segoe UI", sans-serif',e.textAlign="center",e.textBaseline="top";const t=document.getElementById("player1-nickname")?.textContent||"",o=document.getElementById("player1-partial-ip")?.textContent||"",s=document.getElementById("player2-nickname")?.textContent||"",i=document.getElementById("player2-partial-ip")?.textContent||"";t&&(e.fillStyle="white",e.strokeStyle="black",e.lineWidth=3,e.strokeText(t,50,10),e.fillText(t,50,10),o&&(e.font="12px sans-serif",e.strokeText(o,50,30),e.fillText(o,50,30))),s&&(e.font='bold 16px "Segoe UI", sans-serif',e.strokeText(s,382,10),e.fillText(s,382,10),i&&(e.font="12px sans-serif",e.strokeText(i,382,30),e.fillText(i,382,30))),this.drawChatBubble(e,"player1-chat-box",80,60),this.drawChatBubble(e,"player2-chat-box",352,60),e.restore()}drawChatBubble(e,t,o,s){const i=document.getElementById(t);if(!i||!i.textContent||""===i.textContent.trim())return;const n=i.textContent;e.font="14px sans-serif";const a=e.measureText(n).width+20;e.fillStyle="rgba(255, 255, 255, 0.9)",e.fillRect(o-a/2,s,a,30),e.strokeStyle="black",e.lineWidth=1,e.strokeRect(o-a/2,s,a,30),e.fillStyle="black",e.fillText(n,o,s+6)}startRecording(){console.log("ğŸ¥ [RECORD] Starting recording..."),this.updateStatus("ë…¹í™” ì¤€ë¹„ ì¤‘..."),this.recordedChunks=[],this.isRecording=!0;const e=this.renderer.view;console.log("ğŸ–¼ï¸ [RECORD] Canvas:",e);try{const t=30,o=e.captureStream(t);if(this.audioDest&&this.audioDest.stream){const e=this.audioDest.stream.getAudioTracks();console.log("ğŸ”Š [RECORD] Audio tracks available:",e.length),e.length>0?(o.addTrack(e[0]),console.log("âœ… [RECORD] Audio track added to video stream")):console.warn("âš ï¸ [RECORD] No audio tracks available!")}else console.warn("âš ï¸ [RECORD] audioDest not initialized!");console.log("ğŸ“Š [RECORD] Combined stream:",{videoTracks:o.getVideoTracks().length,audioTracks:o.getAudioTracks().length}),this.mediaRecorder=new MediaRecorder(o,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:25e5}),console.log("ğŸ“¹ [RECORD] Canvas stream created at",t,"FPS");let s="video/webm;codecs=vp9";MediaRecorder.isTypeSupported(s)||(console.warn("âš ï¸ [RECORD] VP9 not supported, trying VP8"),s="video/webm;codecs=vp8",MediaRecorder.isTypeSupported(s)||(console.warn("âš ï¸ [RECORD] VP8 not supported, using default webm"),s="video/webm")),console.log("âœ… [RECORD] Using codec:",s),this.mediaRecorder=new MediaRecorder(o,{mimeType:s,videoBitsPerSecond:25e5}),console.log("âœ… [RECORD] MediaRecorder created"),this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&(this.recordedChunks.push(e.data),console.log(`ğŸ“¦ [RECORD] Data chunk received: ${e.data.size} bytes, total chunks: ${this.recordedChunks.length}`))},this.mediaRecorder.onstop=()=>{console.log("â¹ï¸ [RECORD] MediaRecorder stopped"),this.saveVideoFile()},this.mediaRecorder.onerror=e=>{console.error("âŒ [RECORD] MediaRecorder error:",e),this.updateStatus("ë…¹í™” ì¤‘ ì—ëŸ¬ ë°œìƒ"),this.isRecording=!1;const t=document.getElementById("record-btn");t&&(t.disabled=!1)},this.mediaRecorder.start(100),console.log("â–¶ï¸ [RECORD] MediaRecorder started"),this.ticker.maxFPS=30,this.ticker.start(),console.log("â–¶ï¸ [TICKER] Ticker started at 30 FPS"),this.updateStatus("ë…¹í™” ì¤‘... 0%"),this.monitorProgress(),console.log("ğŸ“Š [RECORD] Progress monitoring started")}catch(e){console.error("âŒ [RECORD] Error starting recording:",e),this.updateStatus("ë…¹í™” ì‹œì‘ ì‹¤íŒ¨: "+e.message),this.isRecording=!1;const t=document.getElementById("record-btn");t&&(t.disabled=!1)}}monitorProgress(){const e=this.pikaVolley.inputs.length;console.log("ğŸ“Š [PROGRESS] Total frames:",e);const t=document.getElementById("progress-bar"),o=setInterval((()=>{if(!this.pikaVolley||!this.isRecording)return console.log("â¹ï¸ [PROGRESS] Stopping progress monitoring"),void clearInterval(o);const s=this.pikaVolley.replayFrameCounter,i=Math.floor(s/e*100);s%100==0&&console.log(`ğŸ“Š [PROGRESS] Frame ${s}/${e} (${i}%)`),this.updateStatus(`ë…¹í™” ì¤‘... ${i}%`),t&&(t.style.width=`${i}%`),s>=e&&(console.log("ğŸ [PROGRESS] All frames processed"),clearInterval(o),this.stopRecording())}),500)}stopRecording(){this.isRecording?(console.log("â¹ï¸ [STOP] Stopping recording..."),this.updateStatus("ë…¹í™” ì™„ë£Œ, íŒŒì¼ ì €ì¥ ì¤‘..."),this.ticker.stop(),console.log("â¹ï¸ [STOP] Ticker stopped"),this.mediaRecorder&&"inactive"!==this.mediaRecorder.state?(console.log("â¹ï¸ [STOP] Stopping MediaRecorder..."),this.mediaRecorder.stop()):(console.log("âš ï¸ [STOP] MediaRecorder already inactive, saving directly"),this.saveVideoFile())):console.log("âš ï¸ [STOP] Not recording, skipping stop")}saveVideoFile(){if(console.log("ğŸ’¾ [SAVE] Saving video file..."),console.log("ğŸ“¦ [SAVE] Recorded chunks:",this.recordedChunks.length),0===this.recordedChunks.length){console.error("âŒ [SAVE] No recorded data!"),this.updateStatus("ë…¹í™”ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤"),this.isRecording=!1;const e=document.getElementById("record-btn");return void(e&&(e.disabled=!1))}const e=new Blob(this.recordedChunks,{type:"video/webm"});console.log("ğŸ“¦ [SAVE] Blob created:",e.size,"bytes");const t=URL.createObjectURL(e);console.log("ğŸ”— [SAVE] Object URL:",t);const o=new Date,s=`${o.getFullYear()}${("0"+(o.getMonth()+1)).slice(-2)}${("0"+o.getDate()).slice(-2)}`,i=`${("0"+o.getHours()).slice(-2)}${("0"+o.getMinutes()).slice(-2)}`;let n=`${s}_${i}_pikavolley_replay.webm`;const a=this.currentPack;a&&a.nicknames&&2===a.nicknames.length&&(n=`${s}_${i}_${a.nicknames[0].replace(/[/\\?%*:|"<>]/g,"_")}_vs_${a.nicknames[1].replace(/[/\\?%*:|"<>]/g,"_")}.webm`),console.log("ğŸ“ [SAVE] Filename:",n);const l=document.createElement("a");l.href=t,l.download=n,l.style.display="none",document.body.appendChild(l),l.click(),console.log("âœ… [SAVE] Download triggered"),setTimeout((()=>{document.body.removeChild(l),URL.revokeObjectURL(t),console.log("ğŸ§¹ [SAVE] Cleanup complete")}),100),this.updateStatus("ì™„ë£Œ! ë‹¤ë¥¸ ë¦¬í”Œë ˆì´ë¥¼ ë³€í™˜í•˜ë ¤ë©´ ë²„íŠ¼ì„ ë‹¤ì‹œ í´ë¦­í•˜ì„¸ìš”."),this.isRecording=!1;const c=document.getElementById("record-btn");c&&(c.disabled=!1),this.recordedChunks=[];const r=document.getElementById("loading-overlay");r&&r.classList.add("hidden"),console.log("âœ… [SAVE] Complete!")}},$=document.getElementById("record-btn");console.log("ğŸ”˜ [INIT] Record button:",$),$&&($.addEventListener("click",(()=>_.handleRecordButtonClick())),console.log("âœ… [INIT] Record button listener attached")),document.addEventListener("DOMContentLoaded",(()=>{console.log("ğŸ“„ [DOM] DOMContentLoaded event fired");const e=document.getElementById("show-nicknames-checkbox"),t=document.getElementById("show-ip-addresses-checkbox"),o=document.getElementById("show-chat-checkbox"),s=document.getElementById("player1-nickname"),i=document.getElementById("player2-nickname"),n=document.getElementById("player1-partial-ip"),a=document.getElementById("player2-partial-ip");console.log("ğŸ” [DOM] UI Elements:",{showNicknamesCheckbox:e,showIPsCheckbox:t,showChatCheckbox:o,player1NicknameElem:s,player2NicknameElem:i,player1IPElem:n,player2IPElem:a}),e&&(e.addEventListener("change",(()=>{console.log("â˜‘ï¸ [EVENT] Nicknames checkbox changed:",e.checked),e.checked?(s&&(s.classList.remove("hidden"),console.log("âœ… [EVENT] Player1 nickname shown")),i&&(i.classList.remove("hidden"),console.log("âœ… [EVENT] Player2 nickname shown"))):(s&&s.classList.add("hidden"),i&&i.classList.add("hidden"))})),console.log("âœ… [DOM] Nicknames checkbox listener attached")),t&&(t.addEventListener("change",(()=>{console.log("â˜‘ï¸ [EVENT] IPs checkbox changed:",t.checked),t.checked?(n&&(n.classList.remove("hidden"),console.log("âœ… [EVENT] Player1 IP shown")),a&&(a.classList.remove("hidden"),console.log("âœ… [EVENT] Player2 IP shown"))):(n&&n.classList.add("hidden"),a&&a.classList.add("hidden"))})),console.log("âœ… [DOM] IPs checkbox listener attached")),o&&(o.addEventListener("change",(()=>{if(console.log("â˜‘ï¸ [EVENT] Chat checkbox changed:",o.checked),o.checked){console.log("ğŸ’¬ [EVENT] Enabling chat...");try{console.log("âœ… [EVENT] Chat enabled")}catch(e){console.error("âŒ [EVENT] Error enabling chat:",e)}}else{console.log("ğŸ”‡ [EVENT] Disabling chat...");try{console.log("âœ… [EVENT] Chat disabled")}catch(e){console.error("âŒ [EVENT] Error disabling chat:",e)}}})),console.log("âœ… [DOM] Chat checkbox listener attached"))})),console.log("âœ… [INIT] main_out.js initialization complete")}},e=>{e.O(0,[244,415,476],(()=>e(e.s=5128))),e.O()}]);
//# sourceMappingURL=main_out.f82e2661a003f6db939b.js.map