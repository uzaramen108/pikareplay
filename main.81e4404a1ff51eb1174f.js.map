{"version":3,"file":"main.81e4404a1ff51eb1174f.js","mappings":"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","sources":["webpack://pikachu-volleyball-p2p-online/./src/resources/js/pikavolley_online.js","webpack://pikachu-volleyball-p2p-online/./src/resources/js/bad_words_filtering/ui.js","webpack://pikachu-volleyball-p2p-online/./src/resources/js/main_online.js"],"sourcesContent":["'use strict';\r\nimport { PikachuVolleyball } from './offline_version_js/pikavolley.js';\r\nimport { bufferLength, myKeyboard, OnlineKeyboard } from './keyboard_online.js';\r\nimport { SYNC_DIVISOR, channel } from './data_channel/data_channel';\r\nimport { mod } from './utils/mod.js';\r\nimport { askOneMoreGame } from './ui_online.js';\r\nimport {\r\n  displayPartialIPFor,\r\n  displayNicknameFor,\r\n  displayPeerNicknameFor,\r\n  displayMyAndPeerNicknameShownOrHidden,\r\n} from './nickname_display.js';\r\nimport { replaySaver } from './replay/replay_saver.js';\r\nimport { PikaUserInput } from './offline_version_js/physics.js';\r\nimport { displayMyAndPeerChatEnabledOrDisabled } from './chat_display.js';\r\n\r\n/** @typedef GameState @type {function():void} */\r\n\r\n/**\r\n * Class representing Pikachu Volleyball p2p online game\r\n */\r\n// @ts-ignore\r\nexport class PikachuVolleyballOnline extends PikachuVolleyball {\r\n  constructor(stage, resources) {\r\n    super(stage, resources);\r\n    this.physics.player1.isComputer = false;\r\n    this.physics.player2.isComputer = false;\r\n\r\n    // @ts-ignore\r\n    this.keyboardArray[0].unsubscribe();\r\n    // @ts-ignore\r\n    this.keyboardArray[1].unsubscribe();\r\n\r\n    this.myKeyboard = myKeyboard;\r\n    this.myOnlineKeyboard = new OnlineKeyboard(this.myKeyboard.inputQueue);\r\n    this.peerOnlineKeyboard = new OnlineKeyboard(channel.peerInputQueue);\r\n\r\n    this._amIPlayer2 = false;\r\n    this.keyboardArray = [this.myOnlineKeyboard, this.peerOnlineKeyboard];\r\n    this._syncCounter = 0;\r\n    this.noInputFrameTotal.menu = Infinity;\r\n\r\n    this.isFirstGame = true;\r\n\r\n    this.willSaveReplay = true;\r\n  }\r\n\r\n  /**\r\n   * @return {boolean}\r\n   */\r\n  get amIPlayer2() {\r\n    return this._amIPlayer2;\r\n  }\r\n\r\n  /**\r\n   * @param {boolean} bool Am I Player 2? Am I play on the right side?\r\n   */\r\n  set amIPlayer2(bool) {\r\n    this._amIPlayer2 = bool;\r\n    channel.amIPlayer2 = bool;\r\n    if (this._amIPlayer2 === true) {\r\n      this.keyboardArray = [this.peerOnlineKeyboard, this.myOnlineKeyboard];\r\n    } else {\r\n      this.keyboardArray = [this.myOnlineKeyboard, this.peerOnlineKeyboard];\r\n    }\r\n  }\r\n\r\n  get syncCounter() {\r\n    return this._syncCounter;\r\n  }\r\n\r\n  set syncCounter(counter) {\r\n    this._syncCounter = mod(counter, SYNC_DIVISOR);\r\n  }\r\n\r\n  /**\r\n   * Override the \"intro\" method in the super class.\r\n   * It is to ask for one more game with the peer after quick match game ends.\r\n   * @type {GameState}\r\n   */\r\n  intro() {\r\n    if (this.frameCounter === 0) {\r\n      this.selectedWithWho = 0;\r\n      if (this.isFirstGame) {\r\n        this.isFirstGame = false;\r\n        this.amIPlayer2 = !channel.amICreatedRoom;\r\n      } else if (channel.isQuickMatch) {\r\n        askOneMoreGame();\r\n      }\r\n    }\r\n    super.intro();\r\n  }\r\n\r\n  /**\r\n   * Override the \"menu\" method in the super class.\r\n   * It changes \"am I player 1 or player 2\" setting accordingly.\r\n   * @type {GameState}\r\n   */\r\n  menu() {\r\n    const selectedWithWho = this.selectedWithWho;\r\n    super.menu();\r\n    if (this.selectedWithWho !== selectedWithWho) {\r\n      this.amIPlayer2 = !this.amIPlayer2;\r\n      displayNicknameFor(channel.myNickname, this.amIPlayer2);\r\n      displayPeerNicknameFor(channel.peerNickname, !this.amIPlayer2);\r\n      displayPartialIPFor(channel.myPartialPublicIP, this.amIPlayer2);\r\n      displayPartialIPFor(channel.peerPartialPublicIP, !this.amIPlayer2);\r\n      displayMyAndPeerChatEnabledOrDisabled();\r\n      displayMyAndPeerNicknameShownOrHidden();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Game loop\r\n   * This function should be called at regular intervals ( interval = (1 / FPS) second )\r\n   */\r\n  gameLoop() {\r\n    if (!(channel.gameStartAllowed && channel.isOpen)) {\r\n      return;\r\n    }\r\n\r\n    // Sync game frame and user input with peer\r\n    //\r\n    // This must be before the slow-mo effect.\r\n    // Otherwise, frame sync could be broken,\r\n    // for example, if peer use other tap on the browser\r\n    // so peer's game pause while my game goes on slow-mo.\r\n    // This broken frame sync results into different game state between two peers.\r\n    this.myKeyboard.getInputIfNeededAndSendToPeer(this.syncCounter);\r\n    this.gameLoopFromGettingPeerInput();\r\n  }\r\n\r\n  gameLoopFromGettingPeerInput() {\r\n    const checkForPeerInputQueue = this.peerOnlineKeyboard.isInputOnQueue(\r\n      this.syncCounter\r\n    );\r\n    if (!checkForPeerInputQueue) {\r\n      channel.callbackAfterPeerInputQueueReceived =\r\n        this.gameLoopFromGettingPeerInput.bind(this);\r\n      return;\r\n    }\r\n    const checkForMyInputQueue = this.myOnlineKeyboard.isInputOnQueue(\r\n      this.syncCounter\r\n    );\r\n    if (!checkForMyInputQueue) {\r\n      return;\r\n    }\r\n    this.peerOnlineKeyboard.getInput(this.syncCounter);\r\n    this.myOnlineKeyboard.getInput(this.syncCounter);\r\n    this.syncCounter++;\r\n\r\n    if (this.willSaveReplay) {\r\n      const player1Input = new PikaUserInput();\r\n      player1Input.xDirection = this.keyboardArray[0].xDirection;\r\n      player1Input.yDirection = this.keyboardArray[0].yDirection;\r\n      player1Input.powerHit = this.keyboardArray[0].powerHit;\r\n      const player2Input = new PikaUserInput();\r\n      player2Input.xDirection = this.keyboardArray[1].xDirection;\r\n      player2Input.yDirection = this.keyboardArray[1].yDirection;\r\n      player2Input.powerHit = this.keyboardArray[1].powerHit;\r\n      replaySaver.recordInputs(player1Input, player2Input);\r\n    }\r\n\r\n    // slow-mo effect\r\n    if (this.slowMotionFramesLeft > 0) {\r\n      this.slowMotionNumOfSkippedFrames++;\r\n      if (\r\n        this.slowMotionNumOfSkippedFrames %\r\n          Math.round(this.normalFPS / this.slowMotionFPS) !==\r\n        0\r\n      ) {\r\n        return;\r\n      }\r\n      this.slowMotionFramesLeft--;\r\n      this.slowMotionNumOfSkippedFrames = 0;\r\n    }\r\n\r\n    this.physics.player1.isComputer = false;\r\n    this.physics.player2.isComputer = false;\r\n    this.state();\r\n\r\n    // window.setTimeout(callback, 0) is used because it puts\r\n    // the callback to the message queue of Javascript runtime event loop,\r\n    // so the callback does not stack upon the stack of the caller function and\r\n    // also does not block if the callbacks are called a bunch in a row.\r\n    if (this.peerOnlineKeyboard.inputQueue.length > bufferLength) {\r\n      if (this.myOnlineKeyboard.inputQueue.length > bufferLength) {\r\n        window.setTimeout(this.gameLoopFromGettingPeerInput.bind(this), 0);\r\n      } else {\r\n        window.setTimeout(this.gameLoop.bind(this), 0);\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Manages UI relevant to bad words censorship\r\n */\r\n'use strict';\r\n\r\nimport { getIfLocalStorageIsAvailable } from '../utils/is_local_storage_available';\r\nimport { badWordList } from './bad_word_list.js';\r\nconst STORAGE_KEY_CUSTOM_LIST = 'stringifiedbadWordListArrayView';\r\nconst isLocalStorageAvailable = getIfLocalStorageIsAvailable();\r\n\r\nconst STORAGE_KEY_DEFAULT_FILTER_TOGGLE = 'isDefaultBadWordFilterEnabled';\r\n\r\nconst defaultFilterToggle = document.getElementById(\r\n  'basic-chat-filter-checkbox'\r\n);\r\nconst customBadWordsTableContainer = document.getElementById(\r\n  'blocked-bad-words-table-container'\r\n);\r\nconst customBadWordsTableTbody = document.querySelector(\r\n  'table.blocked-bad-words-table tbody'\r\n);\r\nconst deleteCustomWordBtn = document.querySelector(\r\n  'table.blocked-bad-words-table .delete-btn'\r\n);\r\nconst customBadWordsCountSpan = document.getElementById(\r\n  'number-of-bad-words-addresses'\r\n);\r\n\r\nconst addCustomWordBtn = document.getElementById('add-custom-word-btn');\r\nconst newCustomWordInput = document.getElementById('new-custom-word-input');\r\n\r\nexport function setUpUIForManagingBadWords() {\r\n  if (!isLocalStorageAvailable) {\r\n    defaultFilterToggle.parentElement.classList.add('hidden');\r\n    customBadWordsTableContainer.classList.add('hidden');\r\n    return;\r\n  }\r\n\r\n  setUpDefaultFilterToggle();\r\n  setUpCustomFilterManagement();\r\n}\r\n\r\n/**\r\n * Set up toggle for using list of basic bad words at chat_filter.js\r\n */\r\nfunction setUpDefaultFilterToggle() {\r\n  let isEnabled = true;\r\n  try {\r\n    const storedToggleState = window.localStorage.getItem(\r\n      STORAGE_KEY_DEFAULT_FILTER_TOGGLE\r\n    );\r\n    if (storedToggleState !== null) {\r\n      isEnabled = storedToggleState === 'true';\r\n    }\r\n  } catch (err) {\r\n    console.log(err);\r\n  }\r\n  // @ts-ignore\r\n  defaultFilterToggle.checked = isEnabled;\r\n  badWordList.willUseBasicBadWords = isEnabled;\r\n  defaultFilterToggle.addEventListener('change', () => {\r\n    try {\r\n      // @ts-ignore\r\n      window.localStorage.setItem(\r\n        STORAGE_KEY_DEFAULT_FILTER_TOGGLE,\r\n        // @ts-ignore\r\n        String(defaultFilterToggle.checked)\r\n      );\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Set up table of bad words(delete, register)\r\n */\r\nfunction setUpCustomFilterManagement() {\r\n  // @ts-ignore\r\n  deleteCustomWordBtn.disabled = true;\r\n  if (!isLocalStorageAvailable) {\r\n    return;\r\n  }\r\n\r\n  let stringifiedList = null;\r\n  try {\r\n    stringifiedList = window.localStorage.getItem(STORAGE_KEY_CUSTOM_LIST);\r\n  } catch (err) {\r\n    console.log(err);\r\n  }\r\n\r\n  if (stringifiedList !== null) {\r\n    const arrayView = JSON.parse(stringifiedList);\r\n    if (arrayView.length > 0 && arrayView[0].length !== 2) {\r\n      window.localStorage.removeItem(STORAGE_KEY_CUSTOM_LIST);\r\n      location.reload();\r\n    } else {\r\n      badWordList.readArrayViewAndUpdate(arrayView);\r\n    }\r\n  }\r\n\r\n  displayCustomBadWords(badWordList.createArrayView());\r\n  displayNumberOfCustomBadWords();\r\n\r\n  let lastSelectedIndex = -1;\r\n  document.body.addEventListener('click', (event) => {\r\n    const target = event.target;\r\n    if (\r\n      // @ts-ignore\r\n      customBadWordsTableTbody.contains(target) &&\r\n      // @ts-ignore\r\n      target.tagName === 'TD'\r\n    ) {\r\n      // @ts-ignore\r\n      const trElement = target.parentElement;\r\n      const currentIndex = trElement.sectionRowIndex;\r\n\r\n      if (event.shiftKey && lastSelectedIndex !== -1) {\r\n        if (!event.ctrlKey) {\r\n          clearSelection();\r\n        }\r\n        const start = Math.min(lastSelectedIndex, currentIndex);\r\n        const end = Math.max(lastSelectedIndex, currentIndex);\r\n        const rows = customBadWordsTableTbody.getElementsByTagName('tr');\r\n        for (let i = start; i <= end; i++) {\r\n          if (rows[i]) {\r\n            rows[i].classList.add('selected');\r\n          }\r\n        }\r\n      } else {\r\n        if (!event.ctrlKey) {\r\n          clearSelection();\r\n        }\r\n        trElement.classList.toggle('selected');\r\n        lastSelectedIndex = currentIndex;\r\n      }\r\n    } else {\r\n      if (!event.ctrlKey && !event.shiftKey) {\r\n        clearSelection();\r\n      }\r\n    }\r\n\r\n    // @ts-ignore\r\n    deleteCustomWordBtn.disabled =\r\n      !customBadWordsTableTbody.querySelector('.selected');\r\n  });\r\n  deleteCustomWordBtn.addEventListener('click', () => {\r\n    lastSelectedIndex = -1;\r\n    const selectedTRElements =\r\n      customBadWordsTableTbody.querySelectorAll('.selected');\r\n    for (let i = selectedTRElements.length - 1; i >= 0; --i) {\r\n      // @ts-ignore\r\n      badWordList.removeAt(Number(selectedTRElements[i].dataset.index));\r\n    }\r\n    try {\r\n      window.localStorage.setItem(\r\n        'stringifiedbadWordListArrayView',\r\n        JSON.stringify(badWordList.createArrayView())\r\n      );\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n    displayCustomBadWords(badWordList.createArrayView());\r\n    displayNumberOfCustomBadWords();\r\n  });\r\n  addCustomWordBtn.addEventListener('click', () => {\r\n    lastSelectedIndex = -1;\r\n    // @ts-ignore\r\n    const cleanWord = newCustomWordInput.value\r\n      .toLowerCase()\r\n      .replace(/[^\\p{L}\\p{Emoji}]/gu, ''); // Words or emojis will be saved\r\n    if (!cleanWord || badWordList.isFull()) {\r\n      return;\r\n    }\r\n    badWordList.AddBadWords(cleanWord);\r\n    try {\r\n      window.localStorage.setItem(\r\n        STORAGE_KEY_CUSTOM_LIST,\r\n        JSON.stringify(badWordList.createArrayView())\r\n      );\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n    displayCustomBadWords(badWordList.createArrayView());\r\n    displayNumberOfCustomBadWords();\r\n    // @ts-ignore\r\n    newCustomWordInput.value = '';\r\n  });\r\n}\r\n\r\n/**\r\n * Display the given bad word list array view.\r\n * @param {[string, number][]} badWords\r\n */\r\nfunction displayCustomBadWords(badWords) {\r\n  while (customBadWordsTableTbody.firstChild) {\r\n    customBadWordsTableTbody.removeChild(customBadWordsTableTbody.firstChild);\r\n  }\r\n  // Display the given list\r\n  badWords.forEach((badWord, index) => {\r\n    const trElement = document.createElement('tr');\r\n    const tdElementForWord = document.createElement('td');\r\n    const tdElementForTime = document.createElement('td');\r\n    trElement.appendChild(tdElementForWord);\r\n    trElement.appendChild(tdElementForTime);\r\n    trElement.dataset.index = String(index);\r\n    tdElementForWord.textContent = badWord[0];\r\n    tdElementForTime.textContent = new Date(badWord[1]).toLocaleString();\r\n    customBadWordsTableTbody.appendChild(trElement);\r\n  });\r\n}\r\n\r\n/**\r\n * Display the number of bad words in the list\r\n */\r\nfunction displayNumberOfCustomBadWords() {\r\n  customBadWordsCountSpan.textContent = String(badWordList.length);\r\n}\r\n\r\n/**\r\n * Clear all selected rows in the bad words table\r\n */\r\nfunction clearSelection() {\r\n  Array.from(\r\n    // @ts-ignore\r\n    customBadWordsTableTbody.getElementsByTagName('tr')\r\n  ).forEach((elem) => {\r\n    elem.classList.remove('selected');\r\n  });\r\n}\r\n","/**\r\n * This is the main script which executes the p2p online version game.\r\n * General explanations for the all source code files of the game are following.\r\n *\r\n ********************************************************************************************************************\r\n * This p2p online version of the Pikachu Volleyball is developed based on\r\n * the Pikachu Volleyball offline web version (https://github.com/gorisanson/pikachu-volleyball)\r\n * which is made by reverse engineering the core part of the original Pikachu Volleyball game\r\n * which is developed by \"1997 (C) SACHI SOFT / SAWAYAKAN Programmers\" & \"1997 (C) Satoshi Takenouchi\".\r\n ********************************************************************************************************************\r\n *\r\n * This p2p online version game is mainly composed of two parts below.\r\n *  1) Offline version: All the offline web version source code files is in the directory \"offline_version_js\".\r\n *  2) WebRTC data channels: It utilizes WebRTC data channels to communicate with the peer.\r\n *                           The peer-to-peer online functions are contained in \"data_channel.js\"\r\n *\r\n * The game is deterministic on the user (keyboard) inputs except the RNG (random number generator) used in\r\n * \"offline_version_js/physics.js\" and \"offline_version_js/cloud_and_wave.js\". (The RNG is contained\r\n * in \"offline_version_js/rand.js\".) So if the RNG is the same on both peers, only the user inputs need\r\n * to be communicated to maintain the same game state between the peers. In this p2p online version, the RNG\r\n * is set to the same thing on both peers at the data channel open event (handled by the function\r\n * \"dataChannelOpened\" in \"data_channel.js\"), then the user inputs are communicated via the data channel.\r\n *\r\n * And explanations for other source files are below.\r\n *  - \"pikavolley_online.js\": A wrapper for \"offline_version_js/pikavolley.js\".\r\n *  - \"keyboard_online.js\": A wrapper for offline version \"offline_version_js/keyboard.js\".\r\n *                          This module gets user inputs and load them up onto the data channel to the peer.\r\n *  - \"generate_pushid.js\": Generate a room ID easily distinguishable by human eye.\r\n *  - \"mod.js\": To maintain game sync, sync counter is attached for each user input, and mod is used to\r\n *              make sync counter cycle in a range [0, 255] which fits in a byte.\r\n *  - \"ui_online.js\": For the user interface of the html page and inputs/outputs relevant to html elements.\r\n *  - \"chat_display.js\": For displaying chat messages.\r\n *  - \"firebase_config.template.js\": This p2p online version utilized firebase cloud firestore to establish\r\n *                                   webRTC data channel connection between peers. Fill this template and\r\n *                                   change the file name to \"firebase_config.js\".\r\n *  - \"rtc_configuration.js\": Contains RTCPeerConnection configuration.\r\n *  - \"quick_match.js\": It is for the quick match function. Manages communication with the quick match server.\r\n *  - \"quick_match_server_url.template.js\": Fill this template the url of the quick match server and change\r\n *                                          the file name to \"quick_match_server_url.js\"\r\n */\r\n'use strict';\r\nimport { settings } from '@pixi/settings';\r\nimport { SCALE_MODES } from '@pixi/constants';\r\nimport { Renderer, BatchRenderer, autoDetectRenderer } from '@pixi/core';\r\nimport { Prepare } from '@pixi/prepare';\r\nimport { Container } from '@pixi/display';\r\nimport { Loader } from '@pixi/loaders';\r\nimport { SpritesheetLoader } from '@pixi/spritesheet';\r\nimport { Ticker } from '@pixi/ticker';\r\nimport { CanvasRenderer } from '@pixi/canvas-renderer';\r\nimport { CanvasSpriteRenderer } from '@pixi/canvas-sprite';\r\nimport { CanvasPrepare } from '@pixi/canvas-prepare';\r\nimport '@pixi/canvas-display';\r\nimport { PikachuVolleyballOnline } from './pikavolley_online.js';\r\nimport { ASSETS_PATH } from './offline_version_js/assets_path.js';\r\nimport { channel } from './data_channel/data_channel.js';\r\nimport { setUpUI, setUpUIAfterLoadingGameAssets } from './ui_online.js';\r\nimport { setUpUIForBlockingOtherUsers } from './block_other_players/ui.js';\r\nimport { setUpUIForManagingBadWords } from './bad_words_filtering/ui.js';\r\nimport { setGetSpeechBubbleNeeded } from './chat_display.js';\r\nimport '../style.css';\r\n\r\n// To show two \"with friend\" on the menu\r\nconst TEXTURES = ASSETS_PATH.TEXTURES;\r\nTEXTURES.WITH_COMPUTER = TEXTURES.WITH_FRIEND;\r\n\r\n// Reference for how to use Renderer.registerPlugin:\r\n// https://github.com/pixijs/pixijs/blob/af3c0c6bb15aeb1049178c972e4a14bb4cabfce4/bundles/pixi.js/src/index.ts#L27-L34\r\nRenderer.registerPlugin('prepare', Prepare);\r\nRenderer.registerPlugin('batch', BatchRenderer);\r\n// Reference for how to use CanvasRenderer.registerPlugin:\r\n// https://github.com/pixijs/pixijs/blob/af3c0c6bb15aeb1049178c972e4a14bb4cabfce4/bundles/pixi.js-legacy/src/index.ts#L13-L19\r\nCanvasRenderer.registerPlugin('prepare', CanvasPrepare);\r\nCanvasRenderer.registerPlugin('sprite', CanvasSpriteRenderer);\r\nLoader.registerPlugin(SpritesheetLoader);\r\n\r\nsettings.RESOLUTION = 2;\r\nsettings.SCALE_MODE = SCALE_MODES.NEAREST;\r\nsettings.ROUND_PIXELS = true;\r\n\r\nconst renderer = autoDetectRenderer({\r\n  width: 432,\r\n  height: 304,\r\n  antialias: false,\r\n  backgroundColor: 0x000000,\r\n  backgroundAlpha: 1,\r\n  // Decided to use only Canvas for compatibility reason. One player had reported that\r\n  // on their browser, where pixi chooses to use WebGL renderer, the graphics are not fine.\r\n  // And the issue had been fixed by using Canvas renderer. And also for the sake of testing,\r\n  // it is more comfortable just to stick with Canvas renderer so that it is unnecessary to switch\r\n  // between WebGL renderer and Canvas renderer.\r\n  forceCanvas: true,\r\n});\r\n\r\nconst stage = new Container();\r\nconst ticker = new Ticker();\r\nconst loader = new Loader();\r\n\r\ndocument.querySelector('#game-canvas-container').appendChild(renderer.view);\r\nrenderer.render(stage); // To make the initial canvas painting stable in the Firefox browser.\r\n\r\nloader.add(ASSETS_PATH.SPRITE_SHEET);\r\nfor (const prop in ASSETS_PATH.SOUNDS) {\r\n  loader.add(ASSETS_PATH.SOUNDS[prop]);\r\n}\r\nsetUpLoaderProgressBar();\r\nchannel.callbackAfterDataChannelOpened = () => {\r\n  loader.load(setup);\r\n};\r\n\r\nsetUpUI();\r\nsetUpUIForBlockingOtherUsers();\r\nsetUpUIForManagingBadWords();\r\n\r\n/**\r\n * Set up the loader progress bar.\r\n */\r\nfunction setUpLoaderProgressBar() {\r\n  const loadingBox = document.getElementById('loading-box');\r\n  const progressBar = document.getElementById('progress-bar');\r\n\r\n  loader.onProgress.add(() => {\r\n    progressBar.style.width = `${loader.progress}%`;\r\n  });\r\n  loader.onComplete.add(() => {\r\n    loadingBox.classList.add('hidden');\r\n  });\r\n}\r\n\r\nfunction setup() {\r\n  const pikaVolley = new PikachuVolleyballOnline(stage, loader.resources);\r\n  setUpUIAfterLoadingGameAssets(pikaVolley, ticker);\r\n  setGetSpeechBubbleNeeded(pikaVolley);\r\n  start(pikaVolley);\r\n}\r\n\r\nfunction start(pikaVolley) {\r\n  ticker.maxFPS = pikaVolley.normalFPS;\r\n  ticker.add(() => {\r\n    // Rendering and gameLoop order is the opposite of\r\n    // the offline web version (refer: ./offline_version_js/main.js).\r\n    // It's for the smooth rendering for the online version\r\n    // which gameLoop can not always succeed right on this \"ticker.add\"ed code\r\n    // because of the transfer delay or connection status. (If gameLoop here fails,\r\n    // it is recovered by the callback gameLoop which is called after peer input received.)\r\n    // Now the rendering is delayed 40ms (when pikaVolley.normalFPS == 25)\r\n    // behind gameLoop.\r\n    renderer.render(stage);\r\n    pikaVolley.gameLoop();\r\n  });\r\n  ticker.start();\r\n}\r\n"],"names":["PikachuVolleyballOnline","constructor","stage","resources","super","this","physics","player1","isComputer","player2","keyboardArray","unsubscribe","myKeyboard","myOnlineKeyboard","inputQueue","peerOnlineKeyboard","peerInputQueue","_amIPlayer2","_syncCounter","noInputFrameTotal","menu","Infinity","isFirstGame","willSaveReplay","amIPlayer2","bool","syncCounter","counter","mod","intro","frameCounter","selectedWithWho","amICreatedRoom","isQuickMatch","myNickname","peerNickname","myPartialPublicIP","peerPartialPublicIP","gameLoop","gameStartAllowed","isOpen","getInputIfNeededAndSendToPeer","gameLoopFromGettingPeerInput","isInputOnQueue","getInput","player1Input","xDirection","yDirection","powerHit","player2Input","recordInputs","slowMotionFramesLeft","slowMotionNumOfSkippedFrames","Math","round","normalFPS","slowMotionFPS","state","length","window","setTimeout","bind","callbackAfterPeerInputQueueReceived","STORAGE_KEY_CUSTOM_LIST","isLocalStorageAvailable","STORAGE_KEY_DEFAULT_FILTER_TOGGLE","defaultFilterToggle","document","getElementById","customBadWordsTableContainer","customBadWordsTableTbody","querySelector","deleteCustomWordBtn","customBadWordsCountSpan","addCustomWordBtn","newCustomWordInput","displayCustomBadWords","badWords","firstChild","removeChild","forEach","badWord","index","trElement","createElement","tdElementForWord","tdElementForTime","appendChild","dataset","String","textContent","Date","toLocaleString","displayNumberOfCustomBadWords","clearSelection","Array","from","getElementsByTagName","elem","classList","remove","TEXTURES","WITH_COMPUTER","WITH_FRIEND","registerPlugin","settings","RESOLUTION","SCALE_MODE","NEAREST","ROUND_PIXELS","renderer","width","height","antialias","backgroundColor","backgroundAlpha","forceCanvas","loader","view","render","add","SPRITE_SHEET","prop","SOUNDS","setup","pikaVolley","maxFPS","start","loadingBox","progressBar","onProgress","style","progress","onComplete","setUpLoaderProgressBar","callbackAfterDataChannelOpened","load","parentElement","isEnabled","storedToggleState","localStorage","getItem","err","console","log","checked","willUseBasicBadWords","addEventListener","setItem","setUpDefaultFilterToggle","disabled","stringifiedList","arrayView","JSON","parse","removeItem","location","reload","readArrayViewAndUpdate","createArrayView","lastSelectedIndex","body","event","target","contains","tagName","currentIndex","sectionRowIndex","shiftKey","ctrlKey","min","end","max","rows","i","toggle","selectedTRElements","querySelectorAll","removeAt","Number","stringify","cleanWord","value","toLowerCase","replace","isFull","AddBadWords","setUpCustomFilterManagement","setUpUIForManagingBadWords"],"sourceRoot":""}