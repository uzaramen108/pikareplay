"use strict";(self.webpackChunkpikachu_volleyball_p2p_online=self.webpackChunkpikachu_volleyball_p2p_online||[]).push([[293],{5128:(e,t,i)=>{var o=i(4603),s=i(6787),n=i(592),a=i(3650),r=i(9449),l=i(7561),c=i(7049),d=i(8077),h=i(4697),u=i(8505),p=(i(7229),i(6090)),m=i(7391),y=i.n(m),g=i(94),k=i(5716),f=i(653),S=i(7147),I=i(6806),b=i(1674),E=i(4805),w=i(3401),C=i(6212),O=i(6970);const D=new class{constructor(){n.A4.registerPlugin("prepare",a.p8),n.A4.registerPlugin("batch",n.ch),d.KB.registerPlugin("prepare",u.S),d.KB.registerPlugin("sprite",h.$),l.aH.registerPlugin(c.A),o.W.RESOLUTION=2,o.W.SCALE_MODE=s.M6.NEAREST,o.W.ROUND_PIXELS=!0,this.ticker=new w.Rv,this.ticker.minFPS=1,this.renderer=(0,n.q5)({width:432,height:304,antialias:!1,backgroundColor:0,backgroundAlpha:1,forceCanvas:!0,preserveDrawingBuffer:!0}),this.stage=new r.mc,this.loader=new l.aH,this.pikaVolley=null,this.playBackSpeedTimes=1,this.playBackSpeedFPS=null}readFile(e){const t=p.I.TEXTURES;t.WITH_COMPUTER=t.WITH_FRIEND,document.querySelector("#game-canvas-container").appendChild(this.renderer.view),this.renderer.render(this.stage),this.ticker.add((()=>{this.renderer.render(this.stage),M(this.pikaVolley.timeCurrent),this.pikaVolley.gameLoop()})),this.pikaVolley.replayFrameCounter>=this.pikaVolley.inputs.length&&(this.ticker.stop(),window.dispatchEvent(new Event("pikaReplayFinished"))),this.loader.add(p.I.SPRITE_SHEET);for(const e in p.I.SOUNDS)this.loader.add(p.I.SOUNDS[e]);!function(e){const t=document.getElementById("loading-box"),i=document.getElementById("progress-bar");e.onProgress.add((()=>{i.style.width=`${e.progress}%`})),e.onComplete.add((()=>{t.classList.add("hidden")}))}(this.loader);const i=new FileReader;i.onload=e=>{let t,i;try{t=JSON.parse(e.target.result),i=t.pack;const o=i.hash;if(i.hash=0,o!==(0,O.i)((0,C.l)(i)))throw"Error: The file content is not matching the hash code"}catch(e){return console.log(e),void L()}var o;o=function(e){const t=[];let i=0,o=e.options[i];for(;o;){if(o[1].speed){let e=null;switch(o[1].speed){case"slow":e=20;break;case"medium":e=25;break;case"fast":e=30}const i=o[0];t.push([i,e])}i++,o=e.options[i]}let s=0,n=0,a=25;for(let e=0;e<t.length;e++){const i=t[e][0];s+=(i-n)/a,n=i,a=t[e][1]}return s+=(e.inputs.length-n)/a,s}(i),document.getElementById("time-duration").textContent=N(o),this.loader.load((()=>{var e;this.pikaVolley=new V(this.stage,this.loader.resources,i.roomID,i.nicknames,i.partialPublicIPs,i.inputs,i.options,i.chats),(0,f.yg)(this.pikaVolley),e=i.inputs.length,P.max=e,this.seekFrame(0),this.ticker.start(),function(){const e=document.getElementById("play-pause-btn");D.ticker.started?e.textContent=document.getElementById("pause-mark").textContent:e.textContent=document.getElementById("play-mark").textContent}(),P.disabled=!1,B.disabled=!1,A.disabled=!1,v.disabled=!1,x.disabled=!1,F.disabled=!1,T.disabled=!1,U.disabled=!1,R.disabled=!1,$.disabled=!1,window.dispatchEvent(new Event("pikaReplayLoaded"))}))};try{i.readAsText(e)}catch(e){return console.log(e),void L()}}seekFrame(e){if((0,f.lD)(),document.getElementById("notice-end-of-replay").classList.add("hidden"),this.ticker.stop(),this.pikaVolley.initializeForReplay(),e>0){for(let t=0;t<e;t++)this.pikaVolley.gameLoopSilent();this.renderer.render(this.stage)}M(this.pikaVolley.timeCurrent)}seekRelativeTime(e){const t=Math.max(0,this.pikaVolley.replayFrameCounter+e*this.pikaVolley.normalFPS);this.seekFrame(t)}adjustPlaybackSpeedTimes(e){this.playBackSpeedFPS=null,this.playBackSpeedTimes=e,this.ticker.maxFPS=this.pikaVolley.normalFPS*this.playBackSpeedTimes,H()}adjustPlaybackSpeedFPS(e){this.playBackSpeedTimes=null,this.playBackSpeedFPS=e,this.ticker.maxFPS=this.playBackSpeedFPS,H()}stopBGM(){this.pikaVolley.audio.sounds.bgm.center.stop()}playBGMProperly(){this.pikaVolley.isBGMPlaying&&this.pikaVolley.audio.sounds.bgm.center.play({start:this.pikaVolley.timeBGM})}},P=document.getElementById("scrubber-range-input"),B=document.getElementById("play-pause-btn"),A=document.getElementById("seek-backward-1"),v=document.getElementById("seek-forward-1"),x=document.getElementById("seek-backward-3"),F=document.getElementById("seek-forward-3"),T=document.getElementById("speed-btn-5-fps"),U=document.getElementById("speed-btn-half-times"),R=document.getElementById("speed-btn-1-times"),$=document.getElementById("speed-btn-2-times");function H(){document.getElementById("fps-input").value=D.ticker.maxFPS}function L(){document.getElementById("notice-file-open-error").classList.remove("hidden")}function M(e){document.getElementById("time-current").textContent=N(e)}function N(e){const t=Math.floor(e%60),i=Math.floor(e/60)%60,o=Math.floor(Math.floor(e/60)/60);return o>0?`${String(o)}:${("0"+i).slice(-2)}:${("0"+t).slice(-2)}`:`${String(i)}:${("0"+t).slice(-2)}`}class V extends g.q{constructor(e,t,i,o,s,n,a,r){super(e,t),this.noInputFrameTotal.menu=1/0,this.roomId=i,this.nicknames=o,this.partialPublicIPs=s,this.inputs=n,this.options=a,this.chats=r,this.player1Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:()=>{}},this.player2Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:()=>{}},this.keyboardArray=[this.player1Keyboard,this.player2Keyboard],this.willDisplayChat=!0;const l={play:()=>{},stop:()=>{}};this.fakeAudio={sounds:{bgm:{fake:!0,center:{isPlaying:!1},play:function(){this.center.isPlaying=!0},stop:function(){this.center.isPlaying=!1}},pipikachu:l,pika:l,chu:l,pi:l,pikachu:l,powerHit:l,ballTouchesGround:l}},this.initializeForReplay()}initializeForReplay(){for(const e in this.audio.sounds)this.audio.sounds[e].stop();this.timeCurrent=0,this.timeBGM=0,this.isBGMPlaying=!1,this.replayFrameCounter=0,this.chatCounter=0,this.optionsCounter=0;const e=y().alea(this.roomId.slice(10));(0,k.p)(e);const t=y().alea(this.roomId.slice(10,15)),i=y().alea(this.roomId.slice(15));(0,f.pt)(t,i),this.view.game.cloudArray=[];for(let e=0;e<10;e++)this.view.game.cloudArray.push(new I.Es);this.view.game.wave=new I.wH,this.view.intro.visible=!1,this.view.menu.visible=!1,this.view.game.visible=!1,this.view.fadeInOut.visible=!1,this.physics=new b.vW(!0,!0),this.normalFPS=25,this.slowMotionFPS=5,this.SLOW_MOTION_FRAMES_NUM=6,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.selectedWithWho=0,this.scores=[0,0],this.winningScore=15,this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.frameCounter=0,this.noInputFrameCounter=0,this.paused=!1,this.isStereoSound=!0,this._isPracticeMode=!1,this.isRoomCreatorPlayer2=!1,this.state=this.intro}intro(){0===this.frameCounter&&(this.selectedWithWho=0,this.nicknames&&((0,S.sb)(this.nicknames[0],this.isRoomCreatorPlayer2),(0,S.sb)(this.nicknames[1],!this.isRoomCreatorPlayer2)),this.partialPublicIPs&&((0,S.UI)(this.partialPublicIPs[0],this.isRoomCreatorPlayer2),(0,S.UI)(this.partialPublicIPs[1],!this.isRoomCreatorPlayer2))),super.intro()}menu(){const e=this.selectedWithWho;super.menu(),this.selectedWithWho!==e&&(this.isRoomCreatorPlayer2=!this.isRoomCreatorPlayer2,this.nicknames&&((0,S.sb)(this.nicknames[0],this.isRoomCreatorPlayer2),(0,S.sb)(this.nicknames[1],!this.isRoomCreatorPlayer2)),this.partialPublicIPs&&((0,S.UI)(this.partialPublicIPs[0],this.isRoomCreatorPlayer2),(0,S.UI)(this.partialPublicIPs[1],!this.isRoomCreatorPlayer2)))}gameLoopSilent(){const e=this.audio;this.willDisplayChat=!1,this.audio=this.fakeAudio,this.gameLoop(),this.willDisplayChat=!0,this.audio=e}gameLoop(){if(this.replayFrameCounter>=this.inputs.length)return void document.getElementById("notice-end-of-replay").classList.remove("hidden");var e;e=this.replayFrameCounter,P.value=e;const t=this.inputs[this.replayFrameCounter],i=(0,E.d)(t>>>5),o=(0,E.d)(t%32);this.player1Keyboard.xDirection=i.xDirection,this.player1Keyboard.yDirection=i.yDirection,this.player1Keyboard.powerHit=i.powerHit,this.player2Keyboard.xDirection=o.xDirection,this.player2Keyboard.yDirection=o.yDirection,this.player2Keyboard.powerHit=o.powerHit,function(e,t){const i=document.getElementById("z-key"),o=document.getElementById("r-key"),s=document.getElementById("v-key"),n=document.getElementById("d-key"),a=document.getElementById("g-key"),r=document.getElementById("enter-key"),l=document.getElementById("up-key"),c=document.getElementById("down-key"),d=document.getElementById("left-key"),h=document.getElementById("right-key");function u(e){e.classList.add("pressed")}function p(e){e.classList.remove("pressed")}switch(e.xDirection){case 0:p(n),p(a);break;case-1:u(n),p(a);break;case 1:p(n),u(a)}switch(e.yDirection){case 0:p(o),p(s);break;case-1:u(o),p(s);break;case 1:p(o),u(s)}switch(e.powerHit){case 0:p(i);break;case 1:u(i)}switch(t.xDirection){case 0:p(d),p(h);break;case-1:u(d),p(h);break;case 1:p(d),u(h)}switch(t.yDirection){case 0:p(l),p(c);break;case-1:u(l),p(c);break;case 1:p(l),u(c)}switch(t.powerHit){case 0:p(r);break;case 1:u(r)}}(i,o);let s=this.options[this.optionsCounter];for(;s&&s[0]===this.replayFrameCounter;){if(s[1].speed){switch(s[1].speed){case"slow":this.normalFPS=20;break;case"medium":this.normalFPS=25;break;case"fast":this.normalFPS=30}n=this.normalFPS,D.playBackSpeedFPS?(D.ticker.maxFPS=D.playBackSpeedFPS,H()):D.playBackSpeedTimes&&(D.ticker.maxFPS=n*D.playBackSpeedTimes,H())}if(s[1].winningScore)switch(s[1].winningScore){case 5:this.winningScore=5;break;case 10:this.winningScore=10;break;case 15:this.winningScore=15}this.optionsCounter++,s=this.options[this.optionsCounter]}var n;this.timeCurrent+=1/this.normalFPS,this.isBGMPlaying=this.audio.sounds.bgm.center.isPlaying,this.isBGMPlaying?this.timeBGM=(this.timeBGM+1/this.normalFPS)%83:this.timeBGM=0;let a=this.chats[this.chatCounter];for(;a&&a[0]===this.replayFrameCounter;)this.willDisplayChat&&(0,f.rE)(a[2],a[1]),this.chatCounter++,a=this.chats[this.chatCounter];this.replayFrameCounter++,this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,super.gameLoop()}}var _=i(5046);console.log("üé¨ [INIT] Offline Renderer (FIXED - Audio Debug & Symmetric UI)");const K=Node.prototype.replaceChild;Node.prototype.replaceChild=function(e,t){try{return K.call(this,e,t)}catch(t){try{this.appendChild(e)}catch(e){}return e}};const W=Node.prototype.removeChild;Node.prototype.removeChild=function(e){try{return W.call(this,e)}catch(e){return null}},function(){const e="../../";if(!p.I.SPRITE_SHEET.startsWith(e)){const t=e=>e.replace(/^\.\.\//,"");p.I.SPRITE_SHEET=e+t(p.I.SPRITE_SHEET);for(const i in p.I.SOUNDS)p.I.SOUNDS[i]=e+t(p.I.SOUNDS[i])}}();const G=new class{constructor(){n.A4.registerPlugin("prepare",a.p8),n.A4.registerPlugin("batch",n.ch),d.KB.registerPlugin("prepare",u.S),d.KB.registerPlugin("sprite",h.$),l.aH.registerPlugin(c.A),o.W.RESOLUTION=2,o.W.SCALE_MODE=s.M6.NEAREST,o.W.ROUND_PIXELS=!0,this.renderer=null,this.stage=null,this.loader=null,this.pikaVolley=null,this.audioLog=[],this.decodedBuffers={},this.totalDuration=0,this.muxer=null,this.videoEncoder=null,this.audioEncoder=null}updateStatus(e){const t=document.getElementById("status");t&&(t.textContent=e),console.log(`üìù [STATUS] ${e}`)}handleRecordButtonClick(){const e=document.createElement("input");e.type="file",e.accept=".txt",e.onchange=e=>{const t=e.target.files[0];t&&this.loadReplayFile(t)},e.click()}loadReplayFile(e){this.updateStatus("Î¶¨ÌîåÎ†àÏù¥ Î∂ÑÏÑù Ï§ë...");const t=new FileReader;t.onload=e=>{try{const t=JSON.parse(e.target.result).pack,i=t.hash;t.hash=0,i!==(0,O.i)((0,C.l)(t))&&console.warn("‚ö†Ô∏è [HASH] Hash mismatch - ignored"),t.hash=i,this.initializeRenderer(t)}catch(e){console.error("‚ùå [LOAD] Error:",e),this.updateStatus("ÌååÏùº Î°úÎî© Ïã§Ìå®")}},t.readAsText(e)}initializeRenderer(e){this.updateStatus("Î¶¨ÏÜåÏä§ Î∞è Ïò§ÎîîÏò§ ÎîîÏΩîÎî© Ï§ë..."),this.renderer=(0,n.q5)({width:432,height:304,antialias:!1,backgroundColor:0,forceCanvas:!0,preserveDrawingBuffer:!0}),this.stage=new r.mc,this.loader=new l.aH;const t=document.querySelector("#game-canvas-container");t.innerHTML="",t.appendChild(this.renderer.view),this.ensureDOMElements(t),this.loader.add(p.I.SPRITE_SHEET);const i=[],o=new(window.AudioContext||window.webkitAudioContext),s={BGM:"bgm",PIPIKACHU:"pipikachu",PIKA:"pika",CHU:"chu",PI:"pi",PIKACHU:"pikachu",POWERHIT:"powerHit",BALLTOUCHESGROUND:"ballTouchesGround"};console.log("üîä [AUDIO] Starting audio decoding..."),console.log("üîä [AUDIO] Sound files:",Object.keys(p.I.SOUNDS)),console.log("üîë [AUDIO] Key mapping:",s);for(const e in p.I.SOUNDS){const t=p.I.SOUNDS[e];console.log(`üîä [AUDIO] Decoding: ${e} from ${t}`);const n=fetch(t).then((t=>(console.log(`üì• [AUDIO] Fetched: ${e}, size: ${t.headers.get("content-length")}`),t.arrayBuffer()))).then((t=>(console.log(`üì¶ [AUDIO] Buffer received: ${e}, size: ${t.byteLength}`),o.decodeAudioData(t)))).then((t=>{const i=s[e]||e.toLowerCase();this.decodedBuffers[i]=t,console.log(`‚úÖ [AUDIO] Decoded: ${e} ‚Üí stored as "${i}", duration: ${t.duration.toFixed(2)}s, channels: ${t.numberOfChannels}`)})).catch((t=>{console.error(`‚ùå [AUDIO] Failed to decode ${e}:`,t)}));i.push(n),this.loader.add(p.I.SOUNDS[e])}Promise.all(i).then((()=>{console.log("‚úÖ [AUDIO] All sounds decoded"),console.log("üîë [AUDIO] Available buffer keys:",Object.keys(this.decodedBuffers)),this.loader.load((()=>this.startOfflineProcessing(e)))}))}ensureDOMElements(e){["player1-chat-box","player2-chat-box","player1-nickname","player2-nickname","player1-partial-ip","player2-partial-ip","player1-chat-disabled","player2-chat-disabled"].forEach((t=>{if(!document.getElementById(t)){const i=document.createElement("div");i.id=t,i.style.display="none",e.appendChild(i)}}))}async startOfflineProcessing(e){this.updateStatus("Ïò§ÌîÑÎùºÏù∏ Î†åÎçîÎßÅ ÏãúÏûë..."),this.pikaVolley=new V(this.stage,this.loader.resources,e.roomID,e.nicknames,e.partialPublicIPs,e.inputs,e.options,e.chats);try{(0,f.yg)(this.pikaVolley)}catch(e){console.warn("‚ö†Ô∏è [GAME] setGetSpeechBubbleNeeded failed:",e)}this.pikaVolley.willDisplayChat=!0,this.audioLog=[],this.mockAudioSystem();const t=e.inputs.length;this.totalDuration=t/30,console.log(`üìä [RENDER] Total frames: ${t}, duration: ${this.totalDuration.toFixed(2)}s`),this.muxer=new _._j({target:new _.T9,video:{codec:"avc",width:432,height:304},audio:{codec:"aac",sampleRate:44100,numberOfChannels:2},fastStart:"in-memory"}),this.videoEncoder=new VideoEncoder({output:(e,t)=>this.muxer.addVideoChunk(e,t),error:e=>console.error("‚ùå [VIDEO] Encoder error:",e)}),this.videoEncoder.configure({codec:"avc1.42001f",width:432,height:304,bitrate:25e5,framerate:30}),this.audioEncoder=new AudioEncoder({output:(e,t)=>this.muxer.addAudioChunk(e,t),error:e=>console.error("‚ùå [AUDIO] Encoder error:",e)}),this.audioEncoder.configure({codec:"mp4a.40.2",sampleRate:44100,numberOfChannels:2,bitrate:128e3});const i=document.getElementById("progress-bar");for(let e=0;e<t;e++){this.videoEncoder.encodeQueueSize>20&&await new Promise((e=>setTimeout(e,10)));try{this.pikaVolley.gameLoopSilent()}catch(t){e%1e3==0&&console.warn(`‚ö†Ô∏è [RENDER] Frame ${e} error:`,t)}this.renderer.render(this.stage),this.drawOverlaysOnCanvas();const o=await createImageBitmap(this.renderer.view),s=new VideoFrame(o,{timestamp:1e6*e/30}),n=e%90==0;if(this.videoEncoder.encode(s,{keyFrame:n}),s.close(),e%30==0){const o=Math.floor(e/t*100);this.updateStatus(`ÏòÅÏÉÅ Ï≤òÎ¶¨ Ï§ë... ${o}%`),i&&(i.style.width=`${o}%`),await new Promise((e=>setTimeout(e,0)))}}await this.videoEncoder.flush(),console.log("‚úÖ [VIDEO] All frames encoded"),console.log(`üîä [AUDIO] Audio log entries: ${this.audioLog.length}`),this.audioLog.length>0&&console.log("üîä [AUDIO] Sample events:",this.audioLog.slice(0,5)),this.updateStatus("Ïò§ÎîîÏò§ Ìï©ÏÑ± Ï§ë..."),await this.synthesizeAndEncodeAudio(30),this.muxer.finalize();const o=this.muxer.target.buffer;this.saveFile(o)}mockAudioSystem(){console.log("üîä [AUDIO-HOOK] Starting mockAudioSystem..."),this.pikaVolley.audio.turnBGMVolume(!1),this.pikaVolley.audio.turnSFXVolume(!0);const e=this.pikaVolley.fakeAudio.sounds;console.log("üîä [AUDIO-HOOK] fakeAudio.sounds keys:",Object.keys(e));for(const t in e)"bgm"!==t?(console.log(`üîä [AUDIO-HOOK] Hooking sound: "${t}"`),e[t]={play:(e=0)=>{const i=this.pikaVolley.replayFrameCounter;console.log(`üéµ [AUDIO-EVENT] Sound: "${t}", Frame: ${i}, Pan: ${e}`),this.audioLog.push({key:t,frame:i,pan:e})},stop:()=>{}}):console.log("üîá [AUDIO-HOOK] Skipping BGM");console.log("‚úÖ [AUDIO-HOOK] mockAudioSystem complete")}async synthesizeAndEncodeAudio(e){if(0===this.audioLog.length)return void console.warn("‚ö†Ô∏è [AUDIO] No audio events recorded - skipping audio synthesis");console.log(`üîä [AUDIO-SYNTH] Starting synthesis with ${this.audioLog.length} events`);const t=44100,i=Math.ceil(this.totalDuration*t)+t;console.log(`üîä [AUDIO-SYNTH] Creating OfflineAudioContext: ${i} samples, ${this.totalDuration.toFixed(2)}s`);const o=new OfflineAudioContext(2,i,t);let s=0,n=0;this.audioLog.forEach(((t,i)=>{const a=this.decodedBuffers[t.key];if(!a)return n++,void(i<5&&(console.warn(`‚ö†Ô∏è [AUDIO-SYNTH] No buffer for key: "${t.key}"`),console.warn(`   Available keys: ${Object.keys(this.decodedBuffers).join(", ")}`)));const r=o.createBufferSource();r.buffer=a;const l=o.createStereoPanner();l.pan.value=.75*(t.pan||0),r.connect(l),l.connect(o.destination);const c=t.frame/e;r.start(c),s++,(i<5||i%100==0)&&console.log(`üéµ [AUDIO-SYNTH] Event ${i}: ${t.key} at ${c.toFixed(2)}s, pan: ${l.pan.value.toFixed(2)}`)})),console.log(`‚úÖ [AUDIO-SYNTH] Placed ${s} audio events (skipped ${n} due to missing buffers)`),console.log("üîä [AUDIO-SYNTH] Starting offline rendering...");const a=await o.startRendering();console.log(`‚úÖ [AUDIO-SYNTH] Rendered: ${a.length} samples, ${a.duration.toFixed(2)}s`);const r=a.getChannelData(0),l=a.getChannelData(1);let c=0,d=0;for(let e=0;e<Math.min(1e3,r.length);e++)c=Math.max(c,Math.abs(r[e])),d=Math.max(d,Math.abs(l[e]));console.log(`üîä [AUDIO-SYNTH] Sample check - Left peak: ${c.toFixed(4)}, Right peak: ${d.toFixed(4)}`),console.log("üîä [AUDIO-ENCODE] Starting audio encoding...");const h=a.length,u=a.numberOfChannels;let p=0;for(let e=0;e<h;e+=4096){const i=Math.min(4096,h-e),o=new Float32Array(i*u);for(let t=0;t<u;t++){const s=a.getChannelData(t),n=t*i;for(let t=0;t<i;t++)o[n+t]=s[e+t]}const s=new AudioData({format:"f32-planar",sampleRate:t,numberOfChannels:u,numberOfFrames:i,timestamp:e/t*1e6,data:o.buffer});this.audioEncoder.encode(s),s.close(),p++,p%100==0&&console.log(`üîä [AUDIO-ENCODE] Encoded ${p} chunks`)}await this.audioEncoder.flush(),console.log(`‚úÖ [AUDIO-ENCODE] Complete - ${p} chunks encoded`)}saveFile(e){const t=new Blob([e],{type:"video/mp4"}),i=URL.createObjectURL(t);console.log(`üíæ [SAVE] File size: ${(e.byteLength/1024/1024).toFixed(2)} MB`);const o=new Date,s=`${o.getFullYear()}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}`,n=`${String(o.getHours()).padStart(2,"0")}${String(o.getMinutes()).padStart(2,"0")}`;let a=`${s}_${n}_pikavolley_replay.mp4`;this.pikaVolley.nicknames&&2===this.pikaVolley.nicknames.length&&(a=`${s}_${n}_${this.pikaVolley.nicknames[0].replace(/[/\\?%*:|"<>]/g,"_")}_vs_${this.pikaVolley.nicknames[1].replace(/[/\\?%*:|"<>]/g,"_")}.mp4`);const r=document.createElement("a");r.href=i,r.download=a,r.click(),this.updateStatus("ÏôÑÎ£å!");const l=document.getElementById("record-btn");l&&(l.disabled=!1);const c=document.getElementById("loading-overlay");c&&c.classList.add("hidden"),setTimeout((()=>{URL.revokeObjectURL(i),this.muxer=null,this.videoEncoder=null,this.audioEncoder=null,this.audioLog=[]}),1e3)}drawOverlaysOnCanvas(){const e=this.renderer.view.getContext("2d");if(!e)return;e.save();const t=352,i=document.getElementById("player1-nickname")?.textContent||"",o=document.getElementById("player1-partial-ip")?.textContent||"",s=document.getElementById("player2-nickname")?.textContent||"",n=document.getElementById("player2-partial-ip")?.textContent||"";i&&(e.font='bold 16px "Segoe UI", sans-serif',e.textAlign="center",e.textBaseline="top",e.fillStyle="white",e.strokeStyle="black",e.lineWidth=3,e.strokeText(i,80,10),e.fillText(i,80,10),o&&(e.font="12px sans-serif",e.strokeText(o,80,30),e.fillText(o,80,30))),s&&(e.font='bold 16px "Segoe UI", sans-serif',e.textAlign="center",e.textBaseline="top",e.fillStyle="white",e.strokeStyle="black",e.lineWidth=3,e.strokeText(s,t,10),e.fillText(s,t,10),n&&(e.font="12px sans-serif",e.strokeText(n,t,30),e.fillText(n,t,30))),this.drawChatBubble(e,"player1-chat-box",80,60),this.drawChatBubble(e,"player2-chat-box",t,60),e.restore()}drawChatBubble(e,t,i,o){const s=document.getElementById(t);if(!s||!s.textContent||""===s.textContent.trim())return;const n=s.textContent;e.font="14px sans-serif",e.textAlign="center";const a=e.measureText(n).width+20;e.fillStyle="rgba(255, 255, 255, 0.9)",e.fillRect(i-a/2,o,a,30),e.strokeStyle="black",e.lineWidth=1,e.strokeRect(i-a/2,o,a,30),e.fillStyle="black",e.fillText(n,i,o+10)}},z=document.getElementById("record-btn");z&&z.addEventListener("click",(()=>G.handleRecordButtonClick())),console.log("‚úÖ [INIT] Offline converter ready")}},e=>{e.O(0,[244,46,415,476],(()=>e(e.s=5128))),e.O()}]);
//# sourceMappingURL=main_out.dc2a4b90f86f6fded877.js.map