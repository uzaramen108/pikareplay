"use strict";(self.webpackChunkpikachu_volleyball_p2p_online=self.webpackChunkpikachu_volleyball_p2p_online||[]).push([[293],{4646:(e,o,t)=>{var n=t(4603),s=t(6787),c=t(592),l=t(3650),a=t(9449),i=t(7561),r=t(7049),d=t(3401),h=t(8077),g=t(4697),p=t(8505),m=(t(7229),t(6090)),u=t(3374),E=t(653),k=t(6212),R=t(6970);console.log("ğŸ¬ [INIT] main_out.js loaded"),function(){console.log("ğŸ”§ [ASSETS] Adjusting assets path..."),m.I.SPRITE_SHEET="../"+m.I.SPRITE_SHEET;for(const e in m.I.SOUNDS)m.I.SOUNDS[e]="../"+m.I.SOUNDS[e];console.log("âœ… [ASSETS] Assets path adjusted")}(),console.log("ğŸ¬ [INIT] Initializing converter...");const b=new class{constructor(){console.log("ğŸ¬ [CONSTRUCTOR] Creating ReplayToVideoConverter"),c.A4.registerPlugin("prepare",l.p8),c.A4.registerPlugin("batch",c.ch),h.KB.registerPlugin("prepare",p.S),h.KB.registerPlugin("sprite",g.$),i.aH.registerPlugin(r.A),n.W.RESOLUTION=2,n.W.SCALE_MODE=s.M6.NEAREST,n.W.ROUND_PIXELS=!0,this.renderer=null,this.stage=null,this.loader=null,this.ticker=null,this.pikaVolley=null,this.currentPack=null,this.mediaRecorder=null,this.recordedChunks=[],this.isRecording=!1,console.log("âœ… [CONSTRUCTOR] ReplayToVideoConverter created")}updateStatus(e){const o=document.getElementById("status");console.log(`ğŸ“ [STATUS] ${e}`),o&&(o.textContent=e)}handleRecordButtonClick(){if(console.log("ğŸ”˜ [BUTTON] Record button clicked"),this.isRecording)return console.warn("âš ï¸ [BUTTON] Already recording!"),void this.updateStatus("ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...");console.log("ğŸ“‚ [BUTTON] Opening file picker...");const e=document.createElement("input");e.type="file",e.accept=".txt",e.onchange=e=>{const o=e.target.files[0];console.log("ğŸ“„ [FILE] File selected:",o?.name),o&&this.loadReplayFile(o)},e.click()}loadReplayFile(e){console.log("ğŸ“¥ [LOAD] Loading replay file:",e.name),this.updateStatus("ë¦¬í”Œë ˆì´ íŒŒì¼ ë¡œë”© ì¤‘...");const o=document.getElementById("record-btn");console.log("ğŸ”˜ [LOAD] Record button element:",o),o&&(o.disabled=!0);const t=document.getElementById("loading-overlay");console.log("â³ [LOAD] Loading overlay element:",t),t&&(t.classList.remove("hidden"),console.log("âœ… [LOAD] Loading overlay shown"));const n=new FileReader;n.onload=e=>{console.log("ğŸ“– [LOAD] File read complete");try{const o=JSON.parse(e.target.result);console.log("ğŸ“¦ [LOAD] Pack parsed:",{hasNicknames:!!o.pack?.nicknames,nicknamesLength:o.pack?.nicknames?.length,nicknames:o.pack?.nicknames,hasIPs:!!o.pack?.partialPublicIPs,IPs:o.pack?.partialPublicIPs,hasChats:!!o.pack?.chats,chatsLength:o.pack?.chats?.length});const t=o.pack,n=t.hash;if(t.hash=0,n!==(0,R.i)((0,k.l)(t)))throw new Error("íŒŒì¼ ë‚´ìš©ì´ í•´ì‹œ ì½”ë“œì™€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤");console.log("âœ… [LOAD] Hash verification passed"),this.initializeRenderer(t)}catch(e){console.error("âŒ [LOAD] Error loading file:",e),this.updateStatus("íŒŒì¼ ë¡œë”© ì‹¤íŒ¨: "+e.message),o&&(o.disabled=!1),t&&t.classList.add("hidden")}},n.onerror=()=>{console.error("âŒ [LOAD] File read error"),this.updateStatus("íŒŒì¼ ì½ê¸° ì‹¤íŒ¨"),o&&(o.disabled=!1),t&&t.classList.add("hidden")},n.readAsText(e)}initializeRenderer(e){console.log("ğŸ¨ [RENDERER] Initializing renderer..."),this.updateStatus("ê²Œì„ ì—ì…‹ ë¡œë”© ì¤‘..."),this.currentPack=e,this.renderer=(0,c.q5)({width:432,height:304,antialias:!1,backgroundColor:0,backgroundAlpha:1,forceCanvas:!0,preserveDrawingBuffer:!0}),console.log("âœ… [RENDERER] Renderer created"),this.stage=new a.mc,this.ticker=new d.Rv,this.ticker.minFPS=1,this.loader=new i.aH,console.log("âœ… [RENDERER] Stage, ticker, loader created");const o=document.querySelector("#game-canvas-container");console.log("ğŸ“¦ [RENDERER] Game container element:",o),o.innerHTML="",o.appendChild(this.renderer.view),console.log("âœ… [RENDERER] Canvas appended to container");const t=m.I.TEXTURES;t.WITH_COMPUTER=t.WITH_FRIEND,this.loader.add(m.I.SPRITE_SHEET);for(const e in m.I.SOUNDS)this.loader.add(m.I.SOUNDS[e]);console.log("âœ… [RENDERER] Assets added to loader"),this.setupLoaderProgressBar(),this.loader.load((()=>this.setupGame(e))),console.log("ğŸ”„ [RENDERER] Loading assets...")}setupLoaderProgressBar(){const e=document.getElementById("progress-bar");console.log("ğŸ“Š [PROGRESS] Progress bar element:",e),e&&this.loader.onProgress.add((()=>{e.style.width=`${this.loader.progress}%`}))}setupGame(e){console.log("ğŸ® [GAME] Setting up game..."),console.log("ğŸ“¦ [GAME] Pack data:",{nicknames:e.nicknames,IPs:e.partialPublicIPs,chatsCount:e.chats?.length,inputsCount:e.inputs?.length}),this.updateStatus("ê²Œì„ ì´ˆê¸°í™” ì¤‘..."),console.log("ğŸ” [DOM] Checking DOM elements...");const o=document.getElementById("player1-chat-box"),t=document.getElementById("player2-chat-box"),n=document.getElementById("player1-nickname"),s=document.getElementById("player2-nickname"),c=document.getElementById("player1-partial-ip"),l=document.getElementById("player2-partial-ip"),a=document.getElementById("player1-chat-disabled"),i=document.getElementById("player2-chat-disabled");console.log("ğŸ“‹ [DOM] Chat boxes:",{chatBox1:o,chatBox2:t}),console.log("ğŸ“‹ [DOM] Nicknames:",{nick1:n,nick2:s}),console.log("ğŸ“‹ [DOM] IPs:",{ip1:c,ip2:l}),console.log("ğŸ“‹ [DOM] Chat disabled:",{chatDisabled1:a,chatDisabled2:i}),console.log("ğŸ® [GAME] Creating PikachuVolleyballReplay..."),this.pikaVolley=new u.Z(this.stage,this.loader.resources,e.roomID,e.nicknames,e.partialPublicIPs,e.inputs,e.options,e.chats),console.log("âœ… [GAME] PikachuVolleyballReplay created"),console.log("ğŸ’¬ [GAME] Setting speech bubble function...");try{(0,E.yg)(this.pikaVolley),console.log("âœ… [GAME] Speech bubble function set")}catch(e){console.error("âŒ [GAME] Error setting speech bubble:",e)}console.log("ğŸ’¬ [GAME] Enabling chat display..."),this.pikaVolley.willDisplayChat=!0;try{(0,E.Az)(!0),console.log("âœ… [GAME] Chat enabled")}catch(e){console.error("âŒ [GAME] Error enabling chat:",e)}console.log("â˜‘ï¸ [CHECKBOX] Activating checkboxes...");const r=document.getElementById("show-nicknames-checkbox"),d=document.getElementById("show-ip-addresses-checkbox"),h=document.getElementById("show-chat-checkbox");console.log("ğŸ“‹ [CHECKBOX] Checkbox elements:",{nicknames:r,ips:d,chat:h}),r?(console.log("â˜‘ï¸ [CHECKBOX] Activating nicknames checkbox..."),r.checked=!0,r.dispatchEvent(new Event("change")),console.log("âœ… [CHECKBOX] Nicknames checkbox activated, checked:",r.checked)):console.warn("âš ï¸ [CHECKBOX] Nicknames checkbox not found!"),d?(console.log("â˜‘ï¸ [CHECKBOX] Activating IPs checkbox..."),d.checked=!0,d.dispatchEvent(new Event("change")),console.log("âœ… [CHECKBOX] IPs checkbox activated, checked:",d.checked)):console.warn("âš ï¸ [CHECKBOX] IPs checkbox not found!"),h?(console.log("â˜‘ï¸ [CHECKBOX] Activating chat checkbox..."),h.checked=!0,h.dispatchEvent(new Event("change")),console.log("âœ… [CHECKBOX] Chat checkbox activated, checked:",h.checked)):console.warn("âš ï¸ [CHECKBOX] Chat checkbox not found!"),console.log("ğŸ” [DOM] Checking DOM elements AFTER checkbox activation..."),console.log("ğŸ“‹ [DOM] Nickname classes:",{nick1:n?.className,nick2:s?.className}),console.log("ğŸ“‹ [DOM] IP classes:",{ip1:c?.className,ip2:l?.className}),console.log("ğŸ”‡ [AUDIO] Disabling BGM..."),this.pikaVolley.audio.turnBGMVolume(!1),this.pikaVolley.audio.sounds.bgm&&this.pikaVolley.audio.sounds.bgm.center&&(this.pikaVolley.audio.sounds.bgm.center.stop(),this.pikaVolley.audio.sounds.bgm.center.play=function(){console.log("ğŸ”‡ [AUDIO] BGM play blocked")},this.pikaVolley.audio.sounds.bgm.center.isPlaying=!1),console.log("âœ… [AUDIO] BGM disabled"),console.log("ğŸ”Š [AUDIO] Enabling SFX..."),this.pikaVolley.audio.turnSFXVolume(!0),console.log("âœ… [AUDIO] SFX enabled"),console.log("ğŸ”„ [TICKER] Setting up ticker..."),this.ticker.add((()=>{this.renderer.render(this.stage),this.pikaVolley.gameLoop()})),console.log("âœ… [TICKER] Ticker set up"),setTimeout((()=>this.startRecording()),100),console.log("â° [GAME] Recording will start in 100ms")}startRecording(){console.log("ğŸ¥ [RECORD] Starting recording..."),this.updateStatus("ë…¹í™” ì¤€ë¹„ ì¤‘..."),this.recordedChunks=[],this.isRecording=!0;const e=this.renderer.view;console.log("ğŸ–¼ï¸ [RECORD] Canvas:",e);try{const o=30,t=e.captureStream(o);console.log("ğŸ“¹ [RECORD] Canvas stream created at",o,"FPS");let n="video/webm;codecs=vp9";MediaRecorder.isTypeSupported(n)||(console.warn("âš ï¸ [RECORD] VP9 not supported, trying VP8"),n="video/webm;codecs=vp8",MediaRecorder.isTypeSupported(n)||(console.warn("âš ï¸ [RECORD] VP8 not supported, using default webm"),n="video/webm")),console.log("âœ… [RECORD] Using codec:",n),this.mediaRecorder=new MediaRecorder(t,{mimeType:n,videoBitsPerSecond:25e5}),console.log("âœ… [RECORD] MediaRecorder created"),this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&(this.recordedChunks.push(e.data),console.log(`ğŸ“¦ [RECORD] Data chunk received: ${e.data.size} bytes, total chunks: ${this.recordedChunks.length}`))},this.mediaRecorder.onstop=()=>{console.log("â¹ï¸ [RECORD] MediaRecorder stopped"),this.saveVideoFile()},this.mediaRecorder.onerror=e=>{console.error("âŒ [RECORD] MediaRecorder error:",e),this.updateStatus("ë…¹í™” ì¤‘ ì—ëŸ¬ ë°œìƒ"),this.isRecording=!1;const o=document.getElementById("record-btn");o&&(o.disabled=!1)},this.mediaRecorder.start(100),console.log("â–¶ï¸ [RECORD] MediaRecorder started"),this.ticker.maxFPS=30,this.ticker.start(),console.log("â–¶ï¸ [TICKER] Ticker started at 30 FPS"),this.updateStatus("ë…¹í™” ì¤‘... 0%"),this.monitorProgress(),console.log("ğŸ“Š [RECORD] Progress monitoring started")}catch(e){console.error("âŒ [RECORD] Error starting recording:",e),this.updateStatus("ë…¹í™” ì‹œì‘ ì‹¤íŒ¨: "+e.message),this.isRecording=!1;const o=document.getElementById("record-btn");o&&(o.disabled=!1)}}monitorProgress(){const e=this.pikaVolley.inputs.length;console.log("ğŸ“Š [PROGRESS] Total frames:",e);const o=document.getElementById("progress-bar"),t=setInterval((()=>{if(!this.pikaVolley||!this.isRecording)return console.log("â¹ï¸ [PROGRESS] Stopping progress monitoring"),void clearInterval(t);const n=this.pikaVolley.replayFrameCounter,s=Math.floor(n/e*100);n%100==0&&console.log(`ğŸ“Š [PROGRESS] Frame ${n}/${e} (${s}%)`),this.updateStatus(`ë…¹í™” ì¤‘... ${s}%`),o&&(o.style.width=`${s}%`),n>=e&&(console.log("ğŸ [PROGRESS] All frames processed"),clearInterval(t),this.stopRecording())}),500)}stopRecording(){this.isRecording?(console.log("â¹ï¸ [STOP] Stopping recording..."),this.updateStatus("ë…¹í™” ì™„ë£Œ, íŒŒì¼ ì €ì¥ ì¤‘..."),this.ticker.stop(),console.log("â¹ï¸ [STOP] Ticker stopped"),this.mediaRecorder&&"inactive"!==this.mediaRecorder.state?(console.log("â¹ï¸ [STOP] Stopping MediaRecorder..."),this.mediaRecorder.stop()):(console.log("âš ï¸ [STOP] MediaRecorder already inactive, saving directly"),this.saveVideoFile())):console.log("âš ï¸ [STOP] Not recording, skipping stop")}saveVideoFile(){if(console.log("ğŸ’¾ [SAVE] Saving video file..."),console.log("ğŸ“¦ [SAVE] Recorded chunks:",this.recordedChunks.length),0===this.recordedChunks.length){console.error("âŒ [SAVE] No recorded data!"),this.updateStatus("ë…¹í™”ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤"),this.isRecording=!1;const e=document.getElementById("record-btn");return void(e&&(e.disabled=!1))}const e=new Blob(this.recordedChunks,{type:"video/webm"});console.log("ğŸ“¦ [SAVE] Blob created:",e.size,"bytes");const o=URL.createObjectURL(e);console.log("ğŸ”— [SAVE] Object URL:",o);const t=new Date,n=`${t.getFullYear()}${("0"+(t.getMonth()+1)).slice(-2)}${("0"+t.getDate()).slice(-2)}`,s=`${("0"+t.getHours()).slice(-2)}${("0"+t.getMinutes()).slice(-2)}`;let c=`${n}_${s}_pikavolley_replay.webm`;const l=this.currentPack;l&&l.nicknames&&2===l.nicknames.length&&(c=`${n}_${s}_${l.nicknames[0].replace(/[/\\?%*:|"<>]/g,"_")}_vs_${l.nicknames[1].replace(/[/\\?%*:|"<>]/g,"_")}.webm`),console.log("ğŸ“ [SAVE] Filename:",c);const a=document.createElement("a");a.href=o,a.download=c,a.style.display="none",document.body.appendChild(a),a.click(),console.log("âœ… [SAVE] Download triggered"),setTimeout((()=>{document.body.removeChild(a),URL.revokeObjectURL(o),console.log("ğŸ§¹ [SAVE] Cleanup complete")}),100),this.updateStatus("ì™„ë£Œ! ë‹¤ë¥¸ ë¦¬í”Œë ˆì´ë¥¼ ë³€í™˜í•˜ë ¤ë©´ ë²„íŠ¼ì„ ë‹¤ì‹œ í´ë¦­í•˜ì„¸ìš”."),this.isRecording=!1;const i=document.getElementById("record-btn");i&&(i.disabled=!1),this.recordedChunks=[];const r=document.getElementById("loading-overlay");r&&r.classList.add("hidden"),console.log("âœ… [SAVE] Complete!")}},y=document.getElementById("record-btn");console.log("ğŸ”˜ [INIT] Record button:",y),y&&(y.addEventListener("click",(()=>b.handleRecordButtonClick())),console.log("âœ… [INIT] Record button listener attached")),document.addEventListener("DOMContentLoaded",(()=>{console.log("ğŸ“„ [DOM] DOMContentLoaded event fired");const e=document.getElementById("show-nicknames-checkbox"),o=document.getElementById("show-ip-addresses-checkbox"),t=document.getElementById("show-chat-checkbox"),n=document.getElementById("player1-nickname"),s=document.getElementById("player2-nickname"),c=document.getElementById("player1-partial-ip"),l=document.getElementById("player2-partial-ip");console.log("ğŸ” [DOM] UI Elements:",{showNicknamesCheckbox:e,showIPsCheckbox:o,showChatCheckbox:t,player1NicknameElem:n,player2NicknameElem:s,player1IPElem:c,player2IPElem:l}),e&&(e.addEventListener("change",(()=>{console.log("â˜‘ï¸ [EVENT] Nicknames checkbox changed:",e.checked),e.checked?(n&&(n.classList.remove("hidden"),console.log("âœ… [EVENT] Player1 nickname shown")),s&&(s.classList.remove("hidden"),console.log("âœ… [EVENT] Player2 nickname shown"))):(n&&n.classList.add("hidden"),s&&s.classList.add("hidden"))})),console.log("âœ… [DOM] Nicknames checkbox listener attached")),o&&(o.addEventListener("change",(()=>{console.log("â˜‘ï¸ [EVENT] IPs checkbox changed:",o.checked),o.checked?(c&&(c.classList.remove("hidden"),console.log("âœ… [EVENT] Player1 IP shown")),l&&(l.classList.remove("hidden"),console.log("âœ… [EVENT] Player2 IP shown"))):(c&&c.classList.add("hidden"),l&&l.classList.add("hidden"))})),console.log("âœ… [DOM] IPs checkbox listener attached")),t&&(t.addEventListener("change",(()=>{if(console.log("â˜‘ï¸ [EVENT] Chat checkbox changed:",t.checked),t.checked){console.log("ğŸ’¬ [EVENT] Enabling chat...");try{(0,E.Az)(!0),console.log("âœ… [EVENT] Chat enabled")}catch(e){console.error("âŒ [EVENT] Error enabling chat:",e)}}else{console.log("ğŸ”‡ [EVENT] Disabling chat...");try{(0,E.Az)(!1),console.log("âœ… [EVENT] Chat disabled")}catch(e){console.error("âŒ [EVENT] Error disabling chat:",e)}}})),console.log("âœ… [DOM] Chat checkbox listener attached"))})),console.log("âœ… [INIT] main_out.js initialization complete")}},e=>{e.O(0,[244,415,476],(()=>e(e.s=4646))),e.O()}]);
//# sourceMappingURL=main_out.414943a5017be659261f.js.map