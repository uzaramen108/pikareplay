{"version":3,"file":"main_out.393408d79c67b61bba8b.js","mappings":"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","sources":["webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay/main_out.js"],"sourcesContent":["/**\r\n * Main script for converting Pikachu Volleyball replay files to video\r\n */\r\n'use strict';\r\nimport { settings } from '@pixi/settings';\r\nimport { SCALE_MODES } from '@pixi/constants';\r\nimport { Renderer, BatchRenderer, autoDetectRenderer } from '@pixi/core';\r\nimport { Prepare } from '@pixi/prepare';\r\nimport { Container } from '@pixi/display';\r\nimport { Loader } from '@pixi/loaders';\r\nimport { SpritesheetLoader } from '@pixi/spritesheet';\r\nimport { Ticker } from '@pixi/ticker';\r\nimport { CanvasRenderer } from '@pixi/canvas-renderer';\r\nimport { CanvasSpriteRenderer } from '@pixi/canvas-sprite';\r\nimport { CanvasPrepare } from '@pixi/canvas-prepare';\r\nimport '@pixi/canvas-display';\r\nimport { ASSETS_PATH } from '../offline_version_js/assets_path.js';\r\nimport { PikachuVolleyballReplay } from './pikavolley_replay.js';\r\nimport { setGetSpeechBubbleNeeded } from '../chat_display.js';\r\nimport { serialize } from '../utils/serialize.js';\r\nimport { getHashCode } from '../utils/hash_code.js';\r\nimport '../../style.css';\r\n\r\n/**\r\n * Class for converting replay to video\r\n */\r\nclass ReplayToVideoConverter {\r\n  constructor() {\r\n    // Reference for how to use Renderer.registerPlugin\r\n    Renderer.registerPlugin('prepare', Prepare);\r\n    Renderer.registerPlugin('batch', BatchRenderer);\r\n    CanvasRenderer.registerPlugin('prepare', CanvasPrepare);\r\n    CanvasRenderer.registerPlugin('sprite', CanvasSpriteRenderer);\r\n    Loader.registerPlugin(SpritesheetLoader);\r\n    settings.RESOLUTION = 2;\r\n    settings.SCALE_MODE = SCALE_MODES.NEAREST;\r\n    settings.ROUND_PIXELS = true;\r\n\r\n    this.ticker = null;\r\n    this.renderer = null;\r\n    this.stage = null;\r\n    this.loader = null;\r\n    this.pikaVolley = null;\r\n    this.mediaRecorder = null;\r\n    this.recordedChunks = [];\r\n    this.isRecording = false;\r\n    this.currentPack = null;\r\n  }\r\n\r\n  /**\r\n   * Update status message\r\n   * @param {string} message \r\n   */\r\n  updateStatus(message) {\r\n    const statusEl = document.getElementById('status');\r\n    if (statusEl) {\r\n      statusEl.textContent = message;\r\n    }\r\n    console.log(message);\r\n  }\r\n\r\n  /**\r\n   * Handle record button click - opens file picker\r\n   */\r\n  handleRecordButtonClick() {\r\n    if (this.isRecording) {\r\n      this.updateStatus('이미 녹화 중입니다...');\r\n      return;\r\n    }\r\n\r\n    const fileInput = document.createElement('input');\r\n    fileInput.type = 'file';\r\n    fileInput.accept = '.txt';\r\n    fileInput.onchange = (e) => {\r\n      //@ts-ignore\r\n      const file = e.target.files[0];\r\n      if (file) {\r\n        this.loadReplayFile(file);\r\n      }\r\n    };\r\n    fileInput.click();\r\n  }\r\n\r\n  /**\r\n   * Load and parse replay file\r\n   * @param {File} file \r\n   */\r\n  loadReplayFile(file) {\r\n    this.updateStatus('리플레이 파일 로딩 중...');\r\n    const recordBtn = document.getElementById('record-btn');\r\n    //@ts-ignore\r\n    if (recordBtn) recordBtn.disabled = true;\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = (event) => {\r\n      let packWithComment;\r\n      let pack;\r\n      try {\r\n        //@ts-ignore\r\n        packWithComment = JSON.parse(event.target.result);\r\n        pack = packWithComment.pack;\r\n        const hash = pack.hash;\r\n        pack.hash = 0;\r\n        if (hash !== getHashCode(serialize(pack))) {\r\n          throw new Error('파일 내용이 해시 코드와 일치하지 않습니다');\r\n        }\r\n        this.initializeRenderer(pack);\r\n      } catch (err) {\r\n        console.error(err);\r\n        this.updateStatus('파일 로딩 실패: ' + err.message);\r\n        //@ts-ignore\r\n        if (recordBtn) recordBtn.disabled = false;\r\n      }\r\n    };\r\n    reader.onerror = () => {\r\n      this.updateStatus('파일 읽기 실패');\r\n      //@ts-ignore\r\n      if (recordBtn) recordBtn.disabled = false;\r\n    };\r\n    reader.readAsText(file);\r\n  }\r\n\r\n  /**\r\n   * Initialize PIXI renderer and load assets\r\n   * @param {Object} pack \r\n   */\r\n  initializeRenderer(pack) {\r\n    this.updateStatus('게임 에셋 로딩 중...');\r\n    this.currentPack = pack;\r\n\r\n    // Setup renderer\r\n    this.renderer = autoDetectRenderer({\r\n      width: 432,\r\n      height: 304,\r\n      antialias: false,\r\n      backgroundColor: 0x000000,\r\n      backgroundAlpha: 1,\r\n      forceCanvas: true,\r\n      preserveDrawingBuffer: true,\r\n    });\r\n\r\n    this.stage = new Container();\r\n    this.ticker = new Ticker();\r\n    this.ticker.minFPS = 1;\r\n    this.loader = new Loader();\r\n\r\n    // Append canvas to container\r\n    const container = document.querySelector('#game-canvas-container');\r\n    container.innerHTML = '';\r\n    container.appendChild(this.renderer.view);\r\n\r\n    // Setup assets\r\n    const TEXTURES = ASSETS_PATH.TEXTURES;\r\n    TEXTURES.WITH_COMPUTER = TEXTURES.WITH_FRIEND;\r\n\r\n    this.loader.add(ASSETS_PATH.SPRITE_SHEET);\r\n    for (const prop in ASSETS_PATH.SOUNDS) {\r\n      this.loader.add(ASSETS_PATH.SOUNDS[prop]);\r\n    }\r\n\r\n    // Setup loader progress\r\n    this.setupLoaderProgressBar();\r\n\r\n    // Load and setup game\r\n    this.loader.load(() => {\r\n      this.setupGame(pack);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Setup loader progress bar\r\n   */\r\n  setupLoaderProgressBar() {\r\n    const loadingBox = document.getElementById('loading-box');\r\n    const progressBar = document.getElementById('progress-bar');\r\n    if (loadingBox && progressBar) {\r\n      loadingBox.classList.remove('hidden');\r\n      this.loader.onProgress.add(() => {\r\n        progressBar.style.width = `${this.loader.progress}%`;\r\n      });\r\n      this.loader.onComplete.add(() => {\r\n        loadingBox.classList.add('hidden');\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup game and start recording\r\n   * @param {Object} pack \r\n   */\r\n  setupGame(pack) {\r\n    this.updateStatus('게임 초기화 중...');\r\n\r\n    this.pikaVolley = new PikachuVolleyballReplay(\r\n      this.stage,\r\n      this.loader.resources,\r\n      pack.roomID,\r\n      pack.nicknames,\r\n      pack.partialPublicIPs,\r\n      pack.inputs,\r\n      pack.options,\r\n      pack.chats\r\n    );\r\n\r\n    // @ts-ignore - PikachuVolleyballReplay extends PikachuVolleyball which is compatible\r\n    setGetSpeechBubbleNeeded(this.pikaVolley);\r\n\r\n    // Disable chat display since we don't have chat UI elements\r\n    this.pikaVolley.willDisplayChat = false;\r\n\r\n    // Setup ticker\r\n    this.ticker.add(() => {\r\n      this.renderer.render(this.stage);\r\n      this.pikaVolley.gameLoop();\r\n    });\r\n\r\n    // Start recording immediately after setup\r\n    setTimeout(() => {\r\n      this.startRecording(pack);\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * Start recording the replay as video\r\n   * @param {Object} pack \r\n   */\r\n  startRecording(pack) {\r\n    this.updateStatus('녹화 시작...');\r\n    this.recordedChunks = [];\r\n    this.isRecording = true;\r\n\r\n    const canvas = this.renderer.view;\r\n    \r\n    try {\r\n      // Create canvas stream\r\n      const fps = 25;\r\n      const stream = canvas.captureStream(fps);\r\n\r\n      // Setup MediaRecorder\r\n      let mimeType = 'video/webm;codecs=vp9';\r\n      if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n        mimeType = 'video/webm;codecs=vp8';\r\n        if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n          mimeType = 'video/webm';\r\n        }\r\n      }\r\n\r\n      this.mediaRecorder = new MediaRecorder(stream, {\r\n        mimeType: mimeType,\r\n        videoBitsPerSecond: 2500000,\r\n      });\r\n\r\n      this.mediaRecorder.ondataavailable = (e) => {\r\n        if (e.data.size > 0) {\r\n          this.recordedChunks.push(e.data);\r\n        }\r\n      };\r\n\r\n      this.mediaRecorder.onstop = () => {\r\n        this.saveVideoFile(pack);\r\n      };\r\n\r\n      this.mediaRecorder.onerror = (e) => {\r\n        console.error('MediaRecorder 에러:', e);\r\n        this.updateStatus('녹화 중 에러 발생');\r\n        this.isRecording = false;\r\n        const recordBtn = document.getElementById('record-btn');\r\n        //@ts-ignore\r\n        if (recordBtn) recordBtn.disabled = false;\r\n      };\r\n\r\n      // Start recording\r\n      this.mediaRecorder.start(100);\r\n\r\n      // Start game ticker\r\n      this.ticker.maxFPS = this.pikaVolley.normalFPS;\r\n      this.ticker.start();\r\n\r\n      this.updateStatus(`녹화 중... (총 ${pack.inputs.length} 프레임)`);\r\n\r\n      // Monitor for replay end\r\n      this.monitorReplayProgress();\r\n\r\n    } catch (err) {\r\n      console.error('녹화 시작 실패:', err);\r\n      this.updateStatus('녹화 시작 실패: ' + err.message);\r\n      this.isRecording = false;\r\n      const recordBtn = document.getElementById('record-btn');\r\n      //@ts-ignore\r\n      if (recordBtn) recordBtn.disabled = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Monitor replay progress and stop when finished\r\n   */\r\n  monitorReplayProgress() {\r\n    const checkInterval = setInterval(() => {\r\n      if (!this.pikaVolley || !this.isRecording) {\r\n        clearInterval(checkInterval);\r\n        return;\r\n      }\r\n\r\n      // Update progress\r\n      const progress = Math.floor((this.pikaVolley.replayFrameCounter / this.pikaVolley.inputs.length) * 100);\r\n      this.updateStatus(`녹화 중... ${progress}%`);\r\n\r\n      // Check if replay finished\r\n      if (this.pikaVolley.replayFrameCounter >= this.pikaVolley.inputs.length) {\r\n        clearInterval(checkInterval);\r\n        this.stopRecording();\r\n      }\r\n    }, 500);\r\n  }\r\n\r\n  /**\r\n   * Stop recording\r\n   */\r\n  stopRecording() {\r\n    if (!this.isRecording) return;\r\n\r\n    this.updateStatus('녹화 완료, 파일 저장 중...');\r\n    this.ticker.stop();\r\n    \r\n    if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {\r\n      this.mediaRecorder.stop();\r\n    } else {\r\n      this.saveVideoFile(this.currentPack || {});\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save recorded video as file\r\n   * @param {Object} pack \r\n   */\r\n  saveVideoFile(pack) {\r\n    if (this.recordedChunks.length === 0) {\r\n      this.updateStatus('녹화된 데이터가 없습니다');\r\n      this.isRecording = false;\r\n      const recordBtn = document.getElementById('record-btn');\r\n      //@ts-ignore\r\n      if (recordBtn) recordBtn.disabled = false;\r\n      return;\r\n    }\r\n\r\n    const blob = new Blob(this.recordedChunks, { type: 'video/webm' });\r\n    const url = URL.createObjectURL(blob);\r\n    \r\n    // Generate filename\r\n    const d = new Date();\r\n    const dateStr = `${d.getFullYear()}${('0' + (d.getMonth() + 1)).slice(-2)}${('0' + d.getDate()).slice(-2)}`;\r\n    const timeStr = `${('0' + d.getHours()).slice(-2)}${('0' + d.getMinutes()).slice(-2)}`;\r\n    \r\n    let filename = `${dateStr}_${timeStr}_pikavolley_replay.webm`;\r\n    \r\n    if (pack.nicknames && pack.nicknames.length === 2) {\r\n      const nick1 = pack.nicknames[0].replace(/[/\\\\?%*:|\"<>]/g, '_');\r\n      const nick2 = pack.nicknames[1].replace(/[/\\\\?%*:|\"<>]/g, '_');\r\n      filename = `${dateStr}_${timeStr}_${nick1}_vs_${nick2}.webm`;\r\n    }\r\n\r\n    // Download file\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = filename;\r\n    a.style.display = 'none';\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    \r\n    // Cleanup\r\n    setTimeout(() => {\r\n      document.body.removeChild(a);\r\n      URL.revokeObjectURL(url);\r\n    }, 100);\r\n\r\n    this.updateStatus('저장 완료! 다른 리플레이를 변환하려면 버튼을 다시 클릭하세요.');\r\n    this.isRecording = false;\r\n    const recordBtn = document.getElementById('record-btn');\r\n    //@ts-ignore\r\n    if (recordBtn) recordBtn.disabled = false;\r\n    this.recordedChunks = [];\r\n  }\r\n}\r\n\r\n// Adjust assets path for ko/replay-download/index.html\r\nadjustAssetsPath();\r\n\r\n// Initialize converter\r\nconst converter = new ReplayToVideoConverter();\r\nconst recordBtn = document.getElementById('record-btn');\r\nif (recordBtn) {\r\n  recordBtn.addEventListener('click', () => converter.handleRecordButtonClick());\r\n}\r\n\r\n\r\n/**\r\n * Adjust game assets path to the path from the perspective of ko/replay-download/index.html\r\n */\r\nfunction adjustAssetsPath() {\r\n  ASSETS_PATH.SPRITE_SHEET = '../' + ASSETS_PATH.SPRITE_SHEET;\r\n  for (const prop in ASSETS_PATH.SOUNDS) {\r\n    ASSETS_PATH.SOUNDS[prop] = '../' + ASSETS_PATH.SOUNDS[prop];\r\n  }\r\n}"],"names":["SPRITE_SHEET","prop","SOUNDS","adjustAssetsPath","converter","constructor","registerPlugin","RESOLUTION","SCALE_MODE","NEAREST","ROUND_PIXELS","this","ticker","renderer","stage","loader","pikaVolley","mediaRecorder","recordedChunks","isRecording","currentPack","updateStatus","message","statusEl","document","getElementById","textContent","console","log","handleRecordButtonClick","fileInput","createElement","type","accept","onchange","e","file","target","files","loadReplayFile","click","recordBtn","disabled","reader","FileReader","onload","event","packWithComment","pack","JSON","parse","result","hash","Error","initializeRenderer","err","error","onerror","readAsText","width","height","antialias","backgroundColor","backgroundAlpha","forceCanvas","preserveDrawingBuffer","minFPS","container","querySelector","innerHTML","appendChild","view","TEXTURES","WITH_COMPUTER","WITH_FRIEND","add","setupLoaderProgressBar","load","setupGame","loadingBox","progressBar","classList","remove","onProgress","style","progress","onComplete","resources","roomID","nicknames","partialPublicIPs","inputs","options","chats","willDisplayChat","render","gameLoop","setTimeout","startRecording","canvas","fps","stream","captureStream","mimeType","MediaRecorder","isTypeSupported","videoBitsPerSecond","ondataavailable","data","size","push","onstop","saveVideoFile","start","maxFPS","normalFPS","length","monitorReplayProgress","checkInterval","setInterval","clearInterval","Math","floor","replayFrameCounter","stopRecording","stop","state","blob","Blob","url","URL","createObjectURL","d","Date","dateStr","getFullYear","getMonth","slice","getDate","timeStr","getHours","getMinutes","filename","replace","a","href","download","display","body","removeChild","revokeObjectURL","addEventListener"],"sourceRoot":""}