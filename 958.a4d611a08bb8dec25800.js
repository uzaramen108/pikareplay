(self.webpackChunkpikachu_volleyball_p2p_online=self.webpackChunkpikachu_volleyball_p2p_online||[]).push([[958],{5023:(e,t,n)=>{"use strict";n.d(t,{W:()=>s});class i{constructor(e,t,n=Date.now(),i=""){this.hashedIP=e,this.partialIP=t,this.blockedTime=n,this.remark=i}}const s=new class{constructor(e){this._blockedIPs=[],this._peerHashedIP=null,this.maxLength=e}get length(){return this._blockedIPs.length}isFull(){return this.length>=this.maxLength}stagePeerHashedIP(e){this._peerHashedIP=e}isPeerHashedIPStaged(){return null!==this._peerHashedIP}AddStagedPeerHashedIPWithPeerPartialIP(e){this.isPeerHashedIPStaged()&&!this.isFull()&&this._blockedIPs.push(new i(this._peerHashedIP,e))}removeAt(e){this._blockedIPs.splice(e,1)}editRemarkAt(e,t){this._blockedIPs[e].remark=t}createArrayView(){return this._blockedIPs.map((e=>[e.hashedIP,e.partialIP,e.blockedTime,e.remark]))}readArrayViewAndUpdate(e){e=e.slice(0,this.maxLength),this._blockedIPs=e.map((e=>new i(e[0],e[1],e[2],e[3])))}createHashedIPArray(){return this._blockedIPs.map((e=>e.hashedIP))}}(50)},6465:(e,t,n)=>{"use strict";n.d(t,{G:()=>l,Z:()=>h});var i=n(5023),s=n(1275);const o=20,a=document.querySelector("table.blocked-ip-addresses-table tbody"),r=document.querySelector("table.blocked-ip-addresses-table .delete-btn"),c=document.getElementById("block-this-peer-btn"),d=function(){try{return localStorage.setItem("__test","test"),localStorage.removeItem("__test"),!0}catch(e){return!1}}();function l(){if(r.disabled=!0,c.disabled=!0,!d)return void document.getElementById("blocked-ip-addresses-table-container").classList.add("hidden");let e=null;try{e=window.localStorage.getItem("stringifiedBlockedIPListArrayView")}catch(e){console.log(e)}if(null!==e){const t=JSON.parse(e);t.length>0&&4!==t[0].length?(window.localStorage.removeItem("stringifiedBlockedIPListArrayView"),location.reload()):i.W.readArrayViewAndUpdate(t)}u(i.W.createArrayView()),m();let t=-1;document.body.addEventListener("click",(e=>{const n=e.target;if(a.contains(n)&&"TD"===n.tagName){const i=n.parentElement,s=i.sectionRowIndex;if(e.shiftKey&&-1!==t){e.ctrlKey||y();const n=Math.min(t,s),i=Math.max(t,s),o=a.getElementsByTagName("tr");for(let e=n;e<=i;e++)o[e]&&o[e].classList.add("selected")}else e.ctrlKey||y(),i.classList.toggle("selected"),t=s}else e.ctrlKey||e.shiftKey||y();r.disabled=!a.querySelector(".selected")})),r.addEventListener("click",(()=>{t=-1;const e=a.querySelectorAll(".selected");for(let t=e.length-1;t>=0;--t)i.W.removeAt(Number(e[t].dataset.index));try{window.localStorage.setItem("stringifiedBlockedIPListArrayView",JSON.stringify(i.W.createArrayView()))}catch(e){console.log(e)}u(i.W.createArrayView()),m()}));const n=document.getElementById("ask-add-this-peer-to-blocked-list"),o=document.getElementById("ask-add-this-peer-to-blocked-list-yes-btn"),l=document.getElementById("ask-add-this-peer-to-blocked-list-no-btn"),h=document.getElementById("notice-adding-this-peer-to-blocked-list-is-completed");c.addEventListener("click",(()=>{document.getElementById("partial-ip-address-of-this-peer-to-be-blocked").textContent=s.Ix.peerPartialPublicIP,n.classList.remove("hidden")})),o.addEventListener("click",(()=>{c.disabled=!0,i.W.AddStagedPeerHashedIPWithPeerPartialIP(s.Ix.peerPartialPublicIP);try{window.localStorage.setItem("stringifiedBlockedIPListArrayView",JSON.stringify(i.W.createArrayView()))}catch(e){console.log(e)}n.classList.add("hidden"),h.classList.remove("hidden")})),l.addEventListener("click",(()=>{n.classList.add("hidden")})),document.getElementById("notice-adding-this-peer-to-blocked-list-is-completed-exit-game-btn").addEventListener("click",(()=>{location.reload()})),document.getElementById("notice-adding-this-peer-to-blocked-list-is-completed-do-not-exit-game-btn").addEventListener("click",(()=>{h.classList.add("hidden")}))}function h(){d&&(c.classList.remove("hidden"),i.W.isPeerHashedIPStaged()&&!i.W.isFull()&&(c.disabled=!1))}function u(e){for(;a.firstChild;)a.removeChild(a.firstChild);e.forEach(((e,t)=>{const n=document.createElement("tr"),s=document.createElement("td"),r=document.createElement("td"),c=document.createElement("td"),d=document.createElement("input");c.appendChild(d),n.appendChild(s),n.appendChild(r),n.appendChild(c),n.dataset.index=String(t),s.textContent=e[1],r.textContent=new Date(e[2]).toLocaleString(),d.value=e[3],d.addEventListener("input",(e=>{const n=e.target.value.slice(0,o);d.value=n,i.W.editRemarkAt(t,n);try{window.localStorage.setItem("stringifiedBlockedIPListArrayView",JSON.stringify(i.W.createArrayView()))}catch(e){console.log(e)}})),a.appendChild(n)}))}function m(){document.getElementById("number-of-blocked-ip-addresses").textContent=String(i.W.length)}function y(){Array.from(a.getElementsByTagName("tr")).forEach((e=>{e.classList.remove("selected")}))}},5523:(e,t,n)=>{"use strict";n.d(t,{rE:()=>k,yL:()=>b,_y:()=>w,QK:()=>v,Az:()=>g,lD:()=>f,pt:()=>p,yg:()=>y});var i=n(1275),s=n(5345);class o{constructor(e,t=Date.now()){this.word=e.toLowerCase().trim(),this.addedTime=t}}const a=new class{constructor(e){this._badWords=[],this.maxLength=e,this.willUseBasicBadWords=!1,this.basicBadWords=["fuck","fuckyou","shit","bitch","asshole","nigger","faggot","개새","느금","ㄴㄱㅁ","ㄴ금마","니애미","ㄴㅇㅁ","느그","병신","병ㅅ","ㅂㅅ","ㅂ신","ㅅㅂ","새끼","ㅅㄲ","시발","씨발","ㅅ발","애미","애비","어머니","엄마","아버지","좆","ㅈ까","ㅈ밥","ㅈㅂ","ㅈ이","ㅄ","씹"]}get length(){return this._badWords.length}isFull(){return this.length>=this.maxLength}AddBadWords(e){this.isFull()||this._badWords.some((t=>t.word===e))||this._badWords.push(new o(e))}removeAt(e){this._badWords.splice(e,1)}createArrayView(){return this._badWords.map((e=>[e.word,e.addedTime]))}readArrayViewAndUpdate(e){this._badWords=[],e=e.slice(0,this.maxLength),this._badWords=e.map((e=>new o(e[0],e[1])))}createWordArray(){return this.willUseBasicBadWords?this.basicBadWords.concat(this._badWords.map((e=>e.word))):this._badWords.map((e=>e.word))}}(50);function r(e,t){const n=[],i=[],s=Array.from(e);for(let e=0;e<s.length;e++){const o=s[e];t.test(o)&&(i.push(e),n.push(o.toLowerCase()))}return{cleaned:n.join(""),mapToOriginal:i}}let c=null,d=null,l=null;const h=document.getElementById("game-canvas-container");let u=document.getElementById("player1-chat-box"),m=document.getElementById("player2-chat-box");function y(e){c=()=>document.querySelectorAll(".fade-in-box:not(.hidden)").length>0||e.state===e.intro||e.state===e.menu}function p(e,t){d=e,l=t}function g(e){i.Ix.myChatEnabled=e,b(),(0,i.Ws)(i.Ix.myChatEnabled)}function b(){const e=document.getElementById("player1-chat-disabled"),t=document.getElementById("player2-chat-disabled"),n=(e,t)=>{e?t.classList.add("hidden"):t.classList.remove("hidden")};null===i.Ix.amIPlayer2?i.Ix.amICreatedRoom?(n(i.Ix.myChatEnabled,e),n(i.Ix.peerChatEnabled,t)):(n(i.Ix.myChatEnabled,t),n(i.Ix.peerChatEnabled,e)):!1===i.Ix.amIPlayer2?(n(i.Ix.myChatEnabled,e),n(i.Ix.peerChatEnabled,t)):!0===i.Ix.amIPlayer2&&(n(i.Ix.myChatEnabled,t),n(i.Ix.peerChatEnabled,e))}function f(){u.classList.add("hidden"),m.classList.add("hidden")}function w(e){null===i.Ix.amIPlayer2?i.Ix.amICreatedRoom?k(e,1):k(e,2):!1===i.Ix.amIPlayer2?k(e,1):!0===i.Ix.amIPlayer2&&k(e,2)}function v(e){e=function(e){const t=a.createWordArray(),n=[...new Set(t)].filter((e=>e.length>0));let i=Array.from(e),s=!0;const o=new RegExp(n.join("|"),"gi"),c=[{name:"Letter+Emoji",regex:/\p{L}|\p{Emoji}/u},{name:"Letter",regex:/\p{L}/u},{name:"Korean",regex:/\p{Script=Hangul}/u},{name:"English",regex:/\p{Script=Latin}/u},{name:"Kanji",regex:/\p{Script=Han}/u},{name:"Emoji",regex:/\p{Emoji}/u}];for(;s;){s=!1;let e=Array.from(i);for(const t of c){const{cleaned:n,mapToOriginal:i}=r(e.join(""),t.regex),a=[...n.matchAll(o)];for(const t of a){const o=Array.from(t[0]).length,a=n.slice(0,t.index),r=Array.from(a).length;for(let t=0;t<o;t++){const n=i[r+t];"*"!==e[n]&&(e[n]="*",s=!0)}}}s&&(i=e)}return i.join("")}(e),null===i.Ix.amIPlayer2?i.Ix.amICreatedRoom?k(e,2):k(e,1):!1===i.Ix.amIPlayer2?k(e,2):!0===i.Ix.amIPlayer2&&k(e,1)}function k(e,t){if(i.Ix.myChatEnabled)if(s.Z.recordChats(e,t),1===t){const t=u.cloneNode();t.textContent=e,t.style.top=20+30*d()+"%",t.style.right=55+25*d()+"%",t.classList.remove("hidden"),c&&!c()?t.classList.remove("in-speech-bubble"):t.classList.add("in-speech-bubble"),h.replaceChild(t,u),u=t}else if(2===t){const t=m.cloneNode();t.textContent=e,t.style.top=20+30*l()+"%",t.style.left=55+25*l()+"%",t.classList.remove("hidden"),c&&!c()?t.classList.remove("in-speech-bubble"):t.classList.add("in-speech-bubble"),h.replaceChild(t,m),m=t}}},1275:(e,t,n)=>{"use strict";n.d(t,{fg:()=>w,Ix:()=>v,sm:()=>K,Bn:()=>G,ab:()=>O,O3:()=>H,Ws:()=>X,DR:()=>J,bP:()=>U,jz:()=>j,nQ:()=>Q});var i=n(223),s=n(4026),o=n(7391),a=n.n(o),r=n(5716),c=n(6546),d=n(9505),l=n(1514),h=n(7147),u=n(5523),m=n(651),y=n(8668),p=n(4805),g=n(2777),b=n(5345);const f=(0,i.Wp)({apiKey:"api-key",authDomain:"project-id.firebaseapp.com",databaseURL:"https://project-id.firebaseio.com",projectId:"project-id",storageBucket:"project-id.appspot.com",messagingSenderId:"sender-id",appId:"app-id",measurementId:"G-measurement-id"}),w=65536,v={isOpen:!1,gameStartAllowed:!1,amICreatedRoom:!1,amIPlayer2:null,isQuickMatch:null,myNickname:"",_peerNickname:"",myPartialPublicIP:"*.*.*.*",peerPartialPublicIP:"*.*.*.*",myChatEnabled:!0,peerChatEnabled:!0,myIsPeerNicknameVisible:!0,peerIsPeerNicknameVisible:!0,willAskFastAutomatically:!1,get peerNickname(){return this.myIsPeerNicknameVisible?this._peerNickname:""},set peerNickname(e){this._peerNickname=e},peerInputQueue:[],_peerInputQueueSyncCounter:0,get peerInputQueueSyncCounter(){return this._peerInputQueueSyncCounter},set peerInputQueueSyncCounter(e){this._peerInputQueueSyncCounter=(0,c.z)(e,w)},callbackAfterDataChannelOpened:null,callbackAfterDataChannelOpenedForUI:null,callbackAfterPeerInputQueueReceived:null},k={pingSentTimeArray:new Array(5),receivedPingResponseNumber:0,pingMesurementArray:[]};function I(e){return{pendingMessage:"",resendIntervalID:null,_syncCounter:e,_peerSyncCounter:e+(e+1)%2,get syncCounter(){return this._syncCounter},set syncCounter(t){this._syncCounter=e+t%2},get peerSyncCounter(){return this._peerSyncCounter},set peerSyncCounter(t){this._peerSyncCounter=e+t%2},get nextPeerSyncCounter(){return e+(this._peerSyncCounter+1)%2}}}const E=I(0),C=I(2),x=I(4),S=I(6),L=I(8);let B=null,P=null,D=null,A=null;const M=[];let N=null,V=null,T=!1,R=!0,W=!0,_=!0,F=!1;async function O(e){v.amICreatedRoom=!0,D=e;const t=(0,s.aU)(f);A=(0,s.H9)(t,"rooms",D),console.log("Create PeerConnection with configuration: ",m.i),B=new RTCPeerConnection(m.i),Y(B),Z(A,B,"offerorCandidates","answererCandidates"),P=B.createDataChannel("pikavolley_p2p_channel",{ordered:!1,maxRetransmits:0}),console.log("Created data channel",P),P.addEventListener("open",q),P.addEventListener("message",$),P.addEventListener("close",z),N=(0,s.aQ)(A,(async e=>{console.log("Got updated room:",e.data());const t=e.data();if(!B.currentRemoteDescription&&t.answer){(0,l.Ct)("Answer received"),console.log("Set remote description");const e=t.answer;await B.setRemoteDescription(e),N(),N=null}}));const n=await B.createOffer();await B.setLocalDescription(n),console.log("Created offer and set local description:",n);const i={timestamp:(0,s.O5)(),offer:{type:n.type,sdp:n.sdp}};await(0,s.BN)(A,i),console.log(`New room created with SDP offer. Room ID: ${A.id}`),(0,l.Ct)("Offer sent")}async function H(e){if(D=e,20!==D.length)return(0,l.Sj)(),!1;console.log("Join room: ",D);const t=(0,s.aU)(f),n=(0,s.H9)(t,"rooms",`${D}`),i=await(0,s._e)(n),o=i.exists();if(console.log("Got room:",o),!o)return console.log("No room is mathing the ID"),v.isQuickMatch?((0,l.t8)(),(0,l.X1)()):(0,l.yZ)(),!1;const a=i.data();if(a.answer)return console.log("The room is already joined by someone else"),(0,l.o1)(),!1;console.log("Create PeerConnection with configuration: ",m.i),B=new RTCPeerConnection(m.i),Y(B),Z(n,B,"answererCandidates","offerorCandidates");const r=a.offer;await B.setRemoteDescription(r),console.log("Set remote description"),(0,l.Ct)("Offer received");const c=await B.createAnswer();await B.setLocalDescription(c),console.log("set local description:",c);const d={answer:{type:c.type,sdp:c.sdp}};return await(0,s.mZ)(n,d),(0,l.Ct)("Answer sent"),console.log("joined room!"),!0}function K(){for(N&&(N(),N=null),V&&(V(),V=null);M.length>0;)(0,s.kd)(M.pop()).then((()=>{console.log("deleted an ICE candidate doc")}));v.amICreatedRoom&&A&&((0,s.kd)(A).then((()=>{console.log("deleted the room")})),A=null)}function G(){P&&P.close(),B&&B.close(),console.log("Did close data channel and peer connection")}function U(e){const t=new ArrayBuffer(2+e.length),n=new DataView(t);n.setUint16(0,e[0].syncCounter,!0);for(let t=0;t<e.length;t++){const i=e[t],s=(0,p.H)(i);n.setUint8(2+t,s)}P.send(t)}function J(e){E.pendingMessage=e;const t=e+String(E.syncCounter);P.send(t),E.resendIntervalID=setInterval((()=>P.send(t)),1e3)}function Q(e){if(!e.speed&&!e.winningScore)return;let t=JSON.stringify(e);t+=String(C.syncCounter),P.send(t),C.resendIntervalID=setInterval((()=>P.send(t)),1e3)}function j(e){let t=String(e);t+=String(x.syncCounter),P.send(t),x.resendIntervalID=setInterval((()=>P.send(t)),1e3)}function X(e){let t=String(e);t+=String(S.syncCounter),P.send(t),S.resendIntervalID=setInterval((()=>P.send(t)),1e3)}function $(e){const t=e.data;if(t instanceof ArrayBuffer){if(t.byteLength>2&&t.byteLength<=2+2*d.$g){if(function(e){R&&(R=!1,(0,l.mg)());const t=new DataView(e),n=t.getUint16(0,!0);for(let i=0;i<e.byteLength-2;i++){const e=(0,c.z)(n+i,w);if(e===v.peerInputQueueSyncCounter&&(0===v.peerInputQueue.length||(0,c.X)(e,v.peerInputQueue[0].syncCounter,v.peerInputQueue[0].syncCounter+2*d.$g-1,w))){const n=t.getUint8(2+i),s=(0,p.d)(n),o=new d.MR(e,s.xDirection,s.yDirection,s.powerHit);v.peerInputQueue.push(o),v.peerInputQueueSyncCounter++}}}(t),null!==v.callbackAfterPeerInputQueueReceived){const e=v.callbackAfterPeerInputQueueReceived;v.callbackAfterPeerInputQueueReceived=null,window.setTimeout(e,0)}}else if(1===t.byteLength){const e=new DataView(t).getInt8(0);e>=8?function(e){new DataView(e).getInt8(0)===L.syncCounter&&(L.syncCounter++,clearInterval(L.resendIntervalID))}(t):e>=6?function(e){new DataView(e).getInt8(0)===S.syncCounter&&(S.syncCounter++,clearInterval(S.resendIntervalID))}(t):e>=4?function(e){new DataView(e).getInt8(0)===x.syncCounter&&(x.syncCounter++,clearInterval(x.resendIntervalID))}(t):e>=2?function(e){new DataView(e).getInt8(0)===C.syncCounter&&(C.syncCounter++,clearInterval(C.resendIntervalID))}(t):e>=0?function(e){new DataView(e).getInt8(0)===E.syncCounter&&(E.syncCounter++,clearInterval(E.resendIntervalID),W?W=!1:((0,u._y)(E.pendingMessage),(0,l.gU)()))}(t):e<0&&function(e){const t=new DataView(e);if(-1===t.getInt8(0)){const e=new ArrayBuffer(1);new DataView(e).setInt8(0,-2),console.log("respond to ping"),P.send(e)}else-2===t.getInt8(0)&&(k.pingMesurementArray.push(Date.now()-k.pingSentTimeArray[k.receivedPingResponseNumber]),k.receivedPingResponseNumber++)}(t)}}else if("string"==typeof t){const e=Number(t.slice(-1));e>=8?function(e){const t=Number(e.slice(-1));if(t===L.peerSyncCounter)console.log("arraybuffer with length 1 for peer nickname shown/hidden message ACK resent");else{if(t!==L.nextPeerSyncCounter)return void console.log("invalid peer nickname shown/hidden message received.");{L.peerSyncCounter++;const t="true"===e.slice(0,-1);v.peerIsPeerNicknameVisible=t,(0,h.displayMyAndPeerNicknameShownOrHidden)()}}const n=new ArrayBuffer(1);new DataView(n).setInt8(0,t),P.send(n)}(t):e>=6?function(e){const t=Number(e.slice(-1));if(t===S.peerSyncCounter)console.log("arraybuffer with length 1 for chat enabled/disabled message ACK resent");else{if(t!==S.nextPeerSyncCounter)return void console.log("invalid chat enabled/disabled message received.");{S.peerSyncCounter++;const t="true"===e.slice(0,-1);v.peerChatEnabled=t,(0,u.yL)()}}const n=new ArrayBuffer(1);new DataView(n).setInt8(0,t),P.send(n)}(t):e>=4?function(e){const t=Number(e.slice(-1));if(t===x.peerSyncCounter)console.log("arraybuffer with length 1 for options change message ACK resent");else{if(t!==x.nextPeerSyncCounter)return void console.log("invalid options change message received.");{x.peerSyncCounter++;const t="true"===e.slice(0,-1);(0,l.YI)(t)}}const n=new ArrayBuffer(1);new DataView(n).setInt8(0,t),P.send(n)}(t):e>=2?function(e){const t=Number(e.slice(-1));if(t===C.peerSyncCounter)console.log("arraybuffer with length 1 for options change message ACK resent");else{if(t!==C.nextPeerSyncCounter)return void console.log("invalid options change message received.");{C.peerSyncCounter++;const t=JSON.parse(e.slice(0,-1));if(t.auto&&"fast"===t.speed&&v.willAskFastAutomatically)return(0,l.Ew)(),void(F=!0);(0,l.Dc)(t)}}const n=new ArrayBuffer(1);new DataView(n).setInt8(0,t),P.send(n)}(t):e>=0&&function(e){const t=Number(e.slice(-1));if(t===E.peerSyncCounter)console.log("arraybuffer with length 1 for chat message ACK resent");else{if(t!==E.nextPeerSyncCounter)return void console.log("invalid chat message received.");E.peerSyncCounter++,_?(_=!1,v.peerNickname=e.slice(0,-1).trim().slice(0,l.Py),(0,h.displayPeerNicknameFor)(v.peerNickname,v.amICreatedRoom),(0,h.s)(v.myNickname,!v.amICreatedRoom),(0,h.U)(v.peerPartialPublicIP,v.amICreatedRoom),(0,h.U)(v.myPartialPublicIP,!v.amICreatedRoom),v.amICreatedRoom?(b.Z.recordNicknames(v.myNickname,v.peerNickname),b.Z.recordPartialPublicIPs(v.myPartialPublicIP,v.peerPartialPublicIP)):(b.Z.recordNicknames(v.peerNickname,v.myNickname),b.Z.recordPartialPublicIPs(v.peerPartialPublicIP,v.myPartialPublicIP))):(0,u.QK)(e.slice(0,-1))}const n=new ArrayBuffer(1);new DataView(n).setInt8(0,t),P.send(n)}(t)}}function q(){(0,l.Ct)("data channel opened!"),console.log("data channel opened!"),console.log(`dataChannel.ordered: ${P.ordered}`),console.log(`dataChannel.maxRetransmits: ${P.maxRetransmits}`),P.binaryType="arraybuffer",v.isOpen=!0,T=!0,(0,l.YT)(),K(),v.isQuickMatch&&(0,l.disableCancelQuickMatchBtnForAWhile)(),v.amICreatedRoom&&(v.isQuickMatch?(0,g.Bt)():(0,g.Fb)()),b.Z.recordRoomID(D);const e=a().alea(D.slice(10));(0,r.p)(e);const t=a().alea(D.slice(10,15)),n=a().alea(D.slice(15));(0,u.pt)(t,n),function(){J(v.myNickname),v.willAskFastAutomatically&&(0,l.Z1)(!F),(0,l.Ct)("start ping test");const e=new ArrayBuffer(1);new DataView(e).setInt8(0,-1);let t=0;const n=setInterval((()=>{if(5!==t)k.pingSentTimeArray[t]=Date.now(),P.send(e),(0,l.iS)(),t++;else{window.clearInterval(n);const e=k.pingMesurementArray.reduce(((e,t)=>e+t),0)/k.pingMesurementArray.length;console.log(`average ping: ${e} ms, ping list: ${k.pingMesurementArray}`),v.callbackAfterDataChannelOpened(),v.callbackAfterDataChannelOpenedForUI(),(0,l.gB)(e);let t=10;(0,l.sK)(t);const i=setInterval((()=>{if(t--,(0,l.sK)(t),0===t)return window.clearInterval(i),(0,l.q3)(),void(v.gameStartAllowed=!0)}),1e3)}}),1e3)}()}function z(){console.log("data channel closed"),v.isOpen=!1,(0,l.Qu)()}function Y(e){e.addEventListener("icegatheringstatechange",(()=>{console.log(`ICE gathering state changed: ${e.iceGatheringState}`),(0,l.Ct)(`ICE gathering state changed: ${e.iceGatheringState}`)})),e.addEventListener("connectionstatechange",(()=>{console.log(`Connection state change: ${e.connectionState}`),(0,l.Ct)(`Connection state change: ${e.connectionState}`),"disconnected"!==e.connectionState&&"closed"!==e.connectionState||(v.isOpen=!1,(0,l.Qu)()),"failed"===e.connectionState&&!1===T&&((0,l.YT)(),(0,l.X1)())})),e.addEventListener("signalingstatechange",(()=>{console.log(`Signaling state change: ${e.signalingState}`),(0,l.Ct)(`Signaling state change: ${e.signalingState}`)})),e.addEventListener("iceconnectionstatechange ",(()=>{console.log(`ICE connection state change: ${e.iceConnectionState}`),(0,l.Ct)(`ICE connection state change: ${e.iceConnectionState}`)})),e.addEventListener("datachannel",(e=>{P=e.channel,console.log("data channel received!",P),(0,l.Ct)("data channel received!"),P.addEventListener("open",q),P.addEventListener("message",$),P.addEventListener("close",z)}))}function Z(e,t,n,i){const o=(0,s.rJ)(e,n);t.addEventListener("icecandidate",(e=>{if(!e.candidate)return void console.log("Got final candidate!");const t=e.candidate.toJSON();if((0,s.gS)(o,t).then((e=>M.push(e))),console.log("Got candidate: ",e.candidate),""===e.candidate.candidate)return;const n=(0,y.V6)(e.candidate.candidate);null!==n&&(v.myPartialPublicIP=(0,y.LB)(n),console.log("part of my public IP address:",v.myPartialPublicIP))})),V=(0,s.aQ)((0,s.rJ)(e,i),(e=>{e.docChanges().forEach((async e=>{if("added"===e.type){const n=e.doc.data();if(await t.addIceCandidate(n),console.log("Got new remote ICE candidate"),""===n.candidate)return;const i=(0,y.V6)(n.candidate);null!==i&&(v.peerPartialPublicIP=(0,y.LB)(i),console.log("part of the peer's public IP address:",v.peerPartialPublicIP))}}))}))}},8668:(e,t,n)=>{"use strict";function i(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:n[t[e]]=t[e+1]}return n}function s(e){const t=i(e);return"srflx"===t.type?t.ip:"host"!==t.type||t.ip.endsWith(".local")||RegExp("(^127.)|(^10.)|(^172.1[6-9].)|(^172.2[0-9].)|(^172.3[0-1].)|(^192.168.)").test(t.ip)?null:t.ip}function o(e){const t=e.indexOf(".",e.indexOf(".")+1);return-1===t?e.slice(0,7):`${e.slice(0,t)}.*.*`}n.d(t,{LB:()=>o,PR:()=>i,V6:()=>s})},651:(e,t,n)=>{"use strict";n.d(t,{i:()=>i});const i={iceServers:[{urls:["stun:stun1.l.google.com:19302"]},{urls:["stun:stun2.l.google.com:19302"]}]};window.rtcConfiguration=i},9505:(e,t,n)=>{"use strict";n.d(t,{$g:()=>r,MR:()=>h,Nz:()=>l,Uq:()=>d});var i=n(478),s=n(1674),o=n(1275),a=n(6546);const r=8;class c extends i.t{getInput(){this.leftKey.isDown?this.xDirection=-1:this.rightKey.isDown||!o.Ix.amIPlayer2&&this.downRightKey&&this.downRightKey.isDown?this.xDirection=1:this.xDirection=0,this.upKey.isDown?this.yDirection=-1:this.downKey.isDown||this.downRightKey&&this.downRightKey.isDown?this.yDirection=1:this.yDirection=0;const e=this.powerHitKey.isDown;!this.powerHitKeyIsDownPrevious&&e?this.powerHit=1:this.powerHit=0,this.powerHitKeyIsDownPrevious=e}}const d=new class{constructor(e,t,n,i,s,o,a,r,d,l,h,u){this.keyboard1=new c(e,t,n,i,s,o),this.keyboard2=new c(a,r,d,l,h,u),this._syncCounter=0,this.inputQueue=[]}get syncCounter(){return this._syncCounter}set syncCounter(e){this._syncCounter=(0,a.z)(e,o.fg)}subscribe(){this.keyboard1.subscribe(),this.keyboard2.subscribe()}unsubscribe(){this.keyboard1.unsubscribe(),this.keyboard2.unsubscribe()}getInputIfNeededAndSendToPeer(e){if(0===this.inputQueue.length||(0,a.X)(this.syncCounter,e,e+r-1,o.fg)){this.keyboard1.getInput(),this.keyboard2.getInput();const e=0!==this.keyboard1.xDirection?this.keyboard1.xDirection:this.keyboard2.xDirection,t=0!==this.keyboard1.yDirection?this.keyboard1.yDirection:this.keyboard2.yDirection,n=0!==this.keyboard1.powerHit?this.keyboard1.powerHit:this.keyboard2.powerHit,i=new h(this.syncCounter,e,t,n);this.inputQueue.push(i),this.syncCounter++}(0,o.bP)(this.inputQueue)}}("KeyD","KeyG","KeyR","KeyV","KeyZ","KeyF","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter","ArrowDown");class l{constructor(e){this.xDirection=0,this.yDirection=0,this.powerHit=0,this.inputQueue=e,this.isHistoryBufferFilled=!1}isInputOnQueue(e){if(0===this.inputQueue.length)return!1;if(this.isHistoryBufferFilled)return this.inputQueue.length>r&&(this.inputQueue[r].syncCounter===e||(console.log("Something in OnlineKeyboard is wrong..."),!1));for(let t=0;t<this.inputQueue.length;t++)if(this.inputQueue[t].syncCounter===e)return!0;return!1}getInput(e){if(0===this.inputQueue.length)return void console.log("Something in getInput method is wrong...0");let t=null;if(this.isHistoryBufferFilled){if(!(this.inputQueue.length>r))return void console.log("Something in getInput method is wrong...2");if(t=this.inputQueue[r],t.syncCounter!==e)return void console.log("Something in getInput method is wrong...1");this.inputQueue.shift()}else for(let n=0;n<this.inputQueue.length;n++)if(this.inputQueue[n].syncCounter===e){t=this.inputQueue[n],n===r&&(this.isHistoryBufferFilled=!0,this.inputQueue.shift());break}null!==t?(this.xDirection=t.xDirection,this.yDirection=t.yDirection,this.powerHit=t.powerHit):console.log("Something in getInput method is wrong...3")}}class h extends s.BF{constructor(e,t,n,i){super(),this.syncCounter=e,this.xDirection=t,this.yDirection=n,this.powerHit=i}}},7147:(e,t,n)=>{"use strict";function i(e,t){let n=null;n=t?document.getElementById("player2-nickname"):document.getElementById("player1-nickname"),n.textContent=e}function s(e,t){let n=null;n=t?document.getElementById("player2-partial-ip"):document.getElementById("player1-partial-ip"),n.textContent=e}n.d(t,{U:()=>s,s:()=>i})},6090:(e,t,n)=>{"use strict";n.d(t,{I:()=>i});const i={SPRITE_SHEET:"../resources/assets/images/sprite_sheet.json",TEXTURES:{},SOUNDS:{}},s=i.TEXTURES;s.PIKACHU=(e,t)=>`pikachu/pikachu_${e}_${t}.png`,s.BALL=e=>`ball/ball_${e}.png`,s.NUMBER=e=>`number/number_${e}.png`,s.NEW_NUMBER=e=>`new_number/number_${e}.png`,s.SKY_BLUE="objects/sky_blue.png",s.MOUNTAIN="objects/mountain.png",s.GROUND_RED="objects/ground_red.png",s.GROUND_LINE="objects/ground_line.png",s.GROUND_LINE_LEFT_MOST="objects/ground_line_leftmost.png",s.GROUND_LINE_RIGHT_MOST="objects/ground_line_rightmost.png",s.GROUND_YELLOW="objects/ground_yellow.png",s.NET_PILLAR_TOP="objects/net_pillar_top.png",s.NET_PILLAR="objects/net_pillar.png",s.SHADOW="objects/shadow.png",s.BALL_HYPER="ball/ball_hyper.png",s.BALL_TRAIL="ball/ball_trail.png",s.BALL_PUNCH="ball/ball_punch.png",s.CLOUD="objects/cloud.png",s.WAVE="objects/wave.png",s.BLACK="objects/black.png",s.SACHISOFT="messages/common/sachisoft.png",s.READY="messages/common/ready.png",s.GAME_END="messages/common/game_end.png",s.MARK="messages/ja/mark.png",s.POKEMON="messages/ja/pokemon.png",s.PIKACHU_VOLLEYBALL="messages/ja/pikachu_volleyball.png",s.FIGHT="messages/ja/fight.png",s.WITH_COMPUTER="messages/ja/with_computer.png",s.WITH_FRIEND="messages/ja/with_friend.png",s.GAME_START="messages/ja/game_start.png",s.SITTING_PIKACHU="sitting_pikachu.png";const o=i.SOUNDS;o.BGM="../resources/assets/sounds/bgm.mp3",o.PIPIKACHU="../resources/assets/sounds/WAVE140_1.wav",o.PIKA="../resources/assets/sounds/WAVE141_1.wav",o.CHU="../resources/assets/sounds/WAVE142_1.wav",o.PI="../resources/assets/sounds/WAVE143_1.wav",o.PIKACHU="../resources/assets/sounds/WAVE144_1.wav",o.POWERHIT="../resources/assets/sounds/WAVE145_1.wav",o.BALLTOUCHESGROUND="../resources/assets/sounds/WAVE146_1.wav"},6806:(e,t,n)=>{"use strict";n.d(t,{Es:()=>s,S0:()=>a,wH:()=>o});var i=n(5716);class s{constructor(){this.topLeftPointX=(0,i._)()%500-68,this.topLeftPointY=(0,i._)()%152,this.topLeftPointXVelocity=1+(0,i._)()%2,this.sizeDiffTurnNumber=(0,i._)()%11}get sizeDiff(){return 5-Math.abs(this.sizeDiffTurnNumber-5)}get spriteTopLeftPointX(){return this.topLeftPointX-this.sizeDiff}get spriteTopLeftPointY(){return this.topLeftPointY-this.sizeDiff}get spriteWidth(){return 48+2*this.sizeDiff}get spriteHeight(){return 24+2*this.sizeDiff}}class o{constructor(){this.verticalCoord=0,this.verticalCoordVelocity=2,this.yCoords=[];for(let e=0;e<27;e++)this.yCoords.push(314)}}function a(e,t){for(let t=0;t<10;t++)e[t].topLeftPointX+=e[t].topLeftPointXVelocity,e[t].topLeftPointX>432&&(e[t].topLeftPointX=-68,e[t].topLeftPointY=(0,i._)()%152,e[t].topLeftPointXVelocity=1+(0,i._)()%2),e[t].sizeDiffTurnNumber=(e[t].sizeDiffTurnNumber+1)%11;t.verticalCoord+=t.verticalCoordVelocity,t.verticalCoord>32?(t.verticalCoord=32,t.verticalCoordVelocity=-1):t.verticalCoord<0&&t.verticalCoordVelocity<0&&(t.verticalCoordVelocity=2,t.verticalCoord=-(0,i._)()%40);for(let e=0;e<27;e++)t.yCoords[e]=314-t.verticalCoord+(0,i._)()%3}},478:(e,t,n)=>{"use strict";n.d(t,{t:()=>s});var i=n(1674);class s extends i.BF{constructor(e,t,n,i,s,a=null){super(),this.powerHitKeyIsDownPrevious=!1,this.leftKey=new o(e),this.rightKey=new o(t),this.upKey=new o(n),this.downKey=new o(i),this.powerHitKey=new o(s),this.downRightKey=new o(a)}getInput(){this.leftKey.isDown?this.xDirection=-1:this.rightKey.isDown||this.downRightKey&&this.downRightKey.isDown?this.xDirection=1:this.xDirection=0,this.upKey.isDown?this.yDirection=-1:this.downKey.isDown||this.downRightKey&&this.downRightKey.isDown?this.yDirection=1:this.yDirection=0;const e=this.powerHitKey.isDown;!this.powerHitKeyIsDownPrevious&&e?this.powerHit=1:this.powerHit=0,this.powerHitKeyIsDownPrevious=e}subscribe(){this.leftKey.subscribe(),this.rightKey.subscribe(),this.upKey.subscribe(),this.downKey.subscribe(),this.powerHitKey.subscribe(),this.downRightKey.subscribe()}unsubscribe(){this.leftKey.unsubscribe(),this.rightKey.unsubscribe(),this.upKey.unsubscribe(),this.downKey.unsubscribe(),this.powerHitKey.unsubscribe(),this.downRightKey.unsubscribe()}}class o{constructor(e){this.value=e,this.isDown=!1,this.isUp=!0,this.downListener=this.downHandler.bind(this),this.upListener=this.upHandler.bind(this),this.subscribe()}downHandler(e){e.code===this.value&&(this.isDown=!0,this.isUp=!1,e.preventDefault())}upHandler(e){e.code===this.value&&(this.isDown=!1,this.isUp=!0,e.preventDefault())}subscribe(){window.addEventListener("keyup",this.upListener),window.addEventListener("keydown",this.downListener)}unsubscribe(){window.removeEventListener("keydown",this.downListener),window.removeEventListener("keyup",this.upListener),this.isDown=!1,this.isUp=!0}}},1674:(e,t,n)=>{"use strict";n.d(t,{BF:()=>l,Rs:()=>o,vW:()=>d});var i=n(5716);const s=432,o=216,a=32,r=244,c=252;class d{constructor(e,t){this.player1=new h(!1,e),this.player2=new h(!0,t),this.ball=new u(!1),this.modeNum=1}runEngineForNextFrame(e){const t=function(e,t,n,i,a=1){const r=function(e){e.previousPreviousX=e.previousX,e.previousPreviousY=e.previousY,e.previousX=e.x,e.previousY=e.y;let t=e.fineRotation+(e.xVelocity/2|0);t<0?t+=50:t>50&&(t+=-50),e.fineRotation=t,e.rotation=e.fineRotation/10|0;const n=e.x+e.xVelocity;(n<20||n>s)&&(e.xVelocity=-e.xVelocity,e.isDownPowerhit=!1);let i=e.y+e.yVelocity;if(i<0&&(e.yVelocity=1),Math.abs(e.x-o)<25&&e.y>176)if(e.y<=192)e.yVelocity>0&&(e.yVelocity=-e.yVelocity,e.isDownPowerhit=!1);else{let t=e.xVelocity;e.x<o?e.xVelocity=-Math.abs(e.xVelocity):e.xVelocity=Math.abs(e.xVelocity),e.xVelocity*t<0&&(e.isDownPowerhit=!1)}return i=e.y+e.yVelocity,i>c?(e.sound.ballTouchesGround=!0,e.dribbleCounts=[0,0],e.y<212&&e.yVelocity>42&&1==e.isServeState&&(e.endByThunder=!0),e.yVelocity=-e.yVelocity,e.punchEffectX=e.x,e.y=c,e.punchEffectRadius=20,e.punchEffectY=272,!0):(e.y=i,e.x=e.x+e.xVelocity,e.yVelocity+=1,!1)}(n);let d,l;for(let s=0;s<2;s++)0===s?(d=e,l=t):(d=t,l=e),g(n),y(d,i[s],l,n,a);for(let s=0;s<2;s++)d=0===s?e:t,!0===m(n,d.x,d.y)?!1===d.isCollisionWithBallHappened&&(+n.isPlayer2Serve!=s&&n.isServeState&&(n.isServeState=!1,2==a&&(n.canPowerhitBasedOnCollision=!0)),3==a&&n.dribbleCounts[s]>4||(p(n,d.x,i[s],d.state,a),d.isCollisionWithBallHappened=!0,n.isServeState&&2==a&&(n.canPowerhitBasedOnCollision=!1))):d.isCollisionWithBallHappened=!1,1!=a&&3!=a||n.isDownPowerhit&&n.isServeState&&!n.expectedNetCollision&&(n.expectedLandingPointX>=o&&!n.isPlayer2Serve||n.expectedLandingPointX<o&&n.isPlayer2Serve)&&(n.endByDownServe=!0);return r}(this.player1,this.player2,this.ball,e,this.modeNum);return t}}class l{constructor(){this.xDirection=0,this.yDirection=0,this.powerHit=0}}class h{constructor(e,t){this.isPlayer2=e,this.isComputer=t,this.initializeForNewRound(),this.divingDirection=0,this.lyingDownDurationLeft=-1,this.isWinner=!1,this.gameEnded=!1,this.computerWhereToStandBy=0,this.sound={pipikachu:!1,pika:!1,chu:!1}}initializeForNewRound(){this.x=36,this.isPlayer2&&(this.x=396),this.y=r,this.yVelocity=0,this.isCollisionWithBallHappened=!1,this.state=0,this.frameNumber=0,this.normalStatusArmSwingDirection=1,this.delayBeforeNextFrame=0,this.computerBoldness=(0,i._)()%5}}class u{constructor(e){this.initializeForNewRound(e),this.expectedLandingPointX=0,this.expectedNetCollision=!1,this.rotation=0,this.fineRotation=0,this.punchEffectX=0,this.punchEffectY=0,this.previousX=0,this.previousPreviousX=0,this.previousY=0,this.previousPreviousY=0,this.dribbleCounts=[0,0],this.dribbleCounts=[0,0],this.sound={powerHit:!1,ballTouchesGround:!1}}initializeForNewRound(e){this.isPlayer2Serve=e,this.isServeState=!0,this.canPowerhitBasedOnCollision=!0,this.endByDownServe=!1,this.endByThunder=!1,this.updatedDownServe=!1,this.isDownPowerhit=!1,this.x=56,!0===e&&(this.x=376),this.y=0,this.xVelocity=0,this.yVelocity=1,this.punchEffectRadius=0,this.isPowerHit=!1,this.dribbleCounts=[0,0]}}function m(e,t,n){let i=e.x-t;return Math.abs(i)<=a&&(i=e.y-n,Math.abs(i)<=a)}function y(e,t,n,c,d=1){if(!0===e.isComputer&&function(e,t,n,r){r.xDirection=0,r.yDirection=0,r.powerHit=0;let c=t.expectedLandingPointX;if(Math.abs(t.x-e.x)>100&&Math.abs(t.xVelocity)<e.computerBoldness+5){const n=Number(e.isPlayer2)*o;(t.expectedLandingPointX<=n||t.expectedLandingPointX>=Number(e.isPlayer2)*s+o)&&0===e.computerWhereToStandBy&&(c=n+(o/2|0))}if(Math.abs(c-e.x)>e.computerBoldness+8?e.x<c?r.xDirection=1:r.xDirection=-1:(0,i._)()%20==0&&(e.computerWhereToStandBy=(0,i._)()%2),0===e.state){Math.abs(t.xVelocity)<e.computerBoldness+3&&Math.abs(t.x-e.x)<a&&t.y>-36&&t.y<10*e.computerBoldness+84&&t.yVelocity>0&&(r.yDirection=-1);const n=Number(e.isPlayer2)*o,i=(Number(e.isPlayer2)+1)*o;t.expectedLandingPointX>n&&t.expectedLandingPointX<i&&Math.abs(t.x-e.x)>5*e.computerBoldness+64&&t.x>n&&t.x<i&&t.y>174&&(r.powerHit=1,e.x<t.x?r.xDirection=1:r.xDirection=-1)}else if((1===e.state||2===e.state)&&(Math.abs(t.x-e.x)>8&&(e.x<t.x?r.xDirection=1:r.xDirection=-1),Math.abs(t.x-e.x)<48&&Math.abs(t.y-e.y)<48)){const a=function(e,t,n,a){if((0,i._)()%2==0)for(let i=1;i>-1;i--)for(let r=-1;r<2;r++){const c=b(i,r,t);if((c<=Number(e.isPlayer2)*o||c>=Number(e.isPlayer2)*s+o)&&Math.abs(c-n.x)>64)return a.xDirection=i,a.yDirection=r,!0}else for(let i=1;i>-1;i--)for(let r=1;r>-2;r--){const c=b(i,r,t);if((c<=Number(e.isPlayer2)*o||c>=Number(e.isPlayer2)*s+o)&&Math.abs(c-n.x)>64)return a.xDirection=i,a.yDirection=r,!0}return!1}(e,t,n,r);!0===a&&(r.powerHit=1,Math.abs(n.x-e.x)<80&&-1!==r.yDirection&&(r.yDirection=-1))}}(e,c,n,t),4===e.state)return e.lyingDownDurationLeft+=-1,void(e.lyingDownDurationLeft<-1&&(e.state=0));let l=0;e.state<5&&(l=e.state<3?6*t.xDirection:8*e.divingDirection);const h=e.x+l;e.x=h,!1===e.isPlayer2?h<a?e.x=a:h>o-a&&(e.x=o-a):h<o+a?e.x=o+a:h>400&&(e.x=400),e.state<3&&-1===t.yDirection&&e.y===r&&(e.yVelocity=-16,e.state=1,e.frameNumber=0,e.sound.chu=!0);const u=e.y+e.yVelocity;if(e.y=u,u<r?e.yVelocity+=1:u>r&&(e.yVelocity=0,e.y=r,e.frameNumber=0,3===e.state?(e.state=4,e.frameNumber=0,e.lyingDownDurationLeft=3):e.state=0),3===d&&(!e.isPlayer2&&c.dribbleCounts[0]>2||e.isPlayer2&&c.dribbleCounts[1]>2)?c.canPowerhitBasedOnCollision=!1:3==d&&(c.canPowerhitBasedOnCollision=!0),1===t.powerHit&&(1!==e.state||2===d&&!c.canPowerhitBasedOnCollision&&e.isPlayer2===c.isPlayer2Serve||3==d&&!c.canPowerhitBasedOnCollision?0===e.state&&0!==t.xDirection&&(e.state=3,e.frameNumber=0,e.divingDirection=t.xDirection,e.yVelocity=-5,e.sound.chu=!0):(e.delayBeforeNextFrame=5,e.frameNumber=0,e.state=2,e.sound.pika=!0)),1===e.state)e.frameNumber=(e.frameNumber+1)%3;else if(2===e.state)e.delayBeforeNextFrame<1?(e.frameNumber+=1,e.frameNumber>4&&(e.frameNumber=0,e.state=1)):e.delayBeforeNextFrame-=1;else if(0===e.state&&(e.delayBeforeNextFrame+=1,e.delayBeforeNextFrame>3)){e.delayBeforeNextFrame=0;const t=e.frameNumber+e.normalStatusArmSwingDirection;(t<0||t>4)&&(e.normalStatusArmSwingDirection=-e.normalStatusArmSwingDirection),e.frameNumber=e.frameNumber+e.normalStatusArmSwingDirection}!0===e.gameEnded&&(0===e.state&&(!0===e.isWinner?(e.state=5,e.sound.pipikachu=!0):e.state=6,e.delayBeforeNextFrame=0,e.frameNumber=0),function(e){!0===e.gameEnded&&e.frameNumber<4&&(e.delayBeforeNextFrame+=1,e.delayBeforeNextFrame>4&&(e.delayBeforeNextFrame=0,e.frameNumber+=1))}(e))}function p(e,t,n,s,a){e.x<t?e.xVelocity=-(Math.abs(e.x-t)/3|0):e.x>t&&(e.xVelocity=Math.abs(e.x-t)/3|0),0===e.xVelocity&&(e.xVelocity=(0,i._)()%3-1);const r=Math.abs(e.yVelocity);e.yVelocity=-r,r<15&&(e.yVelocity=-15),e.isDownPowerhit=!1,2===s?(e.x<o?e.xVelocity=10*(Math.abs(n.xDirection)+1):e.xVelocity=10*-(Math.abs(n.xDirection)+1),e.punchEffectX=e.x,e.punchEffectY=e.y,e.yVelocity=Math.abs(e.yVelocity)*n.yDirection*2,e.punchEffectRadius=20,1==n.yDirection&&(e.isDownPowerhit=!0),e.sound.powerHit=!0,e.isPowerHit=!0,e.dribbleCounts=[0,0]):(3==a&&(t<o?(e.dribbleCounts[0]+=1,e.dribbleCounts[1]=0):(e.dribbleCounts[0]=0,e.dribbleCounts[1]+=1)),e.isPowerHit=!1),g(e)}function g(e){const t={x:e.x,y:e.y,xVelocity:e.xVelocity,yVelocity:e.yVelocity};let n=0,i=!1;for(;;){n++;const e=t.xVelocity+t.x;if((e<20||e>s)&&(t.xVelocity=-t.xVelocity),t.y+t.yVelocity<0&&(t.yVelocity=1),Math.abs(t.x-o)<25&&t.y>176)if(t.y<192)t.yVelocity>0&&(t.yVelocity=-t.yVelocity,i=!0);else{let e=t.xVelocity;t.x<o?t.xVelocity=-Math.abs(t.xVelocity):t.xVelocity=Math.abs(t.xVelocity),t.xVelocity*e<0&&(i=!0)}if(t.y=t.y+t.yVelocity,t.y>c||n>=1e3)break;t.x=t.x+t.xVelocity,t.yVelocity+=1}e.expectedLandingPointX=t.x,e.expectedNetCollision=i}function b(e,t,n){const i={x:n.x,y:n.y,xVelocity:n.xVelocity,yVelocity:n.yVelocity};i.x<o?i.xVelocity=10*(Math.abs(e)+1):i.xVelocity=10*-(Math.abs(e)+1),i.yVelocity=Math.abs(i.yVelocity)*t*2;let a=0;for(;;){a++;const e=i.x+i.xVelocity;if((e<20||e>s)&&(i.xVelocity=-i.xVelocity),i.y+i.yVelocity<0&&(i.yVelocity=1),Math.abs(i.x-o)<25&&i.y>176&&i.yVelocity>0&&(i.yVelocity=-i.yVelocity),i.y=i.y+i.yVelocity,i.y>c||a>=1e3)return i.x;i.x=i.x+i.xVelocity,i.yVelocity+=1}}},94:(e,t,n)=>{"use strict";n.d(t,{q:()=>C});var i=n(1674),s=n(9819),o=n(7153),a=n(9449),r=n(6806),c=n(6090);const d=c.I.TEXTURES;class l{constructor(e){const t=e[c.I.SPRITE_SHEET].textures;this.mark=y(t,d.MARK,.5,.5),this.mark.x=216,this.mark.y=152,this.container=new a.mc,this.container.addChild(this.mark)}get visible(){return this.container.visible}set visible(e){this.container.visible=e}drawMark(e){const t=this.mark;0!==e?e<100?t.alpha=Math.min(1,t.alpha+.04):e>=100&&(t.alpha=Math.max(0,t.alpha-.04)):t.alpha=0}}class h{constructor(e){const t=e[c.I.SPRITE_SHEET].textures;this.messages={pokemon:y(t,d.POKEMON,0,0),pikachuVolleyball:y(t,d.PIKACHU_VOLLEYBALL,0,0),withWho:[y(t,d.WITH_COMPUTER,0,0),y(t,d.WITH_FRIEND,0,0)],sachisoft:y(t,d.SACHISOFT,0,0),fight:y(t,d.FIGHT,0,0)},this.sittingPikachuTilesContainer=function(e){const t=new a.mc,n=e[d.SITTING_PIKACHU],i=n.width,s=n.height;let r;for(let e=0;e<Math.floor(304/s)+2;e++)for(let a=0;a<Math.floor(432/i)+2;a++)r=new o.k(n),b(t,r,i*a,s*e);return t}(t),this.messages.sachisoft.x=216-this.messages.sachisoft.texture.width/2,this.messages.sachisoft.y=264,this.messages.pikachuVolleyball.x=140,this.messages.pikachuVolleyball.y=80,this.messages.pokemon.x=170,this.messages.pokemon.y=40,this.container=new a.mc,this.container.addChild(this.sittingPikachuTilesContainer),this.container.addChild(this.messages.pokemon),this.container.addChild(this.messages.pikachuVolleyball),this.container.addChild(this.messages.withWho[0]),this.container.addChild(this.messages.withWho[1]),this.container.addChild(this.messages.sachisoft),this.container.addChild(this.messages.fight),this.initializeVisibles(),this.sittingPikachuTilesDisplacement=0,this.selectedWithWho=-1,this.selectedWithWhoMessageSizeIncrement=2}get visible(){return this.container.visible}set visible(e){this.container.visible=e,!1===e&&this.initializeVisibles()}initializeVisibles(){for(const e in this.messages)this.messages[e].visible=!1}drawFightMessage(e){const t=[20,22,25,27,30,27,25,22,20],n=this.messages.fight,i=n.texture.width,s=n.texture.height;if(0===e&&(n.visible=!0),e<30){const t=Math.floor(Math.floor(e*i/30)/2),o=Math.floor(Math.floor(e*s/30)/2);n.width=2*t,n.height=2*o,n.x=100-t,n.y=70-o}else{const o=(e+1)%9,a=Math.floor(Math.floor(t[o]*i/30)/2),r=Math.floor(Math.floor(t[o]*s/30)/2);n.width=2*a,n.height=2*r,n.y=70-r,n.x=100-a}}drawSachisoft(e){0===e&&(this.messages.sachisoft.visible=!0,this.messages.sachisoft.alpha=0),this.messages.sachisoft.alpha=Math.min(1,this.messages.sachisoft.alpha+.04),e>70&&(this.messages.sachisoft.alpha=1)}drawSittingPikachuTiles(e){0===e&&(this.sittingPikachuTilesContainer.visible=!0,this.sittingPikachuTilesContainer.alpha=0);const t=this.sittingPikachuTilesContainer.getChildAt(0).texture.height;this.sittingPikachuTilesDisplacement=(this.sittingPikachuTilesDisplacement+2)%t,this.sittingPikachuTilesContainer.x=-this.sittingPikachuTilesDisplacement,this.sittingPikachuTilesContainer.y=-this.sittingPikachuTilesDisplacement,e>30&&(this.sittingPikachuTilesContainer.alpha=Math.min(1,this.sittingPikachuTilesContainer.alpha+.04)),e>70&&(this.sittingPikachuTilesContainer.alpha=1)}drawPikachuVolleyballMessage(e){if(0!==e)if(e>30&&(this.messages.pikachuVolleyball.visible=!0),e>30&&e<=44){const t=195-15*(e-30);this.messages.pikachuVolleyball.x=140+t}else e>44&&e<=55?(this.messages.pikachuVolleyball.x=140,this.messages.pikachuVolleyball.width=200-15*(e-44)):e>55&&e<=71?(this.messages.pikachuVolleyball.x=140,this.messages.pikachuVolleyball.width=40+15*(e-55)):e>71&&(this.messages.pikachuVolleyball.x=140,this.messages.pikachuVolleyball.width=this.messages.pikachuVolleyball.texture.width);else this.messages.pikachuVolleyball.visible=!1}drawPokemonMessage(e){0!==e?e>71&&(this.messages.pokemon.visible=!0):this.messages.pokemon.visible=!1}drawWithWhoMessages(e){const t=this.messages.withWho,n=t[0].texture.width,i=t[0].texture.height;if(0!==e){if(e>70){this.selectedWithWhoMessageSizeIncrement<10&&(this.selectedWithWhoMessageSizeIncrement+=1);for(let e=0;e<2;e++){const s=Number(this.selectedWithWho===e),o=s*(this.selectedWithWhoMessageSizeIncrement+2),a=s*this.selectedWithWhoMessageSizeIncrement;t[e].visible=!0,t[e].x=216-n/2-o,t[e].y=184+30*e-a,t[e].width=n+2*o,t[e].height=i+2*a}}}else for(let e=0;e<2;e++)t[e].visible=!1}selectWithWho(e){this.selectedWithWho=e,this.selectedWithWhoMessageSizeIncrement=2}}class u{constructor(e){const t=e[c.I.SPRITE_SHEET].textures;this.bgContainer=function(e){const t=new a.mc;let n,i=e[d.SKY_BLUE];for(let e=0;e<12;e++)for(let s=0;s<27;s++)n=new o.k(i),b(t,n,16*s,16*e);i=e[d.MOUNTAIN],n=new o.k(i),b(t,n,0,188),i=e[d.GROUND_RED];for(let e=0;e<27;e++)n=new o.k(i),b(t,n,16*e,248);i=e[d.GROUND_LINE];for(let e=1;e<26;e++)n=new o.k(i),b(t,n,16*e,264);i=e[d.GROUND_LINE_LEFT_MOST],n=new o.k(i),b(t,n,0,264),i=e[d.GROUND_LINE_RIGHT_MOST],n=new o.k(i),b(t,n,416,264),i=e[d.GROUND_YELLOW];for(let e=0;e<2;e++)for(let s=0;s<27;s++)n=new o.k(i),b(t,n,16*s,280+16*e);i=e[d.NET_PILLAR_TOP],n=new o.k(i),b(t,n,213,176),i=e[d.NET_PILLAR];for(let e=0;e<12;e++)n=new o.k(i),b(t,n,213,184+8*e);return t}(t);const n=function(e){const t=(t,n)=>e[d.PIKACHU(t,n)],n=[];for(let e=0;e<7;e++)if(3===e)n.push(t(e,0)),n.push(t(e,1));else if(4===e)n.push(t(e,0));else for(let i=0;i<5;i++)n.push(t(e,i));const i=new s.D(n,!1),o=new s.D(n,!1);return i.anchor.x=.5,i.anchor.y=.5,o.anchor.x=.5,o.anchor.y=.5,[i,o]}(t);this.player1=n[0],this.player2=n[1],this.ball=function(e){const t=t=>e[d.BALL(t)],n=[t(0),t(1),t(2),t(3),t(4),t("hyper")],i=new s.D(n,!1);return i.anchor.x=.5,i.anchor.y=.5,i}(t),this.ballHyper=y(t,d.BALL_HYPER,.5,.5),this.ballTrail=y(t,d.BALL_TRAIL,.5,.5),this.punch=y(t,d.BALL_PUNCH,.5,.5),this.scoreBoards=[p(t),p(t)],this.downServeBoards=[g(t),g(t)],this.shadows={forPlayer1:y(t,d.SHADOW,.5,.5),forPlayer2:y(t,d.SHADOW,.5,.5),forBall:y(t,d.SHADOW,.5,.5)},this.messages={gameStart:y(t,d.GAME_START,0,0),ready:y(t,d.READY,0,0),gameEnd:y(t,d.GAME_END,0,0)},this.cloudContainer=function(e){const t=new a.mc,n=e[d.CLOUD];for(let e=0;e<10;e++){const e=new o.k(n);e.anchor.x=0,e.anchor.y=0,t.addChild(e)}return t}(t),this.waveContainer=function(e){const t=new a.mc,n=e[d.WAVE];for(let e=0;e<27;e++)b(t,new o.k(n),16*e,0);return t}(t),this.container=new a.mc,this.container.addChild(this.bgContainer),this.container.addChild(this.cloudContainer),this.container.addChild(this.waveContainer),this.container.addChild(this.shadows.forPlayer1),this.container.addChild(this.shadows.forPlayer2),this.container.addChild(this.shadows.forBall),this.container.addChild(this.player1),this.container.addChild(this.player2),this.container.addChild(this.ballTrail),this.container.addChild(this.ballHyper),this.container.addChild(this.ball),this.container.addChild(this.punch),this.container.addChild(this.scoreBoards[0]),this.container.addChild(this.scoreBoards[1]),this.container.addChild(this.downServeBoards[0]),this.container.addChild(this.downServeBoards[1]),this.container.addChild(this.messages.gameStart),this.container.addChild(this.messages.ready),this.container.addChild(this.messages.gameEnd),this.bgContainer.x=0,this.bgContainer.y=0,this.cloudContainer.x=0,this.cloudContainer.y=0,this.waveContainer.x=0,this.waveContainer.y=0,this.messages.ready.x=176,this.messages.ready.y=38,this.scoreBoards[0].x=14,this.scoreBoards[0].y=10,this.scoreBoards[1].x=354,this.scoreBoards[1].y=10,this.downServeBoards[0].x=14,this.downServeBoards[0].y=18,this.downServeBoards[1].x=354,this.downServeBoards[1].y=18,this.shadows.forPlayer1.y=273,this.shadows.forPlayer2.y=273,this.shadows.forBall.y=273,this.initializeVisibles(),this.cloudArray=[];for(let e=0;e<10;e++)this.cloudArray.push(new r.Es);this.wave=new r.wH}get visible(){return this.container.visible}set visible(e){this.container.visible=e,!1===e&&this.initializeVisibles()}initializeVisibles(){for(const e in this.messages)this.messages[e].visible=!1}drawPlayersAndBall(e){const t=e.player1,n=e.player2,i=e.ball;this.player1.x=t.x,this.player1.y=t.y,3===t.state||4===t.state?this.player1.scale.x=-1===t.divingDirection?-1:1:this.player1.scale.x=1,this.shadows.forPlayer1.x=t.x,this.player2.x=n.x,this.player2.y=n.y,3===n.state||4===n.state?this.player2.scale.x=1===n.divingDirection?1:-1:this.player2.scale.x=-1,this.shadows.forPlayer2.x=n.x;const s=f(t.state,t.frameNumber),o=f(n.state,n.frameNumber);this.player1.gotoAndStop(s),this.player2.gotoAndStop(o),this.ball.x=i.x,this.ball.y=i.y,this.shadows.forBall.x=i.x,this.ball.gotoAndStop(i.rotation),i.punchEffectRadius>0?(i.punchEffectRadius-=2,this.punch.width=2*i.punchEffectRadius,this.punch.height=2*i.punchEffectRadius,this.punch.x=i.punchEffectX,this.punch.y=i.punchEffectY,this.punch.visible=!0):this.punch.visible=!1,!0===i.isPowerHit?(this.ballHyper.x=i.previousX,this.ballHyper.y=i.previousY,this.ballTrail.x=i.previousPreviousX,this.ballTrail.y=i.previousPreviousY,this.ballHyper.visible=!0,this.ballTrail.visible=!0):(this.ballHyper.visible=!1,this.ballTrail.visible=!1)}drawScoresToScoreBoards(e){for(let t=0;t<2;t++){const n=this.scoreBoards[t],i=e[t],s=n.getChildAt(0),o=n.getChildAt(1);s.gotoAndStop(i%10),o.gotoAndStop(Math.floor(i/10)%10),o.visible=i>=10}}drawDownServeCountsToDownServeBoards(e){for(let t=0;t<2;t++){const n=this.downServeBoards[t],i=e[t],s=n.getChildAt(0),o=n.getChildAt(1);s.gotoAndStop(i%10),o.gotoAndStop(Math.floor(i/10)%10),o.visible=i>=10}}drawCloudsAndWave(){const e=this.cloudArray,t=this.wave;(0,r.S0)(e,t);for(let t=0;t<10;t++){const n=e[t],i=this.cloudContainer.getChildAt(t);i.x=n.spriteTopLeftPointX,i.y=n.spriteTopLeftPointY,i.width=n.spriteWidth,i.height=n.spriteHeight}for(let e=0;e<27;e++)this.waveContainer.getChildAt(e).y=t.yCoords[e]}drawGameStartMessage(e,t){if(0===e)this.messages.gameStart.visible=!0;else if(e>=t-1)return void(this.messages.gameStart.visible=!1);const n=this.messages.gameStart,i=n.texture.width,s=n.texture.height,o=Math.floor(i*e/50),a=Math.floor(s*e/50);n.x=216-o,n.y=50+2*a,n.width=2*o,n.height=2*a}drawReadyMessage(e){this.messages.ready.visible=e}toggleReadyMessage(){this.messages.ready.visible=!this.messages.ready.visible}drawGameEndMessage(e){const t=this.messages.gameEnd,n=t.texture.width,i=t.texture.height;if(0===e&&(t.visible=!0),e<50){const s=2*Math.floor((50-e)*n/50),o=2*Math.floor((50-e)*i/50);t.x=216-n/2-s,t.y=50-o,t.width=n+2*s,t.height=i+2*o}else t.x=216-n/2,t.y=50,t.width=n,t.height=i}}class m{constructor(e){const t=e[c.I.SPRITE_SHEET].textures;this.black=y(t,d.BLACK,0,0),this.black.width=432,this.black.height=304,this.black.x=0,this.black.y=0,this.black.alpha=1}get visible(){return this.black.visible}set visible(e){this.black.visible=e}setBlackAlphaTo(e){this.black.alpha=e,0===this.black.alpha?this.black.visible=!1:this.black.visible=!0}changeBlackAlphaBy(e){this.black.alpha=e>=0?Math.min(1,this.black.alpha+e):Math.max(0,this.black.alpha+e),0===this.black.alpha?this.black.visible=!1:this.black.visible=!0}}function y(e,t,n,i){const s=new o.k(e[t]);return s.anchor.x=n,s.anchor.y=i,s}function p(e){const t=[];for(let i=0;i<10;i++)t.push((n=i,e[d.NUMBER(n)]));var n;const i=[null,null];i[0]=new s.D(t,!1),i[1]=new s.D(t,!1);const o=new a.mc;return b(o,i[0],32,0),b(o,i[1],0,0),o.setChildIndex(i[0],0),o.setChildIndex(i[1],1),o}function g(e){const t=[],n=[null,null],i=new a.mc;for(let n=0;n<10;n++)t.push((o=n,e[d.NEW_NUMBER(o)]));var o;return n[0]=new s.D(t,!1),n[1]=new s.D(t,!1),b(i,n[0],28,28),b(i,n[1],0,28),i.setChildIndex(n[0],0),i.setChildIndex(n[1],1),i}function b(e,t,n,i){e.addChild(t),t.anchor.x=0,t.anchor.y=0,t.x=n,t.y=i}function f(e,t){return e<4?5*e+t:4===e?17+t:e>4?18+5*(e-5)+t:void 0}var w=n(478),v=n(6789);const k=c.I.SOUNDS;class I{constructor(e){this.sounds={bgm:new E(e[k.BGM].sound),pipikachu:new E(e[k.PIPIKACHU].sound),pika:new E(e[k.PIKA].sound),chu:new E(e[k.CHU].sound),pi:new E(e[k.PI].sound),pikachu:new E(e[k.PIKACHU].sound),powerHit:new E(e[k.POWERHIT].sound),ballTouchesGround:new E(e[k.BALLTOUCHESGROUND].sound)},this.sounds.bgm.loop=!0,this.properBGMVolume=.2,this.properSFXVolume=.35,this.adjustVolume()}adjustVolume(){for(const e in this.sounds)this.sounds[e].volume="bgm"===e?this.properBGMVolume:this.properSFXVolume}turnBGMVolume(e){let t;t=e?this.properBGMVolume:0,this.sounds.bgm.volume=t}turnSFXVolume(e){let t;t=e?this.properSFXVolume:0;for(const e in this.sounds)"bgm"!==e&&(this.sounds[e].volume=t)}muteAll(){v.s3.muteAll()}unmuteAll(){v.s3.unmuteAll()}}class E{constructor(e){this.center=e,this.left=v.AB.from(e.url),this.right=v.AB.from(e.url);const t=new v.uW.StereoFilter(0),n=new v.uW.StereoFilter(-.75),i=new v.uW.StereoFilter(.75);this.center.filters=[t],this.left.filters=[n],this.right.filters=[i]}set volume(e){this.center.volume=e,this.left.volume=e,this.right.volume=e}set loop(e){this.center.loop=e,this.left.loop=e,this.right.loop=e}play(e=0){0===e?this.center.play():-1===e?this.left.play():1===e&&this.right.play()}stop(){this.center.stop(),this.left.stop(),this.right.stop()}}class C{constructor(e,t){this.view={intro:new l(t),menu:new h(t),game:new u(t),fadeInOut:new m(t)},e.addChild(this.view.intro.container),e.addChild(this.view.menu.container),e.addChild(this.view.game.container),e.addChild(this.view.fadeInOut.black),this.view.intro.visible=!1,this.view.menu.visible=!1,this.view.game.visible=!1,this.view.fadeInOut.visible=!1,this.audio=new I(t),this.physics=new i.vW(!0,!0),this.keyboardArray=[new w.t("KeyD","KeyG","KeyR","KeyV","KeyZ","KeyF"),new w.t("ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter")],this.normalFPS=30,this.slowMotionFPS=5,this.SLOW_MOTION_FRAMES_NUM=6,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.selectedWithWho=0,this.scores=[0,0],this.downServeCounts=[0,0],this.downServeLimit=3,this.dribbleReset=[0,0],this.serveLimitScore=10,this.winningScore=15,this.currentServeRecord=[],this.previousServeRecord=[],this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.frameCounter=0,this.frameTotal={intro:165,afterMenuSelection:15,beforeStartOfNewGame:15,startOfNewGame:71,afterEndOfRound:5,beforeStartOfNextRound:30,gameEnd:211},this.noInputFrameCounter=0,this.noInputFrameTotal={menu:225},this.paused=!1,this.isStereoSound=!0,this._isPracticeMode=!1,this.state=this.intro}gameLoop(){if(!0!==this.paused){if(this.slowMotionFramesLeft>0){if(this.slowMotionNumOfSkippedFrames++,this.slowMotionNumOfSkippedFrames%Math.round(this.normalFPS/this.slowMotionFPS)!=0)return;this.slowMotionFramesLeft--,this.slowMotionNumOfSkippedFrames=0}this.keyboardArray[0].getInput(),this.keyboardArray[1].getInput(),this.state()}}intro(){0===this.frameCounter&&(this.view.intro.visible=!0,this.view.fadeInOut.setBlackAlphaTo(0),this.audio.sounds.bgm.stop()),this.view.intro.drawMark(this.frameCounter),this.frameCounter++,1!==this.keyboardArray[0].powerHit&&1!==this.keyboardArray[1].powerHit||(this.frameCounter=0,this.view.intro.visible=!1,this.state=this.menu),this.frameCounter>=this.frameTotal.intro&&(this.frameCounter=0,this.view.intro.visible=!1,this.state=this.menu)}menu(){if(0===this.frameCounter&&(this.view.menu.visible=!0,this.view.fadeInOut.setBlackAlphaTo(0),this.selectedWithWho=0,this.view.menu.selectWithWho(this.selectedWithWho)),this.view.menu.drawFightMessage(this.frameCounter),this.view.menu.drawSachisoft(this.frameCounter),this.view.menu.drawSittingPikachuTiles(this.frameCounter),this.view.menu.drawPikachuVolleyballMessage(this.frameCounter),this.view.menu.drawPokemonMessage(this.frameCounter),this.view.menu.drawWithWhoMessages(this.frameCounter),this.frameCounter++,this.frameCounter<71&&(1===this.keyboardArray[0].powerHit||1===this.keyboardArray[1].powerHit))this.frameCounter=71;else if(!(this.frameCounter<=71)){if(-1!==this.keyboardArray[0].yDirection&&-1!==this.keyboardArray[1].yDirection||1!==this.selectedWithWho?1!==this.keyboardArray[0].yDirection&&1!==this.keyboardArray[1].yDirection||0!==this.selectedWithWho?this.noInputFrameCounter++:(this.noInputFrameCounter=0,this.selectedWithWho=1,this.view.menu.selectWithWho(this.selectedWithWho),this.audio.sounds.pi.play()):(this.noInputFrameCounter=0,this.selectedWithWho=0,this.view.menu.selectWithWho(this.selectedWithWho),this.audio.sounds.pi.play()),1===this.keyboardArray[0].powerHit||1===this.keyboardArray[1].powerHit)return 1===this.selectedWithWho?(this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1):1===this.keyboardArray[0].powerHit?(this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!0):1===this.keyboardArray[1].powerHit&&(this.physics.player1.isComputer=!0,this.physics.player2.isComputer=!1),this.audio.sounds.pikachu.play(),this.frameCounter=0,this.noInputFrameCounter=0,void(this.state=this.afterMenuSelection);this.noInputFrameCounter>=this.noInputFrameTotal.menu&&(this.physics.player1.isComputer=!0,this.physics.player2.isComputer=!0,this.frameCounter=0,this.noInputFrameCounter=0,this.state=this.afterMenuSelection)}}afterMenuSelection(){this.view.fadeInOut.changeBlackAlphaBy(1/16),this.frameCounter++,this.frameCounter>=this.frameTotal.afterMenuSelection&&(this.frameCounter=0,this.state=this.beforeStartOfNewGame)}beforeStartOfNewGame(){this.frameCounter++,this.frameCounter>=this.frameTotal.beforeStartOfNewGame&&(this.frameCounter=0,this.view.menu.visible=!1,this.state=this.startOfNewGame)}startOfNewGame(){0===this.frameCounter&&(this.view.game.visible=!0,this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.physics.player1.gameEnded=!1,this.physics.player1.isWinner=!1,this.physics.player2.gameEnded=!1,this.physics.player2.isWinner=!1,this.scores[0]=0,this.scores[1]=0,this.view.game.drawScoresToScoreBoards(this.scores),this.downServeCounts[0]=this.downServeLimit,this.downServeCounts[1]=this.downServeLimit,1==this.physics.modeNum?this.view.game.drawDownServeCountsToDownServeBoards(this.downServeCounts):3==this.physics.modeNum&&this.view.game.drawDownServeCountsToDownServeBoards(this.physics.ball.dribbleCounts),this.currentServeRecord=[],this.previousServeRecord=[],this.physics.player1.initializeForNewRound(),this.physics.player2.initializeForNewRound(),this.physics.ball.initializeForNewRound(this.isPlayer2Serve),this.view.game.drawPlayersAndBall(this.physics),this.view.fadeInOut.setBlackAlphaTo(1),this.audio.sounds.bgm.play()),this.view.game.drawGameStartMessage(this.frameCounter,this.frameTotal.startOfNewGame),this.view.game.drawCloudsAndWave(),this.view.fadeInOut.changeBlackAlphaBy(-1/17),this.frameCounter++,this.frameCounter>=this.frameTotal.startOfNewGame&&(this.frameCounter=0,this.view.fadeInOut.setBlackAlphaTo(0),this.state=this.round)}round(){const e=1===this.keyboardArray[0].powerHit||1===this.keyboardArray[1].powerHit;if(!0===this.physics.player1.isComputer&&!0===this.physics.player2.isComputer&&e)return this.frameCounter=0,this.view.game.visible=!1,void(this.state=this.intro);const t=this.physics.runEngineForNextFrame(this.keyboardArray);if(3==this.physics.modeNum&&(this.roundEnded?this.view.game.drawDownServeCountsToDownServeBoards(this.dribbleReset):this.view.game.drawDownServeCountsToDownServeBoards(this.physics.ball.dribbleCounts)),!1===this.roundEnded&&this.physics.ball.isServeState&&this.currentServeRecord.push([this.physics.ball.x,this.physics.ball.y]),this.playSoundEffect(),this.view.game.drawPlayersAndBall(this.physics),this.view.game.drawCloudsAndWave(),!0===this.gameEnded)return this.view.game.drawGameEndMessage(this.frameCounter),this.frameCounter++,void((this.frameCounter>=this.frameTotal.gameEnd||this.frameCounter>=70&&e)&&(this.frameCounter=0,this.view.game.visible=!1,this.state=this.intro));let n=!1;this.physics.ball.endByDownServe&&!this.physics.ball.updatedDownServe&&(this.physics.ball.updatedDownServe=!0,this.physics.ball.isPlayer2Serve?this.downServeCounts[1]>0&&1==this.physics.modeNum?this.downServeCounts[1]-=1:n=!0:this.downServeCounts[0]>0&&1==this.physics.modeNum?this.downServeCounts[0]-=1:n=!0,1==this.physics.modeNum&&this.view.game.drawDownServeCountsToDownServeBoards(this.downServeCounts)),(t||n)&&!1===this._isPracticeMode&&!1===this.roundEnded&&!1===this.gameEnded&&(this.isIdenticalServe&&this.physics.ball.isServeState&&1==this.physics.modeNum?this.physics.ball.isPlayer2Serve?(this.isPlayer2Serve=!1,this.scores[1]=Math.max(this.scores[1]-1,0)):(this.isPlayer2Serve=!0,this.scores[0]=Math.max(this.scores[0]-1,0)):!n&&1!=this.physics.ball.endByThunder||1!=this.physics.modeNum&&3!=this.physics.modeNum?this.physics.ball.punchEffectX<i.Rs?(this.isPlayer2Serve=!0,this.scores[1]+=1):(this.isPlayer2Serve=!1,this.scores[0]+=1):this.physics.ball.isPlayer2Serve?(this.isPlayer2Serve=!1,this.scores[0]+=1):(this.isPlayer2Serve=!0,this.scores[1]+=1),this.scores[0]>=this.serveLimitScore&&(this.downServeCounts[0]=0),this.scores[1]>=this.serveLimitScore&&(this.downServeCounts[1]=0),this.scores[1]>=this.winningScore?(this.gameEnded=!0,this.physics.player1.isWinner=!1,this.physics.player2.isWinner=!0,this.physics.player1.gameEnded=!0,this.physics.player2.gameEnded=!0):this.scores[0]>=this.winningScore&&(this.gameEnded=!0,this.physics.player1.isWinner=!0,this.physics.player2.isWinner=!1,this.physics.player1.gameEnded=!0,this.physics.player2.gameEnded=!0),this.view.game.drawScoresToScoreBoards(this.scores),1==this.physics.modeNum&&this.view.game.drawDownServeCountsToDownServeBoards(this.downServeCounts),!1===this.roundEnded&&!1===this.gameEnded&&(this.slowMotionFramesLeft=this.SLOW_MOTION_FRAMES_NUM),this.previousServeRecord=this.currentServeRecord,this.currentServeRecord=[],this.roundEnded=!0),!0===this.roundEnded&&!1===this.gameEnded&&0===this.slowMotionFramesLeft&&(this.view.fadeInOut.changeBlackAlphaBy(1/16),this.state=this.afterEndOfRound)}afterEndOfRound(){this.view.fadeInOut.changeBlackAlphaBy(1/16),this.frameCounter++,this.frameCounter>=this.frameTotal.afterEndOfRound&&(this.frameCounter=0,this.state=this.beforeStartOfNextRound)}beforeStartOfNextRound(){0===this.frameCounter&&(this.view.fadeInOut.setBlackAlphaTo(1),this.view.game.drawReadyMessage(!1),this.physics.player1.initializeForNewRound(),this.physics.player2.initializeForNewRound(),this.physics.ball.initializeForNewRound(this.isPlayer2Serve),this.view.game.drawPlayersAndBall(this.physics)),this.view.game.drawCloudsAndWave(),this.view.fadeInOut.changeBlackAlphaBy(-1/16),this.frameCounter++,this.frameCounter%5==0&&this.view.game.toggleReadyMessage(),this.frameCounter>=this.frameTotal.beforeStartOfNextRound&&(this.frameCounter=0,this.view.game.drawReadyMessage(!1),this.view.fadeInOut.setBlackAlphaTo(0),this.roundEnded=!1,this.state=this.round)}playSoundEffect(){const e=this.audio;for(let t=0;t<2;t++){const n=this.physics[`player${t+1}`].sound;let i=0;this.isStereoSound&&(i=0===t?-1:1),!0===n.pipikachu&&(e.sounds.pipikachu.play(i),n.pipikachu=!1),!0===n.pika&&(e.sounds.pika.play(i),n.pika=!1),!0===n.chu&&(e.sounds.chu.play(i),n.chu=!1)}const t=this.physics.ball,n=t.sound;let s=0;this.isStereoSound&&(t.punchEffectX<i.Rs?s=-1:t.punchEffectX>i.Rs&&(s=1)),!0===n.powerHit&&(e.sounds.powerHit.play(s),n.powerHit=!1),!0===n.ballTouchesGround&&(e.sounds.ballTouchesGround.play(s),n.ballTouchesGround=!1)}changeDownBoardVisibility(e){this.view.game.downServeBoards[0].visible=e,this.view.game.downServeBoards[1].visible=e}restart(){this.frameCounter=0,this.noInputFrameCounter=0,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.view.menu.visible=!1,this.view.game.visible=!1,this.state=this.intro}get isPracticeMode(){return this._isPracticeMode}set isPracticeMode(e){this._isPracticeMode=e,this.view.game.scoreBoards[0].visible=!e,this.view.game.scoreBoards[1].visible=!e,this.view.game.downServeBoards[0].visible=!e,this.view.game.downServeBoards[1].visible=!e}get isIdenticalServe(){return JSON.stringify(this.currentServeRecord)===JSON.stringify(this.previousServeRecord)}}},5716:(e,t,n)=>{"use strict";n.d(t,{_:()=>s,p:()=>o});let i=null;function s(){return null===i?Math.floor(32768*Math.random()):Math.floor(32768*i())}function o(e){i=e}},6691:(e,t,n)=>{"use strict";n.d(t,{Q:()=>i});const i={GLOBAL:"GLOBAL",KR:"KR",TW:"TW"}},2777:(e,t,n)=>{"use strict";n.d(t,{WJ:()=>u,cy:()=>g,Bt:()=>y,Fb:()=>p,xB:()=>m});const i="http://localhost:3000";var s=n(1275),o=n(5023),a=n(6691),r=n(1514);let c=null,d=null,l=null;const h={initial:"initial",roomCreated:"roomCreated",quickMatchSuccess:"quickMatchSuccess",withFriendSuccess:"withFriendSuccess",cancel:"cancel"},u={createRoom:"createRoom",keepWait:"keepWait",connectToPeer:"connectToPeer",connectToPeerAfterAWhile:"connectToPeerAfterAWhile",waitPeerConnection:"waitPeerConnection",abandoned:"abandoned"};function m(e,t){c=e,d=t,l=0,b(i,w(h.initial,c,d,o.W.createHashedIPArray())).then(f)}function y(){console.log("Send quick match success message to server"),b(i,w(h.quickMatchSuccess,c,d))}function p(){console.log("Send with friend success message to server"),b(i,w(h.withFriendSuccess,c))}function g(){console.log("Send cancel quick match message to server"),b(i,w(h.cancel,c,d))}async function b(e="",t={}){try{return(await fetch(e,{method:"POST",mode:"cors",cache:"default",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(t)})).json()}catch(e){(0,r.Mu)(e),(0,r.KE)()}}const f=e=>{if(null!==e.numOfSuccess){const t=e.numOfSuccess;(0,r.y$)(t.withinLast24hours,t.withinLast1hour,t.withinLast10minutes)}switch(e.message){case u.createRoom:console.log("Create room!"),(0,s.ab)(c).then((()=>b(i,w(h.roomCreated,c,d)).then(f)));break;case u.keepWait:console.log("Keep wait!"),window.setTimeout((()=>{b(i,w(h.roomCreated,c,d)).then(f)}),1e3);break;case u.waitPeerConnection:console.log("Wait peer connection!"),(0,r.disableCancelQuickMatchBtnForAWhile)(),o.W.stagePeerHashedIP(e.hashedPeerIP);break;case u.connectToPeerAfterAWhile:console.log("Connect To Peer after 3 seconds..."),(0,r.disableCancelQuickMatchBtnForAWhile)(),window.setTimeout((()=>{console.log("Connect To Peer!"),(0,r.disableCancelQuickMatchBtnForAWhile)(),o.W.stagePeerHashedIP(e.hashedPeerIP),(0,s.O3)(e.roomId),(0,r.x4)(u.connectToPeer)}),3e3);break;case u.connectToPeer:console.log("Connect To Peer!"),(0,r.disableCancelQuickMatchBtnForAWhile)(),o.W.stagePeerHashedIP(e.hashedPeerIP),(0,s.O3)(e.roomId);break;case u.abandoned:console.log("room id abandoned.. please retry quick match.");break;case u.cancelAccepted:console.log("quick match cancel accepted")}l++,(0,r.n2)(l),(0,r.x4)(e.message)};function w(e,t,n=a.Q.GLOBAL,i=[]){return{message:e,roomId:t,matchGroup:n,blockedHashedIPs:i}}},3374:(e,t,n)=>{"use strict";n.d(t,{Z:()=>y});var i=n(7391),s=n.n(i),o=n(94),a=n(5716),r=n(5523),c=n(7147),d=n(6806),l=n(1674),h=n(4805),u=n(570),m=n(7839);class y extends o.q{constructor(e,t,n,i,s,o,a,r){super(e,t),this.noInputFrameTotal.menu=1/0,this.roomId=n,this.nicknames=i,this.partialPublicIPs=s,this.inputs=o,this.options=a,this.chats=r,this.player1Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:()=>{}},this.player2Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:()=>{}},this.keyboardArray=[this.player1Keyboard,this.player2Keyboard],this.willDisplayChat=!0;const c={play:()=>{},stop:()=>{}};this.fakeAudio={sounds:{bgm:{fake:!0,center:{isPlaying:!1},play:function(){this.center.isPlaying=!0},stop:function(){this.center.isPlaying=!1}},pipikachu:c,pika:c,chu:c,pi:c,pikachu:c,powerHit:c,ballTouchesGround:c}},this.initializeForReplay()}initializeForReplay(){for(const e in this.audio.sounds)this.audio.sounds[e].stop();this.timeCurrent=0,this.timeBGM=0,this.isBGMPlaying=!1,this.replayFrameCounter=0,this.chatCounter=0,this.optionsCounter=0;const e=s().alea(this.roomId.slice(10));(0,a.p)(e);const t=s().alea(this.roomId.slice(10,15)),n=s().alea(this.roomId.slice(15));(0,r.pt)(t,n),this.view.game.cloudArray=[];for(let e=0;e<10;e++)this.view.game.cloudArray.push(new d.Es);this.view.game.wave=new d.wH,this.view.intro.visible=!1,this.view.menu.visible=!1,this.view.game.visible=!1,this.view.fadeInOut.visible=!1,this.physics=new l.vW(!0,!0),this.normalFPS=25,this.slowMotionFPS=5,this.SLOW_MOTION_FRAMES_NUM=6,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.selectedWithWho=0,this.scores=[0,0],this.winningScore=15,this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.frameCounter=0,this.noInputFrameCounter=0,this.paused=!1,this.isStereoSound=!0,this._isPracticeMode=!1,this.isRoomCreatorPlayer2=!1,this.state=this.intro}intro(){0===this.frameCounter&&(this.selectedWithWho=0,this.nicknames&&((0,c.s)(this.nicknames[0],this.isRoomCreatorPlayer2),(0,c.s)(this.nicknames[1],!this.isRoomCreatorPlayer2)),this.partialPublicIPs&&((0,c.U)(this.partialPublicIPs[0],this.isRoomCreatorPlayer2),(0,c.U)(this.partialPublicIPs[1],!this.isRoomCreatorPlayer2))),super.intro()}menu(){const e=this.selectedWithWho;super.menu(),this.selectedWithWho!==e&&(this.isRoomCreatorPlayer2=!this.isRoomCreatorPlayer2,this.nicknames&&((0,c.s)(this.nicknames[0],this.isRoomCreatorPlayer2),(0,c.s)(this.nicknames[1],!this.isRoomCreatorPlayer2)),this.partialPublicIPs&&((0,c.U)(this.partialPublicIPs[0],this.isRoomCreatorPlayer2),(0,c.U)(this.partialPublicIPs[1],!this.isRoomCreatorPlayer2)))}gameLoopSilent(){const e=this.audio;this.willDisplayChat=!1,this.audio=this.fakeAudio,this.gameLoop(),this.willDisplayChat=!0,this.audio=e}gameLoop(){if(this.replayFrameCounter>=this.inputs.length)return void(0,u.mU)();(0,u.Vu)(this.replayFrameCounter);const e=this.inputs[this.replayFrameCounter],t=(0,h.d)(e>>>5),n=(0,h.d)(e%32);this.player1Keyboard.xDirection=t.xDirection,this.player1Keyboard.yDirection=t.yDirection,this.player1Keyboard.powerHit=t.powerHit,this.player2Keyboard.xDirection=n.xDirection,this.player2Keyboard.yDirection=n.yDirection,this.player2Keyboard.powerHit=n.powerHit,(0,u.kF)(t,n);let i=this.options[this.optionsCounter];for(;i&&i[0]===this.replayFrameCounter;){if(i[1].speed){switch(i[1].speed){case"slow":this.normalFPS=20;break;case"medium":this.normalFPS=25;break;case"fast":this.normalFPS=30}(0,m.r)(this.normalFPS)}if(i[1].winningScore)switch(i[1].winningScore){case 5:this.winningScore=5;break;case 10:this.winningScore=10;break;case 15:this.winningScore=15}if(i[1].rule)switch(i[1].rule){case"default":this.physics.modeNum=0,this.changeDownBoardVisibility(!1);break;case"Pgo":this.physics.modeNum=1,this.changeDownBoardVisibility(!0);break;case"noserve":this.physics.modeNum=2,this.changeDownBoardVisibility(!1);break;case"DL36":this.physics.modeNum=3,this.changeDownBoardVisibility(!0)}this.optionsCounter++,i=this.options[this.optionsCounter]}this.timeCurrent+=1/this.normalFPS,this.isBGMPlaying=this.audio.sounds.bgm.center.isPlaying,this.isBGMPlaying?this.timeBGM=(this.timeBGM+1/this.normalFPS)%83:this.timeBGM=0;let s=this.chats[this.chatCounter];for(;s&&s[0]===this.replayFrameCounter;)this.willDisplayChat&&(0,r.rE)(s[2],s[1]),this.chatCounter++,s=this.chats[this.chatCounter];this.replayFrameCounter++,this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,super.gameLoop()}}},7839:(e,t,n)=>{"use strict";n.d(t,{J:()=>v,r:()=>k});var i=n(4603),s=n(6787),o=n(592),a=n(3650),r=n(9449),c=n(7561),d=n(7049),l=n(3401),h=n(8077),u=n(4697),m=n(8505),y=(n(7229),n(6090)),p=n(3374),g=n(5523),b=n(570),f=n(6212),w=n(6970);const v=new class{constructor(){o.A4.registerPlugin("prepare",a.p8),o.A4.registerPlugin("batch",o.ch),h.KB.registerPlugin("prepare",m.S),h.KB.registerPlugin("sprite",u.$),c.aH.registerPlugin(d.A),i.W.RESOLUTION=2,i.W.SCALE_MODE=s.M6.NEAREST,i.W.ROUND_PIXELS=!0,this.ticker=new l.Rv,this.ticker.minFPS=1,this.renderer=(0,o.q5)({width:432,height:304,antialias:!1,backgroundColor:0,backgroundAlpha:1,forceCanvas:!0}),this.stage=new r.mc,this.loader=new c.aH,this.pikaVolley=null,this.playBackSpeedTimes=1,this.playBackSpeedFPS=null}readFile(e){const t=y.I.TEXTURES;t.WITH_COMPUTER=t.WITH_FRIEND,document.querySelector("#game-canvas-container").appendChild(this.renderer.view),this.renderer.render(this.stage),this.ticker.add((()=>{this.renderer.render(this.stage),(0,b.KZ)(this.pikaVolley.timeCurrent),this.pikaVolley.gameLoop()})),this.loader.add(y.I.SPRITE_SHEET);for(const e in y.I.SOUNDS)this.loader.add(y.I.SOUNDS[e]);!function(e){const t=document.getElementById("loading-box"),n=document.getElementById("progress-bar");e.onProgress.add((()=>{n.style.width=`${e.progress}%`})),e.onComplete.add((()=>{t.classList.add("hidden")}))}(this.loader);const n=new FileReader;n.onload=e=>{let t,n;try{t=JSON.parse(e.target.result),n=t.pack;const i=n.hash;if(n.hash=0,i!==(0,w.i)((0,f.l)(n)))throw"Error: The file content is not matching the hash code"}catch(e){return console.log(e),void(0,b.DI)()}(0,b.HK)(function(e){const t=[];let n=0,i=e.options[n];for(;i;){if(i[1].speed){let e=null;switch(i[1].speed){case"slow":e=20;break;case"medium":e=25;break;case"fast":e=30}const n=i[0];t.push([n,e])}n++,i=e.options[n]}let s=0,o=0,a=25;for(let e=0;e<t.length;e++){const n=t[e][0];s+=(n-o)/a,o=n,a=t[e][1]}return s+=(e.inputs.length-o)/a,s}(n)),this.loader.load((()=>{this.pikaVolley=new p.Z(this.stage,this.loader.resources,n.roomID,n.nicknames,n.partialPublicIPs,n.inputs,n.options,n.chats),(0,g.yg)(this.pikaVolley),(0,b.vk)(n.inputs.length),this.seekFrame(0),this.ticker.start(),(0,b.tr)(),(0,b.V$)()}))};try{n.readAsText(e)}catch(e){return console.log(e),void(0,b.DI)()}}seekFrame(e){if((0,g.lD)(),(0,b.Ml)(),this.ticker.stop(),this.pikaVolley.initializeForReplay(),e>0){for(let t=0;t<e;t++)this.pikaVolley.gameLoopSilent();this.renderer.render(this.stage)}(0,b.KZ)(this.pikaVolley.timeCurrent)}seekRelativeTime(e){const t=Math.max(0,this.pikaVolley.replayFrameCounter+e*this.pikaVolley.normalFPS);this.seekFrame(t)}adjustPlaybackSpeedTimes(e){this.playBackSpeedFPS=null,this.playBackSpeedTimes=e,this.ticker.maxFPS=this.pikaVolley.normalFPS*this.playBackSpeedTimes,(0,b.Ki)()}adjustPlaybackSpeedFPS(e){this.playBackSpeedTimes=null,this.playBackSpeedFPS=e,this.ticker.maxFPS=this.playBackSpeedFPS,(0,b.Ki)()}stopBGM(){this.pikaVolley.audio.sounds.bgm.center.stop()}playBGMProperly(){this.pikaVolley.isBGMPlaying&&this.pikaVolley.audio.sounds.bgm.center.play({start:this.pikaVolley.timeBGM})}};function k(e){v.playBackSpeedFPS?(v.ticker.maxFPS=v.playBackSpeedFPS,(0,b.Ki)()):v.playBackSpeedTimes&&(v.ticker.maxFPS=e*v.playBackSpeedTimes,(0,b.Ki)())}},5345:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var i=n(4213),s=n(6212),o=n(6970),a=n(4805),r=n(570);const c=new class{constructor(){this.frameCounter=0,this.roomID=null,this.nicknames=["",""],this.partialPublicIPs=["*.*.*.*","*.*.*.*"],this.inputs=[],this.options=[],this.chats=[]}recordRoomID(e){this.roomID=e}recordNicknames(e,t){this.nicknames[0]=e,this.nicknames[1]=t}recordPartialPublicIPs(e,t){this.partialPublicIPs[0]=e,this.partialPublicIPs[1]=t}recordInputs(e,t){const n=((0,a.H)(e)<<5)+(0,a.H)(t);this.inputs.push(n),this.frameCounter++}recordOptions(e){this.options.push([this.frameCounter,e])}recordChats(e,t){this.chats.push([this.frameCounter,t,e])}saveAsFile(){const e={version:"p2p-online",roomID:this.roomID,nicknames:this.nicknames,partialPublicIPs:this.partialPublicIPs,chats:this.chats,options:this.options,inputs:this.inputs,hash:0},t=(0,o.i)((0,s.l)(e));e.hash=t;const n={_comment:(0,r.rw)(),pack:e},a=new Blob([JSON.stringify(n)],{type:"text/plain;charset=utf-8"}),c=new Date,d=`${c.getFullYear()}${("0"+(c.getMonth()+1)).slice(-2)}${("0"+c.getDate()).slice(-2)}_${("0"+c.getHours()).slice(-2)}${("0"+c.getMinutes()).slice(-2)}_${this.nicknames[0]}_${this.partialPublicIPs[0].replace(".*.*","")}_vs_${this.nicknames[1]}_${this.partialPublicIPs[1].replace(".*.*","")}.txt`.replace(/[/\\?%*:|"<>]/g,"_");(0,i.saveAs)(a,d,{autoBom:!0})}}},570:(e,t,n)=>{"use strict";n.d(t,{DI:()=>k,HK:()=>S,KZ:()=>x,Ki:()=>b,Ml:()=>v,V$:()=>B,Vu:()=>C,aW:()=>g,kF:()=>L,mU:()=>w,rw:()=>I,tr:()=>f,vk:()=>E});var i=n(7839),s=n(5523);let o=!1;const a=document.getElementById("scrubber-range-input"),r=document.getElementById("play-pause-btn"),c=document.getElementById("seek-backward-1"),d=document.getElementById("seek-forward-1"),l=document.getElementById("seek-backward-3"),h=document.getElementById("seek-forward-3"),u=document.getElementById("speed-btn-5-fps"),m=document.getElementById("speed-btn-half-times"),y=document.getElementById("speed-btn-1-times"),p=document.getElementById("speed-btn-2-times");function g(){a.disabled=!0,r.disabled=!0,c.disabled=!0,d.disabled=!0,l.disabled=!0,h.disabled=!0,u.disabled=!0,m.disabled=!0,y.disabled=!0,p.disabled=!0,document.getElementById("file-input").addEventListener("change",(n=>{document.getElementById("loading-box").classList.remove("hidden"),e.classList.add("hidden"),t(n.target.files)}));const e=document.getElementById("dropbox");function t(e){i.J.readFile(e[0])}function n(e){g(),e.currentTarget.classList.add("selected")}function g(){for(const e of[u,m,y,p])e.classList.remove("selected")}e.addEventListener("dragenter",(function(e){e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("drop",(function(n){n.stopPropagation(),n.preventDefault();const i=n.dataTransfer.files;document.getElementById("loading-box").classList.remove("hidden"),e.classList.add("hidden"),t(i)}),!1),a.addEventListener("touchstart",(()=>{i.J.ticker.started&&(i.J.ticker.stop(),i.J.stopBGM())})),a.addEventListener("mousedown",(()=>{i.J.ticker.started&&(i.J.ticker.stop(),i.J.stopBGM())})),a.addEventListener("touchend",(()=>{o||i.J.ticker.started||(i.J.ticker.start(),i.J.playBGMProperly())})),a.addEventListener("mouseup",(()=>{o||i.J.ticker.started||(i.J.ticker.start(),i.J.playBGMProperly())})),a.addEventListener("input",(e=>{i.J.seekFrame(Number(e.currentTarget.value))})),r.disabled=!0,r.addEventListener("click",(()=>{i.J.ticker.started?(i.J.ticker.stop(),i.J.stopBGM(),o=!0,f()):(i.J.ticker.start(),i.J.playBGMProperly(),o=!1,f())})),c.addEventListener("click",(()=>{i.J.seekRelativeTime(-1),o||i.J.ticker.started||(i.J.ticker.start(),i.J.playBGMProperly())})),d.addEventListener("click",(()=>{i.J.seekRelativeTime(1),o||i.J.ticker.started||(i.J.ticker.start(),i.J.playBGMProperly())})),l.addEventListener("click",(()=>{i.J.seekRelativeTime(-3),o||i.J.ticker.started||(i.J.ticker.start(),i.J.playBGMProperly())})),h.addEventListener("click",(()=>{i.J.seekRelativeTime(3),o||i.J.ticker.started||(i.J.ticker.start(),i.J.playBGMProperly())})),u.addEventListener("click",(e=>{n(e),i.J.adjustPlaybackSpeedFPS(5)})),m.addEventListener("click",(e=>{n(e),i.J.adjustPlaybackSpeedTimes(.5)})),y.addEventListener("click",(e=>{n(e),i.J.adjustPlaybackSpeedTimes(1)})),p.addEventListener("click",(e=>{n(e),i.J.adjustPlaybackSpeedTimes(2)})),document.getElementById("fps-input").addEventListener("change",(e=>{let t=e.target.value;t<0?t=0:t>60&&(t=60),i.J.adjustPlaybackSpeedFPS(t),g()})),document.getElementById("notice-end-of-replay-ok-btn").addEventListener("click",(()=>{location.reload()})),document.getElementById("notice-file-open-error-ok-btn").addEventListener("click",(()=>{location.reload()}));const b=document.getElementById("keyboard-container"),w=document.getElementById("show-keyboard-checkbox");w.addEventListener("change",(()=>{w.checked?b.classList.remove("hidden"):b.classList.add("hidden")}));const v=document.getElementById("show-chat-checkbox");v.addEventListener("change",(()=>{v.checked?(0,s.Az)(!0):((0,s.Az)(!1),(0,s.lD)())}));const k=document.getElementById("show-nicknames-checkbox"),I=document.getElementById("player1-nickname"),E=document.getElementById("player2-nickname");k.addEventListener("change",(()=>{k.checked?(I.classList.remove("hidden"),E.classList.remove("hidden")):(I.classList.add("hidden"),E.classList.add("hidden"))}));const C=document.getElementById("show-ip-addresses-checkbox"),x=document.getElementById("player1-partial-ip"),S=document.getElementById("player2-partial-ip");C.addEventListener("change",(()=>{C.checked?(x.classList.remove("hidden"),S.classList.remove("hidden")):(x.classList.add("hidden"),S.classList.add("hidden"))}));const L=document.getElementById("turn-on-bgm-checkbox");L.addEventListener("change",(()=>{null!==i.J.pikaVolley&&(L.checked?i.J.pikaVolley.audio.turnBGMVolume(!0):i.J.pikaVolley.audio.turnBGMVolume(!1))}));const B=document.getElementById("turn-on-sfx-checkbox");B.addEventListener("change",(()=>{null!==i.J.pikaVolley&&(B.checked?i.J.pikaVolley.audio.turnSFXVolume(!0):i.J.pikaVolley.audio.turnSFXVolume(!1))}));const P=document.getElementById("graphic-sharp-checkbox");P.addEventListener("change",(()=>{null!==i.J.pikaVolley&&(P.checked?document.querySelector("#game-canvas-container>canvas").classList.remove("graphic-soft"):document.querySelector("#game-canvas-container>canvas").classList.add("graphic-soft"))})),window.addEventListener("keydown",(e=>{"Space"===e.code?(e.preventDefault(),r.click()):"ArrowLeft"===e.code?(e.preventDefault(),l.click()):"ArrowRight"===e.code&&(e.preventDefault(),h.click())}))}function b(){document.getElementById("fps-input").value=i.J.ticker.maxFPS}function f(){const e=document.getElementById("play-pause-btn");i.J.ticker.started?e.textContent=document.getElementById("pause-mark").textContent:e.textContent=document.getElementById("play-mark").textContent}function w(){document.getElementById("notice-end-of-replay").classList.remove("hidden")}function v(){document.getElementById("notice-end-of-replay").classList.add("hidden")}function k(){document.getElementById("notice-file-open-error").classList.remove("hidden")}function I(){return document.getElementById("replay-viewer-at").textContent}function E(e){a.max=e}function C(e){a.value=e}function x(e){document.getElementById("time-current").textContent=P(e)}function S(e){document.getElementById("time-duration").textContent=P(e)}function L(e,t){const n=document.getElementById("z-key"),i=document.getElementById("r-key"),s=document.getElementById("v-key"),o=document.getElementById("d-key"),a=document.getElementById("g-key"),r=document.getElementById("enter-key"),c=document.getElementById("up-key"),d=document.getElementById("down-key"),l=document.getElementById("left-key"),h=document.getElementById("right-key");function u(e){e.classList.add("pressed")}function m(e){e.classList.remove("pressed")}switch(e.xDirection){case 0:m(o),m(a);break;case-1:u(o),m(a);break;case 1:m(o),u(a)}switch(e.yDirection){case 0:m(i),m(s);break;case-1:u(i),m(s);break;case 1:m(i),u(s)}switch(e.powerHit){case 0:m(n);break;case 1:u(n)}switch(t.xDirection){case 0:m(l),m(h);break;case-1:u(l),m(h);break;case 1:m(l),u(h)}switch(t.yDirection){case 0:m(c),m(d);break;case-1:u(c),m(d);break;case 1:m(c),u(d)}switch(t.powerHit){case 0:m(r);break;case 1:u(r)}}function B(){a.disabled=!1,r.disabled=!1,c.disabled=!1,d.disabled=!1,l.disabled=!1,h.disabled=!1,u.disabled=!1,m.disabled=!1,y.disabled=!1,p.disabled=!1}function P(e){const t=Math.floor(e%60),n=Math.floor(e/60)%60,i=Math.floor(Math.floor(e/60)/60);return i>0?`${String(i)}:${("0"+n).slice(-2)}:${("0"+t).slice(-2)}`:`${String(n)}:${("0"+t).slice(-2)}`}},1514:(e,t,n)=>{"use strict";n.d(t,{Py:()=>g,Ew:()=>ie,Dj:()=>Z,Dc:()=>z,Z1:()=>ne,gU:()=>ee,q3:()=>J,mg:()=>X,YI:()=>$,Qu:()=>Y,YT:()=>te,gB:()=>Q,n2:()=>N,X1:()=>U,KE:()=>T,Ct:()=>_,yZ:()=>H,t8:()=>K,Sj:()=>O,y$:()=>W,iS:()=>F,Mu:()=>R,x4:()=>V,o1:()=>G,sK:()=>j,aW:()=>D,zD:()=>A});var i=n(1275);const s=function(){const e="23456789abcdefghijkmnpqrstuvwxyz";let t=0;const n=[];return function(){let i=Date.now();const s=i===t;t=i;const o=new Array(10);for(let t=9;t>=0;t--)o[t]=e.charAt(i%32),i=Math.floor(i/32);if(0!==i)throw new Error("We should have converted the entire timestamp.");let a=o.join("");if(s){let e;for(e=9;e>=0&&31===n[e];e--)n[e]=0;n[e]++}else{let e;void 0!==window.crypto&&window.crypto.getRandomValues&&(e=new Uint32Array(10),window.crypto.getRandomValues(e));for(let t=0;t<10;t++)n[t]=e?e[t]%32:Math.floor(32*Math.random())}for(let t=0;t<10;t++)a+=e.charAt(n[t]);if(20!==a.length)throw new Error("Length should be 20.");return a}}();var o=n(9505),a=n(8668),r=n(651);let c=null,d=null;async function l(e,t,n,i,s,o){c=new RTCPeerConnection(r.i);let l=!1,h=!1,u=!1,m=!1,y=!1;const p=[];let g=!1;const b=(a=!1)=>{if(!g){if(g=!0,a?console.log("Got final candidate!"):console.log("Timed out so just proceed as if got final candidate..."),d&&d.close(),c&&c.close(),Object.keys(p).length>=1){y=!0;for(const e in p)if(1===p[e].length){y=!1;break}console.log(y?"symmetric nat":"normal nat")}m||h?y?(console.log("behind symmetric nat"),o()):(h||m&&!y)&&(console.log('"host address is public IP" or "got srflx, not behind symmetric nat"'),t()):(console.log("did not get srflx candidate"),u?l?(console.log("host address is obfuscated"),i()):(console.log("host address is not obfuscated and is a private ip address"),s()):(console.log("did not get host candidate"),n())),e()}};c.addEventListener("icecandidate",(e=>{if(!e.candidate)return void b(!0);if(""===e.candidate.candidate)return;const t=(0,a.PR)(e.candidate.candidate);"srflx"===t.type?(m=!0,p[t.ip]?p[t.ip][0]!==t.port&&p[t.ip].push(t.port):p[t.ip]=[t.port],setTimeout(b,1500)):"host"===t.type&&(u=!0,t.ip.endsWith(".local")?l=!0:RegExp("(^127.)|(^10.)|(^172.1[6-9].)|(^172.2[0-9].)|(^172.3[0-1].)|(^192.168.)").test(t.ip)||(h=!0),setTimeout(b,3e3)),console.log("Got candidate: ",e.candidate)})),d=c.createDataChannel("test",{ordered:!0,maxRetransmits:0});const f=await c.createOffer();await c.setLocalDescription(f),setTimeout(b,5e3)}var h=n(2777),u=n(5523),m=n(5345),y=n(6465),p=n(6691);const g=8,b={graphic:"sharp",bgm:"on",sfx:"stereo",speed:"fast",winningScore:15,rule:"Pgo"};let f=e=>{le(e),e.graphic&&(b.graphic=e.graphic),e.bgm&&(b.bgm=e.bgm),e.sfx&&(b.sfx=e.sfx),e.speed&&(b.speed=e.speed),e.winningScore&&(b.winningScore=e.winningScore),e.rule&&(b.rule=e.rule)};const w={toSend:null,received:null};let v=null,k=null,I=null,E=!1;const C=document.getElementById("chat-open-btn-and-chat-disabling-btn-container"),x=document.getElementById("chat-open-btn"),S=document.getElementById("chat-disabling-btn"),L=document.getElementById("chat-input-and-send-btn-container"),B=document.getElementById("chat-input"),P=document.getElementById("send-btn");function D(){o.Uq.unsubscribe();const e=document.getElementById("network-test-btn"),t=document.getElementById("quick-match-btn"),n=document.getElementById("with-your-friend-btn"),a=document.getElementById("create-btn"),r=document.getElementById("copy-btn"),c=document.getElementById("exit-room-btn"),d=document.getElementById("join-btn"),b=document.getElementById("join-room-id-input");c.disabled=!0;const E=()=>{e.disabled=!0,t.disabled=!0,n.disabled=!0,a.disabled=!0,d.disabled=!0,b.disabled=!0},D=()=>{e.disabled=!1,document.getElementById("about-with-your-friend").classList.contains("hidden")&&(t.disabled=!1),n.disabled=!1,a.disabled=!1,d.disabled=!1,b.disabled=!1};e.addEventListener("click",(()=>{E(),l(D,(()=>{document.getElementById("test-passed").classList.remove("hidden")}),(()=>{document.getElementById("did-not-get-srflx-candidate-and-did-not-get-host-candidate").classList.remove("hidden")}),(()=>{document.getElementById("did-not-get-srflx-candidate-and-host-address-is-obfuscated").classList.remove("hidden")}),(()=>{document.getElementById("did-not-get-srflx-candidate-and-host-address-is-private-ip-address").classList.remove("hidden")}),(()=>{document.getElementById("behind-symmetric-nat").classList.remove("hidden")}))}));const A=document.getElementById("nickname-input");let N=null;try{N=window.localStorage.getItem("myNickname")}catch(e){console.log(e)}null!==N?(i.Ix.myNickname=N.trim().slice(0,g),A.value=i.Ix.myNickname):i.Ix.myNickname=A.value,A.addEventListener("input",(e=>{i.Ix.myNickname=e.target.value.trim().slice(0,g),A.value=i.Ix.myNickname;try{window.localStorage.setItem("myNickname",i.Ix.myNickname)}catch(e){console.log(e)}}));const V=document.getElementById("auto-fast-speed-checkbox");let T=null;try{T="true"===window.localStorage.getItem("willAskFastAutomatically")}catch(e){console.log(e)}null!==T?(i.Ix.willAskFastAutomatically=T,V.checked=T):i.Ix.willAskFastAutomatically=V.checked,V.addEventListener("change",(()=>{i.Ix.willAskFastAutomatically=V.checked;try{window.localStorage.setItem("willAskFastAutomatically",String(i.Ix.willAskFastAutomatically))}catch(e){console.log(e)}}));const R=document.getElementById("auto-save-replay-checkbox");try{const e=window.localStorage.getItem("willSaveReplayAutomatically");k=null===e||"true"===e}catch(e){console.log(e)}null!==k?R.checked=k:k=R.checked,R.addEventListener("change",(()=>{k=R.checked;try{window.localStorage.setItem("willSaveReplayAutomatically",String(k))}catch(e){console.log(e)}}));const W=document.getElementById("notify-by-sound-on"),_=document.getElementById("notify-by-sound-off");try{const e=window.localStorage.getItem("willNotifyBySound");null!==e&&(I="true"===e)}catch(e){console.log(e)}null!==I?(W.checked=I,_.checked=!I):I=W.checked;const F=e=>{const t=e.currentTarget;if(t.checked){I="on"===t.value;try{window.localStorage.setItem("willNotifyBySound",String(I))}catch(e){console.log(e)}}};W.addEventListener("change",F),_.addEventListener("change",F);let O=null;try{O=window.localStorage.getItem("graphic")}catch(e){console.log(e)}null!==O&&f({graphic:O});let H=null;try{H=window.localStorage.getItem("bgm")}catch(e){console.log(e)}null!==H&&f({bgm:H});let K=null;try{K=window.localStorage.getItem("sfx")}catch(e){console.log(e)}null!==K&&f({sfx:K});let G=null;try{G=window.localStorage.getItem("preselectedMatchGroup")}catch(e){console.log(e)}null===G&&(G=document.querySelector('input[name="match-group"]:checked').value);const U=document.getElementById("each-time"),J=document.getElementById("global"),Q=document.getElementById("korea"),j=document.getElementById("taiwan");if(Object.values(p.Q).includes(G))switch(G){case p.Q.GLOBAL:J.checked=!0;break;case p.Q.KR:Q.checked=!0;break;case p.Q.TW:j.checked=!0}else G=null,U.checked=!0;const X=e=>{const t=e.currentTarget;if(t.checked){const e=t.value;if(Object.values(p.Q).includes(e)){G=e;try{window.localStorage.setItem("preselectedMatchGroup",t.value)}catch(e){console.log(e)}}else{G=null;try{window.localStorage.removeItem("preselectedMatchGroup")}catch(e){console.log(e)}}}};U.addEventListener("change",X),J.addEventListener("change",X),Q.addEventListener("change",X),j.addEventListener("change",X);const $=e=>{if("Enter"===e.code||"KeyZ"===e.code){e.preventDefault(),window.removeEventListener("keydown",$),document.getElementById("press-enter-to-quick-match").classList.add("hidden");const t=()=>{const e=document.querySelector("#global-match-group-btn"),t=document.querySelector("#korea-match-group-btn"),n=document.querySelector("#taiwan-match-group-btn"),i=document.getElementById("match-group-in-quick-match-notice-box"),o=i=>{switch(i.code){case"KeyG":i.preventDefault(),e.click();break;case"KeyK":i.preventDefault(),t.click();break;case"KeyT":i.preventDefault(),n.click()}};window.addEventListener("keydown",o);const a=e=>{window.removeEventListener("keydown",o),document.getElementById("select-match-group").classList.add("hidden"),document.getElementById("quick-match-notice-box").classList.remove("hidden");const t=s();(0,h.xB)(t,e)};if(e.addEventListener("click",(()=>{i.textContent=e.querySelector(".match-group-name").textContent,a(p.Q.GLOBAL)})),t.addEventListener("click",(()=>{i.textContent=t.querySelector(".match-group-name").textContent,a(p.Q.KR)})),n.addEventListener("click",(()=>{i.textContent=n.querySelector(".match-group-name").textContent,a(p.Q.TW)})),document.getElementById("select-match-group").classList.remove("hidden"),null!==G)switch(G){case p.Q.GLOBAL:e.click();break;case p.Q.KR:t.click();break;case p.Q.TW:n.click()}};l((()=>{}),t,(()=>{document.getElementById("did-not-get-srflx-candidate-and-did-not-get-host-candidate").classList.remove("hidden"),D()}),(()=>{document.getElementById("did-not-get-srflx-candidate-and-host-address-is-obfuscated").classList.remove("hidden"),D()}),(()=>{document.getElementById("did-not-get-srflx-candidate-and-host-address-is-private-ip-address").classList.remove("hidden"),D()}),(()=>{document.getElementById("behind-symmetric-nat").classList.remove("hidden"),D()}))}};t.addEventListener("click",(()=>{E(),i.Ix.isQuickMatch=!0,window.addEventListener("keydown",$),document.getElementById("press-enter-to-quick-match").classList.remove("hidden")}));const z=e=>{"Enter"===e.code&&(e.preventDefault(),window.removeEventListener("keydown",z),t.click())};window.addEventListener("keydown",z),a.addEventListener("click",(()=>{E(),document.getElementById("join-room-id-input").value="",i.Ix.isQuickMatch=!1;const e=s();(0,i.ab)(e).then((()=>{M(e),r.classList.remove("hidden"),c.disabled=!1}))})),r.addEventListener("click",(()=>{r.innerHTML=document.getElementById("copied").innerHTML,setTimeout((()=>{r.textContent=document.getElementById("copy").textContent}),700),navigator.clipboard.writeText(document.getElementById("current-room-id").textContent)})),c.addEventListener("click",(()=>{(0,i.sm)(),window.setTimeout((()=>location.reload()),0)}));const Y=e=>{"Enter"===e.code&&(e.preventDefault(),window.removeEventListener("keydown",Y),d.click())};d.addEventListener("click",(()=>{E(),i.Ix.isQuickMatch=!1;const e=document.getElementById("join-room-id-input").value.trim().split("-").join("");(0,i.O3)(e).then((t=>{t?(M(e),c.disabled=!1):(D(),window.addEventListener("keydown",Y))}))})),n.addEventListener("click",(()=>{const e=document.getElementById("about-with-your-friend"),n=document.getElementById("blocked-ip-addresses-table-container"),i=document.getElementById("open-chat-list-container");e.classList.contains("hidden")?(e.classList.remove("hidden"),t.disabled=!0,window.addEventListener("keydown",Y),n.classList.add("hidden"),i&&i.classList.add("hidden")):(e.classList.add("hidden"),t.disabled=!1,window.removeEventListener("keydown",Y),n.classList.remove("hidden"),i&&i.classList.remove("hidden"))})),window.addEventListener("keydown",(e=>{if("Escape"===e.code){const t=document.getElementById("menu-bar");t.classList.contains("hidden")?t.classList.remove("hidden"):t.classList.add("hidden"),e.preventDefault()}})),x.addEventListener("click",re),P.addEventListener("click",ce),S.addEventListener("click",(()=>{x.disabled?((0,u.Az)(!0),x.disabled=!1,S.textContent=document.getElementById("text-disable-chat").textContent,S.blur()):((0,u.Az)(!1),x.disabled=!0,B.disabled=!0,P.disabled=!0,S.textContent=document.getElementById("text-enable-chat").textContent,S.blur());try{window.localStorage.setItem("isChatEnabled",String(!x.disabled))}catch(e){console.log(e)}}));let Z=!0;try{Z="false"!==window.localStorage.getItem("isChatEnabled")}catch(e){console.log(e)}i.Ix.callbackAfterDataChannelOpenedForUI=()=>{window.addEventListener("keydown",(e=>{"Space"===e.code?C.classList.contains("hidden")||(e.preventDefault(),x.click()):"Enter"===e.code&&e.preventDefault()})),window.addEventListener("keyup",(e=>{"Enter"===e.code&&(L.classList.contains("hidden")||window.setTimeout((()=>P.click()),0))})),function(){const e=document.getElementById("flex-container"),t=document.getElementById("before-connection");document.getElementById("quick-match-notice-box").classList.add("hidden"),t.classList.add("hidden"),i.Ix.isQuickMatch&&(0,y.Z)(),e.classList.remove("hidden"),o.Uq.subscribe()}(),ee(),Z||S.click()},de("test-passed-ok-btn","test-passed"),de("did-not-get-srflx-candidate-and-did-not-get-host-candidate-ok-btn","did-not-get-srflx-candidate-and-did-not-get-host-candidate"),de("did-not-get-srflx-candidate-and-host-address-is-obfuscated-ok-btn","did-not-get-srflx-candidate-and-host-address-is-obfuscated"),de("did-not-get-srflx-candidate-and-host-address-is-private-ip-address-ok-btn","did-not-get-srflx-candidate-and-host-address-is-private-ip-address"),de("behind-symmetric-nat-ok-btn","behind-symmetric-nat"),document.getElementById("cancel-quick-match-btn").addEventListener("click",(()=>{location.reload()})),document.getElementById("cancel-quick-match-btn-in-select-match-group").addEventListener("click",(()=>{location.reload()})),document.getElementById("cancel-quick-match-btn-2").addEventListener("click",(()=>{(0,h.cy)(),(0,i.sm)(),window.setTimeout((()=>location.reload()),0)})),document.getElementById("notice-disconnected-ok-btn").addEventListener("click",(()=>{window.setTimeout((()=>location.reload()),0)})),document.getElementById("ask-one-more-game-yes-btn").addEventListener("click",(()=>{document.getElementById("ask-one-more-game").classList.add("hidden")})),document.getElementById("ask-one-more-game-no-btn").addEventListener("click",(()=>{window.setTimeout((()=>location.reload()),0)})),window.addEventListener("keydown",(e=>{if(B.disabled)if("KeyY"===e.code){e.preventDefault();const t=document.querySelector("div.fade-in-box:not(.hidden) button.key-y");null!==t&&t.click()}else if("KeyN"===e.code){e.preventDefault();const t=document.querySelector("div.fade-in-box:not(.hidden) button.key-n");null!==t&&t.click()}})),window.addEventListener("unload",i.Bn),window.addEventListener("beforeunload",(function(e){(0,i.sm)(),i.Ix.isOpen&&(k&&!document.getElementById("flex-container").classList.contains("hidden")&&m.Z.saveAsFile(),e.preventDefault(),e.returnValue="")})),ae(),function(){const e=document.getElementById("graphic-sharp-btn"),t=document.getElementById("graphic-soft-btn");e.addEventListener("click",(()=>{f({graphic:"sharp"})})),t.addEventListener("click",(()=>{f({graphic:"soft"})}));const n=document.getElementById("bgm-on-btn"),i=document.getElementById("bgm-off-btn");n.addEventListener("click",(()=>{f({bgm:"on"})})),i.addEventListener("click",(()=>{f({bgm:"off"})}));const s=document.getElementById("stereo-btn"),o=document.getElementById("mono-btn"),a=document.getElementById("sfx-off-btn");function r(){return!(!v||v.state===v.intro||v.state===v.menu||v.state===v.round&&v.gameEnded)}s.addEventListener("click",(()=>{f({sfx:"stereo"})})),o.addEventListener("click",(()=>{f({sfx:"mono"})})),a.addEventListener("click",(()=>{f({sfx:"off"})}));const c=document.getElementById("slow-speed-btn"),d=document.getElementById("medium-speed-btn"),l=document.getElementById("fast-speed-btn"),h=document.getElementById("notice-speed-options-cannot-changed-if-game-in-progress"),u=document.getElementById("notice-speed-options-cannot-changed-if-game-in-progress-ok-btn");c.addEventListener("click",(()=>{if(!c.classList.contains("selected"))return r()?(h.classList.remove("hidden"),void oe()):void q({speed:"slow",winningScore:null,rule:null})})),d.addEventListener("click",(()=>{if(!d.classList.contains("selected"))return r()?(h.classList.remove("hidden"),void oe()):void q({speed:"medium",winningScore:null,rule:null})})),l.addEventListener("click",(()=>{if(!l.classList.contains("selected"))return r()?(h.classList.remove("hidden"),void oe()):void q({speed:"fast",winningScore:null,rule:null})})),u.addEventListener("click",(()=>{h.classList.contains("hidden")||(h.classList.add("hidden"),se())}));const m=document.getElementById("winning-score-5-btn"),y=document.getElementById("winning-score-10-btn"),p=document.getElementById("winning-score-15-btn"),g=document.getElementById("notice-winning-score-options-cannot-changed-if-game-in-progress"),b=document.getElementById("notice-winning-score-options-cannot-changed-if-game-in-progress-ok-btn");m.addEventListener("click",(()=>{if(!m.classList.contains("selected"))return r()?(g.classList.remove("hidden"),void oe()):void q({speed:null,winningScore:5,rule:null})})),y.addEventListener("click",(()=>{if(!y.classList.contains("selected"))return r()?(g.classList.remove("hidden"),void oe()):void q({speed:null,winningScore:10,rule:null})})),p.addEventListener("click",(()=>{if(!p.classList.contains("selected"))return r()?(g.classList.remove("hidden"),void oe()):void q({speed:null,winningScore:15,rule:null})})),b.addEventListener("click",(()=>{g.classList.contains("hidden")||(g.classList.add("hidden"),se())}));const w=document.getElementById("Pgo-rule-btn"),k=document.getElementById("noserve-rule-btn"),I=document.getElementById("Down-Limit-36-rule-btn"),E=document.getElementById("notice-rule-options-cannot-changed-if-game-in-progress"),C=document.getElementById("notice-rule-options-cannot-changed-if-game-in-progress-ok-btn");w.addEventListener("click",(()=>{if(!w.classList.contains("selected"))return r()?(E.classList.remove("hidden"),void oe()):void q({speed:null,winningScore:null,rule:"Pgo"})})),k.addEventListener("click",(()=>{if(!k.classList.contains("selected"))return r()?(E.classList.remove("hidden"),void oe()):void q({speed:null,winningScore:null,rule:"noserve"})})),I.addEventListener("click",(()=>{if(!I.classList.contains("selected"))return r()?(E.classList.remove("hidden"),void oe()):void q({speed:null,winningScore:null,rule:"DL36"})})),I.addEventListener("click",(()=>{if(!I.classList.contains("selected"))return r()?(E.classList.remove("hidden"),void oe()):void q({speed:null,winningScore:null,rule:"DL36"})})),C.addEventListener("click",(()=>{E.classList.contains("hidden")||(E.classList.add("hidden"),se())}))}(),window.addEventListener("click",(e=>{e.target.matches(".dropdown-btn, .submenu-btn")||(me(),ue(""))})),document.getElementById("options-dropdown-btn").addEventListener("click",(()=>{var e;e="options-dropdown",me(),ue(e),document.getElementById(e).classList.toggle("show")})),document.getElementById("graphic-submenu-btn").addEventListener("mouseover",(()=>{he("graphic-submenu-btn","graphic-submenu")})),document.getElementById("bgm-submenu-btn").addEventListener("mouseover",(()=>{he("bgm-submenu-btn","bgm-submenu")})),document.getElementById("sfx-submenu-btn").addEventListener("mouseover",(()=>{he("sfx-submenu-btn","sfx-submenu")})),document.getElementById("speed-submenu-btn").addEventListener("mouseover",(()=>{he("speed-submenu-btn","speed-submenu")})),document.getElementById("winning-score-submenu-btn").addEventListener("mouseover",(()=>{he("winning-score-submenu-btn","winning-score-submenu")})),document.getElementById("rule-submenu-btn").addEventListener("mouseover",(()=>{he("rule-submenu-btn","rule-submenu")})),document.getElementById("bgm-submenu-btn").addEventListener("click",(()=>{he("bgm-submenu-btn","bgm-submenu")})),document.getElementById("sfx-submenu-btn").addEventListener("click",(()=>{he("sfx-submenu-btn","sfx-submenu")})),document.getElementById("speed-submenu-btn").addEventListener("click",(()=>{he("speed-submenu-btn","speed-submenu")})),document.getElementById("winning-score-submenu-btn").addEventListener("click",(()=>{he("winning-score-submenu-btn","winning-score-submenu")})),document.getElementById("rule-submenu-btn").addEventListener("click",(()=>{he("rule-submenu-btn","rule-submenu")})),function(){const e=document.getElementById("ask-options-change-send-to-peer"),t=document.getElementById("ask-options-change-send-to-peer-yes-btn"),n=document.getElementById("ask-options-change-send-to-peer-no-btn");t.addEventListener("click",(()=>{(0,i.nQ)(w.toSend),e.classList.add("hidden")})),n.addEventListener("click",(()=>{e.classList.add("hidden"),se()}));const s=document.getElementById("ask-options-change-received-from-peer"),o=document.getElementById("ask-options-change-received-from-peer-yes-btn"),a=document.getElementById("ask-options-change-received-from-peer-no-btn");o.addEventListener("click",(()=>{s.classList.add("hidden"),(0,i.jz)(!0),f(w.received),se()})),a.addEventListener("click",(()=>{s.classList.add("hidden"),(0,i.jz)(!1),se()}));const r=document.getElementById("notice-peer-agreed");document.getElementById("notice-peer-agreed-ok-btn").addEventListener("click",(()=>{r.classList.add("hidden"),se()}));const c=document.getElementById("notice-peer-disagreed");document.getElementById("notice-peer-disagreed-ok-btn").addEventListener("click",(()=>{c.classList.add("hidden"),se()}))}(),document.getElementById("save-replay-btn").addEventListener("click",(()=>{m.Z.saveAsFile()})),document.getElementById("exit-btn").addEventListener("click",(()=>{location.reload()}))}function A(e,t){v=e,f=n=>{if(le(n),m.Z.recordOptions(n),n.graphic){switch(n.graphic){case"sharp":document.querySelector("#game-canvas-container>canvas").classList.remove("graphic-soft");break;case"soft":document.querySelector("#game-canvas-container>canvas").classList.add("graphic-soft")}try{window.localStorage.setItem("graphic",n.graphic)}catch(e){console.log(e)}}if(n.bgm){switch(n.bgm){case"on":e.audio.turnBGMVolume(!0);break;case"off":e.audio.turnBGMVolume(!1)}try{window.localStorage.setItem("bgm",n.bgm)}catch(e){console.log(e)}}if(n.sfx){switch(n.sfx){case"stereo":e.audio.turnSFXVolume(!0),e.isStereoSound=!0;break;case"mono":e.audio.turnSFXVolume(!0),e.isStereoSound=!1;break;case"off":e.audio.turnSFXVolume(!1)}try{window.localStorage.setItem("sfx",n.sfx)}catch(e){console.log(e)}}if(n.speed)switch(n.speed){case"slow":e.normalFPS=20,t.maxFPS=e.normalFPS;break;case"medium":e.normalFPS=25,t.maxFPS=e.normalFPS;break;case"fast":e.normalFPS=30,t.maxFPS=e.normalFPS}if(n.winningScore)switch(n.winningScore){case 5:e.winningScore=5;break;case 10:e.winningScore=10;break;case 15:e.winningScore=15}if(n.rule)switch(n.rule){case"Pgo":e.physics.modeNum=1,e.changeDownBoardVisibility(!0);break;case"noserve":e.physics.modeNum=2,e.changeDownBoardVisibility(!1);break;case"DL36":e.physics.modeNum=3,e.changeDownBoardVisibility(!0)}},f(b)}function M(e){const t=`${e.slice(0,5)}-${e.slice(5,10)}-${e.slice(10,15)}-${e.slice(15)}`;document.getElementById("current-room-id").textContent=t}function N(e){document.getElementById("communication-count").textContent=String(e)}function V(e){let t="";switch(e){case h.WJ.createRoom:t=document.getElementById("waiting-message").textContent;break;case h.WJ.keepWait:return;case h.WJ.waitPeerConnection:t=document.getElementById("waiting-peer-to-connect-message").textContent;break;case h.WJ.connectToPeerAfterAWhile:t=document.getElementById("connect-to-peer-after-a-while-message").textContent;break;case h.WJ.connectToPeer:t=document.getElementById("connect-to-peer-message").textContent;break;case h.WJ.abandoned:t=document.getElementById("abandoned-message").textContent;break;default:return}R(t)}function T(){R(document.getElementById("failed-to-connect-to-server").textContent)}function R(e){const t=document.getElementById("quick-match-log");t.textContent+=`${e}\n`,t.scrollIntoView()}function W(e,t,n){document.getElementById("within-24-hours").textContent=String(e),document.getElementById("within-1-hour").textContent=String(t),document.getElementById("within-10-minutes").textContent=String(n)}function _(e){let t="connection-log-with-friend";i.Ix.isQuickMatch&&(t="connection-log-quick-match");const n=document.getElementById(t);n.textContent+=`${e}\n`,n.scrollIntoView()}function F(){let e="connection-log-with-friend";i.Ix.isQuickMatch&&(e="connection-log-quick-match");const t=document.getElementById(e);t.textContent+=".",t.scrollIntoView()}function O(){_(document.getElementById("not-valid-room-id-message").textContent)}function H(){_(document.getElementById("no-room-matching-message").textContent)}function K(){_(document.getElementById("no-room-matching-message-in-quick-match").textContent)}function G(){_(document.getElementById("someone-else-already-joined-the-room").textContent)}function U(){_(document.getElementById("connection-failed").textContent)}function J(){document.getElementById("ping-box").classList.add("hidden")}function Q(e){document.getElementById("average-ping").textContent=String(e)}function j(e){document.getElementById("starts-in").textContent=String(e)}function X(){document.getElementById("peer-loading-box").classList.add("hidden")}function $(e){e?(f(w.toSend),document.getElementById("notice-peer-agreed").classList.remove("hidden")):document.getElementById("notice-peer-disagreed").classList.remove("hidden")}function q(e){const t=document.getElementById("options-change-to-send");if(e.speed)switch(t.textContent=document.getElementById("speed-submenu-btn").textContent.trim()+" ",e.speed){case"slow":t.textContent+=document.getElementById("slow-speed-btn").textContent.replace("✓","").trim();break;case"medium":t.textContent+=document.getElementById("medium-speed-btn").textContent.replace("✓","").trim();break;case"fast":t.textContent+=document.getElementById("fast-speed-btn").textContent.replace("✓","").trim()}else if(e.winningScore)switch(t.textContent=document.getElementById("winning-score-submenu-btn").textContent.trim()+" ",e.winningScore){case 5:t.textContent+=document.getElementById("winning-score-5-btn").textContent.replace("✓","").trim();break;case 10:t.textContent+=document.getElementById("winning-score-10-btn").textContent.replace("✓","").trim();break;case 15:t.textContent+=document.getElementById("winning-score-15-btn").textContent.replace("✓","").trim()}else{if(!e.rule)return;switch(t.textContent=document.getElementById("rule-submenu-btn").textContent.trim()+" ",e.rule){case"Pgo":t.textContent+=document.getElementById("Pgo-rule-btn").textContent.replace("✓","").trim();break;case"noserve":t.textContent+=document.getElementById("noserve-rule-btn").textContent.replace("✓","").trim();break;case"DL36":t.textContent+=document.getElementById("Down-Limit-36-rule-btn").textContent.replace("✓","").trim()}}w.toSend=e,document.getElementById("ask-options-change-send-to-peer").classList.remove("hidden"),oe()}function z(e){const t=document.getElementById("options-change-received");if(e.speed)switch(t.textContent=document.getElementById("speed-submenu-btn").textContent.trim()+" ",e.speed){case"slow":t.textContent+=document.getElementById("slow-speed-btn").textContent.replace("✓","").trim();break;case"medium":t.textContent+=document.getElementById("medium-speed-btn").textContent.replace("✓","").trim();break;case"fast":t.textContent+=document.getElementById("fast-speed-btn").textContent.replace("✓","").trim()}else if(e.winningScore)switch(t.textContent=document.getElementById("winning-score-submenu-btn").textContent.trim()+" ",e.winningScore){case 5:t.textContent+=document.getElementById("winning-score-5-btn").textContent.replace("✓","").trim();break;case 10:t.textContent+=document.getElementById("winning-score-10-btn").textContent.replace("✓","").trim();break;case 15:t.textContent+=document.getElementById("winning-score-15-btn").textContent.replace("✓","").trim()}else{if(!e.rule)return;switch(t.textContent=document.getElementById("rule-submenu-btn").textContent.trim()+" ",e.rule){case"Pgo":t.textContent+=document.getElementById("Pgo-rule-btn").textContent.replace("✓","").trim();break;case"noserve":t.textContent+=document.getElementById("noserve-rule-btn").textContent.replace("✓","").trim();break;case"DL36":t.textContent+=document.getElementById("Down-Limit-36-rule-btn").textContent.replace("✓","").trim()}}w.received=e,document.getElementById("ask-options-change-received-from-peer").classList.remove("hidden"),oe(),me(),ue("")}function Y(){!k||document.getElementById("flex-container").classList.contains("hidden")||E||(m.Z.saveAsFile(),E=!0),document.getElementById("notice-disconnected").classList.remove("hidden")}function Z(){document.getElementById("ask-one-more-game").classList.remove("hidden")}function ee(){x.disabled=!1,S.disabled=!1}function te(){!1!==I&&document.getElementById("audio-pikachu-sound").play()}function ne(e){w.toSend={auto:!0,speed:"fast",winningScore:null},e&&oe(),(0,i.nQ)(w.toSend)}function ie(){f({speed:"fast",winningScore:null}),se()}function se(){document.getElementById("options-dropdown-btn").disabled=!1}function oe(){document.getElementById("options-dropdown-btn").disabled=!0}function ae(){x.disabled=!0,S.disabled=!0,B.disabled=!0,P.disabled=!0}function re(){x.disabled=!0,B.disabled=!1,P.disabled=!1,o.Uq.unsubscribe(),C.classList.add("hidden"),L.classList.remove("hidden"),B.focus({preventScroll:!0})}function ce(){ae(),o.Uq.subscribe(),L.classList.add("hidden"),C.classList.remove("hidden");const e=B.value;""!==e?(B.value="",(0,i.DR)(e)):ee()}function de(e,t){document.getElementById(e).addEventListener("click",(()=>{document.getElementById(t).classList.add("hidden")}))}function le(e){if(e.graphic){const t=document.getElementById("graphic-sharp-btn"),n=document.getElementById("graphic-soft-btn");switch(e.graphic){case"sharp":n.classList.remove("selected"),t.classList.add("selected");break;case"soft":t.classList.remove("selected"),n.classList.add("selected")}}if(e.bgm){const t=document.getElementById("bgm-on-btn"),n=document.getElementById("bgm-off-btn");switch(e.bgm){case"on":n.classList.remove("selected"),t.classList.add("selected");break;case"off":t.classList.remove("selected"),n.classList.add("selected")}}if(e.sfx){const t=document.getElementById("stereo-btn"),n=document.getElementById("mono-btn"),i=document.getElementById("sfx-off-btn");switch(e.sfx){case"stereo":n.classList.remove("selected"),i.classList.remove("selected"),t.classList.add("selected");break;case"mono":i.classList.remove("selected"),t.classList.remove("selected"),n.classList.add("selected");break;case"off":t.classList.remove("selected"),n.classList.remove("selected"),i.classList.add("selected")}}if(e.speed){const t=document.getElementById("slow-speed-btn"),n=document.getElementById("medium-speed-btn"),i=document.getElementById("fast-speed-btn");switch(e.speed){case"slow":n.classList.remove("selected"),i.classList.remove("selected"),t.classList.add("selected");break;case"medium":i.classList.remove("selected"),t.classList.remove("selected"),n.classList.add("selected");break;case"fast":t.classList.remove("selected"),n.classList.remove("selected"),i.classList.add("selected")}}if(e.winningScore){const t=document.getElementById("winning-score-5-btn"),n=document.getElementById("winning-score-10-btn"),i=document.getElementById("winning-score-15-btn");switch(e.winningScore){case 5:n.classList.remove("selected"),i.classList.remove("selected"),t.classList.add("selected");break;case 10:i.classList.remove("selected"),t.classList.remove("selected"),n.classList.add("selected");break;case 15:t.classList.remove("selected"),n.classList.remove("selected"),i.classList.add("selected")}}if(e.rule){const t=document.getElementById("Pgo-rule-btn"),n=document.getElementById("noserve-rule-btn"),i=document.getElementById("Down-Limit-36-rule-btn");switch(e.rule){case"Pgo":t.classList.add("selected"),n.classList.remove("selected"),i.classList.remove("selected");break;case"noserve":t.classList.remove("selected"),n.classList.add("selected"),i.classList.remove("selected");break;case"DL36":t.classList.remove("selected"),n.classList.remove("selected"),i.classList.add("selected")}}}function he(e,t){me(),document.getElementById(e).classList.add("open"),document.getElementById(t).classList.add("show")}function ue(e){const t=document.getElementsByClassName("dropdown");for(let n=0;n<t.length;n++)t[n].id!==e&&t[n].classList.remove("show")}function me(){const e=document.getElementsByClassName("submenu");for(let t=0;t<e.length;t++)e[t].classList.remove("show");const t=document.getElementsByClassName("submenu-btn");for(let e=0;e<t.length;e++)t[e].classList.remove("open")}},6970:(e,t,n)=>{"use strict";function i(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}n.d(t,{i:()=>i})},4805:(e,t,n)=>{"use strict";n.d(t,{H:()=>s,d:()=>o});var i=n(1674);function s(e){let t=0;switch(e.xDirection){case 1:t+=1;break;case-1:t+=3}switch(e.yDirection){case 1:t+=4;break;case-1:t+=12}return 1===e.powerHit&&(t+=16),t}function o(e){const t=new i.BF;switch(e%4){case 0:t.xDirection=0;break;case 1:t.xDirection=1;break;case 3:t.xDirection=-1}switch((e>>>2)%4){case 0:t.yDirection=0;break;case 1:t.yDirection=1;break;case 3:t.yDirection=-1}return t.powerHit=e>>>4,t}},6546:(e,t,n)=>{"use strict";function i(e,t){return(e%t+t)%t}function s(e,t,n,s){const o=i(e,s);if(i(t,s)<=i(n,s)){if(i(t,s)<=o&&o<=i(n,s))return!0}else if(i(t,s)<=o||o<=i(n,s))return!0;return!1}n.d(t,{X:()=>s,z:()=>i})},6212:(e,t,n)=>{"use strict";function i(e){return Array.isArray(e)?JSON.stringify(e.map((e=>i(e)))):"object"==typeof e&&null!==e?Object.keys(e).sort().map((t=>`${t}:${i(e[t])}`)).join("|"):e}n.d(t,{l:()=>i})},1234:()=>{}}]);
//# sourceMappingURL=958.a4d611a08bb8dec25800.js.map