{"version":3,"file":"main_out.73b5219ae179b2eaf3d4.js","mappings":"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","sources":["webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay_download/replay_player.js","webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay_download/ui_replay.js","webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay_download/pikavolley_replay.js","webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay_download/main_out.js"],"sourcesContent":["'use strict';\r\nimport { settings } from '@pixi/settings';\r\nimport { SCALE_MODES } from '@pixi/constants';\r\nimport { Renderer, BatchRenderer, autoDetectRenderer } from '@pixi/core';\r\nimport { Prepare } from '@pixi/prepare';\r\nimport { Container } from '@pixi/display';\r\nimport { Loader } from '@pixi/loaders';\r\nimport { SpritesheetLoader } from '@pixi/spritesheet';\r\nimport { Ticker } from '@pixi/ticker';\r\nimport { CanvasRenderer } from '@pixi/canvas-renderer';\r\nimport { CanvasSpriteRenderer } from '@pixi/canvas-sprite';\r\nimport { CanvasPrepare } from '@pixi/canvas-prepare';\r\nimport '@pixi/canvas-display';\r\nimport { ASSETS_PATH } from '../offline_version_js/assets_path.js';\r\nimport { PikachuVolleyballReplay } from './pikavolley_replay.js';\r\nimport { setGetSpeechBubbleNeeded, hideChat } from '../chat_display.js';\r\nimport {\r\n  setMaxForScrubberRange,\r\n  adjustPlayPauseBtnIcon,\r\n  showTotalTimeDuration,\r\n  showTimeCurrent,\r\n  enableReplayScrubberAndBtns,\r\n  hideNoticeEndOfReplay,\r\n  noticeFileOpenError,\r\n  adjustFPSInputValue,\r\n} from './ui_replay.js';\r\nimport '../../style.css';\r\nimport { serialize } from '../utils/serialize.js';\r\nimport { getHashCode } from '../utils/hash_code.js';\r\n\r\nclass ReplayPlayer {\r\n  constructor() {\r\n    // Reference for how to use Renderer.registerPlugin:\r\n    // https://github.com/pixijs/pixijs/blob/af3c0c6bb15aeb1049178c972e4a14bb4cabfce4/bundles/pixi.js/src/index.ts#L27-L34\r\n    Renderer.registerPlugin('prepare', Prepare);\r\n    Renderer.registerPlugin('batch', BatchRenderer);\r\n    // Reference for how to use CanvasRenderer.registerPlugin:\r\n    // https://github.com/pixijs/pixijs/blob/af3c0c6bb15aeb1049178c972e4a14bb4cabfce4/bundles/pixi.js-legacy/src/index.ts#L13-L19\r\n    CanvasRenderer.registerPlugin('prepare', CanvasPrepare);\r\n    CanvasRenderer.registerPlugin('sprite', CanvasSpriteRenderer);\r\n    Loader.registerPlugin(SpritesheetLoader);\r\n    settings.RESOLUTION = 2;\r\n    settings.SCALE_MODE = SCALE_MODES.NEAREST;\r\n    settings.ROUND_PIXELS = true;\r\n\r\n    this.ticker = new Ticker();\r\n    this.ticker.minFPS = 1;\r\n    this.renderer = autoDetectRenderer({\r\n      width: 432,\r\n      height: 304,\r\n      antialias: false,\r\n      backgroundColor: 0x000000,\r\n      backgroundAlpha: 1,\r\n      forceCanvas: true,\r\n      preserveDrawingBuffer: true,\r\n    });\r\n    this.stage = new Container();\r\n    this.loader = new Loader();\r\n    this.pikaVolley = null;\r\n    this.playBackSpeedTimes = 1;\r\n    this.playBackSpeedFPS = null;\r\n  }\r\n\r\n  readFile(file) {\r\n    // To show two \"with friend\" on the menu\r\n    const TEXTURES = ASSETS_PATH.TEXTURES;\r\n    TEXTURES.WITH_COMPUTER = TEXTURES.WITH_FRIEND;\r\n\r\n    document\r\n      .querySelector('#game-canvas-container')\r\n      .appendChild(this.renderer.view);\r\n\r\n    this.renderer.render(this.stage); // To make the initial canvas painting stable in the Firefox browser.\r\n    this.ticker.add(() => {\r\n      // Redering and gameLoop order is the opposite of\r\n      // the offline web version (refer: ./offline_version_js/main.js).\r\n      // It's for the smooth rendering for the online version\r\n      // which gameLoop can not always succeed right on this \"ticker.add\"ed code\r\n      // because of the transfer delay or connection status. (If gameLoop here fails,\r\n      // it is recovered by the callback gameLoop which is called after peer input received.)\r\n      // Now the rendering is delayed 40ms (when pikaVolley.normalFPS == 25)\r\n      // behind gameLoop.\r\n      this.renderer.render(this.stage);\r\n      showTimeCurrent(this.pikaVolley.timeCurrent);\r\n      this.pikaVolley.gameLoop();\r\n    });\r\n\r\n    if (this.pikaVolley.replayFrameCounter >= this.pikaVolley.inputs.length) {\r\n      this.ticker.stop(); // 루프 정지\r\n      window.dispatchEvent(new Event('pikaReplayFinished')); // 외부로 종료 신호 발송\r\n    }\r\n\r\n    this.loader.add(ASSETS_PATH.SPRITE_SHEET);\r\n    for (const prop in ASSETS_PATH.SOUNDS) {\r\n      this.loader.add(ASSETS_PATH.SOUNDS[prop]);\r\n    }\r\n    setUpLoaderProgressBar(this.loader);\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = (event) => {\r\n      let packWithComment;\r\n      let pack;\r\n      try {\r\n        // @ts-ignore\r\n        packWithComment = JSON.parse(event.target.result);\r\n        pack = packWithComment.pack;\r\n        const hash = pack.hash;\r\n        pack.hash = 0;\r\n        if (hash !== getHashCode(serialize(pack))) {\r\n          throw 'Error: The file content is not matching the hash code';\r\n        }\r\n      } catch (err) {\r\n        console.log(err);\r\n        noticeFileOpenError();\r\n        return;\r\n      }\r\n      showTotalTimeDuration(getTotalTimeDuration(pack));\r\n      this.loader.load(() => {\r\n        this.pikaVolley = new PikachuVolleyballReplay(\r\n          this.stage,\r\n          this.loader.resources,\r\n          pack.roomID,\r\n          pack.nicknames,\r\n          pack.partialPublicIPs,\r\n          pack.inputs,\r\n          pack.options,\r\n          pack.chats\r\n        );\r\n        // @ts-ignore\r\n        setGetSpeechBubbleNeeded(this.pikaVolley);\r\n        setMaxForScrubberRange(pack.inputs.length);\r\n        this.seekFrame(0);\r\n        this.ticker.start();\r\n        adjustPlayPauseBtnIcon();\r\n        enableReplayScrubberAndBtns();\r\n\r\n        window.dispatchEvent(new Event('pikaReplayLoaded'));\r\n      });\r\n    };\r\n    try {\r\n      reader.readAsText(file);\r\n    } catch (err) {\r\n      console.log(err);\r\n      noticeFileOpenError();\r\n      return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Seek the specific frame\r\n   * @param {number} frameNumber\r\n   */\r\n  seekFrame(frameNumber) {\r\n    hideChat();\r\n    hideNoticeEndOfReplay();\r\n    this.ticker.stop();\r\n\r\n    // Cleanup previous pikaVolley\r\n    this.pikaVolley.initializeForReplay();\r\n\r\n    if (frameNumber > 0) {\r\n      for (let i = 0; i < frameNumber; i++) {\r\n        this.pikaVolley.gameLoopSilent();\r\n      }\r\n      this.renderer.render(this.stage);\r\n    }\r\n    showTimeCurrent(this.pikaVolley.timeCurrent);\r\n  }\r\n\r\n  /**\r\n   * Seek forward/backward the relative time (seconds).\r\n   * @param {number} seconds plus value for seeking forward, minus value for seeking backward\r\n   */\r\n  seekRelativeTime(seconds) {\r\n    const seekFrameCounter = Math.max(\r\n      0,\r\n      this.pikaVolley.replayFrameCounter + seconds * this.pikaVolley.normalFPS\r\n    );\r\n    this.seekFrame(seekFrameCounter);\r\n  }\r\n\r\n  /**\r\n   * Adjust playback speed by times\r\n   * @param {number} times\r\n   */\r\n  adjustPlaybackSpeedTimes(times) {\r\n    this.playBackSpeedFPS = null;\r\n    this.playBackSpeedTimes = times;\r\n    this.ticker.maxFPS = this.pikaVolley.normalFPS * this.playBackSpeedTimes;\r\n    adjustFPSInputValue();\r\n  }\r\n\r\n  /**\r\n   * Adjust playback speed by fps\r\n   * @param {number} fps\r\n   */\r\n  adjustPlaybackSpeedFPS(fps) {\r\n    this.playBackSpeedTimes = null;\r\n    this.playBackSpeedFPS = fps;\r\n    this.ticker.maxFPS = this.playBackSpeedFPS;\r\n    adjustFPSInputValue();\r\n  }\r\n\r\n  stopBGM() {\r\n    this.pikaVolley.audio.sounds.bgm.center.stop();\r\n  }\r\n\r\n  playBGMProperly() {\r\n    if (this.pikaVolley.isBGMPlaying) {\r\n      this.pikaVolley.audio.sounds.bgm.center.play({\r\n        start: this.pikaVolley.timeBGM,\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport const replayPlayer = new ReplayPlayer();\r\n\r\n/**\r\n * Set ticker.maxFPS according to PikachuVolleyball object's normalFPS properly\r\n * @param {number} normalFPS\r\n */\r\nexport function setTickerMaxFPSAccordingToNormalFPS(normalFPS) {\r\n  if (replayPlayer.playBackSpeedFPS) {\r\n    replayPlayer.ticker.maxFPS = replayPlayer.playBackSpeedFPS;\r\n    adjustFPSInputValue();\r\n  } else if (replayPlayer.playBackSpeedTimes) {\r\n    replayPlayer.ticker.maxFPS = normalFPS * replayPlayer.playBackSpeedTimes;\r\n    adjustFPSInputValue();\r\n  }\r\n}\r\n\r\n/**\r\n * Set up the loader progress bar.\r\n * @param {Loader} loader\r\n */\r\nfunction setUpLoaderProgressBar(loader) {\r\n  const loadingBox = document.getElementById('loading-box');\r\n  const progressBar = document.getElementById('progress-bar');\r\n\r\n  loader.onProgress.add(() => {\r\n    progressBar.style.width = `${loader.progress}%`;\r\n  });\r\n  loader.onComplete.add(() => {\r\n    loadingBox.classList.add('hidden');\r\n  });\r\n}\r\n\r\n/**\r\n * Get total time duration for the pack\r\n * @param {Object} pack\r\n */\r\nfunction getTotalTimeDuration(pack) {\r\n  const speedChangeRecord = [];\r\n\r\n  let optionsCounter = 0;\r\n  let options = pack.options[optionsCounter];\r\n  while (options) {\r\n    if (options[1].speed) {\r\n      let fpsFromNowOn = null;\r\n      switch (options[1].speed) {\r\n        case 'slow':\r\n          fpsFromNowOn = 20;\r\n          break;\r\n        case 'medium':\r\n          fpsFromNowOn = 25;\r\n          break;\r\n        case 'fast':\r\n          fpsFromNowOn = 30;\r\n          break;\r\n      }\r\n      const frameCounter = options[0];\r\n      speedChangeRecord.push([frameCounter, fpsFromNowOn]);\r\n    }\r\n    optionsCounter++;\r\n    options = pack.options[optionsCounter];\r\n  }\r\n\r\n  let timeDuration = 0; // unit: second\r\n  let currentFrameCounter = 0;\r\n  let currentFPS = 25;\r\n  for (let i = 0; i < speedChangeRecord.length; i++) {\r\n    const futureFrameCounter = speedChangeRecord[i][0];\r\n    const futureFPS = speedChangeRecord[i][1];\r\n    timeDuration += (futureFrameCounter - currentFrameCounter) / currentFPS;\r\n    currentFrameCounter = futureFrameCounter;\r\n    currentFPS = futureFPS;\r\n  }\r\n  timeDuration += (pack.inputs.length - currentFrameCounter) / currentFPS;\r\n\r\n  return timeDuration;\r\n}\r\n","import { replayPlayer } from './replay_player.js';\r\nimport { enableChat, hideChat } from '../chat_display.js';\r\nimport '../../style.css';\r\n\r\n/** @typedef {import('../offline_version_js/physics.js').PikaUserInput} PikaUserInput */\r\n\r\nlet pausedByBtn = false;\r\n\r\nconst scrubberRangeInput = document.getElementById('scrubber-range-input');\r\nconst playPauseBtn = document.getElementById('play-pause-btn');\r\nconst seekBackward1Btn = document.getElementById('seek-backward-1');\r\nconst seekForward1Btn = document.getElementById('seek-forward-1');\r\nconst seekBackward3Btn = document.getElementById('seek-backward-3');\r\nconst seekForward3Btn = document.getElementById('seek-forward-3');\r\nconst speedBtn5FPS = document.getElementById('speed-btn-5-fps');\r\nconst speedBtnHalfTimes = document.getElementById('speed-btn-half-times');\r\nconst speedBtn1Times = document.getElementById('speed-btn-1-times');\r\nconst speedBtn2Times = document.getElementById('speed-btn-2-times');\r\n\r\nexport function setUpUI() {\r\n  disableReplayScrubberAndBtns();\r\n\r\n  // File input code is from: https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications\r\n  const fileInputElement = document.getElementById('file-input');\r\n  fileInputElement.addEventListener('change', (e) => {\r\n    document.getElementById('loading-box').classList.remove('hidden');\r\n    dropbox.classList.add('hidden');\r\n    // @ts-ignore\r\n    handleFiles(e.target.files);\r\n  });\r\n\r\n  // Dropbox code is from: https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications\r\n  const dropbox = document.getElementById('dropbox');\r\n  dropbox.addEventListener('dragenter', dragenter, false);\r\n  dropbox.addEventListener('dragover', dragover, false);\r\n  dropbox.addEventListener('drop', drop, false);\r\n  function dragenter(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n  }\r\n  function dragover(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n  }\r\n  function drop(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n\r\n    const dt = e.dataTransfer;\r\n    const files = dt.files;\r\n\r\n    document.getElementById('loading-box').classList.remove('hidden');\r\n    dropbox.classList.add('hidden');\r\n\r\n    handleFiles(files);\r\n  }\r\n  function handleFiles(files) {\r\n    replayPlayer.readFile(files[0]);\r\n  }\r\n\r\n  scrubberRangeInput.addEventListener('touchstart', () => {\r\n    if (replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.stop();\r\n      replayPlayer.stopBGM();\r\n    }\r\n  });\r\n  scrubberRangeInput.addEventListener('mousedown', () => {\r\n    if (replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.stop();\r\n      replayPlayer.stopBGM();\r\n    }\r\n  });\r\n  scrubberRangeInput.addEventListener('touchend', () => {\r\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n    }\r\n  });\r\n  scrubberRangeInput.addEventListener('mouseup', () => {\r\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n    }\r\n  });\r\n  scrubberRangeInput.addEventListener('input', (e) => {\r\n    // @ts-ignore\r\n    replayPlayer.seekFrame(Number(e.currentTarget.value));\r\n  });\r\n\r\n  // @ts-ignore\r\n  playPauseBtn.disabled = true;\r\n  playPauseBtn.addEventListener('click', () => {\r\n    if (replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.stop();\r\n      replayPlayer.stopBGM();\r\n      pausedByBtn = true;\r\n      adjustPlayPauseBtnIcon();\r\n    } else {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n      pausedByBtn = false;\r\n      adjustPlayPauseBtnIcon();\r\n    }\r\n  });\r\n\r\n  seekBackward1Btn.addEventListener('click', () => {\r\n    replayPlayer.seekRelativeTime(-1);\r\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n    }\r\n  });\r\n  seekForward1Btn.addEventListener('click', () => {\r\n    replayPlayer.seekRelativeTime(1);\r\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n    }\r\n  });\r\n  seekBackward3Btn.addEventListener('click', () => {\r\n    replayPlayer.seekRelativeTime(-3);\r\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n    }\r\n  });\r\n  seekForward3Btn.addEventListener('click', () => {\r\n    replayPlayer.seekRelativeTime(3);\r\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n    }\r\n  });\r\n\r\n  speedBtn5FPS.addEventListener('click', (e) => {\r\n    processSelected(e);\r\n    replayPlayer.adjustPlaybackSpeedFPS(5);\r\n  });\r\n  speedBtnHalfTimes.addEventListener('click', (e) => {\r\n    processSelected(e);\r\n    replayPlayer.adjustPlaybackSpeedTimes(0.5);\r\n  });\r\n  speedBtn1Times.addEventListener('click', (e) => {\r\n    processSelected(e);\r\n    replayPlayer.adjustPlaybackSpeedTimes(1);\r\n  });\r\n  speedBtn2Times.addEventListener('click', (e) => {\r\n    processSelected(e);\r\n    replayPlayer.adjustPlaybackSpeedTimes(2);\r\n  });\r\n  function processSelected(e) {\r\n    unselectSpeedBtns();\r\n    // @ts-ignore\r\n    e.currentTarget.classList.add('selected');\r\n  }\r\n  function unselectSpeedBtns() {\r\n    for (const btn of [\r\n      speedBtn5FPS,\r\n      speedBtnHalfTimes,\r\n      speedBtn1Times,\r\n      speedBtn2Times,\r\n    ]) {\r\n      btn.classList.remove('selected');\r\n    }\r\n  }\r\n\r\n  const fpsInput = document.getElementById('fps-input');\r\n  fpsInput.addEventListener('change', (e) => {\r\n    // @ts-ignore\r\n    let value = e.target.value;\r\n    if (value < 0) {\r\n      value = 0;\r\n    } else if (value > 60) {\r\n      value = 60;\r\n    }\r\n    replayPlayer.adjustPlaybackSpeedFPS(value);\r\n    unselectSpeedBtns();\r\n  });\r\n\r\n  const noticeBoxEndOfReplayOKBtn = document.getElementById(\r\n    'notice-end-of-replay-ok-btn'\r\n  );\r\n  noticeBoxEndOfReplayOKBtn.addEventListener('click', () => {\r\n    location.reload();\r\n  });\r\n\r\n  const noticeBoxFileErrorOKBtn = document.getElementById(\r\n    'notice-file-open-error-ok-btn'\r\n  );\r\n  noticeBoxFileErrorOKBtn.addEventListener('click', () => {\r\n    location.reload();\r\n  });\r\n\r\n  const keyboardContainer = document.getElementById('keyboard-container');\r\n  const showKeyboardCheckbox = document.getElementById(\r\n    'show-keyboard-checkbox'\r\n  );\r\n  showKeyboardCheckbox.addEventListener('change', () => {\r\n    // @ts-ignore\r\n    if (showKeyboardCheckbox.checked) {\r\n      keyboardContainer.classList.remove('hidden');\r\n    } else {\r\n      keyboardContainer.classList.add('hidden');\r\n    }\r\n  });\r\n\r\n  const showChatCheckbox = document.getElementById('show-chat-checkbox');\r\n  showChatCheckbox.addEventListener('change', () => {\r\n    // @ts-ignore\r\n    if (showChatCheckbox.checked) {\r\n      enableChat(true);\r\n    } else {\r\n      enableChat(false);\r\n      hideChat();\r\n    }\r\n  });\r\n\r\n  const showNicknamesCheckbox = document.getElementById(\r\n    'show-nicknames-checkbox'\r\n  );\r\n  const player1NicknameElem = document.getElementById('player1-nickname');\r\n  const player2NicknameElem = document.getElementById('player2-nickname');\r\n  showNicknamesCheckbox.addEventListener('change', () => {\r\n    // @ts-ignore\r\n    if (showNicknamesCheckbox.checked) {\r\n      player1NicknameElem.classList.remove('hidden');\r\n      player2NicknameElem.classList.remove('hidden');\r\n    } else {\r\n      player1NicknameElem.classList.add('hidden');\r\n      player2NicknameElem.classList.add('hidden');\r\n    }\r\n  });\r\n\r\n  const showIPsCheckbox = document.getElementById('show-ip-addresses-checkbox');\r\n  const player1IPElem = document.getElementById('player1-partial-ip');\r\n  const player2IPElem = document.getElementById('player2-partial-ip');\r\n  showIPsCheckbox.addEventListener('change', () => {\r\n    // @ts-ignore\r\n    if (showIPsCheckbox.checked) {\r\n      player1IPElem.classList.remove('hidden');\r\n      player2IPElem.classList.remove('hidden');\r\n    } else {\r\n      player1IPElem.classList.add('hidden');\r\n      player2IPElem.classList.add('hidden');\r\n    }\r\n  });\r\n\r\n  const turnOnBGMCheckbox = document.getElementById('turn-on-bgm-checkbox');\r\n  turnOnBGMCheckbox.addEventListener('change', () => {\r\n    if (replayPlayer.pikaVolley === null) {\r\n      return;\r\n    }\r\n    // @ts-ignore\r\n    if (turnOnBGMCheckbox.checked) {\r\n      replayPlayer.pikaVolley.audio.turnBGMVolume(true);\r\n    } else {\r\n      replayPlayer.pikaVolley.audio.turnBGMVolume(false);\r\n    }\r\n  });\r\n\r\n  const turnOnSFXCheckbox = document.getElementById('turn-on-sfx-checkbox');\r\n  turnOnSFXCheckbox.addEventListener('change', () => {\r\n    if (replayPlayer.pikaVolley === null) {\r\n      return;\r\n    }\r\n    // @ts-ignore\r\n    if (turnOnSFXCheckbox.checked) {\r\n      replayPlayer.pikaVolley.audio.turnSFXVolume(true);\r\n    } else {\r\n      replayPlayer.pikaVolley.audio.turnSFXVolume(false);\r\n    }\r\n  });\r\n\r\n  const graphicSharpCheckbox = document.getElementById(\r\n    'graphic-sharp-checkbox'\r\n  );\r\n  graphicSharpCheckbox.addEventListener('change', () => {\r\n    if (replayPlayer.pikaVolley === null) {\r\n      return;\r\n    }\r\n    // @ts-ignore\r\n    if (graphicSharpCheckbox.checked) {\r\n      document\r\n        .querySelector('#game-canvas-container>canvas')\r\n        .classList.remove('graphic-soft');\r\n    } else {\r\n      document\r\n        .querySelector('#game-canvas-container>canvas')\r\n        .classList.add('graphic-soft');\r\n    }\r\n  });\r\n\r\n  window.addEventListener('keydown', (event) => {\r\n    if (event.code === 'Space') {\r\n      event.preventDefault();\r\n      playPauseBtn.click();\r\n    } else if (event.code === 'ArrowLeft') {\r\n      event.preventDefault();\r\n      seekBackward3Btn.click();\r\n    } else if (event.code === 'ArrowRight') {\r\n      event.preventDefault();\r\n      seekForward3Btn.click();\r\n    }\r\n  });\r\n}\r\n\r\nexport function adjustFPSInputValue() {\r\n  const fpsInput = document.getElementById('fps-input');\r\n  // @ts-ignore\r\n  fpsInput.value = replayPlayer.ticker.maxFPS;\r\n}\r\n\r\nexport function adjustPlayPauseBtnIcon() {\r\n  const playPauseBtn = document.getElementById('play-pause-btn');\r\n  if (replayPlayer.ticker.started) {\r\n    playPauseBtn.textContent =\r\n      document.getElementById('pause-mark').textContent;\r\n  } else {\r\n    playPauseBtn.textContent = document.getElementById('play-mark').textContent;\r\n  }\r\n}\r\n\r\nexport function noticeEndOfReplay() {\r\n  const noticeBoxEndOfReplay = document.getElementById('notice-end-of-replay');\r\n  noticeBoxEndOfReplay.classList.remove('hidden');\r\n}\r\n\r\nexport function hideNoticeEndOfReplay() {\r\n  const noticeBoxEndOfReplay = document.getElementById('notice-end-of-replay');\r\n  noticeBoxEndOfReplay.classList.add('hidden');\r\n}\r\n\r\nexport function noticeFileOpenError() {\r\n  const noticeBoxFileOpenError = document.getElementById(\r\n    'notice-file-open-error'\r\n  );\r\n  noticeBoxFileOpenError.classList.remove('hidden');\r\n}\r\n\r\nexport function getCommentText() {\r\n  return document.getElementById('replay-viewer-at').textContent;\r\n}\r\n\r\nexport function setMaxForScrubberRange(max) {\r\n  // @ts-ignore\r\n  scrubberRangeInput.max = max;\r\n}\r\n\r\nexport function moveScrubberTo(value) {\r\n  // @ts-ignore\r\n  scrubberRangeInput.value = value;\r\n}\r\n\r\n/**\r\n *\r\n * @param {number} timeCurrent unit: second\r\n */\r\nexport function showTimeCurrent(timeCurrent) {\r\n  document.getElementById('time-current').textContent =\r\n    getTimeText(timeCurrent);\r\n}\r\n\r\n/**\r\n *\r\n * @param {number} timeDuration unit: second\r\n */\r\nexport function showTotalTimeDuration(timeDuration) {\r\n  document.getElementById('time-duration').textContent =\r\n    getTimeText(timeDuration);\r\n}\r\n\r\n/**\r\n * Show Keyboard inputs\r\n * @param {PikaUserInput} player1Input\r\n * @param {PikaUserInput} player2Input\r\n */\r\nexport function showKeyboardInputs(player1Input, player2Input) {\r\n  const zKey = document.getElementById('z-key');\r\n  const rKey = document.getElementById('r-key');\r\n  const vKey = document.getElementById('v-key');\r\n  const dKey = document.getElementById('d-key');\r\n  const gKey = document.getElementById('g-key');\r\n\r\n  const enterKey = document.getElementById('enter-key');\r\n  const upKey = document.getElementById('up-key');\r\n  const downKey = document.getElementById('down-key');\r\n  const leftKey = document.getElementById('left-key');\r\n  const rightKey = document.getElementById('right-key');\r\n\r\n  function pressKeyElm(keyElm) {\r\n    keyElm.classList.add('pressed');\r\n  }\r\n\r\n  function unpressKeyElm(keyElm) {\r\n    keyElm.classList.remove('pressed');\r\n  }\r\n\r\n  switch (player1Input.xDirection) {\r\n    case 0:\r\n      unpressKeyElm(dKey);\r\n      unpressKeyElm(gKey);\r\n      break;\r\n    case -1:\r\n      pressKeyElm(dKey);\r\n      unpressKeyElm(gKey);\r\n      break;\r\n    case 1:\r\n      unpressKeyElm(dKey);\r\n      pressKeyElm(gKey);\r\n      break;\r\n  }\r\n  switch (player1Input.yDirection) {\r\n    case 0:\r\n      unpressKeyElm(rKey);\r\n      unpressKeyElm(vKey);\r\n      break;\r\n    case -1:\r\n      pressKeyElm(rKey);\r\n      unpressKeyElm(vKey);\r\n      break;\r\n    case 1:\r\n      unpressKeyElm(rKey);\r\n      pressKeyElm(vKey);\r\n      break;\r\n  }\r\n  switch (player1Input.powerHit) {\r\n    case 0:\r\n      unpressKeyElm(zKey);\r\n      break;\r\n    case 1:\r\n      pressKeyElm(zKey);\r\n      break;\r\n  }\r\n\r\n  switch (player2Input.xDirection) {\r\n    case 0:\r\n      unpressKeyElm(leftKey);\r\n      unpressKeyElm(rightKey);\r\n      break;\r\n    case -1:\r\n      pressKeyElm(leftKey);\r\n      unpressKeyElm(rightKey);\r\n      break;\r\n    case 1:\r\n      unpressKeyElm(leftKey);\r\n      pressKeyElm(rightKey);\r\n      break;\r\n  }\r\n  switch (player2Input.yDirection) {\r\n    case 0:\r\n      unpressKeyElm(upKey);\r\n      unpressKeyElm(downKey);\r\n      break;\r\n    case -1:\r\n      pressKeyElm(upKey);\r\n      unpressKeyElm(downKey);\r\n      break;\r\n    case 1:\r\n      unpressKeyElm(upKey);\r\n      pressKeyElm(downKey);\r\n      break;\r\n  }\r\n  switch (player2Input.powerHit) {\r\n    case 0:\r\n      unpressKeyElm(enterKey);\r\n      break;\r\n    case 1:\r\n      pressKeyElm(enterKey);\r\n      break;\r\n  }\r\n}\r\n\r\nexport function enableReplayScrubberAndBtns() {\r\n  // @ts-ignore\r\n  scrubberRangeInput.disabled = false;\r\n  // @ts-ignore\r\n  playPauseBtn.disabled = false;\r\n  // @ts-ignore\r\n  seekBackward1Btn.disabled = false;\r\n  // @ts-ignore\r\n  seekForward1Btn.disabled = false;\r\n  // @ts-ignore\r\n  seekBackward3Btn.disabled = false;\r\n  // @ts-ignore\r\n  seekForward3Btn.disabled = false;\r\n  // @ts-ignore\r\n  speedBtn5FPS.disabled = false;\r\n  // @ts-ignore\r\n  speedBtnHalfTimes.disabled = false;\r\n  // @ts-ignore\r\n  speedBtn1Times.disabled = false;\r\n  // @ts-ignore\r\n  speedBtn2Times.disabled = false;\r\n}\r\n\r\nfunction disableReplayScrubberAndBtns() {\r\n  // @ts-ignore\r\n  scrubberRangeInput.disabled = true;\r\n  // @ts-ignore\r\n  playPauseBtn.disabled = true;\r\n  // @ts-ignore\r\n  seekBackward1Btn.disabled = true;\r\n  // @ts-ignore\r\n  seekForward1Btn.disabled = true;\r\n  // @ts-ignore\r\n  seekBackward3Btn.disabled = true;\r\n  // @ts-ignore\r\n  seekForward3Btn.disabled = true;\r\n  // @ts-ignore\r\n  speedBtn5FPS.disabled = true;\r\n  // @ts-ignore\r\n  speedBtnHalfTimes.disabled = true;\r\n  // @ts-ignore\r\n  speedBtn1Times.disabled = true;\r\n  // @ts-ignore\r\n  speedBtn2Times.disabled = true;\r\n}\r\n\r\n/**\r\n *\r\n * @param {number} time unit: second\r\n */\r\nfunction getTimeText(time) {\r\n  const seconds = Math.floor(time % 60);\r\n  const minutes = Math.floor(time / 60) % 60;\r\n  const hours = Math.floor(Math.floor(time / 60) / 60);\r\n\r\n  if (hours > 0) {\r\n    return `${String(hours)}:${('0' + minutes).slice(-2)}:${(\r\n      '0' + seconds\r\n    ).slice(-2)}`;\r\n  } else {\r\n    return `${String(minutes)}:${('0' + seconds).slice(-2)}`;\r\n  }\r\n}\r\n","import seedrandom from 'seedrandom';\r\nimport { PikachuVolleyball } from '../offline_version_js/pikavolley.js';\r\nimport { setCustomRng } from '../offline_version_js/rand.js';\r\nimport { setChatRngs, displayChatMessageAt } from '../chat_display.js';\r\nimport {\r\n  displayNicknameFor,\r\n  displayPartialIPFor,\r\n} from '../nickname_display.js';\r\nimport { Cloud, Wave } from '../offline_version_js/cloud_and_wave.js';\r\nimport { PikaPhysics } from '../offline_version_js/physics.js';\r\nimport { convert5bitNumberToUserInput } from '../utils/input_conversion.js';\r\nimport {\r\n  noticeEndOfReplay,\r\n  moveScrubberTo,\r\n  showKeyboardInputs,\r\n} from './ui_replay.js';\r\nimport { setTickerMaxFPSAccordingToNormalFPS } from './replay_player.js';\r\n\r\n/** @typedef GameState @type {function():void} */\r\n\r\n/**\r\n * Class representing Pikachu Volleyball Replay\r\n */\r\n// @ts-ignore\r\nexport class PikachuVolleyballReplay extends PikachuVolleyball {\r\n  constructor(\r\n    stage,\r\n    resources,\r\n    roomId,\r\n    nicknames,\r\n    partialPublicIPs,\r\n    inputs,\r\n    options,\r\n    chats\r\n  ) {\r\n    super(stage, resources);\r\n    this.noInputFrameTotal.menu = Infinity;\r\n\r\n    this.roomId = roomId;\r\n    this.nicknames = nicknames;\r\n    this.partialPublicIPs = partialPublicIPs;\r\n    this.inputs = inputs;\r\n    this.options = options;\r\n    this.chats = chats;\r\n    this.player1Keyboard = {\r\n      xDirection: 0,\r\n      yDirection: 0,\r\n      powerHit: 0,\r\n      getInput: () => {},\r\n    };\r\n    this.player2Keyboard = {\r\n      xDirection: 0,\r\n      yDirection: 0,\r\n      powerHit: 0,\r\n      getInput: () => {},\r\n    };\r\n    this.keyboardArray = [this.player1Keyboard, this.player2Keyboard];\r\n    this.willDisplayChat = true;\r\n\r\n    const fakeSound = {\r\n      play: () => {},\r\n      stop: () => {},\r\n    };\r\n    const fakeBGM = {\r\n      fake: true,\r\n      center: {\r\n        isPlaying: false,\r\n      },\r\n      play: function () {\r\n        this.center.isPlaying = true;\r\n      },\r\n      stop: function () {\r\n        this.center.isPlaying = false;\r\n      },\r\n    };\r\n    this.fakeAudio = {\r\n      sounds: {\r\n        bgm: fakeBGM,\r\n        pipikachu: fakeSound,\r\n        pika: fakeSound,\r\n        chu: fakeSound,\r\n        pi: fakeSound,\r\n        pikachu: fakeSound,\r\n        powerHit: fakeSound,\r\n        ballTouchesGround: fakeSound,\r\n      },\r\n    };\r\n\r\n    this.initializeForReplay();\r\n  }\r\n\r\n  /**\r\n   * This is mainly for reinitialization for reusing the PikachuVolleyballReplay object\r\n   */\r\n  initializeForReplay() {\r\n    // Stop if sounds are playing\r\n    for (const prop in this.audio.sounds) {\r\n      this.audio.sounds[prop].stop();\r\n    }\r\n\r\n    this.timeCurrent = 0; // unit: second\r\n    this.timeBGM = 0;\r\n    this.isBGMPlaying = false;\r\n    this.replayFrameCounter = 0;\r\n    this.chatCounter = 0;\r\n    this.optionsCounter = 0;\r\n\r\n    // Set the same RNG (used for the game) for both peers\r\n    const customRng = seedrandom.alea(this.roomId.slice(10));\r\n    setCustomRng(customRng);\r\n\r\n    // Set the same RNG (used for displaying chat messages) for both peers\r\n    const rngForPlayer1Chat = seedrandom.alea(this.roomId.slice(10, 15));\r\n    const rngForPlayer2Chat = seedrandom.alea(this.roomId.slice(15));\r\n    setChatRngs(rngForPlayer1Chat, rngForPlayer2Chat);\r\n\r\n    // Reinitialize things which needs exact RNG\r\n    this.view.game.cloudArray = [];\r\n    const NUM_OF_CLOUDS = 10;\r\n    for (let i = 0; i < NUM_OF_CLOUDS; i++) {\r\n      this.view.game.cloudArray.push(new Cloud());\r\n    }\r\n    this.view.game.wave = new Wave();\r\n    this.view.intro.visible = false;\r\n    this.view.menu.visible = false;\r\n    this.view.game.visible = false;\r\n    this.view.fadeInOut.visible = false;\r\n\r\n    this.physics = new PikaPhysics(true, true);\r\n\r\n    this.normalFPS = 25;\r\n    this.slowMotionFPS = 5;\r\n    this.SLOW_MOTION_FRAMES_NUM = 6;\r\n    this.slowMotionFramesLeft = 0;\r\n    this.slowMotionNumOfSkippedFrames = 0;\r\n    this.selectedWithWho = 0;\r\n    this.scores = [0, 0];\r\n    this.winningScore = 15;\r\n    this.gameEnded = false;\r\n    this.roundEnded = false;\r\n    this.isPlayer2Serve = false;\r\n    this.frameCounter = 0;\r\n    this.noInputFrameCounter = 0;\r\n\r\n    this.paused = false;\r\n    this.isStereoSound = true;\r\n    this._isPracticeMode = false;\r\n    this.isRoomCreatorPlayer2 = false;\r\n    this.state = this.intro;\r\n  }\r\n\r\n  /**\r\n   * Override the \"intro\" method in the super class.\r\n   * It is to ask for one more game with the peer after quick match game ends.\r\n   * @type {GameState}\r\n   */\r\n  intro() {\r\n    if (this.frameCounter === 0) {\r\n      this.selectedWithWho = 0;\r\n      if (this.nicknames) {\r\n        displayNicknameFor(this.nicknames[0], this.isRoomCreatorPlayer2);\r\n        displayNicknameFor(this.nicknames[1], !this.isRoomCreatorPlayer2);\r\n      }\r\n      if (this.partialPublicIPs) {\r\n        displayPartialIPFor(\r\n          this.partialPublicIPs[0],\r\n          this.isRoomCreatorPlayer2\r\n        );\r\n        displayPartialIPFor(\r\n          this.partialPublicIPs[1],\r\n          !this.isRoomCreatorPlayer2\r\n        );\r\n      }\r\n    }\r\n    super.intro();\r\n  }\r\n\r\n  /**\r\n   * Override the \"menu\" method in the super class.\r\n   * It changes \"am I player 1 or player 2\" setting accordingly.\r\n   * @type {GameState}\r\n   */\r\n  menu() {\r\n    const selectedWithWho = this.selectedWithWho;\r\n    super.menu();\r\n    if (this.selectedWithWho !== selectedWithWho) {\r\n      this.isRoomCreatorPlayer2 = !this.isRoomCreatorPlayer2;\r\n      if (this.nicknames) {\r\n        displayNicknameFor(this.nicknames[0], this.isRoomCreatorPlayer2);\r\n        displayNicknameFor(this.nicknames[1], !this.isRoomCreatorPlayer2);\r\n      }\r\n      if (this.partialPublicIPs) {\r\n        displayPartialIPFor(\r\n          this.partialPublicIPs[0],\r\n          this.isRoomCreatorPlayer2\r\n        );\r\n        displayPartialIPFor(\r\n          this.partialPublicIPs[1],\r\n          !this.isRoomCreatorPlayer2\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Game loop which play no sound, display no chat, does not move scrubber\r\n   */\r\n  gameLoopSilent() {\r\n    const audio = this.audio;\r\n    this.willDisplayChat = false;\r\n    // @ts-ignore\r\n    this.audio = this.fakeAudio;\r\n    this.gameLoop();\r\n    this.willDisplayChat = true;\r\n    this.audio = audio;\r\n  }\r\n\r\n  /**\r\n   * Game loop\r\n   * This function should be called at regular intervals ( interval = (1 / FPS) second )\r\n   */\r\n  gameLoop() {\r\n    if (this.replayFrameCounter >= this.inputs.length) {\r\n      noticeEndOfReplay();\r\n      return;\r\n    }\r\n\r\n    moveScrubberTo(this.replayFrameCounter);\r\n\r\n    const usersInputNumber = this.inputs[this.replayFrameCounter];\r\n    const player1Input = convert5bitNumberToUserInput(usersInputNumber >>> 5);\r\n    const player2Input = convert5bitNumberToUserInput(\r\n      usersInputNumber % (1 << 5)\r\n    );\r\n    this.player1Keyboard.xDirection = player1Input.xDirection;\r\n    this.player1Keyboard.yDirection = player1Input.yDirection;\r\n    this.player1Keyboard.powerHit = player1Input.powerHit;\r\n    this.player2Keyboard.xDirection = player2Input.xDirection;\r\n    this.player2Keyboard.yDirection = player2Input.yDirection;\r\n    this.player2Keyboard.powerHit = player2Input.powerHit;\r\n    showKeyboardInputs(player1Input, player2Input);\r\n\r\n    let options = this.options[this.optionsCounter];\r\n    while (options && options[0] === this.replayFrameCounter) {\r\n      if (options[1].speed) {\r\n        switch (options[1].speed) {\r\n          case 'slow':\r\n            this.normalFPS = 20;\r\n            break;\r\n          case 'medium':\r\n            this.normalFPS = 25;\r\n            break;\r\n          case 'fast':\r\n            this.normalFPS = 30;\r\n            break;\r\n        }\r\n        setTickerMaxFPSAccordingToNormalFPS(this.normalFPS);\r\n      }\r\n      if (options[1].winningScore) {\r\n        switch (options[1].winningScore) {\r\n          case 5:\r\n            this.winningScore = 5;\r\n            break;\r\n          case 10:\r\n            this.winningScore = 10;\r\n            break;\r\n          case 15:\r\n            this.winningScore = 15;\r\n            break;\r\n        }\r\n      }\r\n      this.optionsCounter++;\r\n      options = this.options[this.optionsCounter];\r\n    }\r\n    this.timeCurrent += 1 / this.normalFPS;\r\n\r\n    this.isBGMPlaying = this.audio.sounds.bgm.center.isPlaying;\r\n    if (this.isBGMPlaying) {\r\n      this.timeBGM = (this.timeBGM + 1 / this.normalFPS) % 83; // 83 is total duration of bgm\r\n    } else {\r\n      this.timeBGM = 0;\r\n    }\r\n\r\n    let chat = this.chats[this.chatCounter];\r\n    while (chat && chat[0] === this.replayFrameCounter) {\r\n      if (this.willDisplayChat) {\r\n        displayChatMessageAt(chat[2], chat[1]);\r\n      }\r\n      this.chatCounter++;\r\n      chat = this.chats[this.chatCounter];\r\n    }\r\n\r\n    this.replayFrameCounter++;\r\n    this.physics.player1.isComputer = false;\r\n    this.physics.player2.isComputer = false;\r\n    super.gameLoop();\r\n  }\r\n}\r\n","/**\r\n * Main script for converting Pikachu Volleyball replay files to video\r\n * OFFLINE RENDERING (High Speed)\r\n * - Resolution: Fixed 432x304\r\n * - Audio: Reconstructed via OfflineAudioContext\r\n * - Chat: Captured via method hooking and drawn to Canvas\r\n * Uses 'mp4-muxer' library\r\n */\r\n'use strict';\r\nimport { settings } from '@pixi/settings';\r\nimport { SCALE_MODES } from '@pixi/constants';\r\nimport { Renderer, BatchRenderer, autoDetectRenderer } from '@pixi/core';\r\nimport { Prepare } from '@pixi/prepare';\r\nimport { Container } from '@pixi/display';\r\nimport { Loader } from '@pixi/loaders';\r\nimport { SpritesheetLoader } from '@pixi/spritesheet';\r\nimport { CanvasRenderer } from '@pixi/canvas-renderer';\r\nimport { CanvasSpriteRenderer } from '@pixi/canvas-sprite';\r\nimport { CanvasPrepare } from '@pixi/canvas-prepare';\r\nimport '@pixi/canvas-display';\r\nimport { ASSETS_PATH } from '../offline_version_js/assets_path.js';\r\nimport { PikachuVolleyballReplay } from './pikavolley_replay.js';\r\n// *중요* : displayChatMessageAt을 import하지만, 실제로는 우리가 덮어쓴 함수가 호출됨\r\nimport * as ChatDisplay from '../chat_display.js'; \r\nimport { serialize } from '../utils/serialize.js';\r\nimport { getHashCode } from '../utils/hash_code.js';\r\nimport '../../style.css';\r\n\r\nimport * as Mp4Muxer from 'mp4-muxer';\r\n\r\nconsole.log('🎬 [INIT] Offline Renderer (Final: Chat & Audio Hooking)');\r\n\r\n// [1] 전역 DOM 패치\r\nconst originalReplaceChild = Node.prototype.replaceChild;\r\nNode.prototype.replaceChild = function(newChild, oldChild) {\r\n    try { return originalReplaceChild.call(this, newChild, oldChild); } \r\n    catch (e) { try { this.appendChild(newChild); } catch (e2) {} return newChild; }\r\n};\r\nconst originalRemoveChild = Node.prototype.removeChild;\r\nNode.prototype.removeChild = function(child) {\r\n    try { return originalRemoveChild.call(this, child); } catch (e) { return null; }\r\n};\r\n\r\nclass OfflineConverter {\r\n  constructor() {\r\n    Renderer.registerPlugin('prepare', Prepare);\r\n    Renderer.registerPlugin('batch', BatchRenderer);\r\n    CanvasRenderer.registerPlugin('prepare', CanvasPrepare);\r\n    CanvasRenderer.registerPlugin('sprite', CanvasSpriteRenderer);\r\n    Loader.registerPlugin(SpritesheetLoader);\r\n    \r\n    // 해상도 고정\r\n    settings.RESOLUTION = 1;\r\n    settings.SCALE_MODE = SCALE_MODES.NEAREST;\r\n    settings.ROUND_PIXELS = true;\r\n\r\n    this.renderer = null;\r\n    this.stage = null;\r\n    this.loader = null;\r\n    this.pikaVolley = null;\r\n    \r\n    // 데이터 저장소\r\n    this.audioLog = []; \r\n    this.decodedBuffers = {}; \r\n    this.totalDuration = 0;\r\n    \r\n    // 채팅 상태 관리 (실시간 렌더링용)\r\n    this.activeChats = { p1: null, p2: null }; // { message: string, timer: number }\r\n    \r\n    this.muxer = null;\r\n    this.videoEncoder = null;\r\n    this.audioEncoder = null;\r\n  }\r\n\r\n  updateStatus(message) {\r\n    const statusEl = document.getElementById('status');\r\n    if (statusEl) statusEl.textContent = message;\r\n    console.log(`📝 [STATUS] ${message}`);\r\n  }\r\n\r\n  handleRecordButtonClick() {\r\n    const fileInput = document.createElement('input');\r\n    fileInput.type = 'file';\r\n    fileInput.accept = '.txt';\r\n    fileInput.onchange = (e) => {\r\n      // @ts-ignore\r\n      const file = e.target.files[0];\r\n      if (file) this.loadReplayFile(file);\r\n    };\r\n    fileInput.click();\r\n  }\r\n\r\n  loadReplayFile(file) {\r\n    this.updateStatus('리플레이 분석 중...');\r\n    const reader = new FileReader();\r\n    reader.onload = (event) => {\r\n      try {\r\n        // @ts-ignore\r\n        const packWithComment = JSON.parse(event.target.result);\r\n        const pack = packWithComment.pack;\r\n        \r\n        const originalHash = pack.hash;\r\n        pack.hash = 0;\r\n        if (originalHash !== getHashCode(serialize(pack))) {\r\n             console.warn('⚠️ Hash mismatch - ignored');\r\n        }\r\n        pack.hash = originalHash;\r\n\r\n        this.initializeRenderer(pack);\r\n      } catch (err) {\r\n        console.error('❌ Error:', err);\r\n        this.updateStatus('파일 로딩 실패');\r\n      }\r\n    };\r\n    reader.readAsText(file);\r\n  }\r\n\r\n  initializeRenderer(pack) {\r\n    this.updateStatus('리소스 및 오디오 디코딩 중...');\r\n    \r\n    this.renderer = autoDetectRenderer({\r\n      width: 432,\r\n      height: 304,\r\n      antialias: false,\r\n      backgroundColor: 0x000000,\r\n      forceCanvas: true,\r\n      preserveDrawingBuffer: true,\r\n    });\r\n\r\n    this.stage = new Container();\r\n    this.loader = new Loader();\r\n\r\n    const container = document.querySelector('#game-canvas-container');\r\n    // @ts-ignore\r\n    container.innerHTML = '';\r\n    // @ts-ignore\r\n    container.appendChild(this.renderer.view);\r\n    \r\n    this.ensureDOMElements(container); \r\n\r\n    this.loader.add(ASSETS_PATH.SPRITE_SHEET);\r\n    \r\n    const soundLoadPromises = [];\r\n    //@ts-ignore\r\n    const AudioContext = window.AudioContext || window.webkitAudioContext;\r\n    const audioCtx = new AudioContext();\r\n    \r\n    const keyMapping = {\r\n      'BGM': 'bgm', 'PIPIKACHU': 'pipikachu', 'PIKA': 'pika', 'CHU': 'chu',\r\n      'PI': 'pi', 'PIKACHU': 'pikachu', 'POWERHIT': 'powerHit', 'BALLTOUCHESGROUND': 'ballTouchesGround',\r\n    };\r\n    \r\n    for (const key in ASSETS_PATH.SOUNDS) {\r\n        const url = ASSETS_PATH.SOUNDS[key];\r\n        const promise = fetch(url)\r\n            .then(res => res.arrayBuffer())\r\n            .then(buf => audioCtx.decodeAudioData(buf))\r\n            .then(decoded => {\r\n                const mappedKey = keyMapping[key] || key.toLowerCase();\r\n                this.decodedBuffers[mappedKey] = decoded;\r\n            });\r\n        soundLoadPromises.push(promise);\r\n        this.loader.add(ASSETS_PATH.SOUNDS[key]);\r\n    }\r\n\r\n    Promise.all(soundLoadPromises).then(() => {\r\n        this.loader.load(() => this.startOfflineProcessing(pack));\r\n    });\r\n  }\r\n\r\n  ensureDOMElements(container) {\r\n    const ids = [\r\n        'player1-chat-box', 'player2-chat-box', \r\n        'player1-nickname', 'player2-nickname', \r\n        'player1-partial-ip', 'player2-partial-ip'\r\n    ];\r\n    ids.forEach(id => {\r\n        let el = document.getElementById(id);\r\n        if (!el) {\r\n            el = document.createElement('div');\r\n            el.id = id;\r\n            el.style.display = 'none'; \r\n            container.appendChild(el);\r\n        } else {\r\n            el.textContent = ''; \r\n        }\r\n    });\r\n  }\r\n\r\n  async startOfflineProcessing(pack) {\r\n    this.updateStatus('오프라인 렌더링 시작...');\r\n    \r\n    this.pikaVolley = new PikachuVolleyballReplay(\r\n      this.stage,\r\n      this.loader.resources,\r\n      pack.roomID,\r\n      pack.nicknames,\r\n      pack.partialPublicIPs,\r\n      pack.inputs,\r\n      pack.options,\r\n      pack.chats\r\n    );\r\n\r\n    // [핵심 1] gameLoopSilent 메서드를 덮어써서(Overriding) 채팅 기능을 살림\r\n    // 원래는 willDisplayChat = false로 끄지만, 우리는 true로 유지해야 함.\r\n    this.pikaVolley.gameLoopSilent = function() {\r\n        const audio = this.audio;\r\n        this.willDisplayChat = true; // <-- 여기가 핵심 변경점 (false -> true)\r\n        // @ts-ignore\r\n        this.audio = this.fakeAudio;\r\n        //@ts-ignore\r\n        this.gameLoop();\r\n        this.audio = audio;\r\n    };\r\n\r\n    // [핵심 2] chat_display.js의 displayChatMessageAt 함수를 가로채기(Hooking)\r\n    // chat_display.js가 에러를 뿜는 대신, 우리가 원하는 동작(변수에 저장)을 하도록 변경\r\n    // pikavolley_replay.js가 이 모듈을 import해서 쓰므로, 여기서 바꾸면 적용됨 (ES Module 특성상 readonly일 수 있으나, 객체 속성이면 가능)\r\n    // 하지만 import 된 함수 자체는 read-only.\r\n    \r\n    // ★ 대안: pikavolley_replay.js는 `displayChatMessageAt`을 import해서 씁니다.\r\n    // 우리는 이걸 직접 바꿀 수 없으므로, pikaVolley 인스턴스의 `chats` 데이터를 직접 감시하거나\r\n    // gameLoop 메서드를 더 깊게 수정해야 합니다.\r\n    \r\n    // 가장 확실한 방법: gameLoop 메서드 자체를 수정하여 `displayChatMessageAt` 호출 부분을 내가 만든 함수로 대체\r\n    const originalGameLoop = this.pikaVolley.gameLoop.bind(this.pikaVolley);\r\n    this.pikaVolley.gameLoop = () => {\r\n        // 채팅 로직을 위해 chatCounter 등을 미리 백업하거나 조작해야 할 수 있음.\r\n        // 하지만 더 쉬운 방법은, pikaVolley.chats 배열을 우리가 직접 순회하며 처리하는 것임.\r\n        // main_out.js의 루프에서 직접 처리하도록 하자.\r\n        originalGameLoop();\r\n    };\r\n\r\n    // [핵심 3] 오디오 로거 설치\r\n    this.audioLog = [];\r\n    this.mockAudioSystem();\r\n\r\n    const fps = 30;\r\n    const totalFrames = pack.inputs.length;\r\n    this.totalDuration = totalFrames / fps;\r\n\r\n    // Muxer 설정\r\n    // @ts-ignore\r\n    this.muxer = new Mp4Muxer.Muxer({\r\n        target: new Mp4Muxer.ArrayBufferTarget(),\r\n        video: { codec: 'avc', width: 432, height: 304 },\r\n        audio: { codec: 'aac', sampleRate: 44100, numberOfChannels: 2 },\r\n        fastStart: 'in-memory',\r\n    });\r\n\r\n    this.videoEncoder = new VideoEncoder({\r\n        output: (chunk, meta) => this.muxer.addVideoChunk(chunk, meta),\r\n        error: (e) => console.error('Video Error:', e)\r\n    });\r\n    this.videoEncoder.configure({\r\n        codec: 'avc1.42001f',\r\n        width: 432,\r\n        height: 304,\r\n        bitrate: 2_500_000,\r\n        framerate: fps,\r\n    });\r\n\r\n    this.audioEncoder = new AudioEncoder({\r\n        output: (chunk, meta) => this.muxer.addAudioChunk(chunk, meta),\r\n        error: (e) => console.error('Audio Error:', e)\r\n    });\r\n    this.audioEncoder.configure({\r\n        codec: 'mp4a.40.2',\r\n        sampleRate: 44100,\r\n        numberOfChannels: 2,\r\n        bitrate: 128_000,\r\n    });\r\n\r\n    const progressBar = document.getElementById('progress-bar');\r\n    \r\n    // 채팅 수동 처리를 위한 변수\r\n    let chatHead = 0;\r\n    const chats = pack.chats || [];\r\n\r\n    // [STEP 1] 비디오 렌더링\r\n    for (let i = 0; i < totalFrames; i++) {\r\n        if (this.videoEncoder.encodeQueueSize > 20) {\r\n            await new Promise(r => setTimeout(r, 10));\r\n        }\r\n\r\n        try {\r\n            // [중요] modified gameLoopSilent 실행\r\n            this.pikaVolley.gameLoopSilent(); \r\n        } catch(e) {\r\n            // chat_display.js에서 에러가 날 수 있음 (channel is undefined 등)\r\n            // 에러가 나도 게임 상태는 업데이트 되었으므로 무시하고 진행\r\n        }\r\n\r\n        // [채팅 로직 수동 구현]\r\n        // pikavolley_replay.js의 로직을 흉내내어 채팅을 감지하고 상태를 업데이트\r\n        while (chatHead < chats.length && chats[chatHead][0] === i) {\r\n            const chat = chats[chatHead];\r\n            const side = chat[1]; // 1 or 2\r\n            const message = chat[2];\r\n            \r\n            // 채팅 활성화 (5초간 표시)\r\n            if (side === 1) this.activeChats.p1 = { message, timer: 150 };\r\n            else this.activeChats.p2 = { message, timer: 150 };\r\n            \r\n            chatHead++;\r\n        }\r\n        \r\n        // 채팅 타이머 감소\r\n        if (this.activeChats.p1 && this.activeChats.p1.timer-- <= 0) this.activeChats.p1 = null;\r\n        if (this.activeChats.p2 && this.activeChats.p2.timer-- <= 0) this.activeChats.p2 = null;\r\n\r\n        // 렌더링\r\n        this.renderer.render(this.stage);\r\n        this.drawOverlaysOnCanvas();\r\n\r\n        // @ts-ignore\r\n        const bitmap = await createImageBitmap(this.renderer.view);\r\n        const videoFrame = new VideoFrame(bitmap, { timestamp: (i * 1000000) / fps });\r\n        \r\n        const keyFrame = i % 90 === 0;\r\n        this.videoEncoder.encode(videoFrame, { keyFrame });\r\n        videoFrame.close();\r\n\r\n        if (i % 30 === 0) {\r\n            const percent = Math.floor((i / totalFrames) * 100);\r\n            this.updateStatus(`영상 처리 중... ${percent}%`);\r\n            // @ts-ignore\r\n            if(progressBar) progressBar.style.width = `${percent}%`;\r\n            await new Promise(r => setTimeout(r, 0));\r\n        }\r\n    }\r\n\r\n    await this.videoEncoder.flush();\r\n    \r\n    // [STEP 2] 오디오 합성\r\n    this.updateStatus('오디오 합성 중...');\r\n    await this.synthesizeAndEncodeAudio(fps);\r\n\r\n    // [STEP 3] 저장\r\n    this.muxer.finalize();\r\n    const buffer = this.muxer.target.buffer;\r\n    this.saveFile(buffer);\r\n  }\r\n\r\n  mockAudioSystem() {\r\n    this.pikaVolley.audio.turnBGMVolume(false);\r\n    this.pikaVolley.audio.turnSFXVolume(true);\r\n\r\n    const fakeSounds = this.pikaVolley.fakeAudio.sounds;\r\n    for (const key in fakeSounds) {\r\n        if (key === 'bgm') continue;\r\n        \r\n        // fakeAudio 객체 분리 및 후킹\r\n        fakeSounds[key] = {\r\n            play: (pan = 0) => {\r\n                const currentFrame = this.pikaVolley.replayFrameCounter;\r\n                this.audioLog.push({\r\n                    key: key,\r\n                    frame: currentFrame,\r\n                    pan: pan \r\n                });\r\n            },\r\n            stop: () => {}\r\n        };\r\n    }\r\n  }\r\n\r\n  async synthesizeAndEncodeAudio(fps) {\r\n    if (this.audioLog.length === 0) return;\r\n\r\n    const sampleRate = 44100;\r\n    const length = Math.ceil(this.totalDuration * sampleRate) + sampleRate; \r\n    const offlineCtx = new OfflineAudioContext(2, length, sampleRate);\r\n\r\n    this.audioLog.forEach(log => {\r\n        const buffer = this.decodedBuffers[log.key];\r\n        if (buffer) {\r\n            const source = offlineCtx.createBufferSource();\r\n            source.buffer = buffer;\r\n\r\n            const panner = offlineCtx.createStereoPanner();\r\n            panner.pan.value = (log.pan || 0) * 0.75;\r\n\r\n            source.connect(panner);\r\n            panner.connect(offlineCtx.destination);\r\n            \r\n            const startTime = log.frame / fps;\r\n            source.start(startTime);\r\n        }\r\n    });\r\n\r\n    const renderedBuffer = await offlineCtx.startRendering();\r\n\r\n    // WAV 다운로드\r\n    this.downloadWav(renderedBuffer);\r\n\r\n    // MP4 인코딩\r\n    const chunkSize = 4096; \r\n    const lengthSamples = renderedBuffer.length;\r\n    const numberOfChannels = renderedBuffer.numberOfChannels;\r\n\r\n    for (let frame = 0; frame < lengthSamples; frame += chunkSize) {\r\n        const size = Math.min(chunkSize, lengthSamples - frame);\r\n        const planarData = new Float32Array(size * numberOfChannels);\r\n        \r\n        for (let ch = 0; ch < numberOfChannels; ch++) {\r\n            const channelData = renderedBuffer.getChannelData(ch);\r\n            planarData.set(channelData.subarray(frame, frame + size), ch * size);\r\n        }\r\n\r\n        const audioData = new AudioData({\r\n            format: 'f32-planar',\r\n            sampleRate: sampleRate,\r\n            numberOfChannels: numberOfChannels,\r\n            numberOfFrames: size,\r\n            timestamp: (frame / sampleRate) * 1_000_000,\r\n            data: planarData\r\n        });\r\n\r\n        this.audioEncoder.encode(audioData);\r\n        audioData.close();\r\n    }\r\n\r\n    await this.audioEncoder.flush();\r\n  }\r\n\r\n  saveFile(buffer) {\r\n    const blob = new Blob([buffer], { type: 'video/mp4' });\r\n    const url = URL.createObjectURL(blob);\r\n    \r\n    const d = new Date();\r\n    const dateStr = `${d.getFullYear()}${String(d.getMonth() + 1).padStart(2, '0')}${String(d.getDate()).padStart(2, '0')}`;\r\n    const timeStr = `${String(d.getHours()).padStart(2, '0')}${String(d.getMinutes()).padStart(2, '0')}`;\r\n    let filename = `${dateStr}_${timeStr}_pikavolley_replay.mp4`;\r\n    \r\n    if (this.pikaVolley.nicknames && this.pikaVolley.nicknames.length === 2) {\r\n        const n1 = this.pikaVolley.nicknames[0].replace(/[/\\\\?%*:|\"<>]/g, '_');\r\n        const n2 = this.pikaVolley.nicknames[1].replace(/[/\\\\?%*:|\"<>]/g, '_');\r\n        filename = `${dateStr}_${timeStr}_${n1}_vs_${n2}.mp4`;\r\n    }\r\n\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = filename;\r\n    a.click();\r\n    \r\n    this.updateStatus('완료!');\r\n    const recordBtn = document.getElementById('record-btn');\r\n    // @ts-ignore\r\n    if (recordBtn) recordBtn.disabled = false;\r\n    const loadingOverlay = document.getElementById('loading-overlay');\r\n    // @ts-ignore\r\n    if (loadingOverlay) loadingOverlay.classList.add('hidden');\r\n    \r\n    setTimeout(() => {\r\n        URL.revokeObjectURL(url);\r\n        this.muxer = null;\r\n        this.videoEncoder = null;\r\n        this.audioEncoder = null;\r\n        this.audioLog = [];\r\n    }, 1000);\r\n  }\r\n\r\n  drawOverlaysOnCanvas() {\r\n    // @ts-ignore\r\n    const ctx = this.renderer.view.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    ctx.save();\r\n    \r\n    const leftX = 148;\r\n    const rightX = 284;\r\n    const nicknameY = 10;\r\n    const ipY = 25;\r\n\r\n    // 닉네임 & IP 표시 (DOM에서 읽기)\r\n    const p1Nick = document.getElementById('player1-nickname')?.textContent || '';\r\n    const p1IP = document.getElementById('player1-partial-ip')?.textContent || '';\r\n    const p2Nick = document.getElementById('player2-nickname')?.textContent || '';\r\n    const p2IP = document.getElementById('player2-partial-ip')?.textContent || '';\r\n\r\n    // Player 1\r\n    if (p1Nick) {\r\n        ctx.font = 'bold 12px \"Segoe UI\", sans-serif';\r\n        ctx.textAlign = 'center';\r\n        ctx.textBaseline = 'top';\r\n        ctx.fillStyle = 'white';\r\n        ctx.strokeStyle = 'black';\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeText(p1Nick, leftX, nicknameY);\r\n        ctx.fillText(p1Nick, leftX, nicknameY);\r\n        \r\n        if (p1IP) {\r\n            ctx.font = '8px sans-serif';\r\n            ctx.lineWidth = 1;\r\n            ctx.strokeText(p1IP, leftX, ipY);\r\n            ctx.fillText(p1IP, leftX, ipY);\r\n        }\r\n    }\r\n\r\n    // Player 2\r\n    if (p2Nick) {\r\n        ctx.font = 'bold 12px \"Segoe UI\", sans-serif';\r\n        ctx.textAlign = 'center';\r\n        ctx.textBaseline = 'top';\r\n        ctx.fillStyle = 'white';\r\n        ctx.strokeStyle = 'black';\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeText(p2Nick, rightX, nicknameY);\r\n        ctx.fillText(p2Nick, rightX, nicknameY);\r\n        \r\n        if (p2IP) {\r\n            ctx.font = '8px sans-serif';\r\n            ctx.lineWidth = 1;\r\n            ctx.strokeText(p2IP, rightX, ipY);\r\n            ctx.fillText(p2IP, rightX, ipY);\r\n        }\r\n    }\r\n\r\n    // 채팅 말풍선 그리기 (this.activeChats 사용)\r\n    if (this.activeChats.p1) {\r\n        this.drawChatBubble(ctx, this.activeChats.p1.message, leftX, 68);\r\n    }\r\n    if (this.activeChats.p2) {\r\n        this.drawChatBubble(ctx, this.activeChats.p2.message, rightX, 68);\r\n    }\r\n    \r\n    ctx.restore();\r\n  }\r\n\r\n  drawChatBubble(ctx, text, x, y) {\r\n      if (!text || text.trim() === '') return;\r\n      \r\n      ctx.font = '14px sans-serif';\r\n      ctx.textAlign = 'center';\r\n      \r\n      const textMetrics = ctx.measureText(text);\r\n      const width = textMetrics.width + 20;\r\n      const height = 30;\r\n\r\n      // 말풍선 배경\r\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n      ctx.fillRect(x - width / 2, y, width, height);\r\n      ctx.strokeStyle = 'black';\r\n      ctx.lineWidth = 2;\r\n      ctx.strokeRect(x - width / 2, y, width, height);\r\n\r\n      // 텍스트\r\n      ctx.fillStyle = 'black';\r\n      ctx.fillText(text, x, y + 8);\r\n  }\r\n\r\n  // WAV 다운로드\r\n  downloadWav(audioBuffer) {\r\n    const buffer = this.bufferToWave(audioBuffer, audioBuffer.length);\r\n    const blob = new Blob([buffer], { type: 'audio/wav' });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `pikavolley_audio_debug.wav`;\r\n    a.style.display = 'none';\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); }, 1000);\r\n  }\r\n\r\n  bufferToWave(abuffer, len) {\r\n    const numOfChan = abuffer.numberOfChannels;\r\n    const length = len * numOfChan * 2 + 44;\r\n    const buffer = new ArrayBuffer(length);\r\n    const view = new DataView(buffer);\r\n    const channels = [];\r\n    let i, sample, offset = 0, pos = 0;\r\n\r\n    setUint32(0x46464952); setUint32(length - 8); setUint32(0x45564157); \r\n    setUint32(0x20746d66); setUint32(16); setUint16(1); setUint16(numOfChan);\r\n    setUint32(abuffer.sampleRate); setUint32(abuffer.sampleRate * 2 * numOfChan); \r\n    setUint16(numOfChan * 2); setUint16(16); setUint32(0x61746164); setUint32(length - pos - 4); \r\n\r\n    for (i = 0; i < abuffer.numberOfChannels; i++) channels.push(abuffer.getChannelData(i));\r\n\r\n    while (pos < len) {\r\n      for (i = 0; i < numOfChan; i++) {\r\n        sample = Math.max(-1, Math.min(1, channels[i][pos])); \r\n        sample = (0.5 + sample < 0 ? sample * 32768 : sample * 32767) | 0; \r\n        view.setInt16(44 + offset, sample, true);\r\n        offset += 2;\r\n      }\r\n      pos++;\r\n    }\r\n    function setUint16(data) { view.setUint16(pos, data, true); pos += 2; }\r\n    function setUint32(data) { view.setUint32(pos, data, true); pos += 4; }\r\n    return buffer;\r\n  }\r\n}\r\n\r\nfunction adjustAssetsPath() {\r\n  const prefix = '../../';\r\n  if (!ASSETS_PATH.SPRITE_SHEET.startsWith(prefix)) {\r\n    const clean = (p) => p.replace(/^\\.\\.\\//, '');\r\n    ASSETS_PATH.SPRITE_SHEET = prefix + clean(ASSETS_PATH.SPRITE_SHEET);\r\n    for (const k in ASSETS_PATH.SOUNDS) ASSETS_PATH.SOUNDS[k] = prefix + clean(ASSETS_PATH.SOUNDS[k]);\r\n  }\r\n}\r\nadjustAssetsPath();\r\n\r\nconst converter = new OfflineConverter();\r\nconst recordBtn = document.getElementById('record-btn');\r\nif (recordBtn) {\r\n  recordBtn.addEventListener('click', () => converter.handleRecordButtonClick());\r\n}"],"names":["constructor","registerPlugin","settings","RESOLUTION","SCALE_MODE","NEAREST","ROUND_PIXELS","this","ticker","minFPS","renderer","width","height","antialias","backgroundColor","backgroundAlpha","forceCanvas","preserveDrawingBuffer","stage","loader","pikaVolley","playBackSpeedTimes","playBackSpeedFPS","readFile","file","TEXTURES","WITH_COMPUTER","WITH_FRIEND","document","querySelector","appendChild","view","render","add","showTimeCurrent","timeCurrent","gameLoop","replayFrameCounter","inputs","length","stop","window","dispatchEvent","Event","SPRITE_SHEET","prop","SOUNDS","loadingBox","getElementById","progressBar","onProgress","style","progress","onComplete","classList","setUpLoaderProgressBar","reader","FileReader","onload","event","packWithComment","pack","JSON","parse","target","result","hash","serialize","err","console","log","noticeFileOpenError","timeDuration","speedChangeRecord","optionsCounter","options","speed","fpsFromNowOn","frameCounter","push","currentFrameCounter","currentFPS","i","futureFrameCounter","getTotalTimeDuration","textContent","getTimeText","load","max","PikachuVolleyballReplay","resources","roomID","nicknames","partialPublicIPs","chats","scrubberRangeInput","seekFrame","start","playPauseBtn","started","adjustPlayPauseBtnIcon","disabled","seekBackward1Btn","seekForward1Btn","seekBackward3Btn","seekForward3Btn","speedBtn5FPS","speedBtnHalfTimes","speedBtn1Times","speedBtn2Times","readAsText","frameNumber","initializeForReplay","gameLoopSilent","seekRelativeTime","seconds","seekFrameCounter","Math","normalFPS","adjustPlaybackSpeedTimes","times","maxFPS","adjustFPSInputValue","adjustPlaybackSpeedFPS","fps","stopBGM","audio","sounds","bgm","center","playBGMProperly","isBGMPlaying","play","timeBGM","value","remove","time","floor","minutes","hours","String","slice","roomId","super","noInputFrameTotal","menu","Infinity","player1Keyboard","xDirection","yDirection","powerHit","getInput","player2Keyboard","keyboardArray","willDisplayChat","fakeSound","fakeAudio","fake","isPlaying","pipikachu","pika","chu","pi","pikachu","ballTouchesGround","chatCounter","customRng","rngForPlayer1Chat","rngForPlayer2Chat","game","cloudArray","wave","intro","visible","fadeInOut","physics","slowMotionFPS","SLOW_MOTION_FRAMES_NUM","slowMotionFramesLeft","slowMotionNumOfSkippedFrames","selectedWithWho","scores","winningScore","gameEnded","roundEnded","isPlayer2Serve","noInputFrameCounter","paused","isStereoSound","_isPracticeMode","isRoomCreatorPlayer2","state","usersInputNumber","player1Input","player2Input","zKey","rKey","vKey","dKey","gKey","enterKey","upKey","downKey","leftKey","rightKey","pressKeyElm","keyElm","unpressKeyElm","showKeyboardInputs","chat","player1","isComputer","player2","originalReplaceChild","Node","prototype","replaceChild","newChild","oldChild","call","e","e2","originalRemoveChild","removeChild","child","prefix","startsWith","clean","p","replace","k","adjustAssetsPath","converter","audioLog","decodedBuffers","totalDuration","activeChats","p1","p2","muxer","videoEncoder","audioEncoder","updateStatus","message","statusEl","handleRecordButtonClick","fileInput","createElement","type","accept","onchange","files","loadReplayFile","click","originalHash","warn","initializeRenderer","error","container","innerHTML","ensureDOMElements","soundLoadPromises","audioCtx","AudioContext","webkitAudioContext","keyMapping","key","url","promise","fetch","then","res","arrayBuffer","buf","decodeAudioData","decoded","mappedKey","toLowerCase","Promise","all","startOfflineProcessing","forEach","id","el","display","originalGameLoop","bind","mockAudioSystem","totalFrames","video","codec","sampleRate","numberOfChannels","fastStart","VideoEncoder","output","chunk","meta","addVideoChunk","configure","bitrate","framerate","AudioEncoder","addAudioChunk","chatHead","encodeQueueSize","r","setTimeout","side","timer","drawOverlaysOnCanvas","bitmap","createImageBitmap","videoFrame","VideoFrame","timestamp","keyFrame","encode","close","percent","flush","synthesizeAndEncodeAudio","finalize","buffer","saveFile","turnBGMVolume","turnSFXVolume","fakeSounds","pan","currentFrame","frame","ceil","offlineCtx","OfflineAudioContext","source","createBufferSource","panner","createStereoPanner","connect","destination","startTime","renderedBuffer","startRendering","downloadWav","lengthSamples","size","min","planarData","Float32Array","ch","channelData","getChannelData","set","subarray","audioData","AudioData","format","numberOfFrames","data","blob","Blob","URL","createObjectURL","d","Date","dateStr","getFullYear","getMonth","padStart","getDate","timeStr","getHours","getMinutes","filename","a","href","download","recordBtn","loadingOverlay","revokeObjectURL","ctx","getContext","save","leftX","rightX","p1Nick","p1IP","p2Nick","p2IP","font","textAlign","textBaseline","fillStyle","strokeStyle","lineWidth","strokeText","fillText","drawChatBubble","restore","text","x","y","trim","measureText","fillRect","strokeRect","audioBuffer","bufferToWave","body","abuffer","len","numOfChan","ArrayBuffer","DataView","channels","sample","offset","pos","setUint32","setUint16","setInt16","addEventListener"],"sourceRoot":""}