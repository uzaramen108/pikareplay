{"version":3,"file":"main_out.e811b81287bc02770963.js","mappings":"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","sources":["webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay_download/replay_player.js","webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay_download/ui_replay.js","webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay_download/pikavolley_replay.js","webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay_download/main_out.js"],"sourcesContent":["'use strict';\nimport { settings } from '@pixi/settings';\nimport { SCALE_MODES } from '@pixi/constants';\nimport { Renderer, BatchRenderer, autoDetectRenderer } from '@pixi/core';\nimport { Prepare } from '@pixi/prepare';\nimport { Container } from '@pixi/display';\nimport { Loader } from '@pixi/loaders';\nimport { SpritesheetLoader } from '@pixi/spritesheet';\nimport { Ticker } from '@pixi/ticker';\nimport { CanvasRenderer } from '@pixi/canvas-renderer';\nimport { CanvasSpriteRenderer } from '@pixi/canvas-sprite';\nimport { CanvasPrepare } from '@pixi/canvas-prepare';\nimport '@pixi/canvas-display';\nimport { ASSETS_PATH } from '../offline_version_js/assets_path.js';\nimport { PikachuVolleyballReplay } from './pikavolley_replay.js';\nimport { setGetSpeechBubbleNeeded, hideChat } from '../chat_display.js';\nimport {\n  setMaxForScrubberRange,\n  adjustPlayPauseBtnIcon,\n  showTotalTimeDuration,\n  showTimeCurrent,\n  enableReplayScrubberAndBtns,\n  hideNoticeEndOfReplay,\n  noticeFileOpenError,\n  adjustFPSInputValue,\n} from './ui_replay.js';\nimport '../../style.css';\nimport { serialize } from '../utils/serialize.js';\nimport { getHashCode } from '../utils/hash_code.js';\n\nclass ReplayPlayer {\n  constructor() {\n    // Reference for how to use Renderer.registerPlugin:\n    // https://github.com/pixijs/pixijs/blob/af3c0c6bb15aeb1049178c972e4a14bb4cabfce4/bundles/pixi.js/src/index.ts#L27-L34\n    Renderer.registerPlugin('prepare', Prepare);\n    Renderer.registerPlugin('batch', BatchRenderer);\n    // Reference for how to use CanvasRenderer.registerPlugin:\n    // https://github.com/pixijs/pixijs/blob/af3c0c6bb15aeb1049178c972e4a14bb4cabfce4/bundles/pixi.js-legacy/src/index.ts#L13-L19\n    CanvasRenderer.registerPlugin('prepare', CanvasPrepare);\n    CanvasRenderer.registerPlugin('sprite', CanvasSpriteRenderer);\n    Loader.registerPlugin(SpritesheetLoader);\n    settings.RESOLUTION = 2;\n    settings.SCALE_MODE = SCALE_MODES.NEAREST;\n    settings.ROUND_PIXELS = true;\n\n    this.ticker = new Ticker();\n    this.ticker.minFPS = 1;\n    this.renderer = autoDetectRenderer({\n      width: 432,\n      height: 304,\n      antialias: false,\n      backgroundColor: 0x000000,\n      backgroundAlpha: 1,\n      forceCanvas: true,\n      preserveDrawingBuffer: true,\n    });\n    this.stage = new Container();\n    this.loader = new Loader();\n    this.pikaVolley = null;\n    this.playBackSpeedTimes = 1;\n    this.playBackSpeedFPS = null;\n  }\n\n  readFile(file) {\n    // To show two \"with friend\" on the menu\n    const TEXTURES = ASSETS_PATH.TEXTURES;\n    TEXTURES.WITH_COMPUTER = TEXTURES.WITH_FRIEND;\n\n    document\n      .querySelector('#game-canvas-container')\n      .appendChild(this.renderer.view);\n\n    this.renderer.render(this.stage); // To make the initial canvas painting stable in the Firefox browser.\n    this.ticker.add(() => {\n      // Redering and gameLoop order is the opposite of\n      // the offline web version (refer: ./offline_version_js/main.js).\n      // It's for the smooth rendering for the online version\n      // which gameLoop can not always succeed right on this \"ticker.add\"ed code\n      // because of the transfer delay or connection status. (If gameLoop here fails,\n      // it is recovered by the callback gameLoop which is called after peer input received.)\n      // Now the rendering is delayed 40ms (when pikaVolley.normalFPS == 25)\n      // behind gameLoop.\n      this.renderer.render(this.stage);\n      showTimeCurrent(this.pikaVolley.timeCurrent);\n      this.pikaVolley.gameLoop();\n    });\n\n    if (this.pikaVolley.replayFrameCounter >= this.pikaVolley.inputs.length) {\n      this.ticker.stop(); // 루프 정지\n      window.dispatchEvent(new Event('pikaReplayFinished')); // 외부로 종료 신호 발송\n    }\n\n    this.loader.add(ASSETS_PATH.SPRITE_SHEET);\n    for (const prop in ASSETS_PATH.SOUNDS) {\n      this.loader.add(ASSETS_PATH.SOUNDS[prop]);\n    }\n    setUpLoaderProgressBar(this.loader);\n\n    const reader = new FileReader();\n    reader.onload = (event) => {\n      let packWithComment;\n      let pack;\n      try {\n        // @ts-ignore\n        packWithComment = JSON.parse(event.target.result);\n        pack = packWithComment.pack;\n        const hash = pack.hash;\n        pack.hash = 0;\n        if (hash !== getHashCode(serialize(pack))) {\n          throw 'Error: The file content is not matching the hash code';\n        }\n      } catch (err) {\n        console.log(err);\n        noticeFileOpenError();\n        return;\n      }\n      showTotalTimeDuration(getTotalTimeDuration(pack));\n      this.loader.load(() => {\n        this.pikaVolley = new PikachuVolleyballReplay(\n          this.stage,\n          this.loader.resources,\n          pack.roomID,\n          pack.nicknames,\n          pack.partialPublicIPs,\n          pack.inputs,\n          pack.options,\n          pack.chats\n        );\n        // @ts-ignore\n        setGetSpeechBubbleNeeded(this.pikaVolley);\n        setMaxForScrubberRange(pack.inputs.length);\n        this.seekFrame(0);\n        this.ticker.start();\n        adjustPlayPauseBtnIcon();\n        enableReplayScrubberAndBtns();\n\n        window.dispatchEvent(new Event('pikaReplayLoaded'));\n      });\n    };\n    try {\n      reader.readAsText(file);\n    } catch (err) {\n      console.log(err);\n      noticeFileOpenError();\n      return;\n    }\n  }\n\n  /**\n   * Seek the specific frame\n   * @param {number} frameNumber\n   */\n  seekFrame(frameNumber) {\n    hideChat();\n    hideNoticeEndOfReplay();\n    this.ticker.stop();\n\n    // Cleanup previous pikaVolley\n    this.pikaVolley.initializeForReplay();\n\n    if (frameNumber > 0) {\n      for (let i = 0; i < frameNumber; i++) {\n        this.pikaVolley.gameLoopSilent();\n      }\n      this.renderer.render(this.stage);\n    }\n    showTimeCurrent(this.pikaVolley.timeCurrent);\n  }\n\n  /**\n   * Seek forward/backward the relative time (seconds).\n   * @param {number} seconds plus value for seeking forward, minus value for seeking backward\n   */\n  seekRelativeTime(seconds) {\n    const seekFrameCounter = Math.max(\n      0,\n      this.pikaVolley.replayFrameCounter + seconds * this.pikaVolley.normalFPS\n    );\n    this.seekFrame(seekFrameCounter);\n  }\n\n  /**\n   * Adjust playback speed by times\n   * @param {number} times\n   */\n  adjustPlaybackSpeedTimes(times) {\n    this.playBackSpeedFPS = null;\n    this.playBackSpeedTimes = times;\n    this.ticker.maxFPS = this.pikaVolley.normalFPS * this.playBackSpeedTimes;\n    adjustFPSInputValue();\n  }\n\n  /**\n   * Adjust playback speed by fps\n   * @param {number} fps\n   */\n  adjustPlaybackSpeedFPS(fps) {\n    this.playBackSpeedTimes = null;\n    this.playBackSpeedFPS = fps;\n    this.ticker.maxFPS = this.playBackSpeedFPS;\n    adjustFPSInputValue();\n  }\n\n  stopBGM() {\n    this.pikaVolley.audio.sounds.bgm.center.stop();\n  }\n\n  playBGMProperly() {\n    if (this.pikaVolley.isBGMPlaying) {\n      this.pikaVolley.audio.sounds.bgm.center.play({\n        start: this.pikaVolley.timeBGM,\n      });\n    }\n  }\n}\n\nexport const replayPlayer = new ReplayPlayer();\n\n/**\n * Set ticker.maxFPS according to PikachuVolleyball object's normalFPS properly\n * @param {number} normalFPS\n */\nexport function setTickerMaxFPSAccordingToNormalFPS(normalFPS) {\n  if (replayPlayer.playBackSpeedFPS) {\n    replayPlayer.ticker.maxFPS = replayPlayer.playBackSpeedFPS;\n    adjustFPSInputValue();\n  } else if (replayPlayer.playBackSpeedTimes) {\n    replayPlayer.ticker.maxFPS = normalFPS * replayPlayer.playBackSpeedTimes;\n    adjustFPSInputValue();\n  }\n}\n\n/**\n * Set up the loader progress bar.\n * @param {Loader} loader\n */\nfunction setUpLoaderProgressBar(loader) {\n  const loadingBox = document.getElementById('loading-box');\n  const progressBar = document.getElementById('progress-bar');\n\n  loader.onProgress.add(() => {\n    progressBar.style.width = `${loader.progress}%`;\n  });\n  loader.onComplete.add(() => {\n    loadingBox.classList.add('hidden');\n  });\n}\n\n/**\n * Get total time duration for the pack\n * @param {Object} pack\n */\nfunction getTotalTimeDuration(pack) {\n  const speedChangeRecord = [];\n\n  let optionsCounter = 0;\n  let options = pack.options[optionsCounter];\n  while (options) {\n    if (options[1].speed) {\n      let fpsFromNowOn = null;\n      switch (options[1].speed) {\n        case 'slow':\n          fpsFromNowOn = 20;\n          break;\n        case 'medium':\n          fpsFromNowOn = 25;\n          break;\n        case 'fast':\n          fpsFromNowOn = 30;\n          break;\n      }\n      const frameCounter = options[0];\n      speedChangeRecord.push([frameCounter, fpsFromNowOn]);\n    }\n    optionsCounter++;\n    options = pack.options[optionsCounter];\n  }\n\n  let timeDuration = 0; // unit: second\n  let currentFrameCounter = 0;\n  let currentFPS = 25;\n  for (let i = 0; i < speedChangeRecord.length; i++) {\n    const futureFrameCounter = speedChangeRecord[i][0];\n    const futureFPS = speedChangeRecord[i][1];\n    timeDuration += (futureFrameCounter - currentFrameCounter) / currentFPS;\n    currentFrameCounter = futureFrameCounter;\n    currentFPS = futureFPS;\n  }\n  timeDuration += (pack.inputs.length - currentFrameCounter) / currentFPS;\n\n  return timeDuration;\n}\n","import { replayPlayer } from './replay_player.js';\nimport { enableChat, hideChat } from '../chat_display.js';\nimport '../../style.css';\n\n/** @typedef {import('../offline_version_js/physics.js').PikaUserInput} PikaUserInput */\n\nlet pausedByBtn = false;\n\nconst scrubberRangeInput = document.getElementById('scrubber-range-input');\nconst playPauseBtn = document.getElementById('play-pause-btn');\nconst seekBackward1Btn = document.getElementById('seek-backward-1');\nconst seekForward1Btn = document.getElementById('seek-forward-1');\nconst seekBackward3Btn = document.getElementById('seek-backward-3');\nconst seekForward3Btn = document.getElementById('seek-forward-3');\nconst speedBtn5FPS = document.getElementById('speed-btn-5-fps');\nconst speedBtnHalfTimes = document.getElementById('speed-btn-half-times');\nconst speedBtn1Times = document.getElementById('speed-btn-1-times');\nconst speedBtn2Times = document.getElementById('speed-btn-2-times');\n\nexport function setUpUI() {\n  disableReplayScrubberAndBtns();\n\n  // File input code is from: https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications\n  const fileInputElement = document.getElementById('file-input');\n  fileInputElement.addEventListener('change', (e) => {\n    document.getElementById('loading-box').classList.remove('hidden');\n    dropbox.classList.add('hidden');\n    // @ts-ignore\n    handleFiles(e.target.files);\n  });\n\n  // Dropbox code is from: https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications\n  const dropbox = document.getElementById('dropbox');\n  dropbox.addEventListener('dragenter', dragenter, false);\n  dropbox.addEventListener('dragover', dragover, false);\n  dropbox.addEventListener('drop', drop, false);\n  function dragenter(e) {\n    e.stopPropagation();\n    e.preventDefault();\n  }\n  function dragover(e) {\n    e.stopPropagation();\n    e.preventDefault();\n  }\n  function drop(e) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    const dt = e.dataTransfer;\n    const files = dt.files;\n\n    document.getElementById('loading-box').classList.remove('hidden');\n    dropbox.classList.add('hidden');\n\n    handleFiles(files);\n  }\n  function handleFiles(files) {\n    replayPlayer.readFile(files[0]);\n  }\n\n  scrubberRangeInput.addEventListener('touchstart', () => {\n    if (replayPlayer.ticker.started) {\n      replayPlayer.ticker.stop();\n      replayPlayer.stopBGM();\n    }\n  });\n  scrubberRangeInput.addEventListener('mousedown', () => {\n    if (replayPlayer.ticker.started) {\n      replayPlayer.ticker.stop();\n      replayPlayer.stopBGM();\n    }\n  });\n  scrubberRangeInput.addEventListener('touchend', () => {\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\n      replayPlayer.ticker.start();\n      replayPlayer.playBGMProperly();\n    }\n  });\n  scrubberRangeInput.addEventListener('mouseup', () => {\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\n      replayPlayer.ticker.start();\n      replayPlayer.playBGMProperly();\n    }\n  });\n  scrubberRangeInput.addEventListener('input', (e) => {\n    // @ts-ignore\n    replayPlayer.seekFrame(Number(e.currentTarget.value));\n  });\n\n  // @ts-ignore\n  playPauseBtn.disabled = true;\n  playPauseBtn.addEventListener('click', () => {\n    if (replayPlayer.ticker.started) {\n      replayPlayer.ticker.stop();\n      replayPlayer.stopBGM();\n      pausedByBtn = true;\n      adjustPlayPauseBtnIcon();\n    } else {\n      replayPlayer.ticker.start();\n      replayPlayer.playBGMProperly();\n      pausedByBtn = false;\n      adjustPlayPauseBtnIcon();\n    }\n  });\n\n  seekBackward1Btn.addEventListener('click', () => {\n    replayPlayer.seekRelativeTime(-1);\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\n      replayPlayer.ticker.start();\n      replayPlayer.playBGMProperly();\n    }\n  });\n  seekForward1Btn.addEventListener('click', () => {\n    replayPlayer.seekRelativeTime(1);\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\n      replayPlayer.ticker.start();\n      replayPlayer.playBGMProperly();\n    }\n  });\n  seekBackward3Btn.addEventListener('click', () => {\n    replayPlayer.seekRelativeTime(-3);\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\n      replayPlayer.ticker.start();\n      replayPlayer.playBGMProperly();\n    }\n  });\n  seekForward3Btn.addEventListener('click', () => {\n    replayPlayer.seekRelativeTime(3);\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\n      replayPlayer.ticker.start();\n      replayPlayer.playBGMProperly();\n    }\n  });\n\n  speedBtn5FPS.addEventListener('click', (e) => {\n    processSelected(e);\n    replayPlayer.adjustPlaybackSpeedFPS(5);\n  });\n  speedBtnHalfTimes.addEventListener('click', (e) => {\n    processSelected(e);\n    replayPlayer.adjustPlaybackSpeedTimes(0.5);\n  });\n  speedBtn1Times.addEventListener('click', (e) => {\n    processSelected(e);\n    replayPlayer.adjustPlaybackSpeedTimes(1);\n  });\n  speedBtn2Times.addEventListener('click', (e) => {\n    processSelected(e);\n    replayPlayer.adjustPlaybackSpeedTimes(2);\n  });\n  function processSelected(e) {\n    unselectSpeedBtns();\n    // @ts-ignore\n    e.currentTarget.classList.add('selected');\n  }\n  function unselectSpeedBtns() {\n    for (const btn of [\n      speedBtn5FPS,\n      speedBtnHalfTimes,\n      speedBtn1Times,\n      speedBtn2Times,\n    ]) {\n      btn.classList.remove('selected');\n    }\n  }\n\n  const fpsInput = document.getElementById('fps-input');\n  fpsInput.addEventListener('change', (e) => {\n    // @ts-ignore\n    let value = e.target.value;\n    if (value < 0) {\n      value = 0;\n    } else if (value > 60) {\n      value = 60;\n    }\n    replayPlayer.adjustPlaybackSpeedFPS(value);\n    unselectSpeedBtns();\n  });\n\n  const noticeBoxEndOfReplayOKBtn = document.getElementById(\n    'notice-end-of-replay-ok-btn'\n  );\n  noticeBoxEndOfReplayOKBtn.addEventListener('click', () => {\n    location.reload();\n  });\n\n  const noticeBoxFileErrorOKBtn = document.getElementById(\n    'notice-file-open-error-ok-btn'\n  );\n  noticeBoxFileErrorOKBtn.addEventListener('click', () => {\n    location.reload();\n  });\n\n  const keyboardContainer = document.getElementById('keyboard-container');\n  const showKeyboardCheckbox = document.getElementById(\n    'show-keyboard-checkbox'\n  );\n  showKeyboardCheckbox.addEventListener('change', () => {\n    // @ts-ignore\n    if (showKeyboardCheckbox.checked) {\n      keyboardContainer.classList.remove('hidden');\n    } else {\n      keyboardContainer.classList.add('hidden');\n    }\n  });\n\n  const showChatCheckbox = document.getElementById('show-chat-checkbox');\n  showChatCheckbox.addEventListener('change', () => {\n    // @ts-ignore\n    if (showChatCheckbox.checked) {\n      enableChat(true);\n    } else {\n      enableChat(false);\n      hideChat();\n    }\n  });\n\n  const showNicknamesCheckbox = document.getElementById(\n    'show-nicknames-checkbox'\n  );\n  const player1NicknameElem = document.getElementById('player1-nickname');\n  const player2NicknameElem = document.getElementById('player2-nickname');\n  showNicknamesCheckbox.addEventListener('change', () => {\n    // @ts-ignore\n    if (showNicknamesCheckbox.checked) {\n      player1NicknameElem.classList.remove('hidden');\n      player2NicknameElem.classList.remove('hidden');\n    } else {\n      player1NicknameElem.classList.add('hidden');\n      player2NicknameElem.classList.add('hidden');\n    }\n  });\n\n  const showIPsCheckbox = document.getElementById('show-ip-addresses-checkbox');\n  const player1IPElem = document.getElementById('player1-partial-ip');\n  const player2IPElem = document.getElementById('player2-partial-ip');\n  showIPsCheckbox.addEventListener('change', () => {\n    // @ts-ignore\n    if (showIPsCheckbox.checked) {\n      player1IPElem.classList.remove('hidden');\n      player2IPElem.classList.remove('hidden');\n    } else {\n      player1IPElem.classList.add('hidden');\n      player2IPElem.classList.add('hidden');\n    }\n  });\n\n  const turnOnBGMCheckbox = document.getElementById('turn-on-bgm-checkbox');\n  turnOnBGMCheckbox.addEventListener('change', () => {\n    if (replayPlayer.pikaVolley === null) {\n      return;\n    }\n    // @ts-ignore\n    if (turnOnBGMCheckbox.checked) {\n      replayPlayer.pikaVolley.audio.turnBGMVolume(true);\n    } else {\n      replayPlayer.pikaVolley.audio.turnBGMVolume(false);\n    }\n  });\n\n  const turnOnSFXCheckbox = document.getElementById('turn-on-sfx-checkbox');\n  turnOnSFXCheckbox.addEventListener('change', () => {\n    if (replayPlayer.pikaVolley === null) {\n      return;\n    }\n    // @ts-ignore\n    if (turnOnSFXCheckbox.checked) {\n      replayPlayer.pikaVolley.audio.turnSFXVolume(true);\n    } else {\n      replayPlayer.pikaVolley.audio.turnSFXVolume(false);\n    }\n  });\n\n  const graphicSharpCheckbox = document.getElementById(\n    'graphic-sharp-checkbox'\n  );\n  graphicSharpCheckbox.addEventListener('change', () => {\n    if (replayPlayer.pikaVolley === null) {\n      return;\n    }\n    // @ts-ignore\n    if (graphicSharpCheckbox.checked) {\n      document\n        .querySelector('#game-canvas-container>canvas')\n        .classList.remove('graphic-soft');\n    } else {\n      document\n        .querySelector('#game-canvas-container>canvas')\n        .classList.add('graphic-soft');\n    }\n  });\n\n  window.addEventListener('keydown', (event) => {\n    if (event.code === 'Space') {\n      event.preventDefault();\n      playPauseBtn.click();\n    } else if (event.code === 'ArrowLeft') {\n      event.preventDefault();\n      seekBackward3Btn.click();\n    } else if (event.code === 'ArrowRight') {\n      event.preventDefault();\n      seekForward3Btn.click();\n    }\n  });\n}\n\nexport function adjustFPSInputValue() {\n  const fpsInput = document.getElementById('fps-input');\n  // @ts-ignore\n  fpsInput.value = replayPlayer.ticker.maxFPS;\n}\n\nexport function adjustPlayPauseBtnIcon() {\n  const playPauseBtn = document.getElementById('play-pause-btn');\n  if (replayPlayer.ticker.started) {\n    playPauseBtn.textContent =\n      document.getElementById('pause-mark').textContent;\n  } else {\n    playPauseBtn.textContent = document.getElementById('play-mark').textContent;\n  }\n}\n\nexport function noticeEndOfReplay() {\n  const noticeBoxEndOfReplay = document.getElementById('notice-end-of-replay');\n  noticeBoxEndOfReplay.classList.remove('hidden');\n}\n\nexport function hideNoticeEndOfReplay() {\n  const noticeBoxEndOfReplay = document.getElementById('notice-end-of-replay');\n  noticeBoxEndOfReplay.classList.add('hidden');\n}\n\nexport function noticeFileOpenError() {\n  const noticeBoxFileOpenError = document.getElementById(\n    'notice-file-open-error'\n  );\n  noticeBoxFileOpenError.classList.remove('hidden');\n}\n\nexport function getCommentText() {\n  return document.getElementById('replay-viewer-at').textContent;\n}\n\nexport function setMaxForScrubberRange(max) {\n  // @ts-ignore\n  scrubberRangeInput.max = max;\n}\n\nexport function moveScrubberTo(value) {\n  // @ts-ignore\n  scrubberRangeInput.value = value;\n}\n\n/**\n *\n * @param {number} timeCurrent unit: second\n */\nexport function showTimeCurrent(timeCurrent) {\n  document.getElementById('time-current').textContent =\n    getTimeText(timeCurrent);\n}\n\n/**\n *\n * @param {number} timeDuration unit: second\n */\nexport function showTotalTimeDuration(timeDuration) {\n  document.getElementById('time-duration').textContent =\n    getTimeText(timeDuration);\n}\n\n/**\n * Show Keyboard inputs\n * @param {PikaUserInput} player1Input\n * @param {PikaUserInput} player2Input\n */\nexport function showKeyboardInputs(player1Input, player2Input) {\n  const zKey = document.getElementById('z-key');\n  const rKey = document.getElementById('r-key');\n  const vKey = document.getElementById('v-key');\n  const dKey = document.getElementById('d-key');\n  const gKey = document.getElementById('g-key');\n\n  const enterKey = document.getElementById('enter-key');\n  const upKey = document.getElementById('up-key');\n  const downKey = document.getElementById('down-key');\n  const leftKey = document.getElementById('left-key');\n  const rightKey = document.getElementById('right-key');\n\n  function pressKeyElm(keyElm) {\n    keyElm.classList.add('pressed');\n  }\n\n  function unpressKeyElm(keyElm) {\n    keyElm.classList.remove('pressed');\n  }\n\n  switch (player1Input.xDirection) {\n    case 0:\n      unpressKeyElm(dKey);\n      unpressKeyElm(gKey);\n      break;\n    case -1:\n      pressKeyElm(dKey);\n      unpressKeyElm(gKey);\n      break;\n    case 1:\n      unpressKeyElm(dKey);\n      pressKeyElm(gKey);\n      break;\n  }\n  switch (player1Input.yDirection) {\n    case 0:\n      unpressKeyElm(rKey);\n      unpressKeyElm(vKey);\n      break;\n    case -1:\n      pressKeyElm(rKey);\n      unpressKeyElm(vKey);\n      break;\n    case 1:\n      unpressKeyElm(rKey);\n      pressKeyElm(vKey);\n      break;\n  }\n  switch (player1Input.powerHit) {\n    case 0:\n      unpressKeyElm(zKey);\n      break;\n    case 1:\n      pressKeyElm(zKey);\n      break;\n  }\n\n  switch (player2Input.xDirection) {\n    case 0:\n      unpressKeyElm(leftKey);\n      unpressKeyElm(rightKey);\n      break;\n    case -1:\n      pressKeyElm(leftKey);\n      unpressKeyElm(rightKey);\n      break;\n    case 1:\n      unpressKeyElm(leftKey);\n      pressKeyElm(rightKey);\n      break;\n  }\n  switch (player2Input.yDirection) {\n    case 0:\n      unpressKeyElm(upKey);\n      unpressKeyElm(downKey);\n      break;\n    case -1:\n      pressKeyElm(upKey);\n      unpressKeyElm(downKey);\n      break;\n    case 1:\n      unpressKeyElm(upKey);\n      pressKeyElm(downKey);\n      break;\n  }\n  switch (player2Input.powerHit) {\n    case 0:\n      unpressKeyElm(enterKey);\n      break;\n    case 1:\n      pressKeyElm(enterKey);\n      break;\n  }\n}\n\nexport function enableReplayScrubberAndBtns() {\n  // @ts-ignore\n  scrubberRangeInput.disabled = false;\n  // @ts-ignore\n  playPauseBtn.disabled = false;\n  // @ts-ignore\n  seekBackward1Btn.disabled = false;\n  // @ts-ignore\n  seekForward1Btn.disabled = false;\n  // @ts-ignore\n  seekBackward3Btn.disabled = false;\n  // @ts-ignore\n  seekForward3Btn.disabled = false;\n  // @ts-ignore\n  speedBtn5FPS.disabled = false;\n  // @ts-ignore\n  speedBtnHalfTimes.disabled = false;\n  // @ts-ignore\n  speedBtn1Times.disabled = false;\n  // @ts-ignore\n  speedBtn2Times.disabled = false;\n}\n\nfunction disableReplayScrubberAndBtns() {\n  // @ts-ignore\n  scrubberRangeInput.disabled = true;\n  // @ts-ignore\n  playPauseBtn.disabled = true;\n  // @ts-ignore\n  seekBackward1Btn.disabled = true;\n  // @ts-ignore\n  seekForward1Btn.disabled = true;\n  // @ts-ignore\n  seekBackward3Btn.disabled = true;\n  // @ts-ignore\n  seekForward3Btn.disabled = true;\n  // @ts-ignore\n  speedBtn5FPS.disabled = true;\n  // @ts-ignore\n  speedBtnHalfTimes.disabled = true;\n  // @ts-ignore\n  speedBtn1Times.disabled = true;\n  // @ts-ignore\n  speedBtn2Times.disabled = true;\n}\n\n/**\n *\n * @param {number} time unit: second\n */\nfunction getTimeText(time) {\n  const seconds = Math.floor(time % 60);\n  const minutes = Math.floor(time / 60) % 60;\n  const hours = Math.floor(Math.floor(time / 60) / 60);\n\n  if (hours > 0) {\n    return `${String(hours)}:${('0' + minutes).slice(-2)}:${(\n      '0' + seconds\n    ).slice(-2)}`;\n  } else {\n    return `${String(minutes)}:${('0' + seconds).slice(-2)}`;\n  }\n}\n","import seedrandom from 'seedrandom';\nimport { PikachuVolleyball } from '../offline_version_js/pikavolley.js';\nimport { setCustomRng } from '../offline_version_js/rand.js';\nimport { setChatRngs, displayChatMessageAt } from '../chat_display.js';\nimport {\n  displayNicknameFor,\n  displayPartialIPFor,\n} from '../nickname_display.js';\nimport { Cloud, Wave } from '../offline_version_js/cloud_and_wave.js';\nimport { PikaPhysics } from '../offline_version_js/physics.js';\nimport { convert5bitNumberToUserInput } from '../utils/input_conversion.js';\nimport {\n  noticeEndOfReplay,\n  moveScrubberTo,\n  showKeyboardInputs,\n} from './ui_replay.js';\nimport { setTickerMaxFPSAccordingToNormalFPS } from './replay_player.js';\n\n/** @typedef GameState @type {function():void} */\n\n/**\n * Class representing Pikachu Volleyball Replay\n */\n// @ts-ignore\nexport class PikachuVolleyballReplay extends PikachuVolleyball {\n  constructor(\n    stage,\n    resources,\n    roomId,\n    nicknames,\n    partialPublicIPs,\n    inputs,\n    options,\n    chats\n  ) {\n    super(stage, resources);\n    this.noInputFrameTotal.menu = Infinity;\n\n    this.roomId = roomId;\n    this.nicknames = nicknames;\n    this.partialPublicIPs = partialPublicIPs;\n    this.inputs = inputs;\n    this.options = options;\n    this.chats = chats;\n    this.player1Keyboard = {\n      xDirection: 0,\n      yDirection: 0,\n      powerHit: 0,\n      getInput: () => {},\n    };\n    this.player2Keyboard = {\n      xDirection: 0,\n      yDirection: 0,\n      powerHit: 0,\n      getInput: () => {},\n    };\n    this.keyboardArray = [this.player1Keyboard, this.player2Keyboard];\n    this.willDisplayChat = true;\n\n    const fakeSound = {\n      play: () => {},\n      stop: () => {},\n    };\n    const fakeBGM = {\n      fake: true,\n      center: {\n        isPlaying: false,\n      },\n      play: function () {\n        this.center.isPlaying = true;\n      },\n      stop: function () {\n        this.center.isPlaying = false;\n      },\n    };\n    this.fakeAudio = {\n      sounds: {\n        bgm: fakeBGM,\n        pipikachu: fakeSound,\n        pika: fakeSound,\n        chu: fakeSound,\n        pi: fakeSound,\n        pikachu: fakeSound,\n        powerHit: fakeSound,\n        ballTouchesGround: fakeSound,\n      },\n    };\n\n    this.initializeForReplay();\n  }\n\n  /**\n   * This is mainly for reinitialization for reusing the PikachuVolleyballReplay object\n   */\n  initializeForReplay() {\n    // Stop if sounds are playing\n    for (const prop in this.audio.sounds) {\n      this.audio.sounds[prop].stop();\n    }\n\n    this.timeCurrent = 0; // unit: second\n    this.timeBGM = 0;\n    this.isBGMPlaying = false;\n    this.replayFrameCounter = 0;\n    this.chatCounter = 0;\n    this.optionsCounter = 0;\n\n    // Set the same RNG (used for the game) for both peers\n    const customRng = seedrandom.alea(this.roomId.slice(10));\n    setCustomRng(customRng);\n\n    // Set the same RNG (used for displaying chat messages) for both peers\n    const rngForPlayer1Chat = seedrandom.alea(this.roomId.slice(10, 15));\n    const rngForPlayer2Chat = seedrandom.alea(this.roomId.slice(15));\n    setChatRngs(rngForPlayer1Chat, rngForPlayer2Chat);\n\n    // Reinitialize things which needs exact RNG\n    this.view.game.cloudArray = [];\n    const NUM_OF_CLOUDS = 10;\n    for (let i = 0; i < NUM_OF_CLOUDS; i++) {\n      this.view.game.cloudArray.push(new Cloud());\n    }\n    this.view.game.wave = new Wave();\n    this.view.intro.visible = false;\n    this.view.menu.visible = false;\n    this.view.game.visible = false;\n    this.view.fadeInOut.visible = false;\n\n    this.physics = new PikaPhysics(true, true);\n\n    this.normalFPS = 25;\n    this.slowMotionFPS = 5;\n    this.SLOW_MOTION_FRAMES_NUM = 6;\n    this.slowMotionFramesLeft = 0;\n    this.slowMotionNumOfSkippedFrames = 0;\n    this.selectedWithWho = 0;\n    this.scores = [0, 0];\n    this.winningScore = 15;\n    this.gameEnded = false;\n    this.roundEnded = false;\n    this.isPlayer2Serve = false;\n    this.frameCounter = 0;\n    this.noInputFrameCounter = 0;\n\n    this.paused = false;\n    this.isStereoSound = true;\n    this._isPracticeMode = false;\n    this.isRoomCreatorPlayer2 = false;\n    this.state = this.intro;\n  }\n\n  /**\n   * Override the \"intro\" method in the super class.\n   * It is to ask for one more game with the peer after quick match game ends.\n   * @type {GameState}\n   */\n  intro() {\n    if (this.frameCounter === 0) {\n      this.selectedWithWho = 0;\n      if (this.nicknames) {\n        displayNicknameFor(this.nicknames[0], this.isRoomCreatorPlayer2);\n        displayNicknameFor(this.nicknames[1], !this.isRoomCreatorPlayer2);\n      }\n      if (this.partialPublicIPs) {\n        displayPartialIPFor(\n          this.partialPublicIPs[0],\n          this.isRoomCreatorPlayer2\n        );\n        displayPartialIPFor(\n          this.partialPublicIPs[1],\n          !this.isRoomCreatorPlayer2\n        );\n      }\n    }\n    super.intro();\n  }\n\n  /**\n   * Override the \"menu\" method in the super class.\n   * It changes \"am I player 1 or player 2\" setting accordingly.\n   * @type {GameState}\n   */\n  menu() {\n    const selectedWithWho = this.selectedWithWho;\n    super.menu();\n    if (this.selectedWithWho !== selectedWithWho) {\n      this.isRoomCreatorPlayer2 = !this.isRoomCreatorPlayer2;\n      if (this.nicknames) {\n        displayNicknameFor(this.nicknames[0], this.isRoomCreatorPlayer2);\n        displayNicknameFor(this.nicknames[1], !this.isRoomCreatorPlayer2);\n      }\n      if (this.partialPublicIPs) {\n        displayPartialIPFor(\n          this.partialPublicIPs[0],\n          this.isRoomCreatorPlayer2\n        );\n        displayPartialIPFor(\n          this.partialPublicIPs[1],\n          !this.isRoomCreatorPlayer2\n        );\n      }\n    }\n  }\n\n  /**\n   * Game loop which play no sound, display no chat, does not move scrubber\n   */\n  gameLoopSilent() {\n    const audio = this.audio;\n    this.willDisplayChat = false;\n    // @ts-ignore\n    this.audio = this.fakeAudio;\n    this.gameLoop();\n    this.willDisplayChat = true;\n    this.audio = audio;\n  }\n\n  /**\n   * Game loop\n   * This function should be called at regular intervals ( interval = (1 / FPS) second )\n   */\n  gameLoop() {\n    if (this.replayFrameCounter >= this.inputs.length) {\n      noticeEndOfReplay();\n      return;\n    }\n\n    moveScrubberTo(this.replayFrameCounter);\n\n    const usersInputNumber = this.inputs[this.replayFrameCounter];\n    const player1Input = convert5bitNumberToUserInput(usersInputNumber >>> 5);\n    const player2Input = convert5bitNumberToUserInput(\n      usersInputNumber % (1 << 5)\n    );\n    this.player1Keyboard.xDirection = player1Input.xDirection;\n    this.player1Keyboard.yDirection = player1Input.yDirection;\n    this.player1Keyboard.powerHit = player1Input.powerHit;\n    this.player2Keyboard.xDirection = player2Input.xDirection;\n    this.player2Keyboard.yDirection = player2Input.yDirection;\n    this.player2Keyboard.powerHit = player2Input.powerHit;\n    showKeyboardInputs(player1Input, player2Input);\n\n    let options = this.options[this.optionsCounter];\n    while (options && options[0] === this.replayFrameCounter) {\n      if (options[1].speed) {\n        switch (options[1].speed) {\n          case 'slow':\n            this.normalFPS = 20;\n            break;\n          case 'medium':\n            this.normalFPS = 25;\n            break;\n          case 'fast':\n            this.normalFPS = 30;\n            break;\n        }\n        setTickerMaxFPSAccordingToNormalFPS(this.normalFPS);\n      }\n      if (options[1].winningScore) {\n        switch (options[1].winningScore) {\n          case 5:\n            this.winningScore = 5;\n            break;\n          case 10:\n            this.winningScore = 10;\n            break;\n          case 15:\n            this.winningScore = 15;\n            break;\n        }\n      }\n      this.optionsCounter++;\n      options = this.options[this.optionsCounter];\n    }\n    this.timeCurrent += 1 / this.normalFPS;\n\n    this.isBGMPlaying = this.audio.sounds.bgm.center.isPlaying;\n    if (this.isBGMPlaying) {\n      this.timeBGM = (this.timeBGM + 1 / this.normalFPS) % 83; // 83 is total duration of bgm\n    } else {\n      this.timeBGM = 0;\n    }\n\n    let chat = this.chats[this.chatCounter];\n    while (chat && chat[0] === this.replayFrameCounter) {\n      if (this.willDisplayChat) {\n        displayChatMessageAt(chat[2], chat[1]);\n      }\n      this.chatCounter++;\n      chat = this.chats[this.chatCounter];\n    }\n\n    this.replayFrameCounter++;\n    this.physics.player1.isComputer = false;\n    this.physics.player2.isComputer = false;\n    super.gameLoop();\n  }\n}\n","/**\r\n * Main script for converting Pikachu Volleyball replay files to video\r\n * Real-time recording with MediaRecorder at 30 FPS\r\n * WITH EXTENSIVE DEBUGGING\r\n */\r\n'use strict';\r\nimport { settings } from '@pixi/settings';\r\nimport { SCALE_MODES } from '@pixi/constants';\r\nimport { Renderer, BatchRenderer, autoDetectRenderer } from '@pixi/core';\r\nimport { Prepare } from '@pixi/prepare';\r\nimport { Container } from '@pixi/display';\r\nimport { Loader } from '@pixi/loaders';\r\nimport { SpritesheetLoader } from '@pixi/spritesheet';\r\nimport { Ticker } from '@pixi/ticker';\r\nimport { CanvasRenderer } from '@pixi/canvas-renderer';\r\nimport { CanvasSpriteRenderer } from '@pixi/canvas-sprite';\r\nimport { CanvasPrepare } from '@pixi/canvas-prepare';\r\nimport '@pixi/canvas-display';\r\nimport { ASSETS_PATH } from '../offline_version_js/assets_path.js';\r\nimport { PikachuVolleyballReplay } from './pikavolley_replay.js';\r\nimport { setGetSpeechBubbleNeeded, enableChat } from '../chat_display.js';\r\nimport { serialize } from '../utils/serialize.js';\r\nimport { getHashCode } from '../utils/hash_code.js';\r\nimport '../../style.css';\r\n\r\nconsole.log('🎬 [INIT] main_out.js loaded');\r\n\r\n/**\r\n * Replay to Video Converter with MediaRecorder (Real-time recording)\r\n */\r\nclass ReplayToVideoConverter {\r\n  constructor() {\r\n    console.log('🎬 [CONSTRUCTOR] Creating ReplayToVideoConverter');\r\n    \r\n    // Setup PIXI\r\n    Renderer.registerPlugin('prepare', Prepare);\r\n    Renderer.registerPlugin('batch', BatchRenderer);\r\n    CanvasRenderer.registerPlugin('prepare', CanvasPrepare);\r\n    CanvasRenderer.registerPlugin('sprite', CanvasSpriteRenderer);\r\n    Loader.registerPlugin(SpritesheetLoader);\r\n    settings.RESOLUTION = 2;\r\n    settings.SCALE_MODE = SCALE_MODES.NEAREST;\r\n    settings.ROUND_PIXELS = true;\r\n\r\n    this.renderer = null;\r\n    this.stage = null;\r\n    this.loader = null;\r\n    this.ticker = null;\r\n    this.pikaVolley = null;\r\n    this.currentPack = null;\r\n    \r\n    this.mediaRecorder = null;\r\n    this.recordedChunks = [];\r\n    this.isRecording = false;\r\n\r\n    this.audioDest = null;\r\n    this.audioCtx = null;\r\n    \r\n    console.log('✅ [CONSTRUCTOR] ReplayToVideoConverter created');\r\n  }\r\n\r\n  updateStatus(message) {\r\n    const statusEl = document.getElementById('status');\r\n    console.log(`📝 [STATUS] ${message}`);\r\n    if (statusEl) {\r\n      statusEl.textContent = message;\r\n    }\r\n  }\r\n\r\n  handleRecordButtonClick() {\r\n    console.log('🔘 [BUTTON] Record button clicked');\r\n    \r\n    if (this.isRecording) {\r\n      console.warn('⚠️ [BUTTON] Already recording!');\r\n      this.updateStatus('이미 처리 중입니다...');\r\n      return;\r\n    }\r\n\r\n    console.log('📂 [BUTTON] Opening file picker...');\r\n    const fileInput = document.createElement('input');\r\n    fileInput.type = 'file';\r\n    fileInput.accept = '.txt';\r\n    fileInput.onchange = (e) => {\r\n      // @ts-ignore\r\n      const file = e.target.files[0];\r\n      console.log('📄 [FILE] File selected:', file?.name);\r\n      if (file) {\r\n        this.loadReplayFile(file);\r\n      }\r\n    };\r\n    fileInput.click();\r\n  }\r\n\r\n  loadReplayFile(file) {\r\n    console.log('📥 [LOAD] Loading replay file:', file.name);\r\n    this.updateStatus('리플레이 파일 로딩 중...');\r\n    \r\n    const recordBtn = document.getElementById('record-btn');\r\n    console.log('🔘 [LOAD] Record button element:', recordBtn);\r\n    // @ts-ignore\r\n    if (recordBtn) recordBtn.disabled = true;\r\n\r\n    // Show loading overlay\r\n    const loadingOverlay = document.getElementById('loading-overlay');\r\n    console.log('⏳ [LOAD] Loading overlay element:', loadingOverlay);\r\n    // @ts-ignore\r\n    if (loadingOverlay) {\r\n      loadingOverlay.classList.remove('hidden');\r\n      console.log('✅ [LOAD] Loading overlay shown');\r\n    }\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = (event) => {\r\n      console.log('📖 [LOAD] File read complete');\r\n      try {\r\n        // @ts-ignore\r\n        const packWithComment = JSON.parse(event.target.result);\r\n        console.log('📦 [LOAD] Pack parsed:', {\r\n          hasNicknames: !!packWithComment.pack?.nicknames,\r\n          nicknamesLength: packWithComment.pack?.nicknames?.length,\r\n          nicknames: packWithComment.pack?.nicknames,\r\n          hasIPs: !!packWithComment.pack?.partialPublicIPs,\r\n          IPs: packWithComment.pack?.partialPublicIPs,\r\n          hasChats: !!packWithComment.pack?.chats,\r\n          chatsLength: packWithComment.pack?.chats?.length,\r\n        });\r\n        \r\n        const pack = packWithComment.pack;\r\n        const hash = pack.hash;\r\n        pack.hash = 0;\r\n        if (hash !== getHashCode(serialize(pack))) {\r\n          throw new Error('파일 내용이 해시 코드와 일치하지 않습니다');\r\n        }\r\n        console.log('✅ [LOAD] Hash verification passed');\r\n        this.initializeRenderer(pack);\r\n      } catch (err) {\r\n        console.error('❌ [LOAD] Error loading file:', err);\r\n        // @ts-ignore\r\n        this.updateStatus('파일 로딩 실패: ' + err.message);\r\n        // @ts-ignore\r\n        if (recordBtn) recordBtn.disabled = false;\r\n        // @ts-ignore\r\n        if (loadingOverlay) loadingOverlay.classList.add('hidden');\r\n      }\r\n    };\r\n    reader.onerror = () => {\r\n      console.error('❌ [LOAD] File read error');\r\n      this.updateStatus('파일 읽기 실패');\r\n      // @ts-ignore\r\n      if (recordBtn) recordBtn.disabled = false;\r\n      // @ts-ignore\r\n      if (loadingOverlay) loadingOverlay.classList.add('hidden');\r\n    };\r\n    reader.readAsText(file);\r\n  }\r\n\r\n  initializeRenderer(pack) {\r\n    console.log('🎨 [RENDERER] Initializing renderer...');\r\n    this.updateStatus('게임 에셋 로딩 중...');\r\n    this.currentPack = pack;\r\n\r\n    // Setup renderer\r\n    this.renderer = autoDetectRenderer({\r\n      width: 432,\r\n      height: 304,\r\n      antialias: false,\r\n      backgroundColor: 0x000000,\r\n      backgroundAlpha: 1,\r\n      forceCanvas: true,\r\n      preserveDrawingBuffer: true,\r\n    });\r\n    console.log('✅ [RENDERER] Renderer created');\r\n\r\n    this.stage = new Container();\r\n    this.ticker = new Ticker();\r\n    this.ticker.minFPS = 1;\r\n    this.loader = new Loader();\r\n    console.log('✅ [RENDERER] Stage, ticker, loader created');\r\n\r\n    // Append canvas to container\r\n    const container = document.querySelector('#game-canvas-container');\r\n    console.log('📦 [RENDERER] Game container element:', container);\r\n    // @ts-ignore\r\n    container.innerHTML = '';\r\n    // @ts-ignore\r\n    container.appendChild(this.renderer.view);\r\n    console.log('✅ [RENDERER] Canvas appended to container');\r\n\r\n    // Setup assets\r\n    const TEXTURES = ASSETS_PATH.TEXTURES;\r\n    TEXTURES.WITH_COMPUTER = TEXTURES.WITH_FRIEND;\r\n\r\n    this.loader.add(ASSETS_PATH.SPRITE_SHEET);\r\n    for (const prop in ASSETS_PATH.SOUNDS) {\r\n      this.loader.add(ASSETS_PATH.SOUNDS[prop]);\r\n    }\r\n    console.log('✅ [RENDERER] Assets added to loader');\r\n\r\n    this.setupLoaderProgressBar();\r\n    this.loader.load(() => this.setupGame(pack));\r\n    console.log('🔄 [RENDERER] Loading assets...');\r\n  }\r\n\r\n  setupLoaderProgressBar() {\r\n    const progressBar = document.getElementById('progress-bar');\r\n    console.log('📊 [PROGRESS] Progress bar element:', progressBar);\r\n    if (progressBar) {\r\n      this.loader.onProgress.add(() => {\r\n        // @ts-ignore\r\n        progressBar.style.width = `${this.loader.progress}%`;\r\n      });\r\n    }\r\n  }\r\n\r\n  setupGame(pack) {\r\n    console.log('🎮 [GAME] Setting up game...');\r\n    console.log('📦 [GAME] Pack data:', {\r\n      nicknames: pack.nicknames,\r\n      IPs: pack.partialPublicIPs,\r\n      chatsCount: pack.chats?.length,\r\n      inputsCount: pack.inputs?.length,\r\n    });\r\n    this.updateStatus('게임 초기화 중...');\r\n\r\n    // CRITICAL: Create DOM elements if they don't exist\r\n    console.log('🔨 [DOM] Ensuring DOM elements exist...');\r\n    const container = document.getElementById('game-canvas-container');\r\n    if (container) {\r\n      // Create chat boxes if they don't exist\r\n      if (!document.getElementById('player1-chat-box')) {\r\n        const chatBox1 = document.createElement('div');\r\n        chatBox1.id = 'player1-chat-box';\r\n        chatBox1.className = 'chat-box pre-wrap';\r\n        container.appendChild(chatBox1);\r\n        console.log('✅ [DOM] Created player1-chat-box');\r\n      }\r\n      \r\n      if (!document.getElementById('player2-chat-box')) {\r\n        const chatBox2 = document.createElement('div');\r\n        chatBox2.id = 'player2-chat-box';\r\n        chatBox2.className = 'chat-box pre-wrap';\r\n        container.appendChild(chatBox2);\r\n        console.log('✅ [DOM] Created player2-chat-box');\r\n      }\r\n      \r\n      // Create nicknames container if it doesn't exist\r\n      if (!document.querySelector('.nicknames-container')) {\r\n        const nicknamesContainer = document.createElement('div');\r\n        nicknamesContainer.className = 'nicknames-container';\r\n        \r\n        // Player 1 side\r\n        const leftSide = document.createElement('div');\r\n        leftSide.className = 'nickname-and-partial-ip left';\r\n        const nick1 = document.createElement('span');\r\n        nick1.id = 'player1-nickname';\r\n        nick1.className = 'nickname';\r\n        const ip1 = document.createElement('span');\r\n        ip1.id = 'player1-partial-ip';\r\n        ip1.className = 'partial-ip';\r\n        leftSide.appendChild(nick1);\r\n        leftSide.appendChild(ip1);\r\n        \r\n        // Player 2 side\r\n        const rightSide = document.createElement('div');\r\n        rightSide.className = 'nickname-and-partial-ip right';\r\n        const nick2 = document.createElement('span');\r\n        nick2.id = 'player2-nickname';\r\n        nick2.className = 'nickname';\r\n        const ip2 = document.createElement('span');\r\n        ip2.id = 'player2-partial-ip';\r\n        ip2.className = 'partial-ip';\r\n        rightSide.appendChild(nick2);\r\n        rightSide.appendChild(ip2);\r\n        \r\n        nicknamesContainer.appendChild(leftSide);\r\n        nicknamesContainer.appendChild(rightSide);\r\n        container.appendChild(nicknamesContainer);\r\n        console.log('✅ [DOM] Created nicknames container');\r\n      }\r\n      \r\n      // Create chat disabled elements if they don't exist\r\n      if (!document.getElementById('player1-chat-disabled')) {\r\n        const chatDisabled1 = document.createElement('div');\r\n        chatDisabled1.id = 'player1-chat-disabled';\r\n        chatDisabled1.className = 'hidden';\r\n        container.appendChild(chatDisabled1);\r\n        console.log('✅ [DOM] Created player1-chat-disabled');\r\n      }\r\n      \r\n      if (!document.getElementById('player2-chat-disabled')) {\r\n        const chatDisabled2 = document.createElement('div');\r\n        chatDisabled2.id = 'player2-chat-disabled';\r\n        chatDisabled2.className = 'hidden';\r\n        container.appendChild(chatDisabled2);\r\n        console.log('✅ [DOM] Created player2-chat-disabled');\r\n      }\r\n    }\r\n    const safeDOMPatch = (elementId) => {\r\n        const el = document.getElementById(elementId);\r\n        if (!el) return;\r\n\r\n        // 1. replaceChild 안전하게 덮어쓰기\r\n        const originalReplaceChild = Node.prototype.replaceChild;\r\n        Node.prototype.replaceChild = function(newChild, oldChild) {\r\n            try {\r\n                return originalReplaceChild.call(this, newChild, oldChild);\r\n            } catch (e) {\r\n                // 에러 발생 시(예: oldChild가 없을 때) 교체 대신 그냥 추가(append)해서 채팅이 보이게 함\r\n                try {\r\n                    this.appendChild(newChild);\r\n                } catch (e2) {}\r\n                return newChild;\r\n            }\r\n        };\r\n\r\n        const originalRemoveChild = Node.prototype.removeChild;\r\n        Node.prototype.removeChild = function(child) {\r\n            try {\r\n                return originalRemoveChild.call(this, child);\r\n            } catch (e) {\r\n                // 없는데 지우라고 하면 조용히 무시\r\n                return null;\r\n            }\r\n        };\r\n    };\r\n\r\n    // 플레이어 1, 2 채팅창에 안전장치 적용\r\n    safeDOMPatch('player1-chat-box');\r\n    safeDOMPatch('player2-chat-box');\r\n    console.log('🛡️ [DOM] Chat box safety patch applied');\r\n    // Check DOM elements BEFORE creating game\r\n    console.log('🔍 [DOM] Checking DOM elements...');\r\n    const chatBox1 = document.getElementById('player1-chat-box');\r\n    const chatBox2 = document.getElementById('player2-chat-box');\r\n    const nick1 = document.getElementById('player1-nickname');\r\n    const nick2 = document.getElementById('player2-nickname');\r\n    const ip1 = document.getElementById('player1-partial-ip');\r\n    const ip2 = document.getElementById('player2-partial-ip');\r\n    const chatDisabled1 = document.getElementById('player1-chat-disabled');\r\n    const chatDisabled2 = document.getElementById('player2-chat-disabled');\r\n    \r\n    console.log('📋 [DOM] Chat boxes:', { chatBox1, chatBox2 });\r\n    console.log('📋 [DOM] Nicknames:', { nick1, nick2 });\r\n    console.log('📋 [DOM] IPs:', { ip1, ip2 });\r\n    console.log('📋 [DOM] Chat disabled:', { chatDisabled1, chatDisabled2 });\r\n\r\n    console.log('🎮 [GAME] Creating PikachuVolleyballReplay...');\r\n    this.pikaVolley = new PikachuVolleyballReplay(\r\n      this.stage,\r\n      this.loader.resources,\r\n      pack.roomID,\r\n      pack.nicknames,\r\n      pack.partialPublicIPs,\r\n      pack.inputs,\r\n      pack.options,\r\n      pack.chats\r\n    );\r\n    console.log('✅ [GAME] PikachuVolleyballReplay created');\r\n\r\n    // Set speech bubble function\r\n    console.log('💬 [GAME] Setting speech bubble function...');\r\n    try {\r\n      // @ts-ignore\r\n      setGetSpeechBubbleNeeded(this.pikaVolley);\r\n      console.log('✅ [GAME] Speech bubble function set');\r\n    } catch (err) {\r\n      console.error('❌ [GAME] Error setting speech bubble:', err);\r\n    }\r\n\r\n    // Enable chat display\r\n    console.log('💬 [GAME] Enabling chat display...');\r\n    this.pikaVolley.willDisplayChat = true;\r\n    try {\r\n      //enableChat(true);\r\n      console.log('✅ [GAME] Chat enabled');\r\n    } catch (err) {\r\n      console.error('❌ [GAME] Error enabling chat:', err);\r\n    }\r\n\r\n    // Enable nickname and IP display by checking checkboxes programmatically\r\n    console.log('☑️ [CHECKBOX] Activating checkboxes...');\r\n    const showNicknamesCheckbox = document.getElementById('show-nicknames-checkbox');\r\n    const showIPsCheckbox = document.getElementById('show-ip-addresses-checkbox');\r\n    const showChatCheckbox = document.getElementById('show-chat-checkbox');\r\n    \r\n    console.log('📋 [CHECKBOX] Checkbox elements:', {\r\n      nicknames: showNicknamesCheckbox,\r\n      ips: showIPsCheckbox,\r\n      chat: showChatCheckbox,\r\n    });\r\n    \r\n    if (showNicknamesCheckbox) {\r\n      console.log('☑️ [CHECKBOX] Activating nicknames checkbox...');\r\n      // @ts-ignore\r\n      showNicknamesCheckbox.checked = true;\r\n      showNicknamesCheckbox.dispatchEvent(new Event('change'));// @ts-ignore\r\n      console.log('✅ [CHECKBOX] Nicknames checkbox activated, checked:', showNicknamesCheckbox.checked);\r\n    } else {\r\n      console.warn('⚠️ [CHECKBOX] Nicknames checkbox not found!');\r\n    }\r\n    \r\n    if (showIPsCheckbox) {\r\n      console.log('☑️ [CHECKBOX] Activating IPs checkbox...');\r\n      // @ts-ignore\r\n      showIPsCheckbox.checked = true;\r\n      showIPsCheckbox.dispatchEvent(new Event('change'));// @ts-ignore\r\n      console.log('✅ [CHECKBOX] IPs checkbox activated, checked:', showIPsCheckbox.checked);\r\n    } else {\r\n      console.warn('⚠️ [CHECKBOX] IPs checkbox not found!');\r\n    }\r\n    \r\n    if (showChatCheckbox) {\r\n      console.log('☑️ [CHECKBOX] Activating chat checkbox...');\r\n      // @ts-ignore\r\n      showChatCheckbox.checked = true;\r\n      showChatCheckbox.dispatchEvent(new Event('change'));// @ts-ignore\r\n      console.log('✅ [CHECKBOX] Chat checkbox activated, checked:', showChatCheckbox.checked);\r\n    } else {\r\n      console.warn('⚠️ [CHECKBOX] Chat checkbox not found!');\r\n    }\r\n\r\n    // Check DOM elements AFTER checkbox activation\r\n    console.log('🔍 [DOM] Checking DOM elements AFTER checkbox activation...');\r\n    console.log('📋 [DOM] Nickname classes:', {\r\n      nick1: nick1?.className,\r\n      nick2: nick2?.className,\r\n    });\r\n    console.log('📋 [DOM] IP classes:', {\r\n      ip1: ip1?.className,\r\n      ip2: ip2?.className,\r\n    });\r\n\r\n    // Disable BGM completely\r\n    console.log('🔇 [AUDIO] Disabling BGM...');\r\n    this.pikaVolley.audio.turnBGMVolume(false);\r\n    if (this.pikaVolley.audio.sounds.bgm && this.pikaVolley.audio.sounds.bgm.center) {\r\n      this.pikaVolley.audio.sounds.bgm.center.stop();\r\n      // Override play method to prevent BGM\r\n      // @ts-ignore\r\n      this.pikaVolley.audio.sounds.bgm.center.play = function() {\r\n        console.log('🔇 [AUDIO] BGM play blocked');\r\n      };\r\n      // @ts-ignore\r\n      this.pikaVolley.audio.sounds.bgm.center.isPlaying = false;\r\n    }\r\n    console.log('✅ [AUDIO] BGM disabled');\r\n\r\n    // Enable SFX (sound effects)\r\n    console.log('🔊 [AUDIO] Enabling SFX...');\r\n    this.pikaVolley.audio.turnSFXVolume(true);\r\n    console.log('✅ [AUDIO] SFX enabled');\r\n\r\n    // Setup ticker for rendering\r\n    console.log('🔄 [TICKER] Setting up ticker...');\r\n    this.ticker.add(() => {\r\n        this.renderer.render(this.stage);\r\n        try {\r\n            if (this.pikaVolley) {\r\n                this.pikaVolley.gameLoop();\r\n            }\r\n        } catch (err) {\r\n            // 채팅 말풍선 에러(NotFoundError)가 나도 녹화는 계속되어야 함\r\n            console.warn('⚠️ [GAME LOOP ERROR] Ignored:', err);\r\n        }\r\n        this.drawOverlaysOnCanvas();\r\n    });\r\n    console.log('✅ [TICKER] Ticker set up');\r\n\r\n    setTimeout(() => this.startRecording(), 100);\r\n    console.log('⏰ [GAME] Recording will start in 100ms');\r\n  }\r\n\r\n  drawOverlaysOnCanvas() {\r\n    // @ts-ignore\r\n    const ctx = this.renderer.view.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    ctx.save();\r\n    ctx.font = 'bold 16px \"Segoe UI\", sans-serif';\r\n    ctx.textAlign = 'center';\r\n    ctx.textBaseline = 'top';\r\n\r\n    // HTML 요소에서 텍스트 내용 가져오기\r\n    const p1Nick = document.getElementById('player1-nickname')?.textContent || '';\r\n    const p1IP = document.getElementById('player1-partial-ip')?.textContent || '';\r\n    const p2Nick = document.getElementById('player2-nickname')?.textContent || '';\r\n    const p2IP = document.getElementById('player2-partial-ip')?.textContent || '';\r\n\r\n    // Player 1 (Left)\r\n    if (p1Nick) {\r\n        ctx.fillStyle = 'white';\r\n        ctx.strokeStyle = 'black';\r\n        ctx.lineWidth = 3;\r\n        ctx.strokeText(p1Nick, 50, 10);\r\n        ctx.fillText(p1Nick, 50, 10);\r\n        if (p1IP) {\r\n            ctx.font = '12px sans-serif';\r\n            ctx.strokeText(p1IP, 50, 30);\r\n            ctx.fillText(p1IP, 50, 30);\r\n        }\r\n    }\r\n\r\n    // Player 2 (Right)\r\n    if (p2Nick) {\r\n        ctx.font = 'bold 16px \"Segoe UI\", sans-serif';\r\n        ctx.strokeText(p2Nick, 432 - 50, 10);\r\n        ctx.fillText(p2Nick, 432 - 50, 10);\r\n        if (p2IP) {\r\n            ctx.font = '12px sans-serif';\r\n            ctx.strokeText(p2IP, 432 - 50, 30);\r\n            ctx.fillText(p2IP, 432 - 50, 30);\r\n        }\r\n    }\r\n\r\n    // 채팅 말풍선 그리기\r\n    this.drawChatBubble(ctx, 'player1-chat-box', 80, 60);\r\n    this.drawChatBubble(ctx, 'player2-chat-box', 432 - 80, 60);\r\n\r\n    ctx.restore();\r\n  }\r\n\r\n  drawChatBubble(ctx, elementId, x, y) {\r\n      const el = document.getElementById(elementId);\r\n      // 내용이 비어있으면 그리지 않음\r\n      if (!el || !el.textContent || el.textContent.trim() === '') return;\r\n\r\n      const text = el.textContent;\r\n      ctx.font = '14px sans-serif';\r\n      const textMetrics = ctx.measureText(text);\r\n      const width = textMetrics.width + 20;\r\n      const height = 30;\r\n\r\n      // 말풍선 배경\r\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n      ctx.fillRect(x - width / 2, y, width, height);\r\n      ctx.strokeStyle = 'black';\r\n      ctx.lineWidth = 1;\r\n      ctx.strokeRect(x - width / 2, y, width, height);\r\n\r\n      // 텍스트\r\n      ctx.fillStyle = 'black';\r\n      ctx.fillText(text, x, y + 6);\r\n  }\r\n\r\n  startRecording() {\r\n    console.log('🎥 [RECORD] Starting recording...');\r\n    this.updateStatus('녹화 준비 중...');\r\n    this.recordedChunks = [];\r\n    this.isRecording = true;\r\n\r\n    // @ts-ignore\r\n    const canvas = this.renderer.view;\r\n    console.log('🖼️ [RECORD] Canvas:', canvas);\r\n    \r\n    try {\r\n      // Create canvas stream at 30 FPS\r\n      const fps = 30;\r\n      // @ts-ignore\r\n      const canvasStream = canvas.captureStream(fps);\r\n      if (this.audioDest) {\r\n          const audioTrack = this.audioDest.stream.getAudioTracks()[0];\r\n          if (audioTrack) {\r\n              canvasStream.addTrack(audioTrack);\r\n              console.log('🔊 Audio track added to video stream');\r\n          }\r\n      }\r\n      console.log('📹 [RECORD] Canvas stream created at', fps, 'FPS');\r\n\r\n      // Setup MediaRecorder\r\n      let mimeType = 'video/webm;codecs=vp9';\r\n      if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n        console.warn('⚠️ [RECORD] VP9 not supported, trying VP8');\r\n        mimeType = 'video/webm;codecs=vp8';\r\n        if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n          console.warn('⚠️ [RECORD] VP8 not supported, using default webm');\r\n          mimeType = 'video/webm';\r\n        }\r\n      }\r\n      console.log('✅ [RECORD] Using codec:', mimeType);\r\n\r\n      this.mediaRecorder = new MediaRecorder(canvasStream, {\r\n        mimeType: mimeType,\r\n        videoBitsPerSecond: 2500000, // 2.5 Mbps\r\n      });\r\n      console.log('✅ [RECORD] MediaRecorder created');\r\n\r\n      this.mediaRecorder.ondataavailable = (e) => {\r\n        if (e.data.size > 0) {\r\n          this.recordedChunks.push(e.data);\r\n          console.log(`📦 [RECORD] Data chunk received: ${e.data.size} bytes, total chunks: ${this.recordedChunks.length}`);\r\n        }\r\n      };\r\n\r\n      this.mediaRecorder.onstop = () => {\r\n        console.log('⏹️ [RECORD] MediaRecorder stopped');\r\n        this.saveVideoFile();\r\n      };\r\n\r\n      this.mediaRecorder.onerror = (e) => {\r\n        console.error('❌ [RECORD] MediaRecorder error:', e);\r\n        this.updateStatus('녹화 중 에러 발생');\r\n        this.isRecording = false;\r\n        const recordBtn = document.getElementById('record-btn');\r\n        // @ts-ignore\r\n        if (recordBtn) recordBtn.disabled = false;\r\n      };\r\n\r\n      // Start recording\r\n      this.mediaRecorder.start(100); // Collect data every 100ms\r\n      console.log('▶️ [RECORD] MediaRecorder started');\r\n\r\n      // Start game ticker at 30 FPS\r\n      this.ticker.maxFPS = 30;\r\n      this.ticker.start();\r\n      console.log('▶️ [TICKER] Ticker started at 30 FPS');\r\n\r\n      this.updateStatus(`녹화 중... 0%`);\r\n      this.monitorProgress();\r\n      console.log('📊 [RECORD] Progress monitoring started');\r\n\r\n    } catch (err) {\r\n      console.error('❌ [RECORD] Error starting recording:', err);\r\n      // @ts-ignore\r\n      this.updateStatus('녹화 시작 실패: ' + err.message);\r\n      this.isRecording = false;\r\n      const recordBtn = document.getElementById('record-btn');\r\n      // @ts-ignore\r\n      if (recordBtn) recordBtn.disabled = false;\r\n    }\r\n  }\r\n\r\n  monitorProgress() {\r\n    const totalFrames = this.pikaVolley.inputs.length;\r\n    console.log('📊 [PROGRESS] Total frames:', totalFrames);\r\n    const progressBar = document.getElementById('progress-bar');\r\n    \r\n    const checkInterval = setInterval(() => {\r\n      if (!this.pikaVolley || !this.isRecording) {\r\n        console.log('⏹️ [PROGRESS] Stopping progress monitoring');\r\n        clearInterval(checkInterval);\r\n        return;\r\n      }\r\n\r\n      const currentFrame = this.pikaVolley.replayFrameCounter;\r\n      const progress = Math.floor((currentFrame / totalFrames) * 100);\r\n      \r\n      if (currentFrame % 100 === 0) {\r\n        console.log(`📊 [PROGRESS] Frame ${currentFrame}/${totalFrames} (${progress}%)`);\r\n      }\r\n      \r\n      this.updateStatus(`녹화 중... ${progress}%`);\r\n      if (progressBar) {\r\n        // @ts-ignore\r\n        progressBar.style.width = `${progress}%`;\r\n      }\r\n\r\n      if (currentFrame >= totalFrames) {\r\n        console.log('🏁 [PROGRESS] All frames processed');\r\n        clearInterval(checkInterval);\r\n        this.stopRecording();\r\n      }\r\n    }, 500);\r\n  }\r\n\r\n  stopRecording() {\r\n    if (!this.isRecording) {\r\n      console.log('⚠️ [STOP] Not recording, skipping stop');\r\n      return;\r\n    }\r\n\r\n    console.log('⏹️ [STOP] Stopping recording...');\r\n    this.updateStatus('녹화 완료, 파일 저장 중...');\r\n    this.ticker.stop();\r\n    console.log('⏹️ [STOP] Ticker stopped');\r\n    \r\n    if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {\r\n      console.log('⏹️ [STOP] Stopping MediaRecorder...');\r\n      this.mediaRecorder.stop();\r\n    } else {\r\n      console.log('⚠️ [STOP] MediaRecorder already inactive, saving directly');\r\n      this.saveVideoFile();\r\n    }\r\n  }\r\n\r\n  saveVideoFile() {\r\n    console.log('💾 [SAVE] Saving video file...');\r\n    console.log('📦 [SAVE] Recorded chunks:', this.recordedChunks.length);\r\n    \r\n    if (this.recordedChunks.length === 0) {\r\n      console.error('❌ [SAVE] No recorded data!');\r\n      this.updateStatus('녹화된 데이터가 없습니다');\r\n      this.isRecording = false;\r\n      const recordBtn = document.getElementById('record-btn');\r\n      // @ts-ignore\r\n      if (recordBtn) recordBtn.disabled = false;\r\n      return;\r\n    }\r\n\r\n    const blob = new Blob(this.recordedChunks, { type: 'video/webm' });\r\n    console.log('📦 [SAVE] Blob created:', blob.size, 'bytes');\r\n    const url = URL.createObjectURL(blob);\r\n    console.log('🔗 [SAVE] Object URL:', url);\r\n    \r\n    const d = new Date();\r\n    const dateStr = `${d.getFullYear()}${('0' + (d.getMonth() + 1)).slice(-2)}${('0' + d.getDate()).slice(-2)}`;\r\n    const timeStr = `${('0' + d.getHours()).slice(-2)}${('0' + d.getMinutes()).slice(-2)}`;\r\n    \r\n    let filename = `${dateStr}_${timeStr}_pikavolley_replay.webm`;\r\n    \r\n    const pack = this.currentPack;\r\n    if (pack && pack.nicknames && pack.nicknames.length === 2) {\r\n      const nick1 = pack.nicknames[0].replace(/[/\\\\?%*:|\"<>]/g, '_');\r\n      const nick2 = pack.nicknames[1].replace(/[/\\\\?%*:|\"<>]/g, '_');\r\n      filename = `${dateStr}_${timeStr}_${nick1}_vs_${nick2}.webm`;\r\n    }\r\n    console.log('📝 [SAVE] Filename:', filename);\r\n\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = filename;\r\n    a.style.display = 'none';\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    console.log('✅ [SAVE] Download triggered');\r\n    \r\n    setTimeout(() => {\r\n      document.body.removeChild(a);\r\n      URL.revokeObjectURL(url);\r\n      console.log('🧹 [SAVE] Cleanup complete');\r\n    }, 100);\r\n\r\n    this.updateStatus('완료! 다른 리플레이를 변환하려면 버튼을 다시 클릭하세요.');\r\n    this.isRecording = false;\r\n    const recordBtn = document.getElementById('record-btn');\r\n    // @ts-ignore\r\n    if (recordBtn) recordBtn.disabled = false;\r\n    this.recordedChunks = [];\r\n    \r\n    // Hide loading overlay\r\n    const loadingOverlay = document.getElementById('loading-overlay');\r\n    // @ts-ignore\r\n    if (loadingOverlay) loadingOverlay.classList.add('hidden');\r\n    console.log('✅ [SAVE] Complete!');\r\n  }\r\n}\r\n\r\n// Adjust assets path\r\nfunction adjustAssetsPath() {\r\n  console.log('🔧 [ASSETS] Adjusting assets path...');\r\n  ASSETS_PATH.SPRITE_SHEET = '../' + ASSETS_PATH.SPRITE_SHEET;\r\n  for (const prop in ASSETS_PATH.SOUNDS) {\r\n    ASSETS_PATH.SOUNDS[prop] = '../' + ASSETS_PATH.SOUNDS[prop];\r\n  }\r\n  console.log('✅ [ASSETS] Assets path adjusted');\r\n}\r\n\r\nadjustAssetsPath();\r\n\r\n// Initialize converter\r\nconsole.log('🎬 [INIT] Initializing converter...');\r\nconst converter = new ReplayToVideoConverter();\r\nconst recordBtn = document.getElementById('record-btn');\r\nconsole.log('🔘 [INIT] Record button:', recordBtn);\r\nif (recordBtn) {\r\n  recordBtn.addEventListener('click', () => converter.handleRecordButtonClick());\r\n  console.log('✅ [INIT] Record button listener attached');\r\n}\r\n\r\n// Setup UI event listeners for nickname/IP/chat display\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  console.log('📄 [DOM] DOMContentLoaded event fired');\r\n  \r\n  const showNicknamesCheckbox = document.getElementById('show-nicknames-checkbox');\r\n  const showIPsCheckbox = document.getElementById('show-ip-addresses-checkbox');\r\n  const showChatCheckbox = document.getElementById('show-chat-checkbox');\r\n  \r\n  const player1NicknameElem = document.getElementById('player1-nickname');\r\n  const player2NicknameElem = document.getElementById('player2-nickname');\r\n  const player1IPElem = document.getElementById('player1-partial-ip');\r\n  const player2IPElem = document.getElementById('player2-partial-ip');\r\n\r\n  console.log('🔍 [DOM] UI Elements:', {\r\n    showNicknamesCheckbox,\r\n    showIPsCheckbox,\r\n    showChatCheckbox,\r\n    player1NicknameElem,\r\n    player2NicknameElem,\r\n    player1IPElem,\r\n    player2IPElem,\r\n  });\r\n\r\n  if (showNicknamesCheckbox) {\r\n    showNicknamesCheckbox.addEventListener('change', () => {// @ts-ignore\r\n      console.log('☑️ [EVENT] Nicknames checkbox changed:', showNicknamesCheckbox.checked);\r\n      // @ts-ignore\r\n      if (showNicknamesCheckbox.checked) {\r\n        if (player1NicknameElem) {\r\n          player1NicknameElem.classList.remove('hidden');\r\n          console.log('✅ [EVENT] Player1 nickname shown');\r\n        }\r\n        if (player2NicknameElem) {\r\n          player2NicknameElem.classList.remove('hidden');\r\n          console.log('✅ [EVENT] Player2 nickname shown');\r\n        }\r\n      } else {\r\n        if (player1NicknameElem) player1NicknameElem.classList.add('hidden');\r\n        if (player2NicknameElem) player2NicknameElem.classList.add('hidden');\r\n      }\r\n    });\r\n    console.log('✅ [DOM] Nicknames checkbox listener attached');\r\n  }\r\n\r\n  if (showIPsCheckbox) {\r\n    showIPsCheckbox.addEventListener('change', () => {// @ts-ignore\r\n      console.log('☑️ [EVENT] IPs checkbox changed:', showIPsCheckbox.checked);\r\n      // @ts-ignore\r\n      if (showIPsCheckbox.checked) {\r\n        if (player1IPElem) {\r\n          player1IPElem.classList.remove('hidden');\r\n          console.log('✅ [EVENT] Player1 IP shown');\r\n        }\r\n        if (player2IPElem) {\r\n          player2IPElem.classList.remove('hidden');\r\n          console.log('✅ [EVENT] Player2 IP shown');\r\n        }\r\n      } else {\r\n        if (player1IPElem) player1IPElem.classList.add('hidden');\r\n        if (player2IPElem) player2IPElem.classList.add('hidden');\r\n      }\r\n    });\r\n    console.log('✅ [DOM] IPs checkbox listener attached');\r\n  }\r\n\r\n  if (showChatCheckbox) {\r\n    showChatCheckbox.addEventListener('change', () => {\r\n    // @ts-ignore\r\n      console.log('☑️ [EVENT] Chat checkbox changed:', showChatCheckbox.checked);\r\n      // @ts-ignore\r\n      if (showChatCheckbox.checked) {\r\n        console.log('💬 [EVENT] Enabling chat...');\r\n        try {\r\n          //enableChat(true);\r\n          console.log('✅ [EVENT] Chat enabled');\r\n        } catch (err) {\r\n          console.error('❌ [EVENT] Error enabling chat:', err);\r\n        }\r\n      } else {\r\n        console.log('🔇 [EVENT] Disabling chat...');\r\n        try {\r\n          //enableChat(false);\r\n          console.log('✅ [EVENT] Chat disabled');\r\n        } catch (err) {\r\n          console.error('❌ [EVENT] Error disabling chat:', err);\r\n        }\r\n      }\r\n    });\r\n    console.log('✅ [DOM] Chat checkbox listener attached');\r\n  }\r\n});\r\n\r\nconsole.log('✅ [INIT] main_out.js initialization complete');\r\n"],"names":["constructor","registerPlugin","settings","RESOLUTION","SCALE_MODE","NEAREST","ROUND_PIXELS","this","ticker","minFPS","renderer","width","height","antialias","backgroundColor","backgroundAlpha","forceCanvas","preserveDrawingBuffer","stage","loader","pikaVolley","playBackSpeedTimes","playBackSpeedFPS","readFile","file","TEXTURES","WITH_COMPUTER","WITH_FRIEND","document","querySelector","appendChild","view","render","add","showTimeCurrent","timeCurrent","gameLoop","replayFrameCounter","inputs","length","stop","window","dispatchEvent","Event","SPRITE_SHEET","prop","SOUNDS","loadingBox","getElementById","progressBar","onProgress","style","progress","onComplete","classList","setUpLoaderProgressBar","reader","FileReader","onload","event","packWithComment","pack","JSON","parse","target","result","hash","serialize","err","console","log","noticeFileOpenError","timeDuration","speedChangeRecord","optionsCounter","options","speed","fpsFromNowOn","frameCounter","push","currentFrameCounter","currentFPS","i","futureFrameCounter","getTotalTimeDuration","textContent","getTimeText","load","max","PikachuVolleyballReplay","resources","roomID","nicknames","partialPublicIPs","chats","scrubberRangeInput","seekFrame","start","playPauseBtn","started","adjustPlayPauseBtnIcon","disabled","seekBackward1Btn","seekForward1Btn","seekBackward3Btn","seekForward3Btn","speedBtn5FPS","speedBtnHalfTimes","speedBtn1Times","speedBtn2Times","readAsText","frameNumber","initializeForReplay","gameLoopSilent","seekRelativeTime","seconds","seekFrameCounter","Math","normalFPS","adjustPlaybackSpeedTimes","times","maxFPS","adjustFPSInputValue","adjustPlaybackSpeedFPS","fps","stopBGM","audio","sounds","bgm","center","playBGMProperly","isBGMPlaying","play","timeBGM","value","remove","time","floor","minutes","hours","String","slice","roomId","super","noInputFrameTotal","menu","Infinity","player1Keyboard","xDirection","yDirection","powerHit","getInput","player2Keyboard","keyboardArray","willDisplayChat","fakeSound","fakeAudio","fake","isPlaying","pipikachu","pika","chu","pi","pikachu","ballTouchesGround","chatCounter","customRng","rngForPlayer1Chat","rngForPlayer2Chat","game","cloudArray","wave","intro","visible","fadeInOut","physics","slowMotionFPS","SLOW_MOTION_FRAMES_NUM","slowMotionFramesLeft","slowMotionNumOfSkippedFrames","selectedWithWho","scores","winningScore","gameEnded","roundEnded","isPlayer2Serve","noInputFrameCounter","paused","isStereoSound","_isPracticeMode","isRoomCreatorPlayer2","state","usersInputNumber","player1Input","player2Input","zKey","rKey","vKey","dKey","gKey","enterKey","upKey","downKey","leftKey","rightKey","pressKeyElm","keyElm","unpressKeyElm","showKeyboardInputs","chat","player1","isComputer","player2","adjustAssetsPath","converter","currentPack","mediaRecorder","recordedChunks","isRecording","audioDest","audioCtx","updateStatus","message","statusEl","handleRecordButtonClick","warn","fileInput","createElement","type","accept","onchange","e","files","name","loadReplayFile","click","recordBtn","loadingOverlay","hasNicknames","nicknamesLength","hasIPs","IPs","hasChats","chatsLength","Error","initializeRenderer","error","onerror","container","innerHTML","setupLoaderProgressBar","setupGame","chatsCount","inputsCount","chatBox1","id","className","chatBox2","nicknamesContainer","leftSide","nick1","ip1","rightSide","nick2","ip2","chatDisabled1","chatDisabled2","safeDOMPatch","elementId","originalReplaceChild","Node","prototype","replaceChild","newChild","oldChild","call","e2","originalRemoveChild","removeChild","child","showNicknamesCheckbox","showIPsCheckbox","showChatCheckbox","ips","checked","turnBGMVolume","turnSFXVolume","drawOverlaysOnCanvas","setTimeout","startRecording","ctx","getContext","save","font","textAlign","textBaseline","p1Nick","p1IP","p2Nick","p2IP","fillStyle","strokeStyle","lineWidth","strokeText","fillText","drawChatBubble","restore","x","y","el","trim","text","measureText","fillRect","strokeRect","canvas","canvasStream","captureStream","audioTrack","stream","getAudioTracks","addTrack","mimeType","MediaRecorder","isTypeSupported","videoBitsPerSecond","ondataavailable","data","size","onstop","saveVideoFile","monitorProgress","totalFrames","checkInterval","setInterval","clearInterval","currentFrame","stopRecording","blob","Blob","url","URL","createObjectURL","d","Date","dateStr","getFullYear","getMonth","getDate","timeStr","getHours","getMinutes","filename","replace","a","href","download","display","body","revokeObjectURL","addEventListener","player1NicknameElem","player2NicknameElem","player1IPElem","player2IPElem"],"sourceRoot":""}