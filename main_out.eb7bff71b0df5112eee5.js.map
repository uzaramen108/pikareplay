{"version":3,"file":"main_out.eb7bff71b0df5112eee5.js","mappings":"2JAEA,MAAMA,EAAcC,SAASC,eAAe,iBACtCC,EAAYF,SAASC,eAAe,UAC1C,IAAIE,EACAC,EAAS,GAGbL,EAAYM,iBAAiB,UAAWC,IAEpC,MAAMC,EAAOD,EAAME,OAAOC,MAAM,GAC3BF,IAELL,EAAUQ,UAAY,sBAGtB,IAAaC,SAASJ,GAAK,IAI/BK,OAAOP,iBAAiB,oBAAoB,KAExC,MAAMQ,EAASb,SAASc,cAAc,iCAEtC,IAAKD,EAED,YADAX,EAAUQ,UAAY,0BAK1BN,EAAS,GAIT,MAAMW,EAASF,EAAOG,cAAc,IAGpC,IAAIC,EAAU,CAAEC,SAAU,0BACrBC,cAAcC,gBAAgBH,EAAQC,YACvCD,EAAU,CAAEC,SAAU,eAG1Bf,EAAgB,IAAIgB,cAAcJ,EAAQE,GAE1Cd,EAAckB,gBAAmBC,IACzBA,EAAEC,KAAKC,KAAO,GACdpB,EAAOqB,KAAKH,EAAEC,KAClB,EAGJpB,EAAcuB,OAAS,KACnBxB,EAAUQ,UAAY,yBACtB,MAAMiB,EAAO,IAAIC,KAAKxB,EAAQ,CAAEyB,KAAM,eAChCC,EAAMC,IAAIC,gBAAgBL,GAC1BM,EAAIjC,SAASkC,cAAc,KACjCD,EAAEE,MAAMC,QAAU,OAClBH,EAAEI,KAAOP,EAETG,EAAEK,SAAW,kBAAkBC,KAAKC,aACpCxC,SAASyC,KAAKC,YAAYT,GAC1BA,EAAEU,QAGFC,YAAW,KACP5C,SAASyC,KAAKI,YAAYZ,GAC1BrB,OAAOmB,IAAIe,gBAAgBhB,EAAI,GAChC,IAAI,EAGX3B,EAAc4C,QACd7C,EAAUQ,UAAY,4BACtBsC,QAAQC,IAAI,QAAQ,IAIxBrC,OAAOP,iBAAiB,sBAAsB,KACtCF,GAAyC,cAAxBA,EAAc+C,QAC/B/C,EAAcgD,OACdH,QAAQC,IAAI,SAChB,G","sources":["webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay/main_out.js"],"sourcesContent":["import { replayPlayer } from './replay_player.js';\r\n\r\nconst uploadInput = document.getElementById('replay-upload');\r\nconst statusDiv = document.getElementById('status');\r\nlet mediaRecorder;\r\nlet chunks = [];\r\n\r\n// 1. 파일 업로드 시 리플레이 로드 시작\r\nuploadInput.addEventListener('change', (event) => {\r\n    //@ts-ignore\r\n    const file = event.target.files[0];\r\n    if (!file) return;\r\n\r\n    statusDiv.innerText = \"리플레이 파일을 분석 중입니다...\";\r\n    \r\n    // replay_player.js의 readFile 함수 호출 -> 내부에서 로딩 후 'pikaReplayLoaded' 이벤트 발생시킴\r\n    replayPlayer.readFile(file);\r\n});\r\n\r\n// 2. 로딩 완료 신호를 받으면 녹화 설정 및 시작\r\nwindow.addEventListener('pikaReplayLoaded', () => {\r\n    // 주의: PixiJS가 캔버스를 생성한 후에 요소를 찾아야 함\r\n    const canvas = document.querySelector('#game-canvas-container canvas');\r\n    \r\n    if (!canvas) {\r\n        statusDiv.innerText = \"오류: 게임 캔버스를 찾을 수 없습니다.\";\r\n        return;\r\n    }\r\n\r\n    // 녹화 데이터 초기화\r\n    chunks = [];\r\n\r\n    // 60 FPS로 스트림 캡처 (게임 속도와 일치시키는 것이 좋음)\r\n    //@ts-ignore\r\n    const stream = canvas.captureStream(60); \r\n    \r\n    // 코덱 설정 (브라우저 호환성에 따라 vp9 또는 vp8 사용)\r\n    let options = { mimeType: 'video/webm; codecs=vp9' };\r\n    if (!MediaRecorder.isTypeSupported(options.mimeType)) {\r\n        options = { mimeType: 'video/webm' }; // 기본 설정으로 폴백\r\n    }\r\n\r\n    mediaRecorder = new MediaRecorder(stream, options);\r\n    \r\n    mediaRecorder.ondataavailable = (e) => {\r\n        if (e.data.size > 0) {\r\n            chunks.push(e.data);\r\n        }\r\n    };\r\n    \r\n    mediaRecorder.onstop = () => {\r\n        statusDiv.innerText = \"변환 완료! 파일 다운로드를 시작합니다.\";\r\n        const blob = new Blob(chunks, { type: 'video/webm' });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.style.display = 'none';\r\n        a.href = url;\r\n        // 파일명에 타임스탬프 추가\r\n        a.download = `pikachu_replay_${Date.now()}.webm`;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        \r\n        // 메모리 해제\r\n        setTimeout(() => {\r\n            document.body.removeChild(a);\r\n            window.URL.revokeObjectURL(url);\r\n        }, 100);\r\n    };\r\n\r\n    mediaRecorder.start();\r\n    statusDiv.innerText = \"녹화 중... (다른 탭으로 이동하지 마세요)\";\r\n    console.log(\"녹화 시작\");\r\n});\r\n\r\n// 3. 게임 종료 신호를 받으면 녹화 중지\r\nwindow.addEventListener('pikaReplayFinished', () => {\r\n    if (mediaRecorder && mediaRecorder.state === 'recording') {\r\n        mediaRecorder.stop();\r\n        console.log(\"녹화 완료\");\r\n    }\r\n});"],"names":["uploadInput","document","getElementById","statusDiv","mediaRecorder","chunks","addEventListener","event","file","target","files","innerText","readFile","window","canvas","querySelector","stream","captureStream","options","mimeType","MediaRecorder","isTypeSupported","ondataavailable","e","data","size","push","onstop","blob","Blob","type","url","URL","createObjectURL","a","createElement","style","display","href","download","Date","now","body","appendChild","click","setTimeout","removeChild","revokeObjectURL","start","console","log","state","stop"],"sourceRoot":""}