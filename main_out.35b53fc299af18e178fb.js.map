{"version":3,"file":"main_out.35b53fc299af18e178fb.js","mappings":"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","sources":["webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay_download/main_out.js"],"sourcesContent":["/**\r\n * Main script for converting Pikachu Volleyball replay files to video\r\n * OFFLINE RENDERING (High Speed)\r\n * - Resolution: Fixed 432x304\r\n * - Audio: Reconstructs stereo sound (FakeAudio Hooking)\r\n * - UI: Canvas rendering simulating CSS 'fade-inout' animation & speech bubble style\r\n * Uses 'mp4-muxer' library\r\n */\r\n'use strict';\r\nimport { settings } from '@pixi/settings';\r\nimport { SCALE_MODES } from '@pixi/constants';\r\nimport { Renderer, BatchRenderer, autoDetectRenderer } from '@pixi/core';\r\nimport { Prepare } from '@pixi/prepare';\r\nimport { Container } from '@pixi/display';\r\nimport { Loader } from '@pixi/loaders';\r\nimport { SpritesheetLoader } from '@pixi/spritesheet';\r\nimport { CanvasRenderer } from '@pixi/canvas-renderer';\r\nimport { CanvasSpriteRenderer } from '@pixi/canvas-sprite';\r\nimport { CanvasPrepare } from '@pixi/canvas-prepare';\r\nimport '@pixi/canvas-display';\r\nimport { ASSETS_PATH } from '../offline_version_js/assets_path.js';\r\nimport { PikachuVolleyballReplay } from '../replay/pikavolley_replay.js';\r\nimport { setGetSpeechBubbleNeeded } from '../chat_display.js';\r\nimport { serialize } from '../utils/serialize.js';\r\nimport { getHashCode } from '../utils/hash_code.js';\r\nimport seedrandom from 'seedrandom';\r\nimport '../../style.css';\r\n\r\nimport * as Mp4Muxer from 'mp4-muxer';\r\n\r\nconsole.log('üé¨ [INIT] Offline Renderer (CSS Animation Sync)');\r\n\r\n// [1] Ï†ÑÏó≠ DOM Ìå®Ïπò\r\nconst originalReplaceChild = Node.prototype.replaceChild;\r\nNode.prototype.replaceChild = function(newChild, oldChild) {\r\n    try { return originalReplaceChild.call(this, newChild, oldChild); } \r\n    catch (e) { try { this.appendChild(newChild); } catch (e2) {} return newChild; }\r\n};\r\nconst originalRemoveChild = Node.prototype.removeChild;\r\nNode.prototype.removeChild = function(child) {\r\n    try { return originalRemoveChild.call(this, child); } catch (e) { return null; }\r\n};\r\n\r\nclass OfflineConverter {\r\n  constructor() {\r\n    Renderer.registerPlugin('prepare', Prepare);\r\n    Renderer.registerPlugin('batch', BatchRenderer);\r\n    CanvasRenderer.registerPlugin('prepare', CanvasPrepare);\r\n    CanvasRenderer.registerPlugin('sprite', CanvasSpriteRenderer);\r\n    Loader.registerPlugin(SpritesheetLoader);\r\n    \r\n    settings.RESOLUTION = 1;\r\n    settings.SCALE_MODE = SCALE_MODES.NEAREST;\r\n    settings.ROUND_PIXELS = true;\r\n\r\n    this.renderer = null;\r\n    this.stage = null;\r\n    this.loader = null;\r\n    this.pikaVolley = null;\r\n    \r\n    this.audioLog = []; \r\n    this.decodedBuffers = {}; \r\n    this.totalDuration = 0;\r\n    \r\n    // Ï±ÑÌåÖ ÏÉÅÌÉú Í¥ÄÎ¶¨\r\n    this.chats = [];\r\n    this.chatHead = 0;\r\n    // { side, text, x, y, elapsed, duration }\r\n    this.activeBubbles = []; \r\n    this.rng = null;\r\n\r\n    this.muxer = null;\r\n    this.videoEncoder = null;\r\n    this.audioEncoder = null;\r\n    this.chatSizeSelect = null;\r\n    this.showNicknamesCheckbox = null;\r\n    this.showIPsCheckbox = null;\r\n    this.bgmCheckbox = null;\r\n    this.sfxCheckbox = null;\r\n    this.sharpGraphicsCheckbox = null;\r\n  }\r\n\r\n  updateUI() {\r\n    this.chatSizeSelect = document.getElementById('chat-size-select');\r\n    this.showNicknamesCheckbox = document.getElementById('show-nicknames-checkbox');\r\n    this.showIPsCheckbox = document.getElementById('show-ip-addresses-checkbox');\r\n    this.bgmCheckbox = document.getElementById('turn-on-bgm-checkbox');\r\n    this.sfxCheckbox = document.getElementById('turn-on-sfx-checkbox');\r\n    this.sharpGraphicsCheckbox = document.getElementById('graphic-sharp-checkbox');\r\n  }\r\n\r\n  updateStatus(message) {\r\n    const statusEl = document.getElementById('status');\r\n    if (statusEl) statusEl.textContent = message;\r\n    console.log(`üìù [STATUS] ${message}`);\r\n  }\r\n\r\n  handleRecordButtonClick() {\r\n    const fileInput = document.createElement('input');\r\n    fileInput.type = 'file';\r\n    fileInput.accept = '.txt';\r\n    fileInput.onchange = (e) => {\r\n      // @ts-ignore\r\n      const file = e.target.files[0];\r\n      if (file) this.loadReplayFile(file);\r\n    };\r\n    fileInput.click();\r\n  }\r\n\r\n  loadReplayFile(file) {\r\n    this.updateStatus('Î¶¨ÌîåÎ†àÏù¥ Î∂ÑÏÑù Ï§ë...');\r\n    const reader = new FileReader();\r\n    reader.onload = (event) => {\r\n      try {\r\n        // @ts-ignore\r\n        const packWithComment = JSON.parse(event.target.result);\r\n        const pack = packWithComment.pack;\r\n        \r\n        const originalHash = pack.hash;\r\n        pack.hash = 0;\r\n        if (originalHash !== getHashCode(serialize(pack))) {\r\n             console.warn('‚ö†Ô∏è Hash mismatch - ignored');\r\n        }\r\n        pack.hash = originalHash;\r\n        if (pack.options.rule == null) {\r\n            pack.options.rule = \"default\";\r\n        }\r\n\r\n        this.initializeRenderer(pack);\r\n      } catch (err) {\r\n        console.error('‚ùå Error:', err);\r\n        this.updateStatus('ÌååÏùº Î°úÎî© Ïã§Ìå®');\r\n      }\r\n    };\r\n    reader.readAsText(file);\r\n  }\r\n\r\n  initializeRenderer(pack) {\r\n    this.updateStatus('Î¶¨ÏÜåÏä§ Î∞è Ïò§ÎîîÏò§ ÎîîÏΩîÎî© Ï§ë...');\r\n    \r\n    this.renderer = autoDetectRenderer({\r\n      width: 432,\r\n      height: 304,\r\n      antialias: false,\r\n      backgroundColor: 0x000000,\r\n      forceCanvas: true,\r\n      preserveDrawingBuffer: true,\r\n    });\r\n\r\n    this.stage = new Container();\r\n    this.loader = new Loader();\r\n\r\n    const container = document.querySelector('#game-canvas-container');\r\n    // @ts-ignore\r\n    container.innerHTML = '';\r\n    // @ts-ignore\r\n    container.appendChild(this.renderer.view);\r\n    \r\n    this.ensureDOMElements(container); \r\n\r\n    this.loader.add(ASSETS_PATH.SPRITE_SHEET);\r\n    \r\n    const soundLoadPromises = [];\r\n    //@ts-ignore\r\n    const AudioContext = window.AudioContext || window.webkitAudioContext;\r\n    const audioCtx = new AudioContext();\r\n    \r\n    const keyMapping = {\r\n      'BGM': 'bgm', 'PIPIKACHU': 'pipikachu', 'PIKA': 'pika', 'CHU': 'chu',\r\n      'PI': 'pi', 'PIKACHU': 'pikachu', 'POWERHIT': 'powerHit', 'BALLTOUCHESGROUND': 'ballTouchesGround',\r\n    };\r\n\r\n    this.updateUI();\r\n    \r\n    for (const key in ASSETS_PATH.SOUNDS) {\r\n        const url = ASSETS_PATH.SOUNDS[key];\r\n        const promise = fetch(url)\r\n            .then(res => res.arrayBuffer())\r\n            .then(buf => audioCtx.decodeAudioData(buf))\r\n            .then(decoded => {\r\n                const mappedKey = keyMapping[key] || key.toLowerCase();\r\n                this.decodedBuffers[mappedKey] = decoded;\r\n            });\r\n        soundLoadPromises.push(promise);\r\n        this.loader.add(ASSETS_PATH.SOUNDS[key]);\r\n    }\r\n\r\n    Promise.all(soundLoadPromises).then(() => {\r\n        this.loader.load(() => this.startOfflineProcessing(pack));\r\n    });\r\n  }\r\n\r\n  ensureDOMElements(container) {\r\n    const ids = ['player1-nickname', 'player2-nickname', 'player1-partial-ip', 'player2-partial-ip'];\r\n    ids.forEach(id => {\r\n        let el = document.getElementById(id);\r\n        if (!el) {\r\n            el = document.createElement('div');\r\n            el.id = id;\r\n            el.style.display = 'none'; \r\n            container.appendChild(el);\r\n        } else {\r\n            el.textContent = '';\r\n        }\r\n    });\r\n  }\r\n\r\n  async startOfflineProcessing(pack) {\r\n    this.updateStatus('Ïò§ÌîÑÎùºÏù∏ Î†åÎçîÎßÅ ÏãúÏûë...');\r\n    \r\n    console.log(pack.options.rule);\r\n    this.pikaVolley = new PikachuVolleyballReplay(\r\n      this.stage,\r\n      this.loader.resources,\r\n      pack.roomID,\r\n      pack.nicknames,\r\n      pack.partialPublicIPs,\r\n      pack.inputs,\r\n      pack.options,\r\n      pack.chats\r\n    );\r\n\r\n    // [RNG] Ï±ÑÌåÖ ÏúÑÏπòÏö© (chat_display.jsÏôÄ ÎèôÏùºÌïú ÏãúÎìú ÏÇ¨Ïö©)\r\n    this.rng = seedrandom.alea(pack.roomID.slice(10));\r\n\r\n    this.chats = pack.chats || [];\r\n    this.chatHead = 0;\r\n    this.activeBubbles = [];\r\n\r\n    try {\r\n        // @ts-ignore\r\n        setGetSpeechBubbleNeeded(this.pikaVolley); \r\n    } catch(e){}\r\n    this.pikaVolley.willDisplayChat = true;\r\n\r\n    this.audioLog = [];\r\n    this.mockAudioSystem();\r\n\r\n    const fps = 30;\r\n    const totalFrames = pack.inputs.length;\r\n    this.totalDuration = totalFrames / fps;\r\n\r\n    // @ts-ignore\r\n    this.muxer = new Mp4Muxer.Muxer({\r\n        target: new Mp4Muxer.ArrayBufferTarget(),\r\n        video: { codec: 'avc', width: 432, height: 304 },\r\n        audio: { codec: 'aac', sampleRate: 44100, numberOfChannels: 2 },\r\n        fastStart: 'in-memory',\r\n    });\r\n\r\n    this.videoEncoder = new VideoEncoder({\r\n        output: (chunk, meta) => this.muxer.addVideoChunk(chunk, meta),\r\n        error: (e) => console.error('Video Error:', e)\r\n    });\r\n    this.videoEncoder.configure({\r\n        codec: 'avc1.42001f', \r\n        width: 432, \r\n        height: 304, \r\n        bitrate: 500_000,     // 500 kbps - Ïù¥ÎØ∏ Ï¢ãÏùå! (Îçî Ï§ÑÏù¥Î©¥ 400_000ÎèÑ Í∞ÄÎä•)\r\n        framerate: fps,\r\n    });\r\n\r\n    this.audioEncoder = new AudioEncoder({\r\n        output: (chunk, meta) => this.muxer.addAudioChunk(chunk, meta),\r\n        error: (e) => console.error('Audio Error:', e)\r\n    });\r\n    this.audioEncoder.configure({\r\n        codec: 'mp4a.40.2', \r\n        sampleRate: 44100,        // Ïú†ÏßÄ\r\n        numberOfChannels: 2,      // Ïú†ÏßÄ (Ïä§ÌÖåÎ†àÏò§)\r\n        bitrate: 96_000,          // ‚≠ê 128k ‚Üí 64k (50% Í∞êÏÜå)\r\n    });\r\n\r\n    const progressBar = document.getElementById('progress-bar');\r\n    \r\n    for (let i = 0; i < totalFrames; i++) {\r\n        if (this.videoEncoder.encodeQueueSize > 20) {\r\n            await new Promise(r => setTimeout(r, 10));\r\n        }\r\n\r\n        try {\r\n            this.pikaVolley.gameLoopSilent(); \r\n        } catch(e) {}\r\n\r\n        this.processChatFrame(i); // Ï±ÑÌåÖ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏\r\n\r\n        this.renderer.render(this.stage);\r\n        this.drawOverlaysOnCanvas();\r\n\r\n        // @ts-ignore\r\n        const bitmap = await createImageBitmap(this.renderer.view);\r\n        const videoFrame = new VideoFrame(bitmap, { timestamp: (i * 1000000) / fps });\r\n        \r\n        const keyFrame = i % 90 === 0;\r\n        this.videoEncoder.encode(videoFrame, { keyFrame });\r\n        videoFrame.close();\r\n\r\n        if (i % 30 === 0) {\r\n            const percent = Math.floor((i / totalFrames) * 100);\r\n            this.updateStatus(`ÏòÅÏÉÅ Ï≤òÎ¶¨ Ï§ë... ${percent}%`);\r\n            // @ts-ignore\r\n            if(progressBar) progressBar.style.width = `${percent}%`;\r\n            await new Promise(r => setTimeout(r, 0));\r\n        }\r\n    }\r\n\r\n    await this.videoEncoder.flush();\r\n    \r\n    this.updateStatus('Ïò§ÎîîÏò§ Ìï©ÏÑ± Ï§ë...');\r\n    await this.synthesizeAndEncodeAudio(fps);\r\n\r\n    this.muxer.finalize();\r\n    const buffer = this.muxer.target.buffer;\r\n    this.saveFile(buffer);\r\n  }\r\n\r\n  // [ÌïµÏã¨] CSS @keyframes fade-inout ÏãúÎÆ¨Î†àÏù¥ÏÖò\r\n  // 0%~25%: Fade In | 25%~75%: Visible | 75%~100%: Fade Out\r\n  // Duration: 5Ï¥à (30FPS Í∏∞Ï§Ä 150ÌîÑÎ†àÏûÑ)\r\n  processChatFrame(currentFrame) {\r\n      // 1. ÏÉà Ï±ÑÌåÖ ÌôïÏù∏\r\n      while (this.chatHead < this.chats.length && this.chats[this.chatHead][0] === currentFrame) {\r\n          const chat = this.chats[this.chatHead];\r\n          const side = chat[1]; \r\n          const message = chat[2];\r\n          \r\n          // ÏúÑÏπò Í≥ÑÏÇ∞ (chat_display.js Î°úÏßÅ ÌùâÎÇ¥)\r\n          const rand1 = this.rng();\r\n          const rand2 = this.rng();\r\n          const canvasW = 432;\r\n          const canvasH = 304;\r\n          \r\n          // Y Ï¢åÌëú: top 20% + 30% * rng\r\n          const y = canvasH * (0.20 + 0.30 * rand1);\r\n          let x;\r\n\r\n          if (side === 1) {\r\n              // P1: right 55% + 25% * rng -> left Ï¢åÌëúÎ°ú Î≥ÄÌôò\r\n              // right%Í∞Ä 55~80% Ïù¥Î©¥ left%Îäî 20~45%\r\n              const rightPct = 0.55 + 0.25 * rand2;\r\n              x = canvasW * (1 - rightPct); \r\n          } else {\r\n              // P2: left 55% + 25% * rng\r\n              const leftPct = 0.55 + 0.25 * rand2;\r\n              x = canvasW * leftPct;\r\n          }\r\n\r\n          // Í∏∞Ï°¥ ÎßêÌíçÏÑ† Ï§ë Í∞ôÏùÄ Ìé∏Ïù∏ Í≤É Ï†úÍ±∞\r\n          this.activeBubbles = this.activeBubbles.filter(b => b.side !== side);\r\n\r\n          this.activeBubbles.push({\r\n              side: side,\r\n              text: message,\r\n              x: x,\r\n              y: y,\r\n              elapsed: 0,\r\n              duration: 150 // 5Ï¥à * 30fps\r\n          });\r\n\r\n          this.chatHead++;\r\n      }\r\n\r\n      // 2. Ïï†ÎãàÎ©îÏù¥ÏÖò ÌîÑÎ†àÏûÑ ÏßÑÌñâ\r\n      for (let i = this.activeBubbles.length - 1; i >= 0; i--) {\r\n          const b = this.activeBubbles[i];\r\n          b.elapsed++;\r\n\r\n          // CSS fade-inout ÏãúÎÆ¨Î†àÏù¥ÏÖò\r\n          // 0~25%: Fade In\r\n          // 25~75%: Visible\r\n          // 75~100%: Fade Out\r\n          const progress = b.elapsed / b.duration;\r\n          \r\n          if (progress < 0.25) {\r\n              // 0 -> 1\r\n              b.alpha = progress / 0.25;\r\n          } else if (progress < 0.75) {\r\n              // 1 Ïú†ÏßÄ\r\n              b.alpha = 1.0;\r\n          } else {\r\n              // 1 -> 0\r\n              b.alpha = 1.0 - ((progress - 0.75) / 0.25);\r\n          }\r\n\r\n          if (b.elapsed >= b.duration) {\r\n              this.activeBubbles.splice(i, 1);\r\n          }\r\n      }\r\n  }\r\n\r\n  mockAudioSystem() {\r\n    //@ts-ignore\r\n    this.pikaVolley.audio.turnBGMVolume(false);\r\n    //@ts-ignore\r\n    this.pikaVolley.audio.turnSFXVolume(this.sfxCheckbox.checked);\r\n\r\n    const fakeSounds = this.pikaVolley.fakeAudio.sounds;\r\n    for (const key in fakeSounds) {\r\n        if (key === 'bgm') continue;\r\n        fakeSounds[key] = {\r\n            play: (pan = 0) => {\r\n                const currentFrame = this.pikaVolley.replayFrameCounter;\r\n                this.audioLog.push({ key, frame: currentFrame, pan });\r\n            },\r\n            stop: () => {}\r\n        };\r\n    }\r\n  }\r\n\r\n  async synthesizeAndEncodeAudio(fps) {\r\n    if (this.audioLog.length === 0) return;\r\n\r\n    const sampleRate = 44100;\r\n    const length = Math.ceil(this.totalDuration * sampleRate) + sampleRate; \r\n    const offlineCtx = new OfflineAudioContext(2, length, sampleRate);\r\n\r\n    this.audioLog.forEach(log => {\r\n        const buffer = this.decodedBuffers[log.key];\r\n        if (buffer) {\r\n            const source = offlineCtx.createBufferSource();\r\n            source.buffer = buffer;\r\n            const panner = offlineCtx.createStereoPanner();\r\n            panner.pan.value = (log.pan || 0) * 0.75;\r\n            source.connect(panner);\r\n            panner.connect(offlineCtx.destination);\r\n            source.start(log.frame / fps);\r\n        }\r\n    });\r\n\r\n    const renderedBuffer = await offlineCtx.startRendering();\r\n    this.downloadWav(renderedBuffer);\r\n\r\n    const chunkSize = 4096; \r\n    const lengthSamples = renderedBuffer.length;\r\n    const numberOfChannels = renderedBuffer.numberOfChannels;\r\n\r\n    for (let frame = 0; frame < lengthSamples; frame += chunkSize) {\r\n        const size = Math.min(chunkSize, lengthSamples - frame);\r\n        const planarData = new Float32Array(size * numberOfChannels);\r\n        for (let ch = 0; ch < numberOfChannels; ch++) {\r\n            const channelData = renderedBuffer.getChannelData(ch);\r\n            planarData.set(channelData.subarray(frame, frame + size), ch * size);\r\n        }\r\n        const audioData = new AudioData({\r\n            format: 'f32-planar', sampleRate, numberOfChannels, numberOfFrames: size,\r\n            timestamp: (frame / sampleRate) * 1_000_000, data: planarData\r\n        });\r\n        this.audioEncoder.encode(audioData);\r\n        audioData.close();\r\n    }\r\n    await this.audioEncoder.flush();\r\n  }\r\n\r\n  saveFile(buffer) {\r\n    const blob = new Blob([buffer], { type: 'video/mp4' });\r\n    const url = URL.createObjectURL(blob);\r\n    const d = new Date();\r\n    const dateStr = `${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`;\r\n    const timeStr = `${String(d.getHours()).padStart(2,'0')}${String(d.getMinutes()).padStart(2,'0')}`;\r\n    let filename = `${dateStr}_${timeStr}_pikavolley_replay.mp4`;\r\n    \r\n    if (this.pikaVolley.nicknames && this.pikaVolley.nicknames.length === 2) {\r\n        const n1 = this.pikaVolley.nicknames[0].replace(/[/\\\\?%*:|\"<>]/g, '_');\r\n        const n2 = this.pikaVolley.nicknames[1].replace(/[/\\\\?%*:|\"<>]/g, '_');\r\n        filename = `${dateStr}_${timeStr}_${n1}_vs_${n2}.mp4`;\r\n    }\r\n\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = filename;\r\n    a.click();\r\n    \r\n    this.updateStatus('ÏôÑÎ£å!');\r\n    const recordBtn = document.getElementById('record-btn');\r\n    // @ts-ignore\r\n    if (recordBtn) recordBtn.disabled = false;\r\n    const loadingOverlay = document.getElementById('loading-overlay');\r\n    // @ts-ignore\r\n    if (loadingOverlay) loadingOverlay.classList.add('hidden');\r\n    \r\n    setTimeout(() => {\r\n        URL.revokeObjectURL(url);\r\n        this.muxer = null;\r\n        this.videoEncoder = null;\r\n        this.audioEncoder = null;\r\n        this.audioLog = [];\r\n    }, 1000);\r\n  }\r\n\r\n  drawOverlaysOnCanvas() {\r\n    // @ts-ignore\r\n    const ctx = this.renderer.view.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    ctx.save();\r\n    \r\n    const center = 216;\r\n    const distance = 50;\r\n    const nicknameY = 10;\r\n    const ipY = 25;\r\n    let p1Nickset = '';\r\n    let p2Nickset = '';\r\n    let p1IPset = '';\r\n    let p2IPset = '';\r\n    //@ts-ignore\r\n    if (this.showNicknamesCheckbox.checked) {\r\n        p1Nickset = document.getElementById('player1-nickname')?.textContent || '';\r\n        p2Nickset = document.getElementById('player2-nickname')?.textContent || '';\r\n    }\r\n    //@ts-ignore\r\n    if (this.showIPsCheckbox.checked) {\r\n        p1IPset = document.getElementById('player1-partial-ip')?.textContent || '';\r\n        p2IPset = document.getElementById('player2-partial-ip')?.textContent || '';\r\n    }\r\n\r\n    const p1Nick = p1Nickset;\r\n    const p2Nick = p2Nickset;\r\n    const p1IP = p1IPset;\r\n    const p2IP = p2IPset;\r\n\r\n    // Player 1\r\n    if (p1Nick) {\r\n        ctx.font = 'bold 12px \"Segoe UI\", sans-serif';\r\n        ctx.textAlign = 'center';\r\n        ctx.textBaseline = 'top';\r\n        ctx.fillStyle = 'white';\r\n        ctx.strokeStyle = 'black';\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeText(p1Nick, center - distance, nicknameY);\r\n        ctx.fillText(p1Nick, center - distance, nicknameY);\r\n        if (p1IP) {\r\n            ctx.font = '8px sans-serif';\r\n            ctx.lineWidth = 1;\r\n            ctx.strokeText(p1IP, center - distance, ipY);\r\n            ctx.fillText(p1IP, center - distance, ipY);\r\n        }\r\n    }\r\n\r\n    // Player 2\r\n    if (p2Nick) {\r\n        ctx.font = 'bold 12px \"Segoe UI\", sans-serif';\r\n        ctx.textAlign = 'center';\r\n        ctx.textBaseline = 'top';\r\n        ctx.fillStyle = 'white';\r\n        ctx.strokeStyle = 'black';\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeText(p2Nick, center + distance, nicknameY);\r\n        ctx.fillText(p2Nick, center + distance, nicknameY);\r\n        if (p2IP) {\r\n            ctx.font = '8px sans-serif';\r\n            ctx.lineWidth = 1;\r\n            ctx.strokeText(p2IP, center + distance, ipY);\r\n            ctx.fillText(p2IP, center + distance, ipY);\r\n        }\r\n    }\r\n\r\n    // ÎßêÌíçÏÑ† Í∑∏Î¶¨Í∏∞ (ÌéòÏù¥ÎìúÏïÑÏõÉ ÏïåÌåå Ï†ÅÏö©)\r\n    this.activeBubbles.forEach(b => {\r\n        this.drawSpeechBubble(ctx, b.text, b.x, b.y, b.alpha);\r\n    });\r\n    \r\n    ctx.restore();\r\n  }\r\n\r\n  // [ÌïµÏã¨] CSS Ïä§ÌÉÄÏùº ÌùâÎÇ¥ (Ìù∞ÏÉâ Î∞∞Í≤Ω, Îë•Í∑º Î™®ÏÑúÎ¶¨, Ìå®Îî©)\r\n  drawSpeechBubble(ctx, text, x, y, alpha) {\r\n      if (!text) return;\r\n      \r\n      ctx.save();\r\n      ctx.globalAlpha = alpha; // Í≥ÑÏÇ∞Îêú Ìà¨Î™ÖÎèÑ Ï†ÅÏö©\r\n      //@ts-ignore\r\n      if (this.chatSizeSelect.value === 'large') {\r\n        ctx.font = '18px \"Segoe UI\", sans-serif';\r\n        //@ts-ignore\r\n      } else if (this.chatSizeSelect.value === 'small') {\r\n        ctx.font = '12px \"Segoe UI\", sans-serif';\r\n      } else {\r\n        return;\r\n      }\r\n      ctx.font = '12px sans-serif'; // CSS: font-size: calc(1.5 * var(--font-size)) approx 24px but scaled down here\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'middle';\r\n      \r\n      const textMetrics = ctx.measureText(text);\r\n      const padding = 6; // CSS: padding: 10px\r\n      const width = textMetrics.width + (padding * 2);\r\n      const height = 24 + padding; // ÎåÄÎûµÏ†ÅÏù∏ ÎÜíÏù¥\r\n      const r = 10; // CSS: border-radius: 10px\r\n\r\n      // ÎßêÌíçÏÑ† ÏúÑÏπò Ï°∞Ï†ï (Top, Left/Right Í∏∞Ï§Ä Î≥¥Ï†ï)\r\n      const bubbleX = x - width / 2;\r\n      const bubbleY = y;\r\n\r\n      // Îë•Í∑º ÏÇ¨Í∞ÅÌòï Í∑∏Î¶¨Í∏∞\r\n      ctx.beginPath();\r\n      ctx.moveTo(bubbleX + r, bubbleY);\r\n      ctx.lineTo(bubbleX + width - r, bubbleY);\r\n      ctx.quadraticCurveTo(bubbleX + width, bubbleY, bubbleX + width, bubbleY + r);\r\n      ctx.lineTo(bubbleX + width, bubbleY + height - r);\r\n      ctx.quadraticCurveTo(bubbleX + width, bubbleY + height, bubbleX + width - r, bubbleY + height);\r\n      ctx.lineTo(bubbleX + r, bubbleY + height);\r\n      ctx.quadraticCurveTo(bubbleX, bubbleY + height, bubbleX, bubbleY + height - r);\r\n      ctx.lineTo(bubbleX, bubbleY + r);\r\n      ctx.quadraticCurveTo(bubbleX, bubbleY, bubbleX + r, bubbleY);\r\n      ctx.closePath();\r\n\r\n      // CSS: background-color: rgba(255, 255, 255, 0.95)\r\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';\r\n      ctx.fill();\r\n\r\n      // ÌÖçÏä§Ìä∏ Í∑∏Î¶¨Í∏∞ (CSS: color: black)\r\n      ctx.fillStyle = 'black';\r\n      ctx.fillText(text, x, bubbleY + height / 2);\r\n\r\n      ctx.restore();\r\n  }\r\n\r\n  downloadWav(audioBuffer) {\r\n    const buffer = this.bufferToWave(audioBuffer, audioBuffer.length);\r\n    const blob = new Blob([buffer], { type: 'audio/wav' });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `pikavolley_audio.wav`;\r\n    a.style.display = 'none';\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); }, 1000);\r\n  }\r\n\r\n  bufferToWave(abuffer, len) {\r\n    const numOfChan = abuffer.numberOfChannels;\r\n    const length = len * numOfChan * 2 + 44;\r\n    const buffer = new ArrayBuffer(length);\r\n    const view = new DataView(buffer);\r\n    const channels = [];\r\n    let i, sample, offset = 0, pos = 0;\r\n\r\n    setUint32(0x46464952); setUint32(length - 8); setUint32(0x45564157); \r\n    setUint32(0x20746d66); setUint32(16); setUint16(1); setUint16(numOfChan);\r\n    setUint32(abuffer.sampleRate); setUint32(abuffer.sampleRate * 2 * numOfChan); \r\n    setUint16(numOfChan * 2); setUint16(16); setUint32(0x61746164); setUint32(length - pos - 4); \r\n\r\n    for (i = 0; i < abuffer.numberOfChannels; i++) channels.push(abuffer.getChannelData(i));\r\n\r\n    while (pos < len) {\r\n      for (i = 0; i < numOfChan; i++) {\r\n        sample = Math.max(-1, Math.min(1, channels[i][pos])); \r\n        sample = (0.5 + sample < 0 ? sample * 32768 : sample * 32767) | 0; \r\n        view.setInt16(44 + offset, sample, true);\r\n        offset += 2;\r\n      }\r\n      pos++;\r\n    }\r\n    function setUint16(data) { view.setUint16(pos, data, true); pos += 2; }\r\n    function setUint32(data) { view.setUint32(pos, data, true); pos += 4; }\r\n    return buffer;\r\n  }\r\n}\r\n\r\nfunction adjustAssetsPath() {\r\n  const prefix = '../../';\r\n  if (!ASSETS_PATH.SPRITE_SHEET.startsWith(prefix)) {\r\n    const clean = (p) => p.replace(/^\\.\\.\\//, '');\r\n    ASSETS_PATH.SPRITE_SHEET = prefix + clean(ASSETS_PATH.SPRITE_SHEET);\r\n    for (const k in ASSETS_PATH.SOUNDS) ASSETS_PATH.SOUNDS[k] = prefix + clean(ASSETS_PATH.SOUNDS[k]);\r\n  }\r\n}\r\nadjustAssetsPath();\r\n\r\nconst converter = new OfflineConverter();\r\nconst recordBtn = document.getElementById('record-btn');\r\nif (recordBtn) {\r\n  recordBtn.addEventListener('click', () => converter.handleRecordButtonClick());\r\n}"],"names":["console","log","originalReplaceChild","Node","prototype","replaceChild","newChild","oldChild","call","this","e","appendChild","e2","originalRemoveChild","removeChild","child","prefix","SPRITE_SHEET","startsWith","clean","p","replace","k","SOUNDS","adjustAssetsPath","converter","constructor","registerPlugin","RESOLUTION","SCALE_MODE","NEAREST","ROUND_PIXELS","renderer","stage","loader","pikaVolley","audioLog","decodedBuffers","totalDuration","chats","chatHead","activeBubbles","rng","muxer","videoEncoder","audioEncoder","chatSizeSelect","showNicknamesCheckbox","showIPsCheckbox","bgmCheckbox","sfxCheckbox","sharpGraphicsCheckbox","updateUI","document","getElementById","updateStatus","message","statusEl","textContent","handleRecordButtonClick","fileInput","createElement","type","accept","onchange","file","target","files","loadReplayFile","click","reader","FileReader","onload","event","pack","JSON","parse","result","originalHash","hash","warn","options","rule","initializeRenderer","err","error","readAsText","width","height","antialias","backgroundColor","forceCanvas","preserveDrawingBuffer","container","querySelector","innerHTML","view","ensureDOMElements","add","soundLoadPromises","audioCtx","window","AudioContext","webkitAudioContext","keyMapping","key","url","promise","fetch","then","res","arrayBuffer","buf","decodeAudioData","decoded","mappedKey","toLowerCase","push","Promise","all","load","startOfflineProcessing","forEach","id","el","style","display","resources","roomID","nicknames","partialPublicIPs","inputs","slice","willDisplayChat","mockAudioSystem","totalFrames","length","video","codec","audio","sampleRate","numberOfChannels","fastStart","VideoEncoder","output","chunk","meta","addVideoChunk","configure","bitrate","framerate","AudioEncoder","addAudioChunk","progressBar","i","encodeQueueSize","r","setTimeout","gameLoopSilent","processChatFrame","render","drawOverlaysOnCanvas","bitmap","createImageBitmap","videoFrame","VideoFrame","timestamp","keyFrame","encode","close","percent","Math","floor","flush","synthesizeAndEncodeAudio","finalize","buffer","saveFile","currentFrame","chat","side","rand1","rand2","canvasW","y","x","filter","b","text","elapsed","duration","progress","alpha","splice","turnBGMVolume","turnSFXVolume","checked","fakeSounds","fakeAudio","sounds","play","pan","replayFrameCounter","frame","stop","fps","ceil","offlineCtx","OfflineAudioContext","source","createBufferSource","panner","createStereoPanner","value","connect","destination","start","renderedBuffer","startRendering","downloadWav","lengthSamples","size","min","planarData","Float32Array","ch","channelData","getChannelData","set","subarray","audioData","AudioData","format","numberOfFrames","data","blob","Blob","URL","createObjectURL","d","Date","dateStr","getFullYear","String","getMonth","padStart","getDate","timeStr","getHours","getMinutes","filename","a","href","download","recordBtn","disabled","loadingOverlay","classList","revokeObjectURL","ctx","getContext","save","p1Nickset","p2Nickset","p1IPset","p2IPset","p1Nick","p2Nick","p1IP","p2IP","font","textAlign","textBaseline","fillStyle","strokeStyle","lineWidth","strokeText","center","fillText","drawSpeechBubble","restore","globalAlpha","measureText","bubbleX","bubbleY","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","fill","audioBuffer","bufferToWave","body","abuffer","len","numOfChan","ArrayBuffer","DataView","channels","sample","offset","pos","setUint32","setUint16","max","setInt16","addEventListener"],"sourceRoot":""}