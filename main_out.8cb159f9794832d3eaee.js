"use strict";(self.webpackChunkpikachu_volleyball_p2p_online=self.webpackChunkpikachu_volleyball_p2p_online||[]).push([[293],{6651:(e,t,i)=>{var s=i(4603),n=i(6787),o=i(592),r=i(3650),a=i(9449),d=i(7561),h=i(7049),c=i(3401),l=i(8077),u=i(4697),p=i(8505),m=(i(7229),i(6090)),S=i(3374),g=i(6212),w=i(6970);!function(){const e=window.location.pathname,t=e.endsWith("/")||e.endsWith("index.html")?"../../":"../";if(!m.I.SPRITE_SHEET.startsWith("..")){m.I.SPRITE_SHEET=t+m.I.SPRITE_SHEET;for(const e in m.I.SOUNDS)m.I.SOUNDS[e]=t+m.I.SOUNDS[e]}}(),s.W.RESOLUTION=2,s.W.SCALE_MODE=n.M6.NEAREST,s.W.ROUND_PIXELS=!0,o.A4.registerPlugin("prepare",r.p8),o.A4.registerPlugin("batch",o.ch),l.KB.registerPlugin("prepare",p.S),l.KB.registerPlugin("sprite",u.$),d.aH.registerPlugin(h.A);const k=new class{constructor(){this.renderer=(0,o.q5)({width:432,height:304,antialias:!1,backgroundColor:0,backgroundAlpha:1,forceCanvas:!0,preserveDrawingBuffer:!0}),this.stage=new a.mc,this.loader=new d.aH,this.pikaVolley=null,this.ticker=new c.Rv,this.mediaRecorder=null,this.recordedChunks=[]}initAndStart(e,t,i){this.onStatusChange=t,this.onFinish=i;const s=document.getElementById("game-canvas-container");s.innerHTML="",s.appendChild(this.renderer.view),this.loader.reset(),this.loader.add(m.I.SPRITE_SHEET);for(const e in m.I.SOUNDS)this.loader.add(m.I.SOUNDS[e]);const n=new FileReader;n.onload=e=>{this._parseAndLoadGame(e.target.result)},n.readAsText(e)}_parseAndLoadGame(e){let t;try{const i=JSON.parse(e);t=i.pack;const s=t.hash;if(t.hash=0,s!==(0,w.i)((0,g.l)(t)))throw"Error: File hash mismatch"}catch(e){return console.error(e),void(this.onStatusChange&&this.onStatusChange("오류: 손상된 리플레이 파일입니다."))}this.onStatusChange&&this.onStatusChange("리소스 로딩 중..."),this.loader.onError.add(((e,t,i)=>{console.error("Resource Load Failed:",i.url,e)})),this.loader.load((()=>{this._createGame(t)}))}_createGame(e){const t=m.I.TEXTURES;t.WITH_COMPUTER=t.WITH_FRIEND;try{this.pikaVolley=new S.Z(this.stage,this.loader.resources,e.roomID,e.nicknames,e.partialPublicIPs,e.inputs,e.options,e.chats)}catch(e){return console.error(e),void(e.message&&e.message.includes("undefined")?this.onStatusChange&&this.onStatusChange("오류: 리소스 로딩 실패 (새로고침 후 다시 시도해보세요)"):this.onStatusChange&&this.onStatusChange("게임 생성 오류 (콘솔 확인)"))}this.onStatusChange&&this.onStatusChange("녹화 시작! 소리가 재생됩니다..."),this._startRecordingLoop()}_startRecordingLoop(){const e=this.renderer.view.captureStream(60);let t="video/webm";MediaRecorder.isTypeSupported("video/webm; codecs=vp9")?t="video/webm; codecs=vp9":MediaRecorder.isTypeSupported("video/webm; codecs=vp8")&&(t="video/webm; codecs=vp8"),this.mediaRecorder=new MediaRecorder(e,{mimeType:t,videoBitsPerSecond:5e6}),this.recordedChunks=[],this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.recordedChunks.push(e.data)},this.mediaRecorder.onstop=()=>{this._finalizeDownload()},this.mediaRecorder.start(),this.ticker.stop(),this.ticker=new c.Rv,this.ticker.minFPS=60,this.ticker.maxFPS=60,this.ticker.add((()=>{this.renderer.render(this.stage),this.pikaVolley&&(this.pikaVolley.gameLoop(),this.pikaVolley.replayFrameCounter>=this.pikaVolley.inputs.length&&(this.ticker.stop(),this.mediaRecorder.stop(),this.onStatusChange&&this.onStatusChange("변환 완료! 파일 생성 중...")))})),this.ticker.start()}_finalizeDownload(){const e=new Blob(this.recordedChunks,{type:"video/webm"}),t=URL.createObjectURL(e),i=document.createElement("a");i.style.display="none",i.href=t,i.download=`pikachu_replay_${Date.now()}.webm`,document.body.appendChild(i),i.click(),setTimeout((()=>{document.body.removeChild(i),window.URL.revokeObjectURL(t),this.onFinish&&this.onFinish()}),100)}},E=document.getElementById("record-btn"),C=document.getElementById("status");E?E.addEventListener("click",(()=>{const e=window.AudioContext||window.webkitAudioContext;if(e){const t=new e;t.resume().then((()=>t.close()))}const t=document.createElement("input");t.type="file",t.accept=".txt",t.onchange=e=>{const t=e.target.files[0];t&&(C.innerText="리플레이 파일을 분석 중입니다...",k.initAndStart(t,(e=>{C.innerText=e}),(()=>{C.innerText="다운로드가 완료되었습니다!"})))},t.click()})):console.error("버튼을 찾을 수 없습니다.")}},e=>{e.O(0,[244,415,476],(()=>e(e.s=6651))),e.O()}]);
//# sourceMappingURL=main_out.8cb159f9794832d3eaee.js.map