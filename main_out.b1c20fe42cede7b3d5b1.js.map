{"version":3,"file":"main_out.b1c20fe42cede7b3d5b1.js","mappings":"0TA8YA,WACE,IAAYA,aAAe,MAAQ,IAAYA,aAC/C,IAAK,MAAMC,KAAQ,IAAYC,OAC7B,IAAYA,OAAOD,GAAQ,MAAQ,IAAYC,OAAOD,EAE1D,CAEAE,GAGA,MAAMC,EAAY,IA7XlB,MACE,WAAAC,GAEE,KAASC,eAAe,UAAW,MACnC,KAASA,eAAe,QAAS,MACjC,KAAeA,eAAe,UAAW,KACzC,KAAeA,eAAe,SAAU,KACxC,KAAOA,eAAe,KACtB,IAASC,WAAa,EACtB,IAASC,WAAa,KAAYC,QAClC,IAASC,cAAe,EAExBC,KAAKC,SAAW,KAChBD,KAAKE,MAAQ,KACbF,KAAKG,OAAS,KACdH,KAAKI,OAAS,KACdJ,KAAKK,WAAa,KAClBL,KAAKM,YAAc,KAEnBN,KAAKO,cAAgB,KACrBP,KAAKQ,eAAiB,GACtBR,KAAKS,aAAc,CACrB,CAEA,YAAAC,CAAaC,GACX,MAAMC,EAAWC,SAASC,eAAe,UACrCF,IACFA,EAASG,YAAcJ,GAEzBK,QAAQC,IAAIN,EACd,CAEA,uBAAAO,GACE,GAAIlB,KAAKS,YAEP,YADAT,KAAKU,aAAa,iBAIpB,MAAMS,EAAYN,SAASO,cAAc,SACzCD,EAAUE,KAAO,OACjBF,EAAUG,OAAS,OACnBH,EAAUI,SAAYC,IAEpB,MAAMC,EAAOD,EAAEE,OAAOC,MAAM,GACxBF,GACFzB,KAAK4B,eAAeH,EACtB,EAEFN,EAAUU,OACZ,CAEA,cAAAD,CAAeH,GACbzB,KAAKU,aAAa,mBAClB,MAAMoB,EAAYjB,SAASC,eAAe,cAEtCgB,IAAWA,EAAUC,UAAW,GAGpC,MAAMC,EAAiBnB,SAASC,eAAe,mBAE3CkB,GAAgBA,EAAeC,UAAUC,OAAO,UAEpD,MAAMC,EAAS,IAAIC,WACnBD,EAAOE,OAAUC,IACf,IAEE,MACMC,EADkBC,KAAKC,MAAMH,EAAMZ,OAAOgB,QACnBH,KACvBI,EAAOJ,EAAKI,KAElB,GADAJ,EAAKI,KAAO,EACRA,KAAS,QAAY,OAAUJ,IACjC,MAAM,IAAIK,MAAM,2BAElB5C,KAAK6C,mBAAmBN,EAC1B,CAAE,MAAOO,GACP9B,QAAQ+B,MAAMD,GAEd9C,KAAKU,aAAa,aAAeoC,EAAInC,SAEjCmB,IAAWA,EAAUC,UAAW,GAEhCC,GAAgBA,EAAeC,UAAUe,IAAI,SACnD,GAEFb,EAAOc,QAAU,KACfjD,KAAKU,aAAa,YAEdoB,IAAWA,EAAUC,UAAW,GAEhCC,GAAgBA,EAAeC,UAAUe,IAAI,SAAS,EAE5Db,EAAOe,WAAWzB,EACpB,CAEA,kBAAAoB,CAAmBN,GACjBvC,KAAKU,aAAa,iBAClBV,KAAKM,YAAciC,EAGnBvC,KAAKC,UAAW,QAAmB,CACjCkD,MAAO,IACPC,OAAQ,IACRC,WAAW,EACXC,gBAAiB,EACjBC,gBAAiB,EACjBC,aAAa,EACbC,uBAAuB,IAGzBzD,KAAKE,MAAQ,IAAI,KACjBF,KAAKI,OAAS,IAAI,KAClBJ,KAAKI,OAAOsD,OAAS,EACrB1D,KAAKG,OAAS,IAAI,KAGlB,MAAMwD,EAAY9C,SAAS+C,cAAc,0BAEzCD,EAAUE,UAAY,GAEtBF,EAAUG,YAAY9D,KAAKC,SAAS8D,MAGpC,MAAMC,EAAW,IAAYA,SAC7BA,EAASC,cAAgBD,EAASE,YAElClE,KAAKG,OAAO6C,IAAI,IAAY3D,cAC5B,IAAK,MAAMC,KAAQ,IAAYC,OAC7BS,KAAKG,OAAO6C,IAAI,IAAYzD,OAAOD,IAGrCU,KAAKmE,yBACLnE,KAAKG,OAAOiE,MAAK,IAAMpE,KAAKqE,UAAU9B,IACxC,CAEA,sBAAA4B,GACE,MAAMG,EAAczD,SAASC,eAAe,gBACxCwD,GACFtE,KAAKG,OAAOoE,WAAWvB,KAAI,KAEzBsB,EAAYE,MAAMrB,MAAQ,GAAGnD,KAAKG,OAAOsE,WAAW,GAG1D,CAEA,SAAAJ,CAAU9B,GACRvC,KAAKU,aAAa,eAElBV,KAAKK,WAAa,IAAI,IACpBL,KAAKE,MACLF,KAAKG,OAAOuE,UACZnC,EAAKoC,OACLpC,EAAKqC,UACLrC,EAAKsC,iBACLtC,EAAKuC,OACLvC,EAAKwC,QACLxC,EAAKyC,QAIP,QAAyBhF,KAAKK,YAG9BL,KAAKK,WAAW4E,iBAAkB,GAClC,SAAW,GAGX,MAAMC,EAAwBrE,SAASC,eAAe,2BAChDqE,EAAkBtE,SAASC,eAAe,8BAC1CsE,EAAmBvE,SAASC,eAAe,sBAE7CoE,IAEFA,EAAsBG,SAAU,EAChCH,EAAsBI,cAAc,IAAIC,MAAM,YAG5CJ,IAEFA,EAAgBE,SAAU,EAC1BF,EAAgBG,cAAc,IAAIC,MAAM,YAGtCH,IAEFA,EAAiBC,SAAU,EAC3BD,EAAiBE,cAAc,IAAIC,MAAM,YAI3CvF,KAAKK,WAAWmF,MAAMC,eAAc,GAChCzF,KAAKK,WAAWmF,MAAME,OAAOC,KAAO3F,KAAKK,WAAWmF,MAAME,OAAOC,IAAIC,SACvE5F,KAAKK,WAAWmF,MAAME,OAAOC,IAAIC,OAAOC,OAGxC7F,KAAKK,WAAWmF,MAAME,OAAOC,IAAIC,OAAOE,KAAO,WAAY,EAE3D9F,KAAKK,WAAWmF,MAAME,OAAOC,IAAIC,OAAOG,WAAY,GAItD/F,KAAKK,WAAWmF,MAAMQ,eAAc,GAGpChG,KAAKI,OAAO4C,KAAI,KACdhD,KAAKC,SAASgG,OAAOjG,KAAKE,OAC1BF,KAAKK,WAAW6F,UAAU,IAG5BC,YAAW,IAAMnG,KAAKoG,kBAAkB,IAC1C,CAEA,cAAAA,GACEpG,KAAKU,aAAa,cAClBV,KAAKQ,eAAiB,GACtBR,KAAKS,aAAc,EAGnB,MAAM4F,EAASrG,KAAKC,SAAS8D,KAE7B,IAEE,MAAMuC,EAAM,GAENC,EAAeF,EAAOG,cAAcF,GAG1C,IAAIG,EAAW,wBACVC,cAAcC,gBAAgBF,KACjCA,EAAW,wBACNC,cAAcC,gBAAgBF,KACjCA,EAAW,eAIfzG,KAAKO,cAAgB,IAAImG,cAAcH,EAAc,CACnDE,SAAUA,EACVG,mBAAoB,OAGtB5G,KAAKO,cAAcsG,gBAAmBrF,IAChCA,EAAEsF,KAAKC,KAAO,GAChB/G,KAAKQ,eAAewG,KAAKxF,EAAEsF,KAC7B,EAGF9G,KAAKO,cAAc0G,OAAS,KAC1BjH,KAAKkH,eAAe,EAGtBlH,KAAKO,cAAc0C,QAAWzB,IAC5BR,QAAQ+B,MAAM,oBAAqBvB,GACnCxB,KAAKU,aAAa,cAClBV,KAAKS,aAAc,EACnB,MAAMqB,EAAYjB,SAASC,eAAe,cAEtCgB,IAAWA,EAAUC,UAAW,EAAK,EAI3C/B,KAAKO,cAAc4G,MAAM,KAGzBnH,KAAKI,OAAOgH,OAAS,GACrBpH,KAAKI,OAAO+G,QAEZnH,KAAKU,aAAa,cAClBV,KAAKqH,iBAEP,CAAE,MAAOvE,GACP9B,QAAQ+B,MAAM,YAAaD,GAE3B9C,KAAKU,aAAa,aAAeoC,EAAInC,SACrCX,KAAKS,aAAc,EACnB,MAAMqB,EAAYjB,SAASC,eAAe,cAEtCgB,IAAWA,EAAUC,UAAW,EACtC,CACF,CAEA,eAAAsF,GACE,MAAMC,EAActH,KAAKK,WAAWyE,OAAOyC,OACrCjD,EAAczD,SAASC,eAAe,gBAEtC0G,EAAgBC,aAAY,KAChC,IAAKzH,KAAKK,aAAeL,KAAKS,YAE5B,YADAiH,cAAcF,GAIhB,MAAMG,EAAe3H,KAAKK,WAAWuH,mBAC/BnD,EAAWoD,KAAKC,MAAOH,EAAeL,EAAe,KAE3DtH,KAAKU,aAAa,WAAW+D,MACzBH,IAEFA,EAAYE,MAAMrB,MAAQ,GAAGsB,MAG3BkD,GAAgBL,IAClBI,cAAcF,GACdxH,KAAK+H,gBACP,GACC,IACL,CAEA,aAAAA,GACO/H,KAAKS,cAEVT,KAAKU,aAAa,qBAClBV,KAAKI,OAAOyF,OAER7F,KAAKO,eAA8C,aAA7BP,KAAKO,cAAcyH,MAC3ChI,KAAKO,cAAcsF,OAEnB7F,KAAKkH,gBAET,CAEA,aAAAA,GACE,GAAmC,IAA/BlH,KAAKQ,eAAe+G,OAAc,CACpCvH,KAAKU,aAAa,iBAClBV,KAAKS,aAAc,EACnB,MAAMqB,EAAYjB,SAASC,eAAe,cAG1C,YADIgB,IAAWA,EAAUC,UAAW,GAEtC,CAEA,MAAMkG,EAAO,IAAIC,KAAKlI,KAAKQ,eAAgB,CAAEa,KAAM,eAC7C8G,EAAMC,IAAIC,gBAAgBJ,GAE1BK,EAAI,IAAIC,KACRC,EAAU,GAAGF,EAAEG,iBAAiB,KAAOH,EAAEI,WAAa,IAAIC,OAAO,MAAM,IAAML,EAAEM,WAAWD,OAAO,KACjGE,EAAU,IAAI,IAAMP,EAAEQ,YAAYH,OAAO,MAAM,IAAML,EAAES,cAAcJ,OAAO,KAElF,IAAIK,EAAW,GAAGR,KAAWK,2BAE7B,MAAMtG,EAAOvC,KAAKM,YACdiC,GAAQA,EAAKqC,WAAuC,IAA1BrC,EAAKqC,UAAU2C,SAG3CyB,EAAW,GAAGR,KAAWK,KAFXtG,EAAKqC,UAAU,GAAGqE,QAAQ,iBAAkB,WAC5C1G,EAAKqC,UAAU,GAAGqE,QAAQ,iBAAkB,aAI5D,MAAMC,EAAIrI,SAASO,cAAc,KACjC8H,EAAEC,KAAOhB,EACTe,EAAEE,SAAWJ,EACbE,EAAE1E,MAAM6E,QAAU,OAClBxI,SAASyI,KAAKxF,YAAYoF,GAC1BA,EAAErH,QAEFsE,YAAW,KACTtF,SAASyI,KAAKC,YAAYL,GAC1Bd,IAAIoB,gBAAgBrB,EAAI,GACvB,KAEHnI,KAAKU,aAAa,oCAClBV,KAAKS,aAAc,EACnB,MAAMqB,EAAYjB,SAASC,eAAe,cAEtCgB,IAAWA,EAAUC,UAAW,GACpC/B,KAAKQ,eAAiB,GAGtB,MAAMwB,EAAiBnB,SAASC,eAAe,mBAE3CkB,GAAgBA,EAAeC,UAAUe,IAAI,SACnD,GAeIlB,EAAYjB,SAASC,eAAe,cACtCgB,GACFA,EAAU2H,iBAAiB,SAAS,IAAMhK,EAAUyB,4BAItDL,SAAS4I,iBAAiB,oBAAoB,KAC5C,MAAMvE,EAAwBrE,SAASC,eAAe,2BAChDqE,EAAkBtE,SAASC,eAAe,8BAC1CsE,EAAmBvE,SAASC,eAAe,sBAE3C4I,EAAsB7I,SAASC,eAAe,oBAC9C6I,EAAsB9I,SAASC,eAAe,oBAC9C8I,EAAgB/I,SAASC,eAAe,sBACxC+I,EAAgBhJ,SAASC,eAAe,sBAE1CoE,GACFA,EAAsBuE,iBAAiB,UAAU,KAE3CvE,EAAsBG,SACpBqE,GAAqBA,EAAoBzH,UAAUC,OAAO,UAC1DyH,GAAqBA,EAAoB1H,UAAUC,OAAO,YAE1DwH,GAAqBA,EAAoBzH,UAAUe,IAAI,UACvD2G,GAAqBA,EAAoB1H,UAAUe,IAAI,UAC7D,IAIAmC,GACFA,EAAgBsE,iBAAiB,UAAU,KAErCtE,EAAgBE,SACduE,GAAeA,EAAc3H,UAAUC,OAAO,UAC9C2H,GAAeA,EAAc5H,UAAUC,OAAO,YAE9C0H,GAAeA,EAAc3H,UAAUe,IAAI,UAC3C6G,GAAeA,EAAc5H,UAAUe,IAAI,UACjD,IAIAoC,GACFA,EAAiBqE,iBAAiB,UAAU,KAEtCrE,EAAiBC,SACnB,SAAW,IAEX,SAAW,EACb,GAEJ,G","sources":["webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay/main_out.js"],"sourcesContent":["/**\r\n * Main script for converting Pikachu Volleyball replay files to video\r\n * Real-time recording with MediaRecorder at 30 FPS\r\n */\r\n'use strict';\r\nimport { settings } from '@pixi/settings';\r\nimport { SCALE_MODES } from '@pixi/constants';\r\nimport { Renderer, BatchRenderer, autoDetectRenderer } from '@pixi/core';\r\nimport { Prepare } from '@pixi/prepare';\r\nimport { Container } from '@pixi/display';\r\nimport { Loader } from '@pixi/loaders';\r\nimport { SpritesheetLoader } from '@pixi/spritesheet';\r\nimport { Ticker } from '@pixi/ticker';\r\nimport { CanvasRenderer } from '@pixi/canvas-renderer';\r\nimport { CanvasSpriteRenderer } from '@pixi/canvas-sprite';\r\nimport { CanvasPrepare } from '@pixi/canvas-prepare';\r\nimport '@pixi/canvas-display';\r\nimport { ASSETS_PATH } from '../offline_version_js/assets_path.js';\r\nimport { PikachuVolleyballReplay } from './pikavolley_replay.js';\r\nimport { setGetSpeechBubbleNeeded, enableChat } from '../chat_display.js';\r\nimport { serialize } from '../utils/serialize.js';\r\nimport { getHashCode } from '../utils/hash_code.js';\r\nimport '../../style.css';\r\n\r\n/**\r\n * Replay to Video Converter with MediaRecorder (Real-time recording)\r\n */\r\nclass ReplayToVideoConverter {\r\n  constructor() {\r\n    // Setup PIXI\r\n    Renderer.registerPlugin('prepare', Prepare);\r\n    Renderer.registerPlugin('batch', BatchRenderer);\r\n    CanvasRenderer.registerPlugin('prepare', CanvasPrepare);\r\n    CanvasRenderer.registerPlugin('sprite', CanvasSpriteRenderer);\r\n    Loader.registerPlugin(SpritesheetLoader);\r\n    settings.RESOLUTION = 2;\r\n    settings.SCALE_MODE = SCALE_MODES.NEAREST;\r\n    settings.ROUND_PIXELS = true;\r\n\r\n    this.renderer = null;\r\n    this.stage = null;\r\n    this.loader = null;\r\n    this.ticker = null;\r\n    this.pikaVolley = null;\r\n    this.currentPack = null;\r\n    \r\n    this.mediaRecorder = null;\r\n    this.recordedChunks = [];\r\n    this.isRecording = false;\r\n  }\r\n\r\n  updateStatus(message) {\r\n    const statusEl = document.getElementById('status');\r\n    if (statusEl) {\r\n      statusEl.textContent = message;\r\n    }\r\n    console.log(message);\r\n  }\r\n\r\n  handleRecordButtonClick() {\r\n    if (this.isRecording) {\r\n      this.updateStatus('이미 처리 중입니다...');\r\n      return;\r\n    }\r\n\r\n    const fileInput = document.createElement('input');\r\n    fileInput.type = 'file';\r\n    fileInput.accept = '.txt';\r\n    fileInput.onchange = (e) => {\r\n      // @ts-ignore\r\n      const file = e.target.files[0];\r\n      if (file) {\r\n        this.loadReplayFile(file);\r\n      }\r\n    };\r\n    fileInput.click();\r\n  }\r\n\r\n  loadReplayFile(file) {\r\n    this.updateStatus('리플레이 파일 로딩 중...');\r\n    const recordBtn = document.getElementById('record-btn');\r\n    // @ts-ignore\r\n    if (recordBtn) recordBtn.disabled = true;\r\n\r\n    // Show loading overlay\r\n    const loadingOverlay = document.getElementById('loading-overlay');\r\n    // @ts-ignore\r\n    if (loadingOverlay) loadingOverlay.classList.remove('hidden');\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = (event) => {\r\n      try {\r\n        // @ts-ignore\r\n        const packWithComment = JSON.parse(event.target.result);\r\n        const pack = packWithComment.pack;\r\n        const hash = pack.hash;\r\n        pack.hash = 0;\r\n        if (hash !== getHashCode(serialize(pack))) {\r\n          throw new Error('파일 내용이 해시 코드와 일치하지 않습니다');\r\n        }\r\n        this.initializeRenderer(pack);\r\n      } catch (err) {\r\n        console.error(err);\r\n        // @ts-ignore\r\n        this.updateStatus('파일 로딩 실패: ' + err.message);\r\n        // @ts-ignore\r\n        if (recordBtn) recordBtn.disabled = false;\r\n        // @ts-ignore\r\n        if (loadingOverlay) loadingOverlay.classList.add('hidden');\r\n      }\r\n    };\r\n    reader.onerror = () => {\r\n      this.updateStatus('파일 읽기 실패');\r\n      // @ts-ignore\r\n      if (recordBtn) recordBtn.disabled = false;\r\n      // @ts-ignore\r\n      if (loadingOverlay) loadingOverlay.classList.add('hidden');\r\n    };\r\n    reader.readAsText(file);\r\n  }\r\n\r\n  initializeRenderer(pack) {\r\n    this.updateStatus('게임 에셋 로딩 중...');\r\n    this.currentPack = pack;\r\n\r\n    // Setup renderer\r\n    this.renderer = autoDetectRenderer({\r\n      width: 432,\r\n      height: 304,\r\n      antialias: false,\r\n      backgroundColor: 0x000000,\r\n      backgroundAlpha: 1,\r\n      forceCanvas: true,\r\n      preserveDrawingBuffer: true,\r\n    });\r\n\r\n    this.stage = new Container();\r\n    this.ticker = new Ticker();\r\n    this.ticker.minFPS = 1;\r\n    this.loader = new Loader();\r\n\r\n    // Append canvas to container\r\n    const container = document.querySelector('#game-canvas-container');\r\n    // @ts-ignore\r\n    container.innerHTML = '';\r\n    // @ts-ignore\r\n    container.appendChild(this.renderer.view);\r\n\r\n    // Setup assets\r\n    const TEXTURES = ASSETS_PATH.TEXTURES;\r\n    TEXTURES.WITH_COMPUTER = TEXTURES.WITH_FRIEND;\r\n\r\n    this.loader.add(ASSETS_PATH.SPRITE_SHEET);\r\n    for (const prop in ASSETS_PATH.SOUNDS) {\r\n      this.loader.add(ASSETS_PATH.SOUNDS[prop]);\r\n    }\r\n\r\n    this.setupLoaderProgressBar();\r\n    this.loader.load(() => this.setupGame(pack));\r\n  }\r\n\r\n  setupLoaderProgressBar() {\r\n    const progressBar = document.getElementById('progress-bar');\r\n    if (progressBar) {\r\n      this.loader.onProgress.add(() => {\r\n        // @ts-ignore\r\n        progressBar.style.width = `${this.loader.progress}%`;\r\n      });\r\n    }\r\n  }\r\n\r\n  setupGame(pack) {\r\n    this.updateStatus('게임 초기화 중...');\r\n\r\n    this.pikaVolley = new PikachuVolleyballReplay(\r\n      this.stage,\r\n      this.loader.resources,\r\n      pack.roomID,\r\n      pack.nicknames,\r\n      pack.partialPublicIPs,\r\n      pack.inputs,\r\n      pack.options,\r\n      pack.chats\r\n    );\r\n\r\n    // @ts-ignore\r\n    setGetSpeechBubbleNeeded(this.pikaVolley);\r\n\r\n    // Enable chat display\r\n    this.pikaVolley.willDisplayChat = true;\r\n    enableChat(true);\r\n\r\n    // Enable nickname and IP display by checking checkboxes programmatically\r\n    const showNicknamesCheckbox = document.getElementById('show-nicknames-checkbox');\r\n    const showIPsCheckbox = document.getElementById('show-ip-addresses-checkbox');\r\n    const showChatCheckbox = document.getElementById('show-chat-checkbox');\r\n    \r\n    if (showNicknamesCheckbox) {\r\n      // @ts-ignore\r\n      showNicknamesCheckbox.checked = true;\r\n      showNicknamesCheckbox.dispatchEvent(new Event('change'));\r\n    }\r\n    \r\n    if (showIPsCheckbox) {\r\n      // @ts-ignore\r\n      showIPsCheckbox.checked = true;\r\n      showIPsCheckbox.dispatchEvent(new Event('change'));\r\n    }\r\n    \r\n    if (showChatCheckbox) {\r\n      // @ts-ignore\r\n      showChatCheckbox.checked = true;\r\n      showChatCheckbox.dispatchEvent(new Event('change'));\r\n    }\r\n\r\n    // Disable BGM completely\r\n    this.pikaVolley.audio.turnBGMVolume(false);\r\n    if (this.pikaVolley.audio.sounds.bgm && this.pikaVolley.audio.sounds.bgm.center) {\r\n      this.pikaVolley.audio.sounds.bgm.center.stop();\r\n      // Override play method to prevent BGM\r\n      // @ts-ignore\r\n      this.pikaVolley.audio.sounds.bgm.center.play = function() {};\r\n      // @ts-ignore\r\n      this.pikaVolley.audio.sounds.bgm.center.isPlaying = false;\r\n    }\r\n\r\n    // Enable SFX (sound effects)\r\n    this.pikaVolley.audio.turnSFXVolume(true);\r\n\r\n    // Setup ticker for rendering\r\n    this.ticker.add(() => {\r\n      this.renderer.render(this.stage);\r\n      this.pikaVolley.gameLoop();\r\n    });\r\n\r\n    setTimeout(() => this.startRecording(), 100);\r\n  }\r\n\r\n  startRecording() {\r\n    this.updateStatus('녹화 준비 중...');\r\n    this.recordedChunks = [];\r\n    this.isRecording = true;\r\n\r\n    // @ts-ignore\r\n    const canvas = this.renderer.view;\r\n    \r\n    try {\r\n      // Create canvas stream at 30 FPS\r\n      const fps = 30;\r\n      // @ts-ignore\r\n      const canvasStream = canvas.captureStream(fps);\r\n\r\n      // Setup MediaRecorder\r\n      let mimeType = 'video/webm;codecs=vp9';\r\n      if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n        mimeType = 'video/webm;codecs=vp8';\r\n        if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n          mimeType = 'video/webm';\r\n        }\r\n      }\r\n\r\n      this.mediaRecorder = new MediaRecorder(canvasStream, {\r\n        mimeType: mimeType,\r\n        videoBitsPerSecond: 2500000, // 2.5 Mbps\r\n      });\r\n\r\n      this.mediaRecorder.ondataavailable = (e) => {\r\n        if (e.data.size > 0) {\r\n          this.recordedChunks.push(e.data);\r\n        }\r\n      };\r\n\r\n      this.mediaRecorder.onstop = () => {\r\n        this.saveVideoFile();\r\n      };\r\n\r\n      this.mediaRecorder.onerror = (e) => {\r\n        console.error('MediaRecorder 에러:', e);\r\n        this.updateStatus('녹화 중 에러 발생');\r\n        this.isRecording = false;\r\n        const recordBtn = document.getElementById('record-btn');\r\n        // @ts-ignore\r\n        if (recordBtn) recordBtn.disabled = false;\r\n      };\r\n\r\n      // Start recording\r\n      this.mediaRecorder.start(100); // Collect data every 100ms\r\n\r\n      // Start game ticker at 30 FPS\r\n      this.ticker.maxFPS = 30;\r\n      this.ticker.start();\r\n\r\n      this.updateStatus(`녹화 중... 0%`);\r\n      this.monitorProgress();\r\n\r\n    } catch (err) {\r\n      console.error('녹화 시작 실패:', err);\r\n      // @ts-ignore\r\n      this.updateStatus('녹화 시작 실패: ' + err.message);\r\n      this.isRecording = false;\r\n      const recordBtn = document.getElementById('record-btn');\r\n      // @ts-ignore\r\n      if (recordBtn) recordBtn.disabled = false;\r\n    }\r\n  }\r\n\r\n  monitorProgress() {\r\n    const totalFrames = this.pikaVolley.inputs.length;\r\n    const progressBar = document.getElementById('progress-bar');\r\n    \r\n    const checkInterval = setInterval(() => {\r\n      if (!this.pikaVolley || !this.isRecording) {\r\n        clearInterval(checkInterval);\r\n        return;\r\n      }\r\n\r\n      const currentFrame = this.pikaVolley.replayFrameCounter;\r\n      const progress = Math.floor((currentFrame / totalFrames) * 100);\r\n      \r\n      this.updateStatus(`녹화 중... ${progress}%`);\r\n      if (progressBar) {\r\n        // @ts-ignore\r\n        progressBar.style.width = `${progress}%`;\r\n      }\r\n\r\n      if (currentFrame >= totalFrames) {\r\n        clearInterval(checkInterval);\r\n        this.stopRecording();\r\n      }\r\n    }, 500);\r\n  }\r\n\r\n  stopRecording() {\r\n    if (!this.isRecording) return;\r\n\r\n    this.updateStatus('녹화 완료, 파일 저장 중...');\r\n    this.ticker.stop();\r\n    \r\n    if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {\r\n      this.mediaRecorder.stop();\r\n    } else {\r\n      this.saveVideoFile();\r\n    }\r\n  }\r\n\r\n  saveVideoFile() {\r\n    if (this.recordedChunks.length === 0) {\r\n      this.updateStatus('녹화된 데이터가 없습니다');\r\n      this.isRecording = false;\r\n      const recordBtn = document.getElementById('record-btn');\r\n      // @ts-ignore\r\n      if (recordBtn) recordBtn.disabled = false;\r\n      return;\r\n    }\r\n\r\n    const blob = new Blob(this.recordedChunks, { type: 'video/webm' });\r\n    const url = URL.createObjectURL(blob);\r\n    \r\n    const d = new Date();\r\n    const dateStr = `${d.getFullYear()}${('0' + (d.getMonth() + 1)).slice(-2)}${('0' + d.getDate()).slice(-2)}`;\r\n    const timeStr = `${('0' + d.getHours()).slice(-2)}${('0' + d.getMinutes()).slice(-2)}`;\r\n    \r\n    let filename = `${dateStr}_${timeStr}_pikavolley_replay.webm`;\r\n    \r\n    const pack = this.currentPack;\r\n    if (pack && pack.nicknames && pack.nicknames.length === 2) {\r\n      const nick1 = pack.nicknames[0].replace(/[/\\\\?%*:|\"<>]/g, '_');\r\n      const nick2 = pack.nicknames[1].replace(/[/\\\\?%*:|\"<>]/g, '_');\r\n      filename = `${dateStr}_${timeStr}_${nick1}_vs_${nick2}.webm`;\r\n    }\r\n\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = filename;\r\n    a.style.display = 'none';\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    \r\n    setTimeout(() => {\r\n      document.body.removeChild(a);\r\n      URL.revokeObjectURL(url);\r\n    }, 100);\r\n\r\n    this.updateStatus('완료! 다른 리플레이를 변환하려면 버튼을 다시 클릭하세요.');\r\n    this.isRecording = false;\r\n    const recordBtn = document.getElementById('record-btn');\r\n    // @ts-ignore\r\n    if (recordBtn) recordBtn.disabled = false;\r\n    this.recordedChunks = [];\r\n    \r\n    // Hide loading overlay\r\n    const loadingOverlay = document.getElementById('loading-overlay');\r\n    // @ts-ignore\r\n    if (loadingOverlay) loadingOverlay.classList.add('hidden');\r\n  }\r\n}\r\n\r\n// Adjust assets path\r\nfunction adjustAssetsPath() {\r\n  ASSETS_PATH.SPRITE_SHEET = '../' + ASSETS_PATH.SPRITE_SHEET;\r\n  for (const prop in ASSETS_PATH.SOUNDS) {\r\n    ASSETS_PATH.SOUNDS[prop] = '../' + ASSETS_PATH.SOUNDS[prop];\r\n  }\r\n}\r\n\r\nadjustAssetsPath();\r\n\r\n// Initialize converter\r\nconst converter = new ReplayToVideoConverter();\r\nconst recordBtn = document.getElementById('record-btn');\r\nif (recordBtn) {\r\n  recordBtn.addEventListener('click', () => converter.handleRecordButtonClick());\r\n}\r\n\r\n// Setup UI event listeners for nickname/IP/chat display\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  const showNicknamesCheckbox = document.getElementById('show-nicknames-checkbox');\r\n  const showIPsCheckbox = document.getElementById('show-ip-addresses-checkbox');\r\n  const showChatCheckbox = document.getElementById('show-chat-checkbox');\r\n  \r\n  const player1NicknameElem = document.getElementById('player1-nickname');\r\n  const player2NicknameElem = document.getElementById('player2-nickname');\r\n  const player1IPElem = document.getElementById('player1-partial-ip');\r\n  const player2IPElem = document.getElementById('player2-partial-ip');\r\n\r\n  if (showNicknamesCheckbox) {\r\n    showNicknamesCheckbox.addEventListener('change', () => {\r\n      // @ts-ignore\r\n      if (showNicknamesCheckbox.checked) {\r\n        if (player1NicknameElem) player1NicknameElem.classList.remove('hidden');\r\n        if (player2NicknameElem) player2NicknameElem.classList.remove('hidden');\r\n      } else {\r\n        if (player1NicknameElem) player1NicknameElem.classList.add('hidden');\r\n        if (player2NicknameElem) player2NicknameElem.classList.add('hidden');\r\n      }\r\n    });\r\n  }\r\n\r\n  if (showIPsCheckbox) {\r\n    showIPsCheckbox.addEventListener('change', () => {\r\n      // @ts-ignore\r\n      if (showIPsCheckbox.checked) {\r\n        if (player1IPElem) player1IPElem.classList.remove('hidden');\r\n        if (player2IPElem) player2IPElem.classList.remove('hidden');\r\n      } else {\r\n        if (player1IPElem) player1IPElem.classList.add('hidden');\r\n        if (player2IPElem) player2IPElem.classList.add('hidden');\r\n      }\r\n    });\r\n  }\r\n\r\n  if (showChatCheckbox) {\r\n    showChatCheckbox.addEventListener('change', () => {\r\n      // @ts-ignore\r\n      if (showChatCheckbox.checked) {\r\n        enableChat(true);\r\n      } else {\r\n        enableChat(false);\r\n      }\r\n    });\r\n  }\r\n});\r\n"],"names":["SPRITE_SHEET","prop","SOUNDS","adjustAssetsPath","converter","constructor","registerPlugin","RESOLUTION","SCALE_MODE","NEAREST","ROUND_PIXELS","this","renderer","stage","loader","ticker","pikaVolley","currentPack","mediaRecorder","recordedChunks","isRecording","updateStatus","message","statusEl","document","getElementById","textContent","console","log","handleRecordButtonClick","fileInput","createElement","type","accept","onchange","e","file","target","files","loadReplayFile","click","recordBtn","disabled","loadingOverlay","classList","remove","reader","FileReader","onload","event","pack","JSON","parse","result","hash","Error","initializeRenderer","err","error","add","onerror","readAsText","width","height","antialias","backgroundColor","backgroundAlpha","forceCanvas","preserveDrawingBuffer","minFPS","container","querySelector","innerHTML","appendChild","view","TEXTURES","WITH_COMPUTER","WITH_FRIEND","setupLoaderProgressBar","load","setupGame","progressBar","onProgress","style","progress","resources","roomID","nicknames","partialPublicIPs","inputs","options","chats","willDisplayChat","showNicknamesCheckbox","showIPsCheckbox","showChatCheckbox","checked","dispatchEvent","Event","audio","turnBGMVolume","sounds","bgm","center","stop","play","isPlaying","turnSFXVolume","render","gameLoop","setTimeout","startRecording","canvas","fps","canvasStream","captureStream","mimeType","MediaRecorder","isTypeSupported","videoBitsPerSecond","ondataavailable","data","size","push","onstop","saveVideoFile","start","maxFPS","monitorProgress","totalFrames","length","checkInterval","setInterval","clearInterval","currentFrame","replayFrameCounter","Math","floor","stopRecording","state","blob","Blob","url","URL","createObjectURL","d","Date","dateStr","getFullYear","getMonth","slice","getDate","timeStr","getHours","getMinutes","filename","replace","a","href","download","display","body","removeChild","revokeObjectURL","addEventListener","player1NicknameElem","player2NicknameElem","player1IPElem","player2IPElem"],"sourceRoot":""}