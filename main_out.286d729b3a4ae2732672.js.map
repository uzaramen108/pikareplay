{"version":3,"file":"main_out.286d729b3a4ae2732672.js","mappings":"2JAGA,MAAMA,EAAYC,SAASC,eAAe,cACpCC,EAAYF,SAASC,eAAe,UAC1C,IAAIE,EACAC,EAAS,GAGTL,EACAA,EAAUM,iBAAiB,SAAS,KAEhC,MAAMC,EAAQN,SAASO,cAAc,SACrCD,EAAME,KAAO,OACbF,EAAMG,OAAS,OAGfH,EAAMI,SAAYC,IAEd,MAAMC,EAAOD,EAAME,OAAOC,MAAM,GAC3BF,IAELV,EAAUa,UAAY,sBAGtB,IAAaC,SAASJ,GAAK,EAI/BN,EAAMW,OAAO,IAGjBC,QAAQC,MAAM,kDAIlBC,OAAOf,iBAAiB,oBAAoB,KAExC,MAAMgB,EAASrB,SAASsB,cAAc,iCAEtC,IAAKD,EAED,YADAnB,EAAUa,UAAY,0BAK1BX,EAAS,GAIT,MAAMmB,EAASF,EAAOG,cAAc,IAGpC,IAAIC,EAAU,CAAEC,SAAU,0BACrBC,cAAcC,gBAAgBH,EAAQC,YACvCD,EAAU,CAAEC,SAAU,eAG1BvB,EAAgB,IAAIwB,cAAcJ,EAAQE,GAE1CtB,EAAc0B,gBAAmBC,IACzBA,EAAEC,KAAKC,KAAO,GACd5B,EAAO6B,KAAKH,EAAEC,KAClB,EAGJ5B,EAAc+B,OAAS,KACnBhC,EAAUa,UAAY,yBACtB,MAAMoB,EAAO,IAAIC,KAAKhC,EAAQ,CAAEI,KAAM,eAChC6B,EAAMC,IAAIC,gBAAgBJ,GAC1BK,EAAIxC,SAASO,cAAc,KACjCiC,EAAEC,MAAMC,QAAU,OAClBF,EAAEG,KAAON,EAETG,EAAEI,SAAW,kBAAkBC,KAAKC,aACpC9C,SAAS+C,KAAKC,YAAYR,GAC1BA,EAAEvB,QAGFgC,YAAW,KACPjD,SAAS+C,KAAKG,YAAYV,GAC1BpB,OAAOkB,IAAIa,gBAAgBd,EAAI,GAChC,IAAI,EAGXlC,EAAciD,QACdlD,EAAUa,UAAY,4BACtBG,QAAQmC,IAAI,QAAQ,IAIxBjC,OAAOf,iBAAiB,sBAAsB,KACtCF,GAAyC,cAAxBA,EAAcmD,QAC/BnD,EAAcoD,OACdrC,QAAQmC,IAAI,SAChB,G","sources":["webpack://pikachu-volleyball-p2p-online/./src/resources/js/replay/main_out.js"],"sourcesContent":["import { replayPlayer } from './replay_player.js';\r\n\r\n// HTML의 버튼 ID와 상태 표시줄 ID를 가져옵니다.\r\nconst uploadBtn = document.getElementById('record-btn'); \r\nconst statusDiv = document.getElementById('status');\r\nlet mediaRecorder;\r\nlet chunks = [];\r\n\r\n// 1. 버튼 클릭 시 파일 선택창을 띄우는 로직\r\nif (uploadBtn) {\r\n    uploadBtn.addEventListener('click', () => {\r\n        // 화면에 보이지 않는 input 요소를 동적으로 생성\r\n        const input = document.createElement('input');\r\n        input.type = 'file';\r\n        input.accept = '.txt'; // txt 파일만 선택 가능하도록 설정\r\n\r\n        // 파일이 선택되었을 때 실행될 함수 (change 이벤트)\r\n        input.onchange = (event) => {\r\n            // @ts-ignore\r\n            const file = event.target.files[0];\r\n            if (!file) return; // 취소했을 경우 중단\r\n\r\n            statusDiv.innerText = \"리플레이 파일을 분석 중입니다...\";\r\n            \r\n            // replay_player.js의 readFile 함수 호출 -> 로딩 시작\r\n            replayPlayer.readFile(file);\r\n        };\r\n\r\n        // 가상의 input을 클릭하여 파일 탐색기 열기\r\n        input.click();\r\n    });\r\n} else {\r\n    console.error(\"오류: HTML에서 'record-btn' 아이디를 가진 버튼을 찾을 수 없습니다.\");\r\n}\r\n\r\n// 2. 로딩 완료 신호를 받으면 녹화 설정 및 시작 (기존 코드 동일)\r\nwindow.addEventListener('pikaReplayLoaded', () => {\r\n    // 주의: PixiJS가 캔버스를 생성한 후에 요소를 찾아야 함\r\n    const canvas = document.querySelector('#game-canvas-container canvas');\r\n    \r\n    if (!canvas) {\r\n        statusDiv.innerText = \"오류: 게임 캔버스를 찾을 수 없습니다.\";\r\n        return;\r\n    }\r\n\r\n    // 녹화 데이터 초기화\r\n    chunks = [];\r\n\r\n    // 60 FPS로 스트림 캡처\r\n    // @ts-ignore\r\n    const stream = canvas.captureStream(60); \r\n    \r\n    // 코덱 설정 (브라우저 호환성에 따라 vp9 또는 vp8 사용)\r\n    let options = { mimeType: 'video/webm; codecs=vp9' };\r\n    if (!MediaRecorder.isTypeSupported(options.mimeType)) {\r\n        options = { mimeType: 'video/webm' }; // 기본 설정으로 폴백\r\n    }\r\n\r\n    mediaRecorder = new MediaRecorder(stream, options);\r\n    \r\n    mediaRecorder.ondataavailable = (e) => {\r\n        if (e.data.size > 0) {\r\n            chunks.push(e.data);\r\n        }\r\n    };\r\n    \r\n    mediaRecorder.onstop = () => {\r\n        statusDiv.innerText = \"변환 완료! 파일 다운로드를 시작합니다.\";\r\n        const blob = new Blob(chunks, { type: 'video/webm' });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.style.display = 'none';\r\n        a.href = url;\r\n        // 파일명에 타임스탬프 추가\r\n        a.download = `pikachu_replay_${Date.now()}.webm`;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        \r\n        // 메모리 해제\r\n        setTimeout(() => {\r\n            document.body.removeChild(a);\r\n            window.URL.revokeObjectURL(url);\r\n        }, 100);\r\n    };\r\n\r\n    mediaRecorder.start();\r\n    statusDiv.innerText = \"녹화 중... (다른 탭으로 이동하지 마세요)\";\r\n    console.log(\"녹화 시작\");\r\n});\r\n\r\n// 3. 게임 종료 신호를 받으면 녹화 중지 (기존 코드 동일)\r\nwindow.addEventListener('pikaReplayFinished', () => {\r\n    if (mediaRecorder && mediaRecorder.state === 'recording') {\r\n        mediaRecorder.stop();\r\n        console.log(\"녹화 완료\");\r\n    }\r\n});"],"names":["uploadBtn","document","getElementById","statusDiv","mediaRecorder","chunks","addEventListener","input","createElement","type","accept","onchange","event","file","target","files","innerText","readFile","click","console","error","window","canvas","querySelector","stream","captureStream","options","mimeType","MediaRecorder","isTypeSupported","ondataavailable","e","data","size","push","onstop","blob","Blob","url","URL","createObjectURL","a","style","display","href","download","Date","now","body","appendChild","setTimeout","removeChild","revokeObjectURL","start","log","state","stop"],"sourceRoot":""}